{% load static %}
{% load get_menu_json %}
{% get_user_menu as USER_MENU %}
{% get_brand_navbar_menu as BRAND_NAVBAR_MENU %}
{% block extra_style %}
{% endblock %}

<nav id="gn-brand-navbar" class="gn-brand-navbar ms-main-colors _padding-md ms-flex-box _flex">
    <div class="ms-flex-fill ms-flex-box _flex _flex-gap-sm _flex-center-v">
        {% block logo %}
        <a href="/">
            {% if custom_theme.logo and custom_theme.logo.url %}
                <img src="{{ custom_theme.logo.url }}">
            {% else %}
                <img src="{% block logo_src %}/static/mapstore/img/geonode-logo.svg{% endblock %}">
            {% endif %}
        </a>
        {% endblock %}
        <ul class="ms-flex-fill ms-flex-box _flex _flex-gap-sm _flex-center-v">
            {% for menu_item in BRAND_NAVBAR_MENU %}
                {% include './menu_item.html' with menu_item=menu_item %}
            {% endfor %}
        </ul>
        {% block right_menu %}
            {% block search_bar %}
                {% include './search_bar.html' with search_bar_id='gn-search-bar' %}
            {% endblock %}
            {% block language_selector %}
                {% include './language_selector.html' with align_right=True %}
            {% endblock %}
            <ul class="ms-flex-box _flex _flex-gap-sm _flex-center-v">
                {% for menu_item in USER_MENU %}
                    {% include './menu_item.html' with menu_item=menu_item align_right=True %}
                {% endfor %}
            </ul>
        {% endblock %}
    </div>
</nav>
<div id="gn-brand-navbar-bottom">
    {% block bottom_menu %}
        {% include './search_bar.html' with search_bar_id='gn-search-bar-bottom' %}
    {% endblock %}
</div>
{% block extra_script %}
    <script type="text/javascript">
        (function() {
            function manageUrlChange() {
                var signInElement = document.getElementById("sign-in");
                if (signInElement){
                    if (window.location.pathname === '/account/login/'){
                        signInElement.setAttribute("href", window.location.href)
                    }
                    else {
                        var href = signInElement.getAttribute("href").split("next=")[0];
                        var url_parts = window.location.href.split(window.location.pathname);
                        var path_name = encodeURIComponent(window.location.pathname + url_parts[url_parts.length-1]);
                        signInElement.setAttribute("href", href.concat("next=".concat(path_name)));
                    }
                }
            }
            window.addEventListener('DOMContentLoaded', manageUrlChange);
            window.addEventListener('hashchange', manageUrlChange, false);
        })();
    </script>
{% endblock extra_script %}