(self.webpackChunkgeonode_mapstore_client=self.webpackChunkgeonode_mapstore_client||[]).push([[2933],{4206:(e,t,n)=>{"use strict";n.d(t,{hZ:()=>r,pb:()=>o,kD:()=>i,DI:()=>a,IC:()=>c,Vw:()=>s,KD:()=>p,uj:()=>d,lo:()=>f,Yf:()=>y,fo:()=>m,PY:()=>b,bp:()=>v});var r="CHANGE_DRAWING_STATUS",o="DRAW:END_DRAWING",i="DRAW:SET_CURRENT_STYLE",a="DRAW:GEOMETRY_CHANGED",c="DRAW:DRAW_SUPPORT_STOPPED",l="DRAW:FEATURES_SELECTED",u="DRAW:DRAWING_FEATURES";function s(e,t,n,r,o){return{type:a,features:e,owner:t,enableEdit:n,textChanged:r,circleChanged:o}}function p(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return{type:l,features:e}}function d(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return{type:u,features:e}}function f(){return{type:c}}function y(e,t,n,o,i,a){return{type:r,status:e,method:t,owner:n,features:o,options:i,style:a}}function m(e,t){return{type:o,geometry:e,owner:t}}function b(e){return{type:i,currentStyle:e}}var v=function(e){return y("clean","",e,[],{})}},62770:(e,t,n)=>{"use strict";n.d(t,{Z:()=>w});var r=n(24852),o=n.n(r),i=n(45697),a=n.n(i),c=n(41609),l=n.n(c),u=n(81763),s=n.n(u),p=n(90079);function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function b(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?v(e):t}function v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var O=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(c,e);var t,n,r,i,a=(r=c,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=g(r);if(i){var n=g(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return b(this,e)});function c(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),h(v(t=a.call(this,e)),"state",{containerWidth:0,legendContainerStyle:{overflowX:"auto"}}),h(v(t),"canShow",(function(e){return e.visibility||!t.props.showOnlyIfVisible})),h(v(t),"useLegendOptions",(function(){return!l()(t.props.node.legendOptions)&&s()(t.props.node.legendOptions.legendHeight)&&s()(t.props.node.legendOptions.legendWidth)})),h(v(t),"setOverflow",(function(){return t.useLegendOptions()&&t.props.node.legendOptions.legendWidth>t.state.containerWidth})),t.containerRef=o().createRef(),t}return t=c,(n=[{key:"componentDidMount",value:function(){var e=this.containerRef.current&&this.containerRef.current.clientWidth;this.setState(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach((function(t){h(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({containerWidth:e},this.state))}},{key:"render",value:function(){var e=this.props.node||{},t=this.canShow(e)&&"wms"===e.type&&"background"!==e.group,n=t&&this.useLegendOptions();return t?o().createElement("div",{style:this.setOverflow()?this.state.legendContainerStyle:this.props.legendContainerStyle,ref:this.containerRef},o().createElement(p.Z,{style:this.setOverflow()?{}:this.props.legendStyle,layer:e,currentZoomLvl:this.props.currentZoomLvl,scales:this.props.scales,legendHeight:n&&this.props.node.legendOptions&&this.props.node.legendOptions.legendHeight||this.props.legendHeight||void 0,legendWidth:n&&this.props.node.legendOptions&&this.props.node.legendOptions.legendWidth||this.props.legendWidth||void 0,legendOptions:this.props.WMSLegendOptions,scaleDependent:this.props.scaleDependent,language:this.props.language})):null}}])&&y(t.prototype,n),c}(o().Component);h(O,"propTypes",{node:a().object,legendContainerStyle:a().object,legendStyle:a().object,showOnlyIfVisible:a().bool,currentZoomLvl:a().number,scales:a().array,WMSLegendOptions:a().string,scaleDependent:a().bool,language:a().string,legendWidth:a().number,legendHeight:a().number}),h(O,"defaultProps",{legendContainerStyle:{},showOnlyIfVisible:!1,scaleDependent:!0});const w=O},90079:(e,t,n)=>{"use strict";n.d(t,{Z:()=>S});var r=n(72500),o=n.n(r),i=n(1469),a=n.n(i),c=n(27418),l=n.n(c),u=n(45697),s=n.n(u),p=n(24852),d=n.n(p),f=n(33044),y=n(5346);function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e,t){return!t||"object"!==m(t)&&"function"!=typeof t?O(e):t}function O(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var P=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(u,e);var t,n,r,i,c=(r=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=w(r);if(i){var n=w(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return h(this,e)});function u(){var e;b(this,u);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return E(O(e=c.call.apply(c,[this].concat(n))),"state",{error:!1}),E(O(e),"onImgError",(function(){e.setState((function(){return{error:!0}}))})),E(O(e),"getUrl",(function(e,t){if(e.layer&&"wms"===e.layer.type&&e.layer.url){var n=e.layer,r=t||a()(n.url)&&Math.floor(Math.random()*n.url.length),i=a()(n.url)?n.url[r]:n.url.replace(/[?].*$/g,""),c=o().parse(i),u=(0,f.clearNilValuesForParams)(n.params),s=l()({},{service:"WMS",request:"GetLegendGraphic",format:"image/png",height:e.legendHeight,width:e.legendWidth,layer:n.name,style:n.style||null,version:n.version||"1.3.0",SLD_VERSION:"1.1.0",LEGEND_OPTIONS:e.legendOptions},n.legendParams||{},e.language&&n.localizedLayerStyles?{LANGUAGE:e.language}:{},(0,f.addAuthenticationToSLD)(u||{},e.layer),u&&u.SLD_BODY?{SLD_BODY:u.SLD_BODY}:{},e.scales&&e.currentZoomLvl&&e.scaleDependent?{SCALE:Math.round(e.scales[e.currentZoomLvl])}:{});return(0,f.addAuthenticationParameter)(i,s),o().format({host:c.host,protocol:c.protocol,pathname:c.pathname,query:s})}return""})),E(O(e),"validateImg",(function(t){t.height<=1&&t.width<=2&&e.onImgError()})),e}return t=u,(n=[{key:"UNSAFE_componentWillReceiveProps",value:function(e){this.state.error&&this.getUrl(e,0)!==this.getUrl(this.props,0)&&this.setState((function(){return{error:!1}}))}},{key:"render",value:function(){var e=this;return!this.state.error&&this.props.layer&&"wms"===this.props.layer.type&&this.props.layer.url?d().createElement("img",{onError:this.onImgError,onLoad:function(t){return e.validateImg(t.target)},src:this.getUrl(this.props),style:this.props.style}):d().createElement(y.Z,{msgId:"layerProperties.legenderror"})}}])&&v(t.prototype,n),u}(d().Component);E(P,"propTypes",{layer:s().object,legendHeight:s().number,legendWidth:s().number,legendOptions:s().string,style:s().object,currentZoomLvl:s().number,scales:s().array,scaleDependent:s().bool,language:s().string}),E(P,"defaultProps",{legendHeight:12,legendWidth:12,legendOptions:"forceLabels:on",style:{maxWidth:"100%"},scaleDependent:!0});const S=P},16788:(e,t,n)=>{"use strict";n.d(t,{Z:()=>E});var r=n(24852),o=n.n(r),i=n(45697),a=n.n(i),c=n(1206),l=n.n(c),u=n(96797),s=n.n(u),p=n(67076);function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach((function(t){O(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var w=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(c,e);var t,n,r,i,a=(r=c,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=h(r);if(i){var n=h(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return g(this,e)});function c(){return m(this,c),a.apply(this,arguments)}return t=c,(n=[{key:"componentDidMount",value:function(){s()(this._node)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){e.src!==this.props.src&&s()(this._node)}},{key:"render",value:function(){var e=this,t=this.props,n=t.id,r=t.src,i=t.fit,a=void 0===i?"cover":i,c=t.enableFullscreen,u=void 0===c||c,s=t.fullscreen,p=t.onClick,d=t.description,f=t.showCaption,m=t.caption,b=void 0===m?d:m,v=t.credits,g=t.loaderStyle,h=this.props.loaderComponent,O=this.props.errorComponent;return o().createElement("div",{id:n,className:"ms-media ms-media-image"},r&&"error"!==this.props.status&&o().createElement("img",{ref:function(t){e._node=t},src:r,onLoad:function(){return e.props.onChangeStatus("loaded")},onError:function(){return e.props.onChangeStatus("error")},onClick:u?function(){return p(!0)}:void 0,style:{objectFit:a,fontFamily:"object-fit: ".concat(a),cursor:u?"pointer":"default"}}),r&&!this.props.status&&h&&o().createElement(h,{style:y({},g)}),"error"===this.props.status&&O&&o().createElement(O,null),v&&o().createElement("div",{className:"ms-media-credits"},o().createElement("small",null,v)),f&&b&&o().createElement("div",{className:"ms-media-caption"},o().createElement("small",null,b)),u&&s?o().createElement(l(),{mainSrc:r,onCloseRequest:function(){return p(!1)}}):null)}}])&&b(t.prototype,n),c}(r.Component);O(w,"propTypes",{src:a().string,id:a().string,fit:a().string,description:a().string,showCaption:a().bool,credits:a().string,altText:a().string,enableFullscreen:a().bool,fullscreen:a().bool,onClick:a().func,onChangeStatus:a().func,status:a().string,loaderComponent:a().element,errorComponent:a().element,caption:a().string,loaderStyle:a().object});const E=(0,p.compose)((0,p.withState)("fullscreen","onClick",!1),(0,p.withState)("status","onChangeStatus",""))(w)},7875:(e,t,n)=>{"use strict";n.d(t,{Z:()=>fe});var r=n(24852),o=n.n(r),i=n(67076),a=n(57588),c=n(71703),l=n(19180),u=n(91812),s=n(37981),p=n(69705),d=n(4206),f=["DrawSupport","tools"];function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){b(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function v(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var g=(0,c.connect)((function(e){return e.draw||{}}),{onChangeDrawingStatus:d.Yf,onEndDrawing:d.fo,onGeometryChanged:d.Vw,onDrawStopped:d.lo,setCurrentStyle:d.PY}),h=n(34990),O=n(57068),w=n(1979),E=n(23570),P=n.n(E),S=n(55745),j=n.n(S),C=n(65442),T=n.n(C),I=n(47359),k=n(13311),D=n.n(k),A=n(94184),M=n.n(A),x=n(66113);function R(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return N(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?N(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function N(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}const L=(0,c.connect)((function(e){return{sections:(0,x.NR)(e)}}),{onClickMarker:h.Vx})((function(e){var t=e.responses,n=e.layerInfo,i=e.sections,a=e.onClickMarker,c=function(e,t){var n=D()(t,(function(t){var n=t.contents;return D()(n,{id:e})}));if(n){var r=D()(n.contents,{id:e})||{},o=r.id,i=r.thumbnail,a=(i=void 0===i?{}:i).title,c=void 0===a?"":a;return{sectionId:n.id,contentId:o,title:c}}return n}(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=(D()(e,(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.queryParams,r=(n=void 0===n?{}:n).request,o=e.layerMetadata,i=(o=void 0===o?{}:o).title;return!r&&i.toLowerCase()===t}))||{}).response,r=(n=void 0===n?{}:n).features,o=R(r=void 0===r?[]:r,1)[0];return void 0===o?{}:o}(t,n).contentRefId,i)||{},l=c.title,u=c.contentId,s=c.sectionId;return(0,r.useEffect)((function(){a('sections[{"id":"'.concat(s,'"}].contents[{"id":"').concat(u,'"}].carouselToggle'),!0)}),[s]),o().createElement("div",{className:M()("ms-geostory-carousel-viewer",{"ms-geostory-carousel-viewer-info":!!l,"ms-geostory-carousel-viewer-alert-info alert-info":!l})},l||"No title")}));var _=n(92579),Z=n(18446),W=n.n(Z),F=n(24262),U=n(7412),B=n(49977),V=n(49243),H=["rawPos"],G=["PopupSupport","tools"];function z(){return(z=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function q(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function K(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function $(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$(Object(n),!0).forEach((function(t){Q(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var X=(0,i.mapPropsStream)((function(e){var t=(0,i.createEventHandler)(),n=t.stream,r=t.handler;return n.withLatestFrom(e.map((function(e){return{map:e.map,layers:e.layers,options:e.options}})).distinctUntilChanged((function(e,t){return W()(e,t)}))).switchMap((function(e){var t,n,r=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(t,n)||function(e,t){if(e){if("string"==typeof e)return K(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?K(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],i=o.point,a=o.layerInfo,c=r[1],l=c.map,u=c.layers,s=void 0===u?[]:u,p=c.options,d=(p=void 0===p?{}:p).mapOptions,f=(d=void 0===d?{}:d).mapInfoFormat,y=void 0===f?(0,w.GA)():f,m=s.filter((function(e){return(0,F.T4)(e,l.resolution)&&(0,U.y_)(e)}));a===_.e1&&(m=m.filter((function(e){return e.id===a})));var b=["SLD_BODY"],v=["buffer","cql_filter","filter","propertyName"];return 0===m.length?B.Observable.of({requests:[{}],responses:[{response:{features:[]}}],validResponses:[]}):B.Observable.from(m).mergeMap((function(e){var t=(0,U.Fm)(e,{format:y,map:l,point:i,currentLocale:"en-US"}),n=t.url,r=t.request,o=t.metadata,a=n,c=r,u=Y(Y({},(0,U.K7)(e,v,b)),c),s=P()();return(n?(0,V.y)(a,u,e).map((function(e){return e.data.exceptions?{reqId:s,exceptions:e.data.exceptions,queryParams:c,layerMetadata:o}:{data:e.data,reqId:s,queryParams:c,layerMetadata:Y(Y({},o),{},{features:e.features,featuresCrs:e.featuresCrs})}})):B.Observable.of(function(e,t,n){var r={type:"Feature",properties:{},geometry:{type:"Point",coordinates:[t.lng,t.lat]}},o=n&&n.units;switch(o){case"m":o="meters";break;case"deg":o="degrees";break;case"mi":o="miles";break;default:o="meters"}var i=n&&n.resolution||1,a=j()(r,(n.buffer||1)*i,o);return{data:{crs:null,features:(e.features||[]).filter((function(e){try{return"FeatureCollection"===e.type&&e.features&&e.features.length?e.features.reduce((function(e,t){var r=t.properties.useGeodesicLines&&t.properties.geometryGeodesic?Y(Y({},t),{},{geometry:t.properties.geometryGeodesic}):t;return e||T()(a,i&&n.buffer&&o?j()(r,1,"meters"):r)}),!1):T()(a,i&&n.buffer&&o?j()(e,1,"meters"):e)}catch(e){return!1}})),totalFeatures:"unknown",type:"FeatureCollection"},queryParams:t,layerMetadata:n}}(e,r,o))).catch((function(e){return{error:e.data||e.statusText||e.status,reqId:s,queryParams:c,layerMetadata:o}})).startWith({start:!0,reqId:s,request:u})})).scan((function(e,t){var n=e.requests,r=e.responses,o=e.validResponses;if(t.start){var i=t.reqId,c=t.request;return{requests:n.concat({reqId:i,request:c}),responses:r,validResponses:o}}var l=t.data,u=t.queryParams,s=t.layerMetadata,p=(0,U.Te)(y),d=r.concat({response:l,queryParams:u,layerMetadata:s});return{requests:n,validResponses:p.getValidResponses(d),responses:d,layerInfo:a}}),{requests:[],responses:[],validResponses:[],layerInfo:a})})).startWith({requests:[],responses:[]}).combineLatest(e,(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Y(Y({},t),{},{mapInfo:e,getFeatureInfoHandler:r})}))}));const J=(0,i.branch)((function(e){var t=e.map,n=(t=void 0===t?{}:t).mapInfoControl,r=void 0!==n&&n,o=t.mapDrawControl;return r||!(void 0!==o&&o)}),(0,i.compose)(X,(0,i.withStateHandlers)({popups:[]},{onClick:function(e,t){var n=t.getFeatureInfoHandler,r=void 0===n?function(){}:n,o=t.map,i=(o=void 0===o?{}:o).mapInfoControl;return function(e,t){var n=e.rawPos,o=void 0===n?[]:n,a=q(e,H);return t===_.e1||i?(r({point:a,layerInfo:t}),{popups:[{position:{coordinates:o},id:P()()}]}):{popups:[]}}},onPopupClose:function(){return function(){return{popups:[]}}}}),(0,i.withPropsOnChange)(["mapInfo","popups"],(function(e){var t,n=e.mapInfo,r=e.popups,i=e.options,a=(i=void 0===i?{}:i).mapOptions,c=(a=void 0===a?{}:a).mapInfoFormat,l=void 0===c?(0,w.GA)():c,u=e.map,s=void 0===u?{}:u,p=n.responses,d=n.requests,f=n.validResponses,y=n.layerInfo;t=s.hasOwnProperty("mapDrawControl")&&y===_.e1?o().createElement(L,{layerInfo:y,responses:f}):o().createElement(I.Z,{renderEmpty:!0,responses:p,requests:d,validResponses:f,format:l,showEmptyMessageGFI:!0,missingResponses:(d||[]).length-(p||[]).length});var m=function(){return t};return{popups:r.map((function(e){return Y(Y({},e),{},{component:m})}))}})),(0,i.withPropsOnChange)(["plugins","onPopupClose","popups"],(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.plugins,n=e.popups,r=e.onPopupClose,i=t.PopupSupport,a=t.tools,c=void 0===a?{}:a,l=q(t,G);if(!i)return{};var u=function(e){return o().createElement(i,z({},e,{popups:n,onPopupClose:r}))};return{plugins:Y(Y({},l),{},{tools:Y(Y({},c),{},{popup:u})})}}))));var ee=n(61928),te=(0,c.connect)((function(e){return e.draw||{}}),{onChangeDrawingStatus:d.Yf,onEndDrawing:d.fo,onSelectFeatures:d.KD,onDrawingFeatures:h.uj,onGeometryChanged:d.Vw,onDrawStopped:d.lo,setCurrentStyle:d.PY});const ne=(0,i.compose)(p.Z,(0,u.Z)(0),l.Z,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g;return(0,i.withPropsOnChange)(["plugins"],(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.plugins,r=n.DrawSupport,o=n.tools,i=void 0===o?{}:o,a=v(n,f);if(!r)return{};var c=e(r);return{plugins:m(m({},a),{},{tools:m(m({},i),{},{draw:c})})}}))}(te),J,w.yM,s.Z,O.e)(ee.Z);var re=n(27693),oe=n(99534),ie=n(15135),ae=n(80628),ce=n(38560),le=["layers","mapOptions","description"];function ue(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function se(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ue(Object(n),!0).forEach((function(t){pe(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ue(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function pe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var de=(0,ie.Z)(ce.Z);const fe=(0,i.compose)((0,i.withState)("active","setActive",!1),ae.Z)((function(e){var t=e.id,n=e.map,r=void 0===n?{layers:[re.D]}:n,i=e.fit,c=e.editMap,l=void 0!==c&&c,u=e.onMapViewChanges,s=e.eventHandlers,p=e.expandable,d=void 0!==p&&p,f=e.active,y=e.setActive,m=e.width,b=e.height,v=e.size,g=e.showCaption,h=e.caption,O=e.mapType,w=void 0===O?"leaflet":O,E=e.onMapTypeLoaded,P=r.data?r.data:r,S=P.layers,j=void 0===S?[]:S,C=P.mapOptions,T=void 0===C?{}:C,I=P.description,k=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(P,le),D=h||I,A=d?f?{zoomControl:!1,interactive:!0,mapOptions:{scrollWheelZoom:!0,interactions:{mouseWheelZoom:!0,dragPan:!0}}}:{zoomControl:!1,interactive:!1,mapOptions:{scrollWheelZoom:!1,interactions:{mouseWheelZoom:!1,dragPan:!1}}}:{mapOptions:T},M=l?{mapOptions:se(se({},T),{},{interactions:se(se({},T.interactions),{},{mouseWheelZoom:k.zoomControl})})}:A,x=k.mapInfoControl&&!(d&&!f),R=k.mapDrawControl&&!(d&&!f),N=o().createElement(o().Fragment,null,o().createElement(ne,{key:d?"overlay":"block",onMapViewChanges:u,eventHandlers:s,map:se(se({},k),{},{id:"media-".concat(t),resize:m+"-"+b+"_"+v,className:"aaaa",style:{cursor:x?"pointer":"default"}}),layers:j,tools:x?["popup"]:R?["draw"]:[],options:(0,_.kn)(M),mapType:w,onMapTypeLoaded:E}),d&&!l&&o().createElement(de,{className:"ms-expand-media-button",onClick:function(){return y(!f)},tooltipId:f?"geostory.closeFullscreenMap":"geostory.showFullscreenMap",tooltipPosition:"left"},o().createElement(a.Glyphicon,{glyph:f?"1-close":"1-full-screen"})));return o().createElement("div",{className:"ms-media ms-media-map ".concat(T.zoomPosition||""),style:{objectFit:i}},f&&d?o().createElement(oe.Z,null,o().createElement("div",{className:"ms-expanded-media-container"},N)):N,g&&D&&o().createElement("div",{className:"ms-media-caption"},o().createElement("small",null,D)))}))},82017:(e,t,n)=>{"use strict";n.d(t,{Ln:()=>y,ZP:()=>b});var r=n(24852),o=n.n(r),i=n(45697),a=n.n(i),c=n(16788),l=n(7875),u=n(52826),s=["debounceTime","mediaViewer"];function p(){return(p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var f=c.Z,y={image:c.Z,map:l.Z,video:u.Z},m=function(e){var t,n,i=e.debounceTime,a=e.mediaViewer,c=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(e,s),l="".concat(c.id).concat(c.resourceId?"-".concat(c.resourceId):""),u=(t=(0,r.useState)({}),n=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(t,n)||function(e,t){if(e){if("string"==typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),m=u[0],b=u[1],v=void 0===m[l]||m[l],g=a||y[c.mediaType||c.type]||f;return o().createElement(g,p({sectionType:c.sectionType,debounceTime:i,loading:m,isLoading:v,onLoad:b,loadingId:l},c))};m.propTypes={id:a().string,lazy:a().bool,mediaType:a().string,type:a().string,debounceTime:a().number},m.defaultProps={id:"",lazy:!0,mediaType:"",type:""};const b=m},71335:(e,t,n)=>{"use strict";n.d(t,{Z:()=>O});var r=n(24852),o=n.n(r),i=n(45697),a=n.n(i),c=n(5346),l=n(13718),u=n(14068);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?m(e):t}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var g={FORMAT:o().createElement(c.Z,{msgId:"map.errorFormat"}),SIZE:o().createElement(c.Z,{msgId:"map.errorSize"})},h=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(s,e);var t,n,r,i,a=(r=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=b(r);if(i){var n=b(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return y(this,e)});function s(){var e;p(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return v(m(e=a.call.apply(a,[this].concat(n))),"state",{}),v(m(e),"getThumbnailUrl",(function(){return e.props.map&&e.props.map.newThumbnail&&"NODATA"!==e.props.map.newThumbnail?decodeURIComponent(e.props.map.newThumbnail):null})),v(m(e),"getDataUri",(function(e,t){var n=e;if(n&&n.length>0){var r=n[0],o=new FileReader;return o.onload=function(e){return t(e.target.result,r.size)},o.readAsDataURL(r)}return t(null)})),v(m(e),"getThumbnailDataUri",(function(t){e.getDataUri(e.files,t)})),v(m(e),"generateUUID",(function(){var e=(new Date).getTime();return window.performance&&"function"==typeof window.performance.now&&(e+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))})),v(m(e),"processUpdateThumbnail",(function(t,n,r){var o=e.generateUUID(),i="THUMBNAIL";!e.props.map||r||!e.props.map.thumbnail||e.refs.imgThumbnail||n||e.deleteThumbnail(e.props.map.thumbnail,e.props.map.id,!0),e.props.map&&!r&&e.props.map.newThumbnail&&!e.refs.imgThumbnail&&n&&(e.deleteThumbnail(e.props.map.thumbnail,e.props.map.id,!1),e.props.onSaveAll(t,n,o,r,i,e.props.map.id)),e.props.map.newThumbnail&&r&&e.refs.imgThumbnail&&(e.deleteThumbnail(e.props.map.thumbnail,null,!1),e.props.onSaveAll(t,n,o,r,i,e.props.map.id)),e.props.map.newThumbnail&&!r&&e.refs.imgThumbnail&&e.props.onSaveAll(t,n,o,r,i,e.props.map.id),e.props.map.newThumbnail||r||e.refs.imgThumbnail||(e.props.map.thumbnail&&n&&e.deleteThumbnail(e.props.map.thumbnail,e.props.map.id,!1),e.props.onSaveAll(t,n,o,r,i,e.props.map.id))})),v(m(e),"updateThumbnail",(function(t,n){e.props.map.errors&&e.props.map.errors.length||e.getDataUri(e.files,(function(r){return e.processUpdateThumbnail(t,n,r),r}))})),v(m(e),"deleteThumbnail",(function(t,n){if(t&&-1!==t.indexOf("geostore")){var r=(0,l.C)(t);r&&e.props.onDeleteThumbnail(r,n)}})),e}return t=s,(n=[{key:"renderThumbnailErrors",value:function(){return this.props.thumbnailErrors&&this.props.thumbnailErrors.length>0?o().createElement("div",{className:"dropzone-errorBox alert-danger"},o().createElement("p",null,o().createElement(c.Z,{msgId:"map.error"})),this.props.thumbnailErrors.map((function(e){return o().createElement("div",{id:"error"+e,key:"error"+e,className:"error"+e},g[e])}))):null}},{key:"render",value:function(){var e=this;return o().createElement(u.Z,{ref:"imgThumbnail",thumbnail:this.getThumbnailUrl(),className:null,dropZoneProps:{className:"dropzone alert alert-info",rejectClassName:"alert-danger"},loading:this.props.loading,maxFileSize:this.props.maxFileSize,style:{pointerEvents:this.props.map.saving?"none":"auto"},label:this.props.withLabel&&o().createElement("label",{className:"control-label"},o().createElement(c.Z,{msgId:"map.thumbnail"})),ù:!0,message:o().createElement(o().Fragment,null,this.props.message,o().createElement("br",null),this.props.suggestion),error:this.renderThumbnailErrors(),onUpdate:function(t,n){var r;e.props.onError([],e.props.map.id),e.files=n,e.props.onUpdate(t,null==n||null===(r=n[0])||void 0===r?void 0:r.preview)},onError:function(t,n){e.props.onError(t,e.props.map.id),e.files=n,e.props.onUpdate(null,null)},onRemove:function(){e.files=null,e.props.onUpdate(null,null),e.props.onRemoveThumbnail(),e.props.onError([],e.props.map.id)}})}}])&&d(t.prototype,n),s}(o().Component);v(h,"propTypes",{glyphiconRemove:a().string,style:a().object,thumbnailErrors:a().array,loading:a().bool,withLabel:a().bool,map:a().object,maxFileSize:a().number,onDrop:a().func,onError:a().func,onUpdate:a().func,onSaveAll:a().func,onCreateThumbnail:a().func,onDeleteThumbnail:a().func,onRemoveThumbnail:a().func,message:a().oneOfType([a().string,a().element]),suggestion:a().oneOfType([a().string,a().element])}),v(h,"contextTypes",{messages:a().object}),v(h,"defaultProps",{loading:!1,withLabel:!0,glyphiconRemove:"remove-circle",maxFileSize:5e5,onDrop:function(){},onError:function(){},onUpdate:function(){},onSaveAll:function(){},onRemoveThumbnail:function(){},onCreateThumbnail:function(){},onDeleteThumbnail:function(){},message:o().createElement(c.Z,{msgId:"map.message"}),suggestion:o().createElement(c.Z,{msgId:"map.suggestion"}),map:{},thumbnailErrors:[]});const O=h},87320:(e,t,n)=>{"use strict";n.d(t,{Z:()=>O});var r=n(24852),o=n.n(r),i=n(45697),a=n.n(i),c=n(7412),l=n(43129),u=n(57588),s=n(52595);function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var d=function(e){var t,n,i=e.text,a=e.placement,c=e.bsStyle,l=e.left,d=e.top,f=e.title,y=e.glyph,m=e.id,b=(0,r.useRef)(),v=(t=(0,r.useState)(!1),n=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(t,n)||function(e,t){if(e){if("string"==typeof e)return p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),g=v[0],h=v[1];return o().createElement("span",{className:"mapstore-info-popover",onMouseLeave:function(){return h(!1)}},o().createElement(u.Glyphicon,{onMouseEnter:function(){h(!0)},ref:function(e){b.current=e},className:"text-".concat(c),glyph:y}),o().createElement(s.Z,{placement:a,show:g,target:function(){return b.current}},o().createElement(u.Popover,{id:m,placement:a,positionLeft:l,positionTop:d,title:f},o().createElement("div",{style:{display:"flex"}},i))))};d.propTypes={id:a().string,title:a().string,text:a().string,glyph:a().string,bsStyle:a().string,placement:a().string,left:a().number,top:a().number,trigger:a().oneOfType([a().array,a().bool])},d.defaultProps={id:"",title:"",text:"",placement:"right",left:200,top:50,glyph:"question-sign",bsStyle:"info"};const f=d;var y=n(15402);function m(){return(m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach((function(t){g(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function h(e){var t=e.id,n=e.label,r=e.infoFormat,i=e.availableInfoFormat,a=e.popoverMessage,c=e.disabled,s=e.onInfoFormatChange,p=e.selectProps,d=Object.keys(i).reduce((function(e,t){return Object.keys(e).map((function(t){return e[t]})).some((function(e){return e===i[t]}))?e:v(v({},e),{},g({},t,i[t]))}),{}),b=Object.keys(d).map((function(e){return{value:d[e],label:e}})),h=o().createElement(o().Fragment,null,"   ",a&&o().createElement(f,{text:o().createElement(y.Z,{msgId:a})}),o().createElement(l.ZP,m({},p,{id:t,value:r,clearable:!1,disabled:c,options:b,onChange:function(e){return s(null==e?void 0:e.value)}})));return n?o().createElement(u.FormGroup,{bsSize:"small"},o().createElement(u.ControlLabel,null,n),h):h}h.propTypes={id:a().string,label:a().oneOfType([a().func,a().string,a().object]),availableInfoFormat:a().object,infoFormat:a().string,popoverMessage:a().string,onInfoFormatChange:a().func,disabled:a().bool,selectProps:a().object},h.defaultProps={id:"mapstore-feature-format-selector",availableInfoFormat:(0,c.eq)(),infoFormat:(0,c.wR)(),popoverMessage:"",onInfoFormatChange:function(){},selectProps:{}};const O=h},1036:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(18446),o=n.n(r);const i=(0,n(67076).shouldUpdate)((function(e,t){return!o()(e.start,t.start)||e.disabled!==t.disabled}))(n(85552))},5993:(e,t,n)=>{"use strict";n.d(t,{Z:()=>f});var r=n(45697),o=n.n(r),i=n(84596),a=n.n(i),c=n(67076),l=n(86638),u=["locale"];function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const f=function(e){return(0,c.compose)((0,c.getContext)({locale:o().string}),(0,c.mapProps)((function(t){var n=t.locale,r=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(t,u);return p(p({},r),a()(e).reduce(function(e,t){return function(){var n=arguments.length>1?arguments[1]:void 0;return p(p({},arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),{},d({},n,e[n]&&(0,l.MZ)(t,e[n])))}}(r,n),{}))})))}},79105:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(67076);const o=function(e,t,n){return(0,r.branch)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!e[t]}),(0,r.withState)(e,t,n))}},75927:(e,t,n)=>{"use strict";n.d(t,{Z:()=>m});var r=n(13218),o=n.n(r),i=n(24852),a=n.n(i),c=n(57588),l=n(5346),u=n(15135),s=["settings","element","tabs","activeTab","width","groups","isLocalizedLayerStylesEnabled","setActiveTab","onUpdateParams","onRetrieveLayerData","realtimeUpdate"];function p(){return(p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var y=(0,u.Z)(c.NavItem);const m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.settings,n=e.element,r=void 0===n?{}:n,i=e.tabs,u=void 0===i?[]:i,m=e.activeTab,b=e.width,v=e.groups,g=e.isLocalizedLayerStylesEnabled,h=e.setActiveTab,O=void 0===h?function(){}:h,w=e.onUpdateParams,E=void 0===w?function(){}:w,P=e.onRetrieveLayerData,S=void 0===P?function(){}:P,j=e.realtimeUpdate,C=f(e,s);return a().createElement(c.Row,{key:"ms-toc-settings-navbar",className:"ms-row-tab"},a().createElement(c.Col,{xs:12},a().createElement(c.Nav,{bsStyle:"tabs",activeKey:m,justified:!0},u.map((function(e){return a().createElement(y,{key:"ms-tab-settings-"+e.id,tooltip:a().createElement(l.Z,{msgId:e.tooltipId}),eventKey:e.id,onClick:function(){return O(e.id)}},a().createElement(c.Glyphicon,{glyph:e.glyph}))})))),a().createElement(c.Col,{xs:12},u.filter((function(e){return e.id&&e.id===m})).filter((function(e){return e.Component})).map((function(e){return a().createElement(e.Component,p({},C,{key:"ms-tab-settings-body-"+e.id,containerWidth:b,element:r,groups:v,nodeType:t.nodeType,settings:t,retrieveLayerData:S,isLocalizedLayerStylesEnabled:g,onChange:function(e,t){return o()(e)?E(e,j):E(d({},e,t),j)}}))}))))}},16701:(e,t,n)=>{"use strict";n.d(t,{Z:()=>O});var r=n(24852),o=n.n(r),i=n(67076),a=n(81859),c=n(92222),l=n(29423),u=n(21338),s=n(91175),p=n.n(s);function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){y(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var m=function e(t,n){return t.reduce((function(t,r){var o=f({},r);return o.nodes&&(o=f(f({},o),{},{nodes:e(o.nodes,n)})),n.forEach((function(e){o.nodes&&e.func(o)?o=f(f({},o),e.options):o.nodes&&(o=f({},o))})),t.push(o),t}),[])},b=function(e){var t=e.nodes,n=e.filterText;return e.currentLocale,m(t,[{options:{showComponent:!0},func:function(){return!n}},{options:{loadingError:!0},func:function(e){return p()(e.nodes.filter((function(e){return e.loadingError&&"Warning"!==e.loadingError})))}},{options:{expanded:!0,showComponent:!0},func:function(e){return n&&p()(e.nodes.filter((function(e){return!0})))}}])};const v=(0,i.withProps)((function(e){return{nodes:b(e)}}));var g=n(3307),h=n(17802);const O=(0,i.compose)(h.Z,v,g.Z)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.changeLayerPropertyByGroup,n=void 0===t?function(){}:t,r=e.changeLayerProperty,i=void 0===r?function(){}:r,s=e.changeGroupProperty,p=void 0===s?function(){}:s,d=e.onSort,f=e.onSelect,y=e.selectedNodes,m=e.nodes,b=void 0===m?[]:m;return o().createElement(u.Z,{onSort:d,selectedNodes:y,onSelect:f,nodes:b},o().createElement(l.Z,{groupElement:o().createElement(a.Z,{onSort:d,selectedNodes:y,onSelect:f,propertiesChangeHandler:function(e,t){return Object.keys(t).map((function(r){return n(e,r,t[r])}))},onToggle:function(e,t){return p(e,"expanded",!t)},groupVisibilityCheckbox:!0}),layerElement:o().createElement(c.Z,{selectedNodes:y,onSelect:f,titleTooltip:!0,propertiesChangeHandler:function(e,t){return Object.keys(t).map((function(n){return i(e,n,t[n])}))},onUpdateNode:function(e,t,n){return Object.keys(n).map((function(t){return i(e,t,n[t])}))},onToggle:function(e,t){return i(e,"expanded",!t)}})}))}))},3307:(e,t,n)=>{"use strict";n.d(t,{Z:()=>u});var r=n(84596),o=n.n(r),i=n(30998),a=n.n(i),c=n(67076),l=n(24262);const u=(0,c.withHandlers)({changeLayerProperty:function(e){var t=e.onChange,n=void 0===t?function(){}:t,r=e.map,o=void 0===r?{}:r;return function(e,t,r){var i=a()(o.layers||[],{id:e});n("map.layers[".concat(i,"].").concat(t),r)}},changeLayerPropertyByGroup:function(e){var t=e.onChange,n=void 0===t?function(){}:t,r=e.map,o=void 0===r?{}:r;return function(e,t,r){return o.layers.filter((0,l.CK)(e)).map((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.id;return a()(o.layers||[],{id:t})})).filter((function(e){return e>=0})).map((function(e){return n("map.layers[".concat(e,"].").concat(t),r)}))}},changeGroupProperty:function(e){var t=e.onChange,n=void 0===t?function(){}:t,r=e.map,i=void 0===r?[]:r;return function(e,t,r){var c,l=i.groups?o()(i.groups):[],u=a()(l,(function(t){return e===t.id})),s=-1===u?l.length:u;"expanded"!==t||null!=l&&null!==(c=l[s])&&void 0!==c&&c.id||n("map.groups[".concat(s,"].id"),e),n("map.groups[".concat(s,"].").concat(t),r)}},updateMapEntries:function(e){var t=e.onChange,n=void 0===t?function(){}:t;return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.keys(e).map((function(t){return n("map[".concat(t,"]"),e[t])}))}}})},48860:(e,t,n)=>{"use strict";n.d(t,{Z:()=>u});var r=n(30998),o=n.n(r),i=n(67076);function a(e){return function(e){if(Array.isArray(e))return c(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var l=function(e,t){return(t.layers||[]).filter((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.group,r=void 0===n?"Default":n;return r===e})).map((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.id;return t}))};const u=(0,i.compose)((0,i.withStateHandlers)((function(){return{selectedLayers:[],selectedGroups:[]}}),{onNodeSelect:function(e,t){var n=e.selectedLayers,r=void 0===n?[]:n,i=e.selectedGroups,c=void 0===i?[]:i,u=t.map,s=void 0===u?{}:u;return function(e,t,n){return{selectedLayers:"group"===t?o()(c,(function(t){return t===e}))>=0?r.filter((function(t){return o()(l(e,s),(function(e){return e===t}))<0})):n?[].concat(a(r),a(l(e,s))):a(l(e,s)):o()(r,(function(t){return t===e}))>=0?r.filter((function(t){return t!==e})):n?[].concat(a(r),[e]):[e],selectedGroups:"group"===t?o()(c,(function(t){return t===e}))>=0?c.filter((function(t){return t!==e})):n?[].concat(a(c),[e]):[e]:n?c:[]}}}}),(0,i.withProps)((function(e){var t=e.selectedLayers,n=e.selectedGroups;return{selectedNodes:[].concat(a(t),a(n))}})))},17802:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(67076),o=n(24262);const i=(0,r.withProps)((function(e){var t,n,r,i=e.map;return{nodes:(t=(0,o.DN)(i),n=t.layers,r=void 0===n?{}:n,(0,o.C1)(r.flat||[],r.groups||[]).groups)}}))},51768:(e,t,n)=>{"use strict";n.d(t,{Z:()=>Q});var r=n(27361),o=n.n(r),i=n(67076),a=n(24262),c=n(79105),l=n(87427),u=n(10907),s=n(63209),p=n(30998),d=n.n(p),f=n(45697),y=n.n(f),m=n(24852),b=n.n(m),v=n(57588),g=n(43129),h=n(38560),O=n(5346);function w(e){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function E(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function P(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function j(e,t){return!t||"object"!==w(t)&&"function"!=typeof t?C(e):t}function C(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function T(e){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function I(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var k=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=T(r);if(o){var n=T(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return j(this,e)});function a(){var e;E(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return I(C(e=i.call.apply(i,[this].concat(n))),"renderLegend",(function(){return null})),I(C(e),"renderItemLabel",(function(e){return b().createElement("div",null,b().createElement("div",{key:"item-title"},e.title||e.name),b().createElement("div",null,b().createElement("small",{className:"text-muted",key:"item-key-description"},e.name)))})),I(C(e),"renderError",(function(){return e.props.element&&e.props.element.capabilities&&e.props.element&&e.props.element.capabilities.error?b().createElement(v.Alert,{bsStyle:"danger"},b().createElement(O.Z,{msgId:"layerProperties.styleListLoadError"})):null})),I(C(e),"updateEntry",(function(t,n){var r=n.target.value;e.props.onChange(t,r)})),e}return t=a,(n=[{key:"render",value:function(){var e=this,t=[{label:"Default Style",value:""}].concat((this.props.element.availableStyles||[]).map((function(t){return{label:e.renderItemLabel(t),value:t.name}})));return(this.props.element.style&&this.props.element.availableStyles&&d()(this.props.element.availableStyles,(function(t){return t.name===e.props.element.style})))>=0||!this.props.element.style||t.push({label:this.props.element.style,value:this.props.element.style}),b().createElement(v.Grid,{fluid:!0,style:{paddingTop:15,paddingBottom:15}},b().createElement("form",{ref:"style"},b().createElement(g.ZP.Creatable,{key:"styles-dropdown",options:t,isLoading:this.props.element&&this.props.element.capabilitiesLoading,value:this.props.element.style||"",onOpen:function(){!e.props.element||e.props.element.capabilities&&e.props.element.availableStyles||e.props.retrieveLayerData(e.props.element)},promptTextCreator:function(e){return b().createElement(O.Z,{msgId:"layerProperties.styleCustom",msgParams:{value:e}})},onChange:function(t){e.updateEntry("style",{target:{value:t&&t.value||""}})}}),b().createElement("br",null),this.renderLegend(),this.renderError(),b().createElement(h.Z,{bsStyle:"primary",style:{float:"right"},onClick:function(){return e.props.retrieveLayerData(e.props.element)}},b().createElement(v.Glyphicon,{glyph:"refresh"})," ",b().createElement(O.Z,{msgId:"layerProperties.stylesRefreshList"})),b().createElement("br",null)))}}])&&P(t.prototype,n),a}(b().Component);I(k,"propTypes",{retrieveLayerData:y().func,onChange:y().func,element:y().object,groups:y().array}),I(k,"defaultProps",{element:{},retrieveLayerData:function(){},onChange:function(){}});const D=k;var A=n(3307),M=n(17802),x=n(49977),R=n.n(x),N=n(80833);function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach((function(t){Z(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const W=(0,i.mapPropsStream)((function(e){var t=(0,i.createEventHandler)(),n=t.stream,r=t.handler;return e.pluck("element").distinctUntilChanged((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.id===t.id})).switchMap((function(){return n.switchMap((function(e){return(0,N.kB)(e).map((function(e){return{capabilities:e,capabilitiesLoading:null,description:e._abstract,boundingBox:e.latLonBoundingBox,availableStyles:e.style&&(Array.isArray(e.style)?e.style:[e.style])}})).startWith({capabilitiesLoading:!0})})).catch((function(e){return R().Observable.of({capabilitiesLoading:null,capabilities:{error:"error getting capabilities",details:e},description:null})}))})).startWith({}).combineLatest(e,(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return _(_({},t),{},{retrieveLayerData:r,element:_(_({},t.element),e)})}))}));var F=n(66379),U=n.n(F),B=void 0;function V(e){return(V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var H=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;for(var o in t)null!==t[o]&&"object"===V(t[o])&&(U()(t[o],n)&&r.apply(B,[t[o]]),e(t[o],n,r))};const G=(0,i.withProps)((function(e){var t=e.nodes,n=void 0===t?{}:t,r=e.editNode,o={};return r&&H(n,{id:r},(function(e){o=e})),{selectedNode:o}}));function z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?z(Object(n),!0).forEach((function(t){K(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function K(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var $=W(D),Y=(0,i.withProps)((function(e){return{tabs:e.tabs||[{id:"general",titleId:"layerProperties.general",tooltipId:"layerProperties.general",glyph:"wrench",visible:!0,Component:s.Z},{id:"display",titleId:"layerProperties.display",tooltipId:"layerProperties.display",glyph:"eye-open",visible:e.settings&&"layers"===e.settings.nodeType,Component:u.Z},{id:"style",titleId:"layerProperties.style",tooltipId:"layerProperties.style",glyph:"dropper",visible:e.settings&&"layers"===e.settings.nodeType&&e.element&&"wms"===e.element.type,Component:$}]}}));const Q=(0,i.compose)(M.Z,G,(0,i.withState)("settings","onUpdateSettings",{}),(0,i.withProps)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.map,n=void 0===t?{}:t,r=e.selectedNode,i=e.settings,c=void 0===i?{}:i;return{element:r,settings:q(q({},c),{},{nodeType:r&&r.nodes?"groups":"layers",options:{opacity:c.opacity>=0?c.opacity:r.opacity>=0?r.opacity:1}}),groups:o()((0,a.DN)(n),"layers.groups")}})),(0,i.compose)(A.Z,(0,i.withHandlers)({onUpdateNode:function(e){var t=e.changeLayerProperty,n=void 0===t?function(){}:t,r=e.changeGroupProperty,o=void 0===r?function(){}:r,i=e.editNode;return function(e,t,r){"layers"===t&&Object.keys(r).map((function(e){return n(i,e,r[e])})),"groups"===t&&Object.keys(r).map((function(e){return o(i,e,r[e])}))}}}),(0,i.withHandlers)({onUpdateParams:function(e){var t=e.settings,n=void 0===t?{}:t,r=e.onUpdateNode,o=void 0===r?function(){}:r;return function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t&&o(n.node,n.nodeType,q(q({},n.props),e))}}})),l.kZ,(0,c.Z)("activeTab","setActiveTab","general"),Y)},28124:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>Rc});var r={};n.r(r),n.d(r,{cleanUpEmptyStoryContainers:()=>je,closeShareOnGeostoryChangeMode:()=>We,editMediaForBackgroundEpic:()=>Ee,editWebPageComponent:()=>he,handlePendingGeoStoryChanges:()=>Fe,hideCarouselItemsOnUpdateCurrentPage:()=>Le,inlineEditorEditMap:()=>Ze,loadGeostoryEpic:()=>Pe,loadStoryOnHistoryPop:()=>Ve,openMediaEditorForNewMedia:()=>be,openWebPageComponentCreator:()=>ge,reloadGeoStoryOnLoginLogout:()=>Se,saveGeoStoryResource:()=>Oe,scrollOnLoad:()=>Be,scrollSideBar:()=>He,scrollToContentEpic:()=>we,setDrawModeOnCarouselMarkerToggle:()=>De,setFocusOnMapEditing:()=>Ie,sortContentEpic:()=>Ce,synchronizeCarouselOnMapRemove:()=>xe,synchronizeCarouselOnMapUpdate:()=>Re,updateLayerWithdrawnFeature:()=>Me,updateResourceOnAddCarouselItem:()=>_e,urlUpdateOnScroll:()=>Ue});var o=n(24852),i=n.n(o),a=n(71703),c=n(22222),l=n(75933),u=n.n(l),s=n(22843),p=n(92579),d=n(86638),f=n(31398),y=n(34990),m=n(93848),b=n(49977),v=n(91175),g=n.n(v),h=n(7654),O=n.n(h),w=n(47037),E=n.n(w),P=n(14293),S=n.n(P),j=n(95825),C=n.n(j),T=n(58748),I=n.n(T),k=n(27361),D=n.n(k),A=n(1469),M=n.n(A),x=n(41609),R=n.n(x),N=n(30998),L=n.n(N),_=n(13311),Z=n.n(_),W=n(23560),F=n.n(W),U=n(75982),B=n(23570),V=n.n(B),H=n(75875),G=n.n(H),z=n(91312),q=n(82904),K=n(97395),$=n(63516),Y=n(74621),Q=n(66113),X=n(7501),J=n(89919),ee=n(27693),te=n(82385),ne=n(4206),re=["status","statusText","data","message"],oe=["data","isStatic"],ie=["type","name","id"],ae=["newFeature","geometry"];function ce(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(e,t)||fe(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function le(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ue(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?le(Object(n),!0).forEach((function(t){se(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):le(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function se(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function pe(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function de(e){return function(e){if(Array.isArray(e))return ye(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||fe(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function fe(e,t){if(e){if("string"==typeof e)return ye(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ye(e,t):void 0}}function ye(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var me=function(e,t){return function(n){return n.ofType(m.AQ).switchMap((function(n){var r=n.resource,o=void 0===r?{}:r,i=[],a=e.getState(),c=(0,X.hb)(a),l=(0,X.IQ)(a),u=g()((0,Q.jq)(a).filter((function(e){return e.data&&(l!==ee.r.GEOSTORY&&e.data.id||e.id)===o.id}))),s=o.id;u?s=u.id:R()(o)?i=[].concat(de(i),[(0,y.Od)("".concat(t)),(0,m.Cp)()]):(s=o.id||V()(),i=[].concat(de(i),[(0,y.rp)(s,c,o.data?o.data:o)]));var d=c===p.Tr.MAP?{resourceId:s,type:c,map:void 0}:{resourceId:s,type:c},f=(0,y.Vx)("".concat(t),d,"merge"),v=(0,p.u0)(t),h=v.sectionId,O=v.innerContentId;return R()(o)||c!==p.Tr.MAP||!(0,Q.I0)(h)(a)||O||(f=(0,y.Ak)(h,{resourceId:s})),i=[].concat(de(i),[f,(0,m.Cp)()]),b.Observable.from(i)}))}},be=function(e,t){return e.ofType(y.D7).filter((function(e){var t=e.element,n=void 0===t?{}:t;return n.type===p.bT.MEDIA||(0,p.lt)(n)})).switchMap((function(n){var r=n.path,o=n.element,i="";(0,p.lt)(o)&&"sections"===r&&(i=".contents[0].contents[0]");var a="".concat(r,'[{"id":"').concat(o.id,'"}]').concat(i),c=(0,Q.X6)(t.getState());return b.Observable.of((0,m.$Z)("geostory",c)).merge(e.let(me(t,a)),e.ofType(m.B8).switchMap((function(){return b.Observable.of((0,y.Od)(a))})).takeUntil(e.ofType(y.wb))).takeUntil(e.ofType(m.wd))}))},ve=function(e){return function(t){return t.ofType(y.Hb).switchMap((function(t){var n=t.src;return b.Observable.of((0,y.Vx)("".concat(e),{src:n,editURL:!1},"merge"))}))}},ge=function(e){return e.ofType(y.D7).filter((function(e){var t=e.element,n=void 0===t?{}:t;return n.type===p.bT.WEBPAGE&&!1!==n.editURL||(0,p.NC)(n)})).switchMap((function(t){var n=t.path,r=t.element,o="";(0,p.NC)(r)&&"sections"===n&&(o=".contents[0].contents[0]");var i="".concat(n,'[{"id":"').concat(r.id,'"}]').concat(o);return b.Observable.of((0,y.Vx)(i,{editURL:!0},"merge")).merge(e.let(ve(i))).takeUntil(e.ofType(y.cc))}))},he=function(e){return e.ofType(y.cc).switchMap((function(t){var n=t.path;return b.Observable.of((0,y.Vx)(n,{editURL:!0},"merge")).merge(e.let(ve(n))).takeUntil(e.ofType(y.D7))}))},Oe=function(e){return e.ofType(y.LE).exhaustMap((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.resource,n=e.delay,r=void 0===n?1e3:n;return(t.id?(0,z.id)(t):(0,z.SN)(t)).switchMap((function(e){return b.Observable.of((0,y.GD)(e),(0,y.g5)(p.ZX.SHOW_SAVE,!1),t.id?(0,y.wJ)(e):(0,U.VF)("/geostory/".concat(e))).merge(b.Observable.of((0,K.$Z)({id:"STORY_SAVE_SUCCESS",title:"saveDialog.saveSuccessTitle",message:"saveDialog.saveSuccessMessage"})).delay(t.id?0:r))})).let((0,J.hP)((0,y.YP)(!0,"loading"),(0,y.YP)(!1,"loading"))).catch((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.status,n=e.statusText,r=e.data,o=e.message,i=pe(e,re);return b.Observable.of((0,y.y6)(t?{status:t,statusText:n,data:r}:o||i),(0,y.YP)(!1,"loading"))}))}))},we=function(e){return e.ofType(y.D7).switchMap((function(e){var t=e.element;return b.Observable.of(t).switchMap((function(){if(document.getElementById(t.id))return(0,p.M1)(t.id,{behavior:"auto",block:"center"}),b.Observable.empty();throw new Error("Item not mounted yet")})).retryWhen((function(e){return e.delay(200).take(10)}))}))},Ee=function(e,t){return e.ofType(m.wd).switchMap((function(n){var r=n.path,o=n.owner,i=n.sectionType,a=(0,Q.vv)(r)(t.getState()),c=(0,Q.Tr)(a)(t.getState());return b.Observable.of((0,X.hb)(t.getState())).filter((function(e){return c&&c.type!==e})).map((function(){return(0,m.y5)(c.type)})).merge(b.Observable.of((0,m.$Z)(o,(0,Q.X6)(t.getState())),(0,m.Gh)(a),(0,m.Tk)(i===p.ID.CAROUSEL?["image","video"]:[])).merge(e.let(me(t,r)).takeUntil(e.ofType(m.B8,y.D7))))}))},Pe=function(e,t){var n=t.getState,r=void 0===n?function(){}:n;return e.ofType(y.XH).switchMap((function(e){var t=e.id;return b.Observable.defer((function(){return t&&O()(parseInt(t,10))?G().get("configs/".concat(t,".json")).then((function(e){var t=e.data,n=t.sections,r=M()(n)&&n.map((function(e){return ue(ue({},e),{},{id:V()()})}));return{data:r.length?ue(ue({},t),{},{sections:r}):t,isStatic:!0,canEdit:!0}})):(0,z.RX)(t)})).do((function(e){if(!e.data)throw Error("Wrong data format");return!0})).switchMap((function(e){var n=e.data,o=e.isStatic,i=void 0!==o&&o,a=pe(e,oe),c=r(),l=(0,Y.qg)(c),u=(0,Y.jl)(c),s=E()(n)?JSON.parse(n):n;if(!u&&O()(parseInt(t,10)))return b.Observable.of((0,y.Ct)({status:403}));var d=(0,Q.eK)(c)===p.nl.EDIT;return b.Observable.from([].concat(de(i||d?[(0,y.D_)(a&&a.canEdit||l)]:[]),[(0,y.OS)(t),(0,y.K0)(s),(0,y.DF)(a)]))})).let((0,J.hP)((0,y.YP)(!0,"loading"),(0,y.YP)(!1,"loading"),(function(e){var t=(0,p.of)(),n=t+".errors.loading.unknownError";return 403===e.status?(n=t+".errors.loading.pleaseLogin",((0,Y.jl)(r())||(0,Q.JM)(r()))&&(n=t+".errors.loading.geostoryNotAccessible")):404===e.status?n=t+".errors.loading.geostoryDoesNotExist":S()(e.status)&&(n=e.message),b.Observable.of((0,K.vU)({title:t+".errors.loading.title",message:n}),(0,y.K0)({}),(0,y.Ct)(ue(ue({},e),{},{messageId:n})))}))).startWith((0,y.K0)({}))}))},Se=function(e){return e.ofType(y.XH).switchMap((function(t){var n=t.id;return e.ofType($.XP,$.Nv).switchMap((function(){return b.Observable.of((0,y.wJ)(n)).delay(500)})).takeUntil(e.ofType(U.nk))}))},je=function(e,t){var n=t.getState,r=void 0===n?function(){}:n;return e.ofType(y.Dq).switchMap((function(e){var t=e.path,n=(0,p.Ll)(t,(0,Q.Kg)(r())),o=C()(n,"contents");if(o>0){var i=n.splice(0,o),a=(0,Q.$F)(i.join("."))(r());if(a&&a.contents&&0===a.contents.length)return b.Observable.of((0,y.Od)(i.join(".")))}return b.Observable.empty()}))},Ce=function(e,t){var n=t.getState,r=void 0===n?function(){}:n;return e.ofType(y.tP).switchMap((function(e){var t,n=e.source,o=e.target,i=e.position,a=r(),c=(0,Q.$F)(n)(a);return b.Observable.from([(0,y.Od)(n),(0,y.IH)(o,i,c),(0,y.jw)(!1)]).concat(b.Observable.of((0,y.Ak)(null===(t=(0,p.u0)(o))||void 0===t?void 0:t.sectionId))).startWith((0,y.jw)(!0))}))},Te=(0,ne.Yf)("clean","Point",p.e1,[],{}),Ie=function(e,t){var n=t.getState,r=void 0===n?function(){}:n;return e.ofType(y.wb).filter((function(e){var t=e.path;return(void 0===t?"":t).endsWith("editMap")})).switchMap((function(e){var t=e.path,n=e.element,o=(0,p.ln)(t,(0,Q.Kg)(r())),i=o.flatPath,a=o.path,c=i.pop(),l=i.shift(),u="background"===a[a.length-2],s=u&&"#".concat(l.id," .ms-section-background-container")||"#".concat(c.id);return(0,p.M1)(c.id),b.Observable.from([(0,y.$A)(n,c,s,u,t.replace(".editMap",""))]).concat(n?[]:[Te,(0,y.Vx)("drawContent",{})])}))},ke=function(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"replace",i='sections[{"id":"'.concat(e,'"}].contents[{"id":"').concat(t,'"}]')+(n?".".concat(n):"");return(0,y.Vx)(i,r,o)},De=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.getState;return e.ofType(y.wb).filter((function(e){var t=e.path,n=void 0===t?"":t,r=e.element;return n.endsWith("mapDrawControl")&&r})).debounceTime(500).switchMap((function(e){var t,r=e.path,o=n()||{},i=(0,p.u0)(r)||{},a=(i||{}).contentId,c=((0,Q.Af)(i)(o)||{}).background,l=(c=void 0===c?{}:c).map,u=(l=void 0===l?{}:l).layers,s=void 0===u?[]:u,d=L()((0,Q.eB)(null==i?void 0:i.sectionId)(o),{id:a}),f=(null===(t=Z()(s,(function(e){return e.id===p.e1})))||void 0===t?void 0:t.features)||[],m=Z()(f,(function(e){return e.contentRefId===a})),v=m&&ue(ue({},m),{},{features:null==m?void 0:m.features.map((function(e){var t;return ue(ue({},e),{},{properties:ue(ue({},e.properties),{},{canEdit:!0}),style:null==e||null===(t=e.style)||void 0===t?void 0:t[0]})}))});if(!v){var g=V()();v={type:"FeatureCollection",id:g,contentRefId:a,properties:{id:g,visibility:!0},newFeature:!0,geometry:null,features:[{type:"Feature",properties:{id:V()(),canEdit:!0},geometry:null,style:{id:V()(),highlight:!0,iconColor:"cyan",iconText:"".concat(d+1),iconShape:"circle"}}]}}var h=(0,p.u0)(r)||{},O=(0,y.Vx)(r.replace("mapDrawControl","tempFeature"),v),w=(0,y.Vx)("drawContent",h),E=(0,ne.Yf)("drawOrEdit","Point",p.e1,[v],{editFilter:function(e){return e.getProperties().canEdit},addClickCallback:!0,drawEnabled:!1,editEnabled:!0,featureProjection:"EPSG:4326",geodesic:!1,stopAfterDrawing:!1,transformToFeatureCollection:!0,translateEnabled:!1,useSelectedStyle:!0},{highlight:!1});return b.Observable.from([Te,E,O,w])}))},Ae=function(e,t){return ue(ue({},t),{},{features:t.features.map((function(t){var n,r;return(null==e||null===(n=e.properties)||void 0===n?void 0:n.id)===(null==t||null===(r=t.properties)||void 0===r?void 0:r.id)?ue(ue({},t),{},{geometry:null==e?void 0:e.geometry,style:[t.style]}):t})),style:{}})},Me=function(e,t){var n=t.getState;return e.ofType(y.W7).switchMap((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.features,r=ce(t=void 0===t?[]:t,1),o=r[0],i=n(),a=(0,Q.gN)(i),c=a||{},l=c.sectionId,u=c.contentId,s=(0,Q.Af)(a)(i);if(l&&u&&s){var d,f,y,m,v=null==s||null===(d=s.background)||void 0===d?void 0:d.map,g=!(null==v||!v.layers),h=g&&(null===(f=Z()(null==v?void 0:v.layers,(function(e){return e.id===p.e1})))||void 0===f?void 0:f.features)||[],O=(0,Q.Tr)(null==s||null===(y=s.background)||void 0===y?void 0:y.resourceId)(i)||{},w=O.data,E=((w=void 0===w?{}:w).type,w.name,w.id,pe(w,ie)),P=(null==v?void 0:v.tempFeature)||{},S=P.newFeature,j=(P.geometry,pe(P,ae)),C=R()(h)?[Ae(o,j)]:h.map((function(e){return(null==e?void 0:e.contentRefId)===u&&(null==e?void 0:e.contentRefId)===j.contentRefId?ue(ue({},e),{},{features:e.features.map((function(e){return ue(ue({},e),{},{geometry:null==o?void 0:o.geometry})}))}):e})).concat(S?[Ae(o,j)]:[]),T={type:"vector",visibility:!0,id:p.e1,name:"Geostory",hideLoading:!0,features:C.filter((function(e,t,n){return n.findIndex((function(t){return t.id===e.id}))===t})),handleClickOnLayer:!0};if(g){var I=L()(v.layers,(function(e){return e.id===T.id})),k=v.layers;-1!==I?k[I]=T:k=[].concat(de(k),[T]),m=ue(ue({},v),{},{layers:k})}else m=ue(ue(ue({},E),v),{},{layers:[].concat(de(E.layers),[T])});var D=[l,u,"background.map",m];return b.Observable.of(ke.apply(void 0,D))}return b.Observable.empty()}))},xe=function(e,t){var n=t.getState;return e.ofType(y.Dq).filter((function(){return!(0,Q.Ho)(n())})).switchMap((function(e){var t=e.path,r=n()||{},o=(0,p.u0)(t),i=o||{},a=i.sectionId,c=i.contentId,l=b.Observable.empty();return a&&(0,Q.I0)(a)(r)&&((0,Q.Af)(o)(n())||(l=b.Observable.of((0,y.Ak)(a,{hideContentId:c})))),l}))},Re=function(e,t){var n=t.getState;return e.ofType(y.wb).filter((function(e){return e.path.endsWith("map")&&!(0,Q.Ho)(n())})).switchMap((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.path,r=e.element,o=(r=void 0===r?{}:r).layers,i=void 0===o?[]:o,a=n()||{},c=(0,p.u0)(t),l=c||{},u=l.sectionId,s=l.innerContentId,d=b.Observable.empty();return(0,Q.I0)(u)(a)&&!s&&(R()(i)||(d=b.Observable.of((0,y.Ak)(u,{layers:i})))),d}))},Ne=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;return R()(e)?[]:null==e?void 0:e.map((function(e){var n;return e.id===p.e1?ue(ue({},e),{},{features:null==e||null===(n=e.features)||void 0===n?void 0:n.map((function(e){return ue(ue({},e),{},{features:e.features.map((function(n){var r;return ue(ue({},n),{},{style:[ue(ue({},null==n||null===(r=n.style)||void 0===r?void 0:r[0]),{},{highlight:F()(t)?t(e):t})]})}))})}))}):e}))},Le=function(e,t){var n=t.getState;return e.ofType(y.wb).filter((function(e){var t=e.path,n=e.element;return t&&t.endsWith("carouselToggle")&&n})).switchMap((function(e){var t=e.path,r=(0,p.u0)(t)||{},o=r.sectionId,i=r.contentId,a=(0,Q.eB)(o)(n())||[],c=(Z()(a,(function(e){return e.id===i}))||{}).id;return i&&!R()(a)?b.Observable.from([(0,y.fD)(o,i)]).concat(b.Observable.of(ke(o,c,"background.map.resetPanAndZoom",!0),(0,y.Vx)(t,!1),function(e,t,n){var r=t||{},o=r.contentId,i=r.sectionId,a=D()(Z()(n,(function(e){return e.id===o}))||{},"background.map",{}).layers,c=Ne(void 0===a?[]:a,(function(e){return(null==e?void 0:e.contentRefId)===o&&true}));return ke(i,o,"background.map.layers",c)}(0,{sectionId:o,contentId:i},a))):b.Observable.empty()}))},_e=function(e,t){var n=t.getState;return e.ofType(y.D7).filter((function(){return!(0,Q.Ho)(n())})).switchMap((function(e){var t=e.element,r=e.path,o=n()||{},i=((0,p.u0)(r)||{}).sectionId,a=b.Observable.empty();if((0,Q.I0)(i)(o)&&(null==t?void 0:t.type)===p.bT.COLUMN||(null==t?void 0:t.type)===p.ID.CAROUSEL){var c=(0,Q.eB)(i)(n()),l=((null==c?void 0:c[0])||{}).background,u=(l=void 0===l?{}:l).map,s=void 0===u?{}:u,d=D()(Z()(c,(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.background,n=(t=void 0===t?{}:t).resourceId,r=t.type;return n&&"map"===r}))||{},"background.resourceId"),f=((0,Q.Ps)(o)||{}).map,y=(f=void 0===f?{}:f).mapInfoControl,m=void 0===y||y,v=!R()(s)&&ue(ue({},s),{},{mapInfoControl:m,layers:Ne(null==s?void 0:s.layers,!1)});if(d&&v)a=b.Observable.of(ke(i,null==t?void 0:t.id,"background",ue({resourceId:d,type:"map"},!R()(s)&&{map:v}),"merge"));else{var g=t||{},h=g.id,O=g.contents,w=ce(O=void 0===O?[]:O,1)[0],E=(w=void 0===w?{}:w).id;a=b.Observable.of(ke(h,E,"background.map.mapInfoControl",m))}}return a}))},Ze=function(e,t){var n=t.getState;return e.ofType(te.nr).filter((function(e){var t=e.owner,n=e.map;return"inlineEditor"===t&&!!n})).switchMap((function(){return e.ofType(te.LE).switchMap((function(t){var r=t.map,o=(0,Q.FW)(n()).path;return b.Observable.of((0,y.Vx)("".concat(o,".map"),r,"merge"),(0,y.Vx)("".concat(o,".editMap"),!1),(0,te.Cp)()).takeUntil(e.ofType(te.B8))}))}))},We=function(e){return e.ofType(y.vb).switchMap((function(){return b.Observable.of((0,q.Xg)("share","enabled",!1))}))},Fe=function(e){return b.Observable.merge(e.ofType(y.XH).switchMap((function(){return e.ofType(y.Zf)}))).switchMap((function(){return e.ofType(y.D7,y.wb,y.Dq,y.mN,y.QK,y.km).take(1).switchMap((function(){return b.Observable.of((0,y.c0)(!0)).concat(e.ofType(y.si,U.nk,$.Nv).take(1).switchMap((function(){return b.Observable.of((0,y.c0)(!1))})))}))}))},Ue=function(e,t){var n=t.getState;return e.ofType(y.un).let(function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return e};return function(r){return r.withLatestFrom(e.startWith(t)).filter((function(e){var t=ce(e,2)[1];return n(t)})).map((function(e){return ce(e,1)[0]}))}}(e.ofType(y.Gx).map((function(e){return!e.status})).startWith(!0))).debounceTime(50).switchMap((function(e){var t=e.sectionId,r=e.columnId;if("edit"!==(0,Q.eK)(n())&&(r||t)&&(0,Q.bU)(n())){var o,i,a=D()(n(),"geostory.resource.id"),c=(0,p.NP)(window.location.href,null===(o=window)||void 0===o||null===(i=o.location)||void 0===i?void 0:i.hash,a,t,r);c&&history.pushState(null,"",c)}return b.Observable.empty()}))},Be=function(e){return e.ofType(y.ij).switchMap((function(e){var t,n,r,o=e.delay,i=void 0===o?2e3:o,a=null===(t=window)||void 0===t||null===(n=t.location)||void 0===n||null===(r=n.hash)||void 0===r?void 0:r.split("/");return b.Observable.of(a).do((function(){var e,t,n;null!==(e=window)&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&null!==(n=t.hash)&&void 0!==n&&n.includes("shared")?(0,p.M1)(a[7]||a[5],{block:"start",behavior:"auto"}):a.length>5?(0,p.M1)(a[6],{block:"start",behavior:"auto"}):5===a.length&&(0,p.M1)(a[4],{block:"start",behavior:"auto"})})).ignoreElements().startWith((0,y.WE)(!0)).concat(b.Observable.of((0,y.WE)(!1)).delay(i))}))},Ve=function(e){return e.ofType(U.nk).switchMap((function(e){var t,n=e.payload;if((null==n||null===(t=n.location)||void 0===t?void 0:t.pathname.includes("/geostory/"))&&"POP"===n.action){var r,o=I()(null==n||null===(r=n.location)||void 0===r?void 0:r.pathname);return o.find((function(e){return"shared"===e}))?b.Observable.of((0,y.wJ)(o[2])).delay(500):b.Observable.of((0,y.wJ)(o[1])).delay(500)}return b.Observable.empty()}))},He=function(e,t){var n=t.getState;return e.ofType(y.un).filter((function(e){var t=e.columnId,r=e.sectionId;return!("edit"!==(0,Q.eK)(n())||!t&&!r)})).debounceTime(50).switchMap((function(){return b.Observable.of(Array.from(document.querySelectorAll(".ms-geostory-builder .mapstore-side-card.ms-highlight")).pop()).filter((function(e){return!!e})).withLatestFrom(b.Observable.of(document.querySelector(".ms-geostory-builder .ms2-border-layout-body")).filter((function(e){return!!e}))).map((function(e){var t=ce(e,2),n=t[0],r=t[1];return function(){var e=n.getBoundingClientRect(),t=e.top,o=e.bottom,i=r.getBoundingClientRect(),a=i.top,c=i.bottom;t<a?r.scrollBy({top:t-a-10,behavior:"smooth"}):o>c&&r.scrollBy({top:o-c+10,behavior:"smooth"})}})).do((function(e){return window.requestAnimationFrame(e)})).ignoreElements()}))},Ge=n(8316),ze=n(66190),qe=n(65539),Ke=n(96259),$e=n(67076),Ye=n(28878);function Qe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Xe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Qe(Object(n),!0).forEach((function(t){Je(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Je(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function et(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}(0,$e.setObservableConfig)(Ye.Z);var tt=(0,$e.compose)((0,$e.mapPropsStream)((function(e){var t=(0,$e.createEventHandler)(),n=t.handler,r=t.stream,o="EMPTY",i="EMPTY";return b.Observable.combineLatest(e,r.filter((function(e){var t=e.columnId,n=e.sectionId;return t&&o!==t?(o=t,!0):!(!n||i===n||(i=n,0))})).withLatestFrom(e.pluck("updateCurrentPage")).do((function(e){var t,n,r=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(t,n)||function(e,t){if(e){if("string"==typeof e)return et(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?et(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],i=r[1];return i&&i(o)})).ignoreElements().startWith({}),(function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Xe(Xe({},t.reduce((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return Xe(Xe({},e),t)}),{})),{},{updateCurrentPage:n})}))}))),nt=n(82030),rt=n(22762),ot=n.n(rt);function it(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function at(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?it(Object(n),!0).forEach((function(t){ct(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):it(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ct(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}(0,$e.setObservableConfig)(Ye.Z);const lt=(0,$e.compose)((0,$e.mapPropsStream)((function(e){var t=(0,$e.createEventHandler)(),n=t.handler,r=t.stream;return b.Observable.combineLatest(e,function(e,t){return t.map((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{interceptorTime:e.interceptorTime,updateCurrentPage:e.updateCurrentPage}})).distinctUntilKeyChanged("interceptorTime").switchMap((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.interceptorTime,r=void 0===n?100:n,o=t.updateCurrentPage;return e.scan((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=t.id,r=t.visible,o=t.entry;return at(at({},e),{},ct({},n,{visible:r,entry:o}))}),{}).debounceTime(r).map((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return ot()(Object.keys(e),(function(t){return e[t].visible?D()(e[t],"entry.boundingClientRect.top"):1/0}))})).do((function(e){o&&o({sectionId:e})})).ignoreElements()}))}(r,e).startWith({}),(function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return at(at({},t.reduce((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return at(at({},e),t)}),{})),{},{onVisibilityChange:n})}))})));var ut=n(45697),st=n.n(ut),pt=n(93451),dt=(n(7169),n(37163)),ft=n(73611),yt=n(94184),mt=n.n(yt);function bt(e){return(bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function vt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function gt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ht(e,t,n){return t&&gt(e.prototype,t),n&&gt(e,n),e}function Ot(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&wt(e,t)}function wt(e,t){return(wt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Et(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=jt(e);if(t){var o=jt(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Pt(this,n)}}function Pt(e,t){return!t||"object"!==bt(t)&&"function"!=typeof t?St(e):t}function St(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function jt(e){return(jt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ct(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Tt="External Link",It=function(e){Ot(n,e);var t=Et(n);function n(){var e;vt(this,n);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return Ct(St(e=t.call.apply(t,[this].concat(o))),"state",{expanded:!1}),Ct(St(e),"toggle",(function(){e.setState((function(e){return{expanded:!e.expanded}}))})),e}return ht(n,[{key:"render",value:function(){var e=this.state.expanded,t=this.props,n=t.externalLinkOption,r=t.onSelectionChange,o=t.currentSelectOption,a=t.availableStorySections;return i().createElement("div",{className:"rdw-block-wrapper","aria-label":"rdw-block-control"},i().createElement(ft.Dropdown,{className:"ms-rdw-link-options-dropdown",onChange:r,expanded:e,doExpand:this.toggle,doCollapse:this.toggle,onExpandEvent:this.toggle,title:"MSLinks"},i().createElement("span",null,o),i().createElement(ft.DropdownOption,{active:!0,value:{value:n,label:n},key:n},"External Link"),a&&a.map((function(e){return i().createElement(ft.DropdownOption,{active:e.id===o,value:{value:e.id,label:e.title||e.type||e.id},key:e.id},e.title||e.type||e.id)}))))}}]),n}(o.Component);Ct(It,"propTypes",{externalLinkOption:st().string,onSelectionChange:st().func,currentSelectOption:st().string,availableStorySections:st().array});var kt=function(e){Ot(n,e);var t=Et(n);function n(){var e;vt(this,n);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return Ct(St(e=t.call.apply(t,[this].concat(o))),"state",{showModal:!1,linkTarget:"",linkTitle:"",attributes:{},linkTargetOption:e.props.config.defaultTargetOption,currentSelectOption:"Select link target"}),Ct(St(e),"removeLink",(function(){(0,e.props.onChange)("unlink")})),Ct(St(e),"addLink",(function(){var t=e.props.onChange,n=e.state;t("link",n.linkTitle,n.linkTarget,n.linkTargetOption,n.attributes)})),Ct(St(e),"updateValue",(function(t){e.setState(Ct({},"".concat(t.target.name),t.target.value))})),Ct(St(e),"onSelectionChange",(function(t){t.value===Tt?e.setState({linkTarget:"",attributes:{},currentSelectOption:t.label}):e.setState({linkTarget:t.value,attributes:{"data-geostory-interaction-type":"scrollTo","data-geostory-interaction-params":"".concat(t.value),"data-geostory-interaction-name":t.label},currentSelectOption:t.label})})),Ct(St(e),"updateTargetOption",(function(t){e.setState({linkTargetOption:t.target.checked?"_blank":"_self"})})),Ct(St(e),"hideModal",(function(){e.setState({showModal:!1})})),Ct(St(e),"signalExpandShowModal",(function(){var t=e.props,n=t.onExpandEvent,r=t.currentState,o=r.link,i=r.selectionText,a=e.state.linkTargetOption;n();var c="Select link target";null!=o&&o.target&&o.target.length>0&&(c=Tt),null!=o&&o.attributes["data-geostory-interaction-name"]&&(c=o.attributes["data-geostory-interaction-name"]),e.setState({showModal:!0,linkTarget:o&&o.target||"",linkTargetOption:o&&o.targetOption||a,linkTitle:o&&o.title||i,attributes:o&&o.attributes||{},currentSelectOption:c})})),Ct(St(e),"forceExpandAndShowModal",(function(){var t=e.props,n=t.doExpand,r=t.currentState,o=r.link,i=r.selectionText,a=e.state.linkTargetOption;n();var c="Select link target";null!=o&&o.target&&o.target.length>0&&(c=Tt),null!=o&&o.attributes["data-geostory-interaction-name"]&&(c=o.attributes["data-geostory-interaction-name"]),e.setState({showModal:!0,linkTarget:o&&o.target,linkTargetOption:o&&o.targetOption||a,linkTitle:o&&o.title||i,attributes:o&&o.attributes||{},currentSelectOption:c})})),e}return ht(n,[{key:"componentDidUpdate",value:function(e){e.expanded&&!this.props.expanded&&this.setState({showModal:!1,linkTarget:"",linkTitle:"",attributes:{},linkTargetOption:this.props.config.defaultTargetOption,currentSelectOption:"Select link target"})}},{key:"renderAddLinkModal",value:function(){var e=this.props,t=e.config.popupClassName,n=e.doCollapse,r=e.translations,o=e.availableStorySections,a=this.state,c=a.linkTitle,l=a.linkTarget,u=a.linkTargetOption,s=a.currentSelectOption;return i().createElement("div",{className:mt()("rdw-link-modal",t),onClick:ft.stopPropagation},i().createElement("label",{className:"rdw-link-modal-label",htmlFor:"linkTitle"},r["components.controls.link.linkTitle"]),i().createElement("input",{id:"linkTitle",className:"rdw-link-modal-input",onChange:this.updateValue,onBlur:this.updateValue,name:"linkTitle",value:c}),i().createElement("label",{className:"rdw-link-modal-label",htmlFor:"linkTarget"},r["components.controls.link.linkTarget"]),i().createElement(It,{externalLinkOption:Tt,currentSelectOption:s,onSelectionChange:this.onSelectionChange,availableStorySections:o}),s===Tt&&i().createElement(i().Fragment,null,i().createElement("input",{id:"linkTarget",className:"rdw-link-modal-input",onChange:this.updateValue,onBlur:this.updateValue,name:"linkTarget",value:l}),i().createElement("label",{className:"rdw-link-modal-target-option",htmlFor:"openLinkInNewWindow"},i().createElement("input",{id:"openLinkInNewWindow",type:"checkbox",defaultChecked:"_blank"===u,value:"_blank",onChange:this.updateTargetOption}),i().createElement("span",null,r["components.controls.link.linkTargetOption"]))),i().createElement("span",{className:"rdw-link-modal-buttonsection"},i().createElement("button",{className:"rdw-link-modal-btn",onClick:this.addLink,disabled:!l||!c},r["generic.add"]),i().createElement("button",{className:"rdw-link-modal-btn",onClick:n},r["generic.cancel"])))}},{key:"renderInFlatList",value:function(){var e=this.props,t=e.config,n=t.options,r=t.link,o=t.unlink,a=t.className,c=e.currentState,l=e.expanded,u=e.translations,s=this.state.showModal;return i().createElement("div",{className:mt()("rdw-link-wrapper",a),"aria-label":"rdw-link-control"},n.indexOf("link")>=0&&i().createElement(ft.Option,{value:"unordered-list-item",className:mt()(r.className),onClick:this.signalExpandShowModal,"aria-haspopup":"true","aria-expanded":s,title:r.title||u["components.controls.link.link"]},i().createElement("img",{src:r.icon,alt:""})),n.indexOf("unlink")>=0&&i().createElement(ft.Option,{disabled:!c.link,value:"ordered-list-item",className:mt()(o.className),onClick:this.removeLink,title:o.title||u["components.controls.link.unlink"]},i().createElement("img",{src:o.icon,alt:""})),l&&s?this.renderAddLinkModal():void 0)}},{key:"renderInDropDown",value:function(){var e=this.props,t=e.expanded,n=e.onExpandEvent,r=e.doCollapse,o=e.doExpand,a=e.onChange,c=e.config,l=e.currentState,u=e.translations,s=c.options,p=c.link,d=c.unlink,f=c.className,y=c.dropdownClassName,m=c.title,b=this.state.showModal;return i().createElement("div",{className:"rdw-link-wrapper","aria-haspopup":"true","aria-label":"rdw-link-control","aria-expanded":t,title:m},i().createElement(ft.Dropdown,{className:mt()("rdw-link-dropdown",f),optionWrapperClassName:mt()(y),onChange:a,expanded:t&&!b,doExpand:o,doCollapse:r,onExpandEvent:n},i().createElement("img",{src:(0,ft.getFirstIcon)(c),alt:""}),s.indexOf("link")>=0&&i().createElement(ft.DropdownOption,{onClick:this.forceExpandAndShowModal,className:mt()("rdw-link-dropdownoption",p.className),title:p.title||u["components.controls.link.link"]},i().createElement("img",{src:p.icon,alt:""})),s.indexOf("unlink")>=0&&i().createElement(ft.DropdownOption,{onClick:this.removeLink,disabled:!l.link,className:mt()("rdw-link-dropdownoption",d.className),title:d.title||u["components.controls.link.unlink"]},i().createElement("img",{src:d.icon,alt:""}))),t&&b?this.renderAddLinkModal():void 0)}},{key:"render",value:function(){return this.props.config.inDropdown?this.renderInDropDown():this.renderInFlatList()}}]),n}(o.Component);Ct(kt,"propTypes",{expanded:st().bool,doExpand:st().func,doCollapse:st().func,onExpandEvent:st().func,config:st().object,onChange:st().func,currentState:st().object,translations:st().object,modalHandler:st().any});const Dt=kt;function At(e){return(At="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Mt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function xt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Rt(e,t){return(Rt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Nt(e,t){return!t||"object"!==At(t)&&"function"!=typeof t?Lt(e):t}function Lt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _t(e){return(_t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Zt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Wt(e,t,n){e.findEntityRanges((function(e){var t=e.getEntity();return null!==t&&"LINK"===n.getEntity(t).getType()}),t)}function Ft(e){var t,n,r=e.showOpenOptionOnHover;return n=t=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Rt(e,t)}(l,e);var t,n,o,a,c=(o=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=_t(o);if(a){var n=_t(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Nt(this,e)});function l(){var e;Mt(this,l);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return Zt(Lt(e=c.call.apply(c,[this].concat(n))),"state",{showPopOver:!1}),Zt(Lt(e),"openLink",(function(){var t=e.props,n=t.entityKey,r=t.contentState.getEntity(n).getData().url,o=window.open(r,"blank");o&&o.focus()})),Zt(Lt(e),"toggleShowPopOver",(function(){var t=!e.state.showPopOver;e.setState({showPopOver:t})})),Zt(Lt(e),"renderDecorator",(function(){var t=e.props,n=t.children,o=t.entityKey,a=t.contentState.getEntity(o).getData(),c=a.url,l=a.targetOption,u=a.attributes,s=e.state.showPopOver;return u&&u["data-geostory-interaction-type"]?i().createElement("span",{className:"rdw-link-decorator-wrapper"},i().createElement("a",{"data-geostory-interaction-type":u["data-geostory-interaction-type"],"data-geostory-interaction-params":u["data-geostory-interaction-params"]},n)):i().createElement("span",{className:"rdw-link-decorator-wrapper",onMouseEnter:e.toggleShowPopOver,onMouseLeave:e.toggleShowPopOver},i().createElement("a",{href:c,target:l},n),s&&r?i().createElement("img",{src:ft.openlink,alt:"",onClick:e.openLink,className:"rdw-link-decorator-icon"}):void 0)})),e}return t=l,(n=[{key:"render",value:function(){return this.renderDecorator()}}])&&xt(t.prototype,n),l}(o.Component),Zt(t,"propTypes",{entityKey:st().string.isRequired,children:st().array,contentState:st().object}),n}const Ut=function(e){return{strategy:Wt,component:Ft(e)}};var Bt=n(89265),Vt=n.n(Bt),Ht=n(17247),Gt=n.n(Ht),zt=function(e){var t=void 0;if(e instanceof HTMLAnchorElement){var n={};if(e.dataset&&void 0!==e.dataset.mention)n.url=e.href,n.text=e.innerHTML,n.value=e.dataset.value,t=dt.Entity.__create("MENTION","IMMUTABLE",n);else{n.url=e.getAttribute&&e.getAttribute("href")||e.href,n.title=e.innerHTML,n.targetOption=e.target;var r=e.getAttribute&&e.getAttribute("data-geostory-interaction-type"),o=e.getAttribute&&e.getAttribute("data-geostory-interaction-params"),i=e.getAttribute&&e.getAttribute("data-geostory-interaction-name"),a={};i&&o&&r&&(a["data-geostory-interaction-type"]=r,a["data-geostory-interaction-params"]=o,a["data-geostory-interaction-name"]=i),n.attributes=a,t=dt.Entity.__create("LINK","MUTABLE",n)}}return t},qt=function(e,t){if("MENTION"===e.type)return'< href="'.concat(e.data.url,'" class="wysiwyg-mention" data-mention data-value="').concat(e.data.value,'">').concat(t,"</a>");if("LINK"===e.type){var n=e.data.targetOption||"_self",r=e.data.attributes;return r&&r["data-geostory-interaction-type"]?'<a data-geostory-interaction-name="'.concat(r["data-geostory-interaction-name"],'" data-geostory-interaction-type="').concat(r["data-geostory-interaction-type"],'" data-geostory-interaction-params="').concat(r["data-geostory-interaction-params"],"\" onclick=\"__geostory_interaction(type='scrollTo', '").concat(r["data-geostory-interaction-params"],"')\">").concat(t,"</a>"):'<a href="'.concat(e.data.url,'" target="').concat(n,'">').concat(t,"</a>")}if("IMAGE"===e.type){var o=e.data.alignment,i=o&&"none"!==o?"float: ".concat(o,";"):"display: block; margin: 0 auto 0 auto;";return'<img src="'.concat(e.data.src,'" alt="').concat(e.data.alt,'" style="height: ').concat(e.data.height,"; width: ").concat(e.data.width,"; ").concat(i,'" />')}return"EMBEDDED_LINK"===e.type?'<iframe width="'.concat(e.data.width,'" height="').concat(e.data.height,'" src="').concat(e.data.src,'" frameBorder="0"></iframe>'):t};function Kt(){return(Kt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function $t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Yt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Qt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Yt(Object(n),!0).forEach((function(t){Xt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Xt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Jt=(0,$e.compose)((0,$e.withProps)((function(e){var t=e.storyFonts,n=void 0===t?[]:t,r=e.placeholder,o=e.toolbarStyle,i=void 0===o?{}:o,a=e.className,c=void 0===a?"ms-text-editor":a,l=e.toolbar,u=void 0===l?{}:l;return{editorRef:function(e){return setTimeout((function(){return e&&e.focus&&e.focus()}),100)},stripPastedStyles:!0,placeholder:r,toolbarStyle:i,toolbar:Qt({options:["fontFamily","blockType","fontSize","inline","textAlign","colorPicker","list","link","remove"],fontFamily:{options:n.length>0?n:p.Km,className:void 0,component:void 0,dropdownClassName:void 0},link:{inDropdown:!1,className:void 0,component:void 0,popupClassName:void 0,dropdownClassName:void 0,showOpenOptionOnHover:!0,defaultTargetOption:"_self",options:["link","unlink"],link:{icon:void 0,className:void 0},unlink:{icon:void 0,className:void 0},linkCallback:void 0},blockType:{inDropdown:!0,options:["Normal","H1","H2","H3","H4","H5","H6","Blockquote","Code"],className:void 0,component:void 0,dropdownClassName:void 0},inline:{options:["bold","italic","underline","strikethrough","monospace"],bold:{className:"".concat(c,"-toolbar-btn")},italic:{className:"".concat(c,"-toolbar-btn")},underline:{className:"".concat(c,"-toolbar-btn")},strikethrough:{className:"".concat(c,"-toolbar-btn")},code:{className:"".concat(c,"-toolbar-btn")}},textAlign:{left:{className:"".concat(c,"-toolbar-btn")},center:{className:"".concat(c,"-toolbar-btn")},right:{className:"".concat(c,"-toolbar-btn")},justify:{className:"".concat(c,"-toolbar-btn")}},colorPicker:{className:"".concat(c,"-toolbar-btn")},remove:{className:"".concat(c,"-toolbar-btn")}},u),toolbarClassName:"".concat(c,"-toolbar"),wrapperClassName:"".concat(c,"-wrapper"),editorClassName:"".concat(c,"-main")}})),(0,$e.renderComponent)(ft.Editor)),en=(0,$e.compose)((0,$e.lifecycle)({componentWillUnmount:function(){var e=this.props,t=e.editorState,n=e.save;(void 0===n?function(){}:n)(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(e){var n=1!==(0,dt.convertToRaw)(e.getCurrentContent()).blocks.length||(0,dt.convertToRaw)(e.getCurrentContent()).blocks[0].text,r=Vt()((0,dt.convertToRaw)(e.getCurrentContent()),null,null,qt);return n?r:t}return t}(t,p.gg))}}),(0,$e.withHandlers)({onBlur:function(e){var t=e.toggleEditing,n=void 0===t?function(){}:t;return function(){n(!1)}}}),(0,$e.withProps)((function(e){var t=e.sections;return{availableStorySections:(void 0===t?[]:t).reduce((function(e,t){var n,r=[];return[p.ID.IMMERSIVE,p.ID.CAROUSEL].includes(t.type)?t.contents.forEach((function(e){r.push(e)})):r.push(t),[].concat(function(e){if(Array.isArray(e))return $t(e)}(n=e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(n)||function(e,t){if(e){if("string"==typeof e)return $t(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?$t(e,t):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),r)}),[])}})),(0,$e.withProps)((function(e){var t=e.availableStorySections,n=void 0===t?[]:t;return{toolbar:{link:{inDropdown:!1,className:void 0,component:function(e){return i().createElement(Dt,Kt({},e,{availableStorySections:n}))},popupClassName:void 0,dropdownClassName:void 0,showOpenOptionOnHover:!0,defaultTargetOption:"_self",options:["link","unlink"],link:{icon:void 0,className:void 0},unlink:{icon:void 0,className:void 0},linkCallback:void 0,getLinkDecorator:Ut}}}})),Jt);const tn=(0,$e.compose)((0,$e.withState)("contentEditing","setContentEditing",!1),(0,$e.withState)("editorState","onEditorStateChange"),(0,$e.withHandlers)({toggleEditing:function(e){var t=e.bubblingTextEditing,n=void 0===t?function(){}:t,r=e.sectionType,o=e.onEditorStateChange,i=void 0===o?function(){}:o,a=e.setContentEditing,c=void 0===a?function(){}:a;return function(e,t){if(e){var o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=Gt()(e,null,zt),n=dt.ContentState.createFromBlockArray(t.contentBlocks);return dt.EditorState.createWithContent(n)}(t);if(r===p.ID.TITLE&&"unstyled"===dt.RichUtils.getCurrentBlockType(o)){var a=o.getCurrentContent();a=dt.Modifier.setBlockType(a,dt.EditorState.createWithContent(a).getSelection(),"header-one"),o=dt.EditorState.createWithContent(a)}i(o),c(!0),n(!0)}else c(!1),n(!1)}}}),(0,$e.branch)((function(e){return!!e.contentEditing}),en)),nn=(0,$e.compose)((0,$e.withHandlers)({save:function(e){var t=e.update,n=void 0===t?function(){}:t;return function(e){return n("html",e)}}}),(0,$e.branch)((function(e){return e.mode===p.nl.EDIT}),tn),(0,$e.compose)((0,$e.withPropsOnChange)(["sectionType"],(function(e){var t=e.sectionType;return{placeholder:p.ID.TITLE===t?"geostory.builder.defaults.htmlTitlePlaceholder":"geostory.builder.defaults.htmlPlaceholder",placeholderTag:p.ID.TITLE===t?"h1":"p"}})),(0,pt.Z)("placeholder")))((function(e){var t=e.placeholder,n=e.placeholderTag,r=void 0===n?"p":n,o=e.id,a=e.toggleEditing,c=void 0===a?function(){}:a,l=e.html,u=e.mode;return i().createElement("div",{className:"ms-text-wrapper"},l!==p.gg&&i().createElement("div",{id:o,onClick:function(){return c(!0,l)},dangerouslySetInnerHTML:{__html:l}}),(!l||l===p.gg)&&u===p.nl.EDIT&&i().createElement("div",{className:"ms-text-placeholder",id:"placeholder"+o,onClick:function(){return c(!0,l===p.gg?"":l)},dangerouslySetInnerHTML:{__html:"<".concat(r,">").concat(t,"</").concat(r,">")}}))}));var rn=n(82017),on=n(7472),an=n(57588),cn=["show","style","modal","draggable","closeGlyph","closable","onClose","title","header","footer","children"];function ln(){return(ln=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function un(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function sn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?un(Object(n),!0).forEach((function(t){pn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):un(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function pn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const dn=function(e){var t=e.show,n=e.style,r=void 0===n?{}:n,o=e.modal,a=e.draggable,c=void 0!==a&&a,l=e.closeGlyph,u=void 0===l?"1-close":l,s=e.closable,p=void 0===s||s,d=e.onClose,f=void 0===d?function(){}:d,y=e.title,m=e.header,b=e.footer,v=e.children,g=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(e,cn);return t?i().createElement(on.Z,ln({modal:o,onClickOut:p&&o?function(){return f()}:null,style:sn(sn({},r),{},{display:t?"block":"none"}),draggable:c},g),i().createElement("span",{role:"header"},y||m||i().createElement("span",null," "),p?i().createElement("button",{onClick:function(){return f()},className:"settings-panel-close close"},i().createElement(an.Glyphicon,{glyph:u})):null),i().createElement("span",{role:"body"},v),b?i().createElement("span",{role:"footer"},b):null):null};var fn=n(38560),yn=n(5346),mn=n(99534),bn=(0,$e.branch)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.src,n=void 0===t?"":t,r=e.viewHeight,o=e.size;return!n||!r||!o}),(0,nt.Z)((function(){return!0}),(function(){return{glyph:"code"}})));const vn=(0,$e.compose)(bn)((function(e){var t=e.src,n=e.size,r=e.viewHeight;return i().createElement("div",{className:"ms-webpage-wrapper"},i().createElement("iframe",{src:t,height:"".concat((0,p.t4)(n,r),"px")}))}));var gn=n(11847),hn=n(63202),On=n(48759),wn=n(23279),En=n.n(wn);function Pn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Sn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Pn(Object(n),!0).forEach((function(t){jn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Pn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function jn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Cn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Tn=function(e){var t,n,r=e.id,a=e.onLoad,c=e.loading,l=e.debounceTime,u=e.children,s=e.loaderComponent,p=e.loaderStyle,d=(t=(0,On.YD)(),n=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(t,n)||function(e,t){if(e){if("string"==typeof e)return Cn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Cn(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),f=d[0],y=d[1],m=(0,o.useRef)(null),b=s;return(0,o.useEffect)((function(){return m.current=En()((function(e){a(e)}),l),function(){m.current.cancel()}}),[]),(0,o.useEffect)((function(){y&&c&&m.current(r),!y&&c&&m.current.cancel()}),[y,c,r]),i().createElement("div",{ref:f,className:"ms-visibility-container"},c?b?i().createElement(b,{style:Sn({},p)}):null:(0,o.cloneElement)(u,{inView:y}))};Tn.propTypes={id:st().string,debounceTime:st().number,loading:st().bool,onLoad:st().func,loaderComponent:st().element},Tn.defaultProps={id:"",debounceTime:300,loading:!0,onLoad:function(){},loaderComponent:null};const In=Tn;var kn=n(32425);function Dn(e){return(Dn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function An(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Mn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function xn(e,t){return(xn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Rn(e,t){return!t||"object"!==Dn(t)&&"function"!=typeof t?Nn(e):t}function Nn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ln(e){return(Ln=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Zn=function(){return i().createElement("div",{className:"ms-media-loader"},i().createElement(kn.Z,{size:52}))},Wn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xn(e,t)}(c,e);var t,n,r,o,a=(r=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ln(r);if(o){var n=Ln(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Rn(this,e)});function c(){var e;An(this,c);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return _n(Nn(e=a.call.apply(a,[this].concat(n))),"state",{url:e.props.src||"",error:!1,loading:!0}),_n(Nn(e),"updateURL",(function(t){var n=t.target.value;e.setState({url:n})})),_n(Nn(e),"save",(function(){var t=e.state.url,n=!(0,gn.K2)(t,(0,hn.u8)("GeoStoryValidIframeURLRegex"));e.setState({error:n}),n||e.props.onChange(t)})),e}return t=c,(n=[{key:"render",value:function(){var e=this,t=this.props,n=t.onClose,r=t.editURL,o=this.state,a=o.url,c=o.error;return i().createElement(i().Fragment,null,i().createElement(mn.Z,null,i().createElement(dn,{modal:!0,show:r,onClickOut:function(e){return e.preventDefault()&&e.stopPropagation()},title:i().createElement(yn.Z,{msgId:"geostory.webPageCreator.title"}),onClose:n,id:"web-page-creator",footer:i().createElement(fn.Z,{bsSize:"small",onClick:this.save},i().createElement(yn.Z,{msgId:"geostory.webPageCreator.saveButton"}))},c&&i().createElement("div",{className:"dropzone-errorBox alert-danger"},i().createElement(yn.Z,{msgId:"geostory.webPageCreator.error"})),i().createElement(an.FormGroup,{controlId:"WEBPAGE_URL",validationState:c&&"error"},i().createElement(an.ControlLabel,null,i().createElement(yn.Z,{msgId:"geostory.webPageCreator.url.label"})),i().createElement(an.FormControl,{label:"URL",type:"text",value:a,onChange:this.updateURL,required:!0})))),this.props.lazy?i().createElement(In,{key:this.props.id,id:this.props.id,debounceTime:this.props.debounceTime,loading:this.state.loading,onLoad:function(){return e.setState({loading:!1})},loaderComponent:Zn},i().createElement(vn,this.props)):i().createElement(vn,this.props))}}])&&Mn(t.prototype,n),c}(i().PureComponent);_n(Wn,"propTypes",{editURL:st().bool,onClose:st().func,onChange:st().func,src:st().string,id:st().string,debounceTime:st().number,lazy:st().bool}),_n(Wn,"defaultProps",{lazy:!0});var Fn=(0,$e.compose)((0,$e.withHandlers)({onClose:function(e){var t=e.update,n=void 0===t?function(){}:t;return function(){return n("editURL",!1,"merge")}}}))(Wn);const Un=(0,a.connect)(null,{onChange:y.YM})(Fn);var Bn=["type"];function Vn(){return(Vn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var Hn=function(e){var t=e.type;return i().createElement("div",{className:"ms-content ms-content-unknown"},'warning: unknown content type "'.concat(t,'"'))};const Gn=function(e){var t=e.type,n=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(e,Bn),r=function(e){switch(e){case p.bT.TEXT:return nn;case p.bT.MEDIA:case p.Tr.IMAGE:case p.Tr.MAP:case p.Tr.VIDEO:return rn.ZP;case p.bT.WEBPAGE:return Un;default:return Hn}}(t);return i().createElement(r,Vn({type:t},n))};var zn=n(25288),qn=n(80717);function Kn(e){return(Kn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var $n=["onClick"];function Yn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Qn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Yn(Object(n),!0).forEach((function(t){rr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Xn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Jn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function er(e,t){return(er=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function tr(e,t){return!t||"object"!==Kn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function nr(e){return(nr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function rr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var or=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&er(e,t)}(c,e);var t,n,r,o,a=(r=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=nr(r);if(o){var n=nr(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return tr(this,e)});function c(){return Xn(this,c),a.apply(this,arguments)}return t=c,(n=[{key:"UNSAFE_componentWillReceiveProps",value:function(e){!this.trigger||e.containerWidth===this.props.containerWidth&&e.containerHeight===this.props.containerHeight||this.trigger.hide()}},{key:"render",value:function(){var e=this;return i().createElement(zn.Z,{className:"add-bar",popoverClassName:"add-bar-popover",content:i().createElement(qn.Z,{btnDefaultProps:{className:"square-button btn-tray"},buttons:this.props.buttons.map((function(t){var n=t.onClick,r=void 0===n?function(){}:n;return Qn(Qn({},function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(t,$n)),{},{onClick:function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];r.apply(void 0,n),e.trigger.hide(),n[0]&&n[0].preventDefault&&n[0].preventDefault()}})}))}),ref:function(t){t&&(e.trigger=t.trigger)},placement:"top"},i().createElement(fn.Z,{className:this.props.addButtonClassName},i().createElement(an.Glyphicon,{glyph:"plus"})))}}])&&Jn(t.prototype,n),c}(i().Component);rr(or,"propTypes",{id:st().string,type:st().string,buttons:st().array,containerWidth:st().oneOfType([st().number,st().string]),containerHeight:st().oneOfType([st().number,st().string]),addButtonClassName:st().string}),rr(or,"defaultProps",{id:"",type:"",buttons:[],containerWidth:0,containerHeight:0,addButtonClassName:""});const ir=or;var ar=["id"];function cr(e){return function(e){if(Array.isArray(e))return lr(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return lr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?lr(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function lr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ur(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function sr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ur(Object(n),!0).forEach((function(t){pr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ur(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function pr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function dr(){return(dr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function fr(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}const yr=function(e){var t=e.viewWidth,n=e.viewHeight,r=e.className,o=e.contentProps,a=void 0===o?{}:o,c=e.addButtons,l=void 0===c?[]:c,u=e.tools,s=void 0===u?[]:u,d=e.contents,f=void 0===d?[]:d,y=e.ContentComponent,m=void 0===y?Gn:y,b=e.mode,v=e.sectionType,g=e.editMedia,h=void 0===g?function(){}:g,O=e.editWebPage,w=void 0===O?function(){}:O,E=e.add,P=void 0===E?function(){}:E,S=e.update,j=void 0===S?function(){}:S,C=e.remove,T=void 0===C?function(){}:C,I=e.bubblingTextEditing,k=void 0===I?function(){}:I,D=e.storyTheme,A=e.sections,M=void 0===A?[]:A,x=e.storyFonts;return i().createElement("div",{className:r},f.reduce((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1?arguments[1]:void 0,o=r.id,c=fr(r,ar),u=[i().createElement(m,dr({id:o,key:"".concat(o,"-content"),mode:b,viewWidth:t,sectionType:v,viewHeight:n,editMedia:function(e){for(var t=e.path,n=void 0===t?"":t,r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return h.apply(void 0,[{path:'contents[{"id": "'.concat(o,'"}]')+n}].concat(i))},editWebPage:function(e){for(var t=e.path,n=void 0===t?"":t,r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return w.apply(void 0,[{path:'contents[{"id": "'.concat(o,'"}]')+n}].concat(i))},add:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return P.apply(void 0,['contents[{"id": "'.concat(o,'"}].')+e].concat(n))},update:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return j.apply(void 0,['contents[{"id": "'.concat(o,'"}].')+e].concat(n))},remove:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return T.apply(void 0,['contents[{"id": "'.concat(o,'"}]')+(e?"."+e:"")].concat(n))}},a,c,{storyTheme:D,storyFonts:x,bubblingTextEditing:k,tools:s&&s[c.type],sections:M}))];return b===p.nl.EDIT&&l.length>0&&u.push(i().createElement(ir,{key:"".concat(o,"-content-add-buttons"),containerWidth:t,containerHeight:n,buttons:l.map((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return sr(sr({},e),{},{onClick:function(){return P("contents",o,e.template)}})}))})),[].concat(cr(e),u)}),[]))};n(66337);var mr=["onVisibilityChange","rootSelector"],br=["intersectionObserverOptions","onVisibilityChange"];function vr(){return(vr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function gr(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}const hr=function(e){return(0,$e.compose)((0,$e.withHandlers)({onVisibilityChange:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.id,n=e.onVisibilityChange,r=void 0===n?function(){}:n;return function(e,n){return r({id:t,visible:e,entry:n})}}}),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.onVisibilityChange,n=(e.rootSelector,gr(e,mr));return function(e){return function(r){var o=r.intersectionObserverOptions,a=void 0===o?{}:o,c=r.onVisibilityChange,l=gr(r,br),u=t||c;return i().createElement(On.df,vr({},n,a,{onChange:u}),(function(t){var n=t.inView,r=t.ref,o=t.entry;return i().createElement(e,vr({},l,{inView:n,inViewRef:r,inViewEntry:o}))}))}}}(e))};var Or=n(90085),wr=n(12610),Er=n(18446),Pr=n.n(Er);function Sr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return jr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?jr(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function jr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Cr=(0,wr.Z)(an.DropdownButton);function Tr(e){var t=e.value,n=e.options,r=void 0===n?[]:n,a=e.onSelect,c=void 0===a?function(){}:a,l=e.glyph,u=void 0===l?"":l,s=e.tooltipId,p=e.pullRight,d=void 0!==p&&p,f=e.className,y=void 0===f?"square-button-md no-border":f,m=e.disabled,b=e.noTooltipWhenDisabled,v=void 0!==b&&b,g=e.hideMenuItem,h=void 0===g?function(){return!1}:g,O=e.shouldClose,w=Sr((0,o.useState)(!1),2),E=w[0],P=w[1],j=Sr((0,o.useState)(!1),2),C=j[0],T=j[1],I=(Z()(r,(function(e){return Pr()(e.value,t)}))||{}).glyph;return(0,o.useEffect)((function(){m&&P(!1)}),[m]),i().createElement(Cr,{noCaret:!0,open:E,noTooltipWhenDisabled:v,tooltipId:s,pullRight:d,className:y,disabled:m,title:i().createElement(an.Glyphicon,{glyph:I||u}),onToggle:function(e,n,r){return C||"select"===(null==r?void 0:r.source)||O&&!O(t,n)?null:P(e)}},r.map((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(null==e?void 0:e.Component)||an.MenuItem;return h(t,e)?null:i().createElement(n,{key:e.value,selected:t,value:e.value,active:F()(null==e?void 0:e.isActive)&&e.isActive(t)||!S()(t)&&t===e.value,onClick:null!=e&&e.Component?c:function(){return c(e.value)},onActive:function(e){return T(e)}},e.label)})))}var Ir=n(12122),kr=n(11766),Dr=n(13218),Ar=n.n(Dr);function Mr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function xr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Mr(Object(n),!0).forEach((function(t){Rr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Mr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Rr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Nr(){return(Nr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var Lr=(0,Ir.Z)(Or.Z),_r={primary:"btn-primary",default:"btn-default"},Zr=function(e){var t=e.editMap,n=void 0!==t&&t,r=e.align,o=e.sectionType,a=e.size,c=e.update,l=void 0===c?function(){}:c,u=e.filterOptions,s=e.pullRight;return i().createElement(Tr,{value:a,noTooltipWhenDisabled:!0,disabled:n,glyph:"resize-horizontal",pullRight:s||("right"===r||"full"===a||"large"===a)&&!o,tooltipId:"geostory.contentToolbar.contentSize",options:[{value:"small",glyph:"size-small",label:i().createElement(yn.Z,{msgId:"geostory.contentToolbar.smallSizeLabel"})},{value:"medium",glyph:"size-medium",label:i().createElement(yn.Z,{msgId:"geostory.contentToolbar.mediumSizeLabel"})},{value:"large",glyph:"size-large",label:i().createElement(yn.Z,{msgId:"geostory.contentToolbar.largeSizeLabel"})},{value:"full",glyph:"size-extra-large",label:i().createElement(yn.Z,{msgId:"geostory.contentToolbar.fullSizeLabel"})}].filter((function(e){return!u||u(e)})),onSelect:function(e){return l("size",e)}})},Wr=function(e){var t=e.editMap,n=void 0!==t&&t,r=e.align,o=e.sectionType,a=e.size,c=e.update,l=void 0===c?function(){}:c;return i().createElement(Tr,{value:r,noTooltipWhenDisabled:!0,disabled:"full"===a||n,glyph:"align-center",pullRight:("right"===r||"full"===a||"large"===a)&&!o,tooltipId:"geostory.contentToolbar.contentAlign",options:[{value:"left",label:i().createElement(yn.Z,{msgId:"geostory.contentToolbar.leftAlignLabel"}),glyph:"align-left"},{value:"center",label:i().createElement(yn.Z,{msgId:"geostory.contentToolbar.centerAlignLabel"}),glyph:"align-center"},{value:"right",label:i().createElement(yn.Z,{msgId:"geostory.contentToolbar.rightAlignLabel"}),glyph:"align-right"}],onSelect:function(e){return l("align",e)}})},Fr=function(e){var t=e.editMap,n=void 0!==t&&t,r=e.theme,o=e.storyTheme,a=e.align,c=e.sectionType,l=e.update,u=void 0===l?function(){}:l,s=e.themeProps,p=e.size;return i().createElement(Tr,{value:r,noTooltipWhenDisabled:!0,pullRight:("right"===a||"full"===p||"large"===p)&&!c,glyph:"dropper",tooltipId:"geostory.contentToolbar.contentTheme",disabled:n,shouldClose:function(e,t){var n,r;return Ar()(e)&&"ms-color-picker-cover"!==(null==t||null===(n=t.target)||void 0===n||null===(r=n.getAttribute)||void 0===r?void 0:r.call(n,"class"))||E()(e)||void 0===e},hideMenuItem:function(e,t){return"custom"===(null==e?void 0:e.value)&&"custom"!==(null==t?void 0:t.value)},options:[{value:"",isActive:function(e){return void 0===e||""===e||Ar()(e)&&(void 0===e.value||""===e.value)},label:i().createElement(yn.Z,{msgId:"geostory.contentToolbar.defaultThemeLabel"})},{value:"bright",isActive:function(e){return"bright"===(null==e?void 0:e.value)||"bright"===e},label:i().createElement(yn.Z,{msgId:"geostory.contentToolbar.brightThemeLabel"})},{value:"dark",isActive:function(e){return"dark"===(null==e?void 0:e.value)||"dark"===e},label:i().createElement(yn.Z,{msgId:"geostory.contentToolbar.darkThemeLabel"})},{value:"custom",Component:function(e){return i().createElement(kr.H,Nr({},e,{disableBackgroundAlpha:null==s?void 0:s.disableBackgroundAlpha,disableShadow:null==s?void 0:s.disableShadow,disableTextColor:null==s?void 0:s.disableTextColor,onUpdate:u,storyTheme:o}))}}],onSelect:function(e){return u("theme",xr(xr({},Ar()(r)&&r),{},{value:e}))}})},Ur=function(e){var t=e.editMap,n=void 0!==t&&t,r=e.forceDelBtnDisable,o=void 0!==r&&r,a=e.path,c=e.remove,l=void 0===c?function(){}:c,u=e.bsStyle;return i().createElement(Lr,{glyph:"trash",visible:!0,noTooltipWhenDisabled:!0,disabled:n||o,className:"".concat("square-button-md no-border"," ").concat(u&&_r[u]),tooltipId:"geostory.contentToolbar.remove",confirmTitle:i().createElement(yn.Z,{msgId:"geostory.contentToolbar.removeConfirmTitle"}),confirmContent:i().createElement(yn.Z,{msgId:"geostory.contentToolbar.removeConfirmContent"}),onClick:function(){l(a)}})},Br=["tools"];function Vr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Hr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Vr(Object(n),!0).forEach((function(t){Gr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Vr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Gr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var zr={size:function(e){return{renderButton:i().createElement(Zr,e)}},align:function(e){return{renderButton:i().createElement(Wr,e)}},theme:function(e){return{renderButton:i().createElement(Fr,e)}},fit:function(e){var t=e.editMap,n=void 0!==t&&t,r=e.fit,o=e.update,i=void 0===o?function(){}:o;return{value:r,glyph:"contain"===r?"fit-cover":"fit-contain",disabled:n,visible:!0,tooltipId:"contain"===r?"geostory.contentToolbar.cover":"geostory.contentToolbar.fit",onClick:function(){return i("fit","contain"===r?"cover":"contain")}}},cover:function(e){var t=e.editMap,n=void 0!==t&&t,r=e.cover,o=e.updateSection,i=void 0===o?function(){}:o;return{value:r,glyph:r?"height-auto":"height-view",visible:!0,disabled:n,tooltipId:r?"geostory.contentToolbar.contentHeightAuto":"geostory.contentToolbar.contentHeightView",onClick:function(){return i({cover:!r},"merge")}}},editMedia:function(e){var t=e.editMap,n=void 0!==t&&t,r=e.path,o=e.editMedia,i=void 0===o?function(){}:o,a=e.sectionType;return{glyph:"pencil","data-button":"pencil",visible:!0,disabled:n,tooltipId:"geostory.contentToolbar.editMedia",onClick:function(){i({path:r},r?a:"")}}},remove:function(e){return{renderButton:i().createElement(Ur,e)}},editMap:function(e){var t=e.editMap,n=void 0!==t&&t,r=e.update,o=void 0===r?function(){}:r;return{glyph:"map-edit",visible:!0,disabled:n,bsStyle:n?"success":"default",tooltipId:"geostory.contentToolbar.editMap",onClick:function(){o("editMap",!n)}}},editURL:function(e){var t=e.editURL,n=void 0!==t&&t,r=e.path,o=e.editWebPage,i=void 0===o?function(){}:o;return{glyph:"pencil",visible:!0,disabled:n,bsStyle:n?"success":"default",tooltipId:"geostory.contentToolbar.editURL",onClick:function(){i({path:r})}}},muted:function(e){var t=e.update,n=e.muted;return{glyph:n?"muted":"audio",visible:!0,active:!n,tooltipId:n?"geostory.contentToolbar.enableAudio":"geostory.contentToolbar.disableAudio",onClick:function(){t("muted",!n)}}},autoplay:function(e){var t=e.update,n=e.autoplay;return{glyph:"play-circle",visible:!("cover"===e.fit),active:n,tooltipId:n?"geostory.contentToolbar.disableAutoplay":"geostory.contentToolbar.enableAutoplay",onClick:function(){t("autoplay",!n)}}},loop:function(e){var t=e.update,n=e.loop;return{glyph:"loop",visible:!("cover"===e.fit),active:n,tooltipId:n?"geostory.contentToolbar.disableLoop":"geostory.contentToolbar.enableLoop",onClick:function(){t("loop",!n)}}},showCaption:function(e){var t=e.editMap,n=void 0!==t&&t,r=e.update,o=e.showCaption,i=e.caption,a=e.description;return{glyph:"caption",visible:!(!i&&!a),disabled:n,active:!(!o||n),tooltipId:o?"geostory.contentToolbar.hideCaption":"geostory.contentToolbar.showCaption",onClick:function(){r("showCaption",!o)}}},add:function(e){var t=e.editMap,n=void 0!==t&&t,r=e.addDisabled,o=void 0!==r&&r,i=e.add,a=void 0===i?function(){}:i,c=e.bsStyle;return{glyph:"plus",visible:!0,bsStyle:void 0===c?"default":c,tooltipId:"geostory.contentToolbar.add",disabled:n||o,onClick:a}},edit:function(e){var t=e.editMap,n=void 0!==t&&t,r=e.edit,o=void 0===r?function(){}:r,i=e.bsStyle;return{glyph:"pencil",visible:!0,bsStyle:void 0===i?"default":i,tooltipId:"geostory.contentToolbar.edit",disabled:n,onClick:o}},marker:function(e){var t=e.editMap,n=void 0!==t&&t,r=e.markerDisabled,o=void 0!==r&&r,i=e.marker,a=void 0===i?function(){}:i,c=e.bsStyle;return{glyph:"map-marker",visible:!0,tooltipId:"geostory.contentToolbar.marker",bsStyle:void 0===c?"default":c,disabled:n||o,onClick:a}},closeDraw:function(e){var t=e.editMap,n=void 0!==t&&t,r=e.bsStyle,o=void 0===r?"default":r,i=e.update,a=void 0===i?function(){}:i,c=e.map,l=(c=void 0===c?{}:c).resetMapInfo;return{glyph:"1-close",visible:!0,tooltipId:"geostory.contentToolbar.closeMapEditing",bsStyle:o,disabled:!n,onClick:function(){a("editMap",!n),a("map.mapDrawControl",!1),l&&a("map.mapInfoControl",!0)}}}};function qr(e){var t=e.tools,n=void 0===t?[]:t,r=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(e,Br);return i().createElement("div",{className:"ms-content-toolbar"},i().createElement(qn.Z,{btnDefaultProps:{className:"square-button-md no-border",noTooltipWhenDisabled:!0},buttons:n.filter((function(e){return(null==e?void 0:e.id)&&zr[e.id]||zr[e]})).map((function(e){return(null==e?void 0:e.id)&&zr[e.id](Hr(Hr({},r),e))||zr[e](r)}))}))}var Kr=["id","inViewRef","children","type","contentWrapperStyle","contentToolbar","mode"];function $r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Yr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$r(Object(n),!0).forEach((function(t){Qr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Qr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Xr=function(e){var t=e.id,n=e.inViewRef,r=e.children,o=e.type,a=e.contentWrapperStyle,c=e.contentToolbar,l=e.mode,u=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(e,Kr),s=c||qr;return i().createElement("div",{id:t,ref:n,style:Yr(Yr({},a),u.hideContent&&{display:"none"}),className:"ms-content ms-content-".concat(o).concat((0,p.w)(u))},i().createElement("div",{className:"ms-content-body",style:(0,p.cy)(u)},l===p.nl.EDIT&&i().createElement(s,u),r))};function Jr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var eo=(0,$e.compose)(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return $e.nest.apply(void 0,t.concat([e]))}}(Xr),(0,$e.setDisplayName)("ColumnContent"))(Gn),to=function(e){return{id:"size",filterOptions:function(e){return"full"!==e.value},pullRight:e}};const no=(0,$e.compose)((0,$e.branch)((function(e){var t=e.type,n=e.sectionType;return[p.ID.IMMERSIVE,p.ID.CAROUSEL].includes(n)&&t===p.bT.COLUMN}),hr({threshold:[0,.25,.5,.75]})),function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return $e.nest.apply(void 0,t.concat([e]))}}(Xr),(0,$e.setDisplayName)("SectionContent"),(0,$e.branch)((function(e){return e.type===p.bT.COLUMN}),(0,$e.renderComponent)((function(e){var t,n=e.viewWidth,r=e.viewHeight,o=e.contents,a=void 0===o?[]:o,c=e.mode,l=e.add,u=void 0===l?function(){}:l,s=e.editMedia,d=void 0===s?function(){}:s,f=e.editWebPage,y=void 0===f?function(){}:f,m=e.update,b=void 0===m?function(){}:m,v=e.remove,g=void 0===v?function(){}:v,h=e.bubblingTextEditing,O=void 0===h?function(){}:h,w=e.expandable,E=e.mediaViewer,P=e.contentToolbar,S=e.sections,j=void 0===S?[]:S,C=e.sectionType,T=e.overrideTools,I=void 0===T?function(e){return e}:T,k=e.storyFonts;return i().createElement(yr,{className:"ms-column-contents",ContentComponent:eo,contents:a,mode:c,add:u,editMedia:d,editWebPage:y,update:b,remove:g,viewWidth:n,viewHeight:r,bubblingTextEditing:O,sectionType:C,contentProps:{expandable:w,mediaViewer:E,contentToolbar:P},sections:j,storyFonts:k,tools:I((t={},Jr(t,p.bT.TEXT,["remove"]),Jr(t,p.Tr.IMAGE,["editMedia",to(),"showCaption","remove"]),Jr(t,p.Tr.MAP,["editMedia","editMap",to(!0),"showCaption","remove"]),Jr(t,p.bT.WEBPAGE,["editURL",to(!0),"remove"]),Jr(t,p.Tr.VIDEO,["editMedia","muted","autoplay","loop","showCaption","remove"]),t)),addButtons:[{glyph:"sheet",tooltipId:"geostory.addTextContent",template:p.bT.TEXT},{glyph:"picture",tooltipId:"geostory.addMediaContent",template:p.bT.MEDIA},{glyph:"webpage",tooltipId:"geostory.addWebPageContent",template:p.bT.WEBPAGE}]})}))))(Gn),ro=(0,$e.compose)((0,$e.defaultProps)({ContentComponent:no}),(0,$e.withHandlers)({editMedia:function(e){var t=e.editMedia,n=void 0===t?function(){}:t,r=e.sectionId;return function(e){for(var t=e.path,o=arguments.length,i=new Array(o>1?o-1:0),a=1;a<o;a++)i[a-1]=arguments[a];return n.apply(void 0,[{path:'sections[{"id": "'.concat(r,'"}].')+t}].concat(i))}},editWebPage:function(e){var t=e.editWebPage,n=void 0===t?function(){}:t,r=e.sectionId;return function(e){for(var t=e.path,o=arguments.length,i=new Array(o>1?o-1:0),a=1;a<o;a++)i[a-1]=arguments[a];return n.apply(void 0,[{path:'sections[{"id": "'.concat(r,'"}].')+t}].concat(i))}},add:function(e){var t=e.add,n=void 0===t?function(){}:t,r=e.sectionId;return function(e){for(var t=arguments.length,o=new Array(t>1?t-1:0),i=1;i<t;i++)o[i-1]=arguments[i];return n.apply(void 0,['sections[{"id": "'.concat(r,'"}].')+e].concat(o))}},update:function(e){var t=e.update,n=void 0===t?function(){}:t,r=e.sectionId;return function(e){for(var t=arguments.length,o=new Array(t>1?t-1:0),i=1;i<t;i++)o[i-1]=arguments[i];return n.apply(void 0,['sections[{"id": "'.concat(r,'"}].')+e].concat(o))}},remove:function(e){var t=e.remove,n=void 0===t?function(){}:t,r=e.sectionId;return function(e){for(var t=arguments.length,o=new Array(t>1?t-1:0),i=1;i<t;i++)o[i-1]=arguments[i];return n.apply(void 0,['sections[{"id": "'.concat(r,'"}].')+e].concat(o))}}}),(0,$e.setDisplayName)("SectionContents"))(yr);var oo=n(84753),io=n.n(oo);function ao(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function co(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function lo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?co(Object(n),!0).forEach((function(t){uo(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):co(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function uo(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}(0,$e.setObservableConfig)(Ye.Z);var so=(0,$e.withProps)((function(e){var t=e.id,n=e.backgroundId,r=e.contents,o=function(e,t){var n=L()(e,{id:t});return e[-1!==n&&n?n:0]}(void 0===r?[]:r,n)||{},i=o&&o.id;return{background:D()(o,"background")||{type:"none"},contentId:i,sectionId:t,path:'sections[{"id": "'.concat(t,'"}].contents[{"id": "').concat(i,'"}].background')}})),po=(0,$e.withHandlers)({updateBackground:function(e){var t=e.sectionId,n=e.contentId,r=e.update,o=void 0===r?function(){}:r;return function(e){for(var r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return o.apply(void 0,['sections[{"id": "'.concat(t,'"}].contents[{"id": "').concat(n,'"}].background.')+e].concat(i))}},updateSection:function(e){var t=e.sectionId,n=e.update,r=void 0===n?function(){}:n;return function(){for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return r.apply(void 0,['sections[{"id": "'.concat(t,'"}]')].concat(n))}}}),fo=(0,$e.compose)(so,po);const yo=(0,$e.compose)((0,$e.mapPropsStream)((function(e){var t=(0,$e.createEventHandler)(),n=t.handler,r=t.stream;return b.Observable.combineLatest(e,function(e,t){var n=e.scan((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=t.id,r=t.visible,o=t.entry;return lo(lo({},e),{},uo({},n,{visible:r,entry:o}))}),{}).debounceTime(100).map((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{maxItem:io()(Object.keys(e),(function(t){return e[t].visible?D()(e[t],"entry.intersectionRatio"):-1/0})),items:e}}));return b.Observable.merge(n.pluck("maxItem").distinctUntilChanged().map((function(e){return{backgroundId:e}})),n.map((function(e){var t=e.maxItem,n=e.items;return 0===D()(n[t],"entry.intersectionRatio")?"EMPTY":t})).withLatestFrom(t.pluck("updateCurrentPage")).do((function(e){var t,n,r=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(t,n)||function(e,t){if(e){if("string"==typeof e)return ao(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ao(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],i=r[1];return i&&i({columnId:o})})).ignoreElements())}(r,e).startWith({}),(function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return lo(lo({},t.reduce((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return lo(lo({},e),t)}),{})),{},{onVisibilityChange:n})}))})),fo);var mo=n(89438);function bo(e){return(bo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function vo(){return(vo=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function go(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ho(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?go(Object(n),!0).forEach((function(t){Co(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):go(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Oo(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function wo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Eo(e,t){return(Eo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Po(e,t){return!t||"object"!==bo(t)&&"function"!=typeof t?So(e):t}function So(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function jo(e){return(jo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Co(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var To=n(56936),Io=n(83255),ko=n.n(Io);function Do(e){return(Do="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ao(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Mo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ao(Object(n),!0).forEach((function(t){Wo(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ao(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function xo(){return(xo=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Ro(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function No(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Lo(e,t){return(Lo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _o(e,t){return!t||"object"!==Do(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Zo(e){return(Zo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Wo(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Fo=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Lo(e,t)}(c,e);var t,n,r,o,a=(r=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Zo(r);if(o){var n=Zo(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return _o(this,e)});function c(){return Ro(this,c),a.apply(this,arguments)}return t=c,(n=[{key:"render",value:function(){var e=(0,p.cy)(this.props),t=!this.props.disableToolbarPortal&&this.refs&&this.refs.div&&this.refs.div.parentNode,n=this.props.sectionType===p.ID.TITLE?["editMedia","cover"]:["editMedia"],r=this.props.contentToolbar||qr,o=i().createElement(r,xo({},this.props,{themeProps:{disableBackgroundAlpha:!0,disableTextColor:!0,disableShadow:!0},tools:this.props.tools&&this.props.type&&this.props.tools[this.props.type]||this.props.sectionType===p.ID.BANNER&&[].concat(n,["cover","remove"])||n})),a="".concat(this.props.sectionId||"ms","-media-").concat(this.props.id||this.props.resourceId);return i().createElement("div",{ref:"div",className:"ms-section-background",style:Mo({},this.props.style)},i().createElement("div",{className:"ms-section-background-container".concat((0,p.w)(this.props)),style:Mo(Mo({height:this.props.height},e),null!==rn.Ln&&void 0!==rn.Ln&&rn.Ln[this.props.type]?{}:this.props.backgroundPlaceholder)},i().createElement(rn.ZP,xo({id:a},this.props,{enableFullscreen:!1,descriptionEnabled:!1,mediaViewer:this.props.mediaViewer,containerInView:this.props.inView})),this.props.mode===p.nl.EDIT&&(t?i().createElement(To.h_,{container:t},o):o)))}}])&&No(t.prototype,n),c}(o.Component);Wo(Fo,"propTypes",{id:st().string,resourceId:st().string,sectionId:st().string,mode:st().string,fit:st().string,size:st().string,path:st().string,credits:st().string,description:st().string,height:st().number,width:st().number,tools:st().object,style:st().object,add:st().func,editMedia:st().func,update:st().func,updateSection:st().func,remove:st().func,type:st().oneOf(p.lg.MediaTypes),disableToolbarPortal:st().bool,backgroundPlaceholder:st().object,sectionType:st().string,src:st().string,theme:st().string,mediaViewer:st().func,contentToolbar:st().func,inView:st().bool,sections:st().array}),Wo(Fo,"defaultProps",{height:0,size:"full",width:0,style:{},backgroundPlaceholder:{background:"url(".concat(ko(),")"),backgroundSize:"256px auto"}});const Uo=(Bo=Fo,Ho=Vo=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Eo(e,t)}(c,e);var t,n,r,o,a=(r=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=jo(r);if(o){var n=jo(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Po(this,e)});function c(){var e;Oo(this,c);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Co(So(e=a.call.apply(a,[this].concat(n))),"state",{style:{}}),Co(So(e),"update",(function(t){if(e._stickybits){var n=document.querySelector(t);-1===e._stickybits.definePosition().indexOf("sticky")&&n&&(e._stickybits.update(),setTimeout((function(){var t=n.getBoundingClientRect(),r=t.top,o=t.left;e.setState({style:{top:r,left:o,width:n.scrollWidth-2}})})))}})),e}return t=c,(n=[{key:"componentDidMount",value:function(){this._stickybits=this._node&&(0,mo.Z)(this._node,{scrollEl:this.props.scrollContainerSelector,noStyles:!0,useGetBoundingClientRect:!0}),this.update(this.props.scrollContainerSelector)}},{key:"componentWillReceiveProps",value:function(e){!this._stickybits||e.viewWidth===this.props.viewWidth&&e.viewHeight===this.props.viewHeight||this.update(e.scrollContainerSelector)}},{key:"componentWillUnmount",value:function(){this._stickybits&&this._stickybits.cleanup()}},{key:"render",value:function(){var e=this;return i().createElement(Bo,vo({ref:function(t){t&&t.refs&&t.refs[e.props.refId]&&(e._node=t.refs[e.props.refId])},style:ho({},this.state.style)},this.props),this.props.children)}}])&&wo(t.prototype,n),c}(o.Component),Co(Vo,"propTypes",{scrollContainerSelector:st().string,height:st().number,width:st().number,refId:st().string}),Co(Vo,"defaultProps",{scrollContainerSelector:"body",height:0,width:0,refId:"div"}),Ho);var Bo,Vo,Ho,Go=n(11636),zo=n.n(Go);function qo(){return(qo=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Ko(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const $o=(0,$e.compose)(yo,(0,$e.withStateHandlers)({textEditorActive:!1},{bubblingTextEditing:function(){return function(e){return{textEditorActiveClass:e?" ms-text-editor-active":""}}}}))((function(e){var t,n=e.add,r=void 0===n?function(){}:n,o=e.editMedia,a=void 0===o?function(){}:o,c=e.editWebPage,l=void 0===c?function(){}:c,u=e.onVisibilityChange,s=void 0===u?function(){}:u,d=e.update,f=void 0===d?function(){}:d,y=e.updateBackground,m=void 0===y?function(){}:y,b=e.updateCurrentPage,v=void 0===b?function(){}:b,g=e.remove,h=void 0===g?function(){}:g,O=e.id,w=e.background,E=void 0===w?{}:w,P=e.path,S=e.contents,j=void 0===S?[]:S,C=e.mode,T=e.sectionType,I=e.inViewRef,k=e.viewWidth,A=e.viewHeight,M=e.focusedContent,x=e.contentId,R=e.bubblingTextEditing,N=void 0===R?function(){}:R,L=e.textEditorActiveClass,_=void 0===L?"":L,Z=e.expandableMedia,W=void 0!==Z&&Z,F=e.storyTheme,U=e.mediaViewer,B=e.contentToolbar,V=e.inView,H=e.sections,G=void 0===H?[]:H,z=e.storyFonts,q=M&&M.hideContent&&D()(M,"target.id")===x,K=q?"hidden":"visible",$=W&&E&&"map"===E.type?" ms-expandable-background":"",Y=(null==F?void 0:F.overlay)||{},Q=(null==F?void 0:F.general)||{};return i().createElement("section",{className:"ms-section ms-section-immersive".concat($),id:O,ref:I},i().createElement(Uo,qo({},E,{mode:C,disableToolbarPortal:!0,tools:(t={},Ko(t,p.Tr.IMAGE,["editMedia","fit","size","align","theme"]),Ko(t,p.Tr.MAP,["editMedia","editMap","size","align","theme"]),Ko(t,p.Tr.VIDEO,["editMedia","fit","size","align","theme","muted","autoplay","loop"]),t),scrollContainerSelector:"#ms-sections-container",add:r,editMedia:a,expandable:W,path:P,update:m,updateCurrentPage:v,remove:h,sectionType:T,sectionId:O,backgroundId:E.id,key:E.id,width:k,height:A,backgroundPlaceholder:{background:"url(".concat(zo(),")"),backgroundSize:"600px auto"},storyTheme:Q,mediaViewer:U,contentToolbar:B,inView:V})),i().createElement(ro,{tools:Ko({},p.bT.COLUMN,["size","align","theme"]),className:"ms-section-contents".concat(_),contents:j,mode:C,add:r,updateCurrentPage:v,editMedia:a,editWebPage:l,update:f,remove:h,sectionId:O,viewWidth:k,viewHeight:A,contentProps:{onVisibilityChange:s,contentWrapperStyle:{minHeight:A,visibility:K},expandable:W,mediaViewer:U,contentToolbar:B},focusedContent:M,bubblingTextEditing:N,sectionType:T,storyTheme:Y,sections:G,storyFonts:z}),C===p.nl.EDIT&&!q&&i().createElement(ir,{containerWidth:k,containerHeight:A,buttons:[{glyph:"story-title-section",tooltipId:"geostory.addTitleSection",onClick:function(){r("sections",O,p.ID.TITLE)}},{glyph:"story-banner-section",tooltipId:"geostory.addBannerSection",onClick:function(){r("sections",O,p.ID.BANNER)}},{glyph:"story-paragraph-section",tooltipId:"geostory.addParagraphSection",onClick:function(){r("sections",O,p.ID.PARAGRAPH)}},{glyph:"story-immersive-content",tooltipId:"geostory.addImmersiveContent",onClick:function(){r('sections[{"id": "'.concat(O,'"}].contents'),void 0,p.bT.COLUMN,"geostory.builder.defaults.titleImmersiveContent")}},{glyph:"story-immersive-content",tooltipId:"geostory.addGeocarouselContent",onClick:function(){r("sections",O,p.ID.CAROUSEL)}},{glyph:"story-media-section",tooltipId:"geostory.addMediaSection",onClick:function(){r("sections",O,p.tQ.MEDIA)}},{glyph:"story-webpage-section",tooltipId:"geostory.addWebPageSection",onClick:function(){r("sections",O,p.tQ.WEBPAGE)}}]}))}));function Yo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Qo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Yo(Object(n),!0).forEach((function(t){Xo(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yo(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Xo(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Jo=function(e){var t=e.id,n=e.contents,r=e.mode,o=e.add,a=void 0===o?function(){}:o,c=e.update,l=void 0===c?function(){}:c,u=e.editMedia,s=void 0===u?function(){}:u,d=e.editWebPage,f=void 0===d?function(){}:d,y=e.remove,m=void 0===y?function(){}:y,b=e.inViewRef,v=e.viewWidth,g=e.viewHeight,h=e.expandableMedia,O=e.mediaViewer,w=e.contentToolbar,E=e.sections,P=void 0===E?[]:E,S=e.sectionType,j=e.storyFonts;return i().createElement("section",{className:"ms-section ms-section-paragraph",id:t,ref:b},i().createElement(ro,{className:"ms-section-contents",contents:n,mode:r,add:a,editMedia:s,editWebPage:f,update:l,remove:m,sectionId:t,viewWidth:v,viewHeight:g,sectionType:S,contentProps:{expandable:h,mediaViewer:O,contentToolbar:w,overrideTools:function(e){return Qo(Qo({},e),{},Xo({},p.bT.TEXT,[(!0,{id:"size",filterOptions:function(e){return"full"!==e.value},pullRight:true}),"remove"]))}},sections:P,storyFonts:j}),r===p.nl.EDIT&&i().createElement(ir,{containerWidth:v,containerHeight:g,buttons:[{glyph:"story-title-section",tooltipId:"geostory.addTitleSection",onClick:function(){a("sections",t,p.ID.TITLE)}},{glyph:"story-banner-section",tooltipId:"geostory.addBannerSection",onClick:function(){a("sections",t,p.ID.BANNER)}},{glyph:"story-paragraph-section",tooltipId:"geostory.addParagraphSection",onClick:function(){a("sections",t,p.ID.PARAGRAPH)}},{glyph:"story-immersive-section",tooltipId:"geostory.addImmersiveSection",onClick:function(){a("sections",t,p.ID.IMMERSIVE)}},{glyph:"story-immersive-section",tooltipId:"geostory.addGeocarouselSection",onClick:function(){a("sections",t,p.ID.CAROUSEL)}},{glyph:"story-media-section",tooltipId:"geostory.addMediaSection",onClick:function(){a("sections",t,p.tQ.MEDIA)}},{glyph:"story-webpage-section",tooltipId:"geostory.addWebPageSection",onClick:function(){a("sections",t,p.tQ.WEBPAGE)}}]}))};var ei=n(75492),ti=n.n(ei);function ni(){return(ni=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function ri(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const oi=(0,$e.compose)(fo,(0,$e.withStateHandlers)({textEditorActive:!1},{bubblingTextEditing:function(){return function(e){return{textEditorActiveClass:e?" ms-text-editor-active":""}}}}))((function(e){var t=e.id,n=e.background,r=void 0===n?{}:n,o=e.contents,a=void 0===o?[]:o,c=e.mode,l=e.contentId,u=e.path,s=e.sectionType,d=e.cover,f=e.viewWidth,y=e.viewHeight,m=e.inViewRef,b=e.add,v=void 0===b?function(){}:b,g=e.update,h=void 0===g?function(){}:g,O=e.updateSection,w=void 0===O?function(){}:O,E=e.remove,P=void 0===E?function(){}:E,S=e.updateBackground,j=void 0===S?function(){}:S,C=e.editMedia,T=void 0===C?function(){}:C,I=e.focusedContent,k=e.bubblingTextEditing,A=void 0===k?function(){}:k,M=e.textEditorActiveClass,x=void 0===M?"":M,R=e.expandableMedia,N=void 0!==R&&R,L=e.storyTheme,_=e.mediaViewer,Z=e.contentToolbar,W=e.inView,F=e.sections,U=void 0===F?[]:F,B=e.storyFonts,V=D()(I,"target.id")===l,H=V?"hidden":"visible",G=N&&r&&"map"===r.type?" ms-expandable-background":"",z=(null==L?void 0:L.overlay)||{},q=(null==L?void 0:L.general)||{};return i().createElement("section",{ref:m,className:"ms-section ms-section-title".concat(G),id:t},i().createElement(Ke.Z,null,(function(e){var t,n=e.height;return i().createElement(Uo,ni({},r,{scrollContainerSelector:"#ms-sections-container",key:r.id,mode:c,id:l,path:u,update:j,add:v,editMedia:T,expandable:N,updateSection:w,cover:d,remove:P,width:f,sectionType:s,backgroundPlaceholder:{background:"url(".concat(d?ko():ti(),")"),backgroundSize:"".concat(d?64:600,"px auto")},tools:(t={},ri(t,p.Tr.IMAGE,["editMedia","cover","fit","size","align","theme"]),ri(t,p.Tr.MAP,["editMedia","cover","editMap","size","align","theme"]),ri(t,p.Tr.VIDEO,["editMedia","cover","fit","size","align","theme","muted","autoplay","loop"]),t),height:n>=y?y:n,storyTheme:q,mediaViewer:_,contentToolbar:Z,inView:W}))})),i().createElement(ro,{className:"ms-section-contents".concat(x),contents:a,mode:c,add:v,sectionType:s,update:h,remove:P,sectionId:t,contentProps:{contentWrapperStyle:d?{minHeight:y,visibility:H}:{visibility:H},mediaViewer:_,contentToolbar:Z},tools:ri({},p.bT.TEXT,["size","align","theme","remove"]),focusedContent:I,bubblingTextEditing:A,storyTheme:z,sections:U,storyFonts:B}),c===p.nl.EDIT&&!V&&i().createElement(ir,{containerWidth:f,containerHeight:y,buttons:[{glyph:"story-title-section",tooltipId:"geostory.addTitleSection",onClick:function(){v("sections",t,p.ID.TITLE)}},{glyph:"story-banner-section",tooltipId:"geostory.addBannerSection",onClick:function(){v("sections",t,p.ID.BANNER)}},{glyph:"story-paragraph-section",tooltipId:"geostory.addParagraphSection",onClick:function(){v("sections",t,p.ID.PARAGRAPH)}},{glyph:"story-immersive-section",tooltipId:"geostory.addImmersiveSection",onClick:function(){v("sections",t,p.ID.IMMERSIVE)}},{glyph:"story-immersive-section",tooltipId:"geostory.addGeocarouselSection",onClick:function(){v("sections",t,p.ID.CAROUSEL)}},{glyph:"story-media-section",tooltipId:"geostory.addMediaSection",onClick:function(){v("sections",t,p.tQ.MEDIA)}},{glyph:"story-webpage-section",tooltipId:"geostory.addWebPageSection",onClick:function(){v("sections",t,p.tQ.WEBPAGE)}}]}))}));function ii(){return(ii=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function ai(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const ci=(0,$e.compose)(fo,(0,$e.withStateHandlers)({textEditorActive:!1}))((function(e){var t=e.id,n=e.background,r=void 0===n?{}:n,o=e.mode,a=e.contentId,c=e.path,l=e.sectionType,u=void 0===l?p.ID.BANNER:l,s=e.cover,d=e.viewWidth,f=e.viewHeight,y=e.inViewRef,m=e.add,b=void 0===m?function(){}:m,v=e.updateSection,g=void 0===v?function(){}:v,h=e.remove,O=void 0===h?function(){}:h,w=e.updateBackground,E=void 0===w?function(){}:w,P=e.editMedia,S=void 0===P?function(){}:P,j=e.focusedContent,C=e.expandableMedia,T=void 0!==C&&C,I=e.storyTheme,k=e.mediaViewer,A=e.contentToolbar,M=e.inView,x=D()(j,"target.id")===a,R=T&&r&&"map"===r.type?" ms-expandable-background":"",N=c.replace(".background","");return i().createElement("section",{ref:y,className:"ms-section ms-section-banner".concat(R),id:t},i().createElement(Ke.Z,null,(function(e){var t,n=e.height;return i().createElement(Uo,ii({},r,{scrollContainerSelector:"#ms-sections-container",key:r.id,mode:o,id:a,path:c,update:E,add:b,editMedia:S,expandable:T,updateSection:g,cover:s,remove:function(){return O(N)},width:d,sectionType:u,backgroundPlaceholder:{background:"url(".concat(s?ko():ti(),")"),backgroundSize:"".concat(s?64:600,"px auto")},tools:(t={},ai(t,p.Tr.IMAGE,["editMedia","cover","fit","size","align","theme","remove"]),ai(t,p.Tr.MAP,["editMedia","cover","editMap","size","align","theme","remove"]),ai(t,p.Tr.VIDEO,["editMedia","cover","fit","size","align","theme","muted","autoplay","loop","remove"]),t),height:n>=f?f:n,storyTheme:I,mediaViewer:k,contentToolbar:A,inView:M}))})),i().createElement("div",{style:{minHeight:s?f:300,pointerEvents:"none"}}),o===p.nl.EDIT&&!x&&i().createElement(ir,{containerWidth:d,containerHeight:f,buttons:[{glyph:"story-title-section",tooltipId:"geostory.addTitleSection",onClick:function(){b("sections",t,p.ID.TITLE)}},{glyph:"story-banner-section",tooltipId:"geostory.addBannerSection",onClick:function(){b("sections",t,p.ID.BANNER)}},{glyph:"story-paragraph-section",tooltipId:"geostory.addParagraphSection",onClick:function(){b("sections",t,p.ID.PARAGRAPH)}},{glyph:"story-immersive-section",tooltipId:"geostory.addImmersiveSection",onClick:function(){b("sections",t,p.ID.IMMERSIVE)}},{glyph:"story-immersive-section",tooltipId:"geostory.addGeocarouselSection",onClick:function(){b("sections",t,p.ID.CAROUSEL)}},{glyph:"story-media-section",tooltipId:"geostory.addMediaSection",onClick:function(){b("sections",t,p.tQ.MEDIA)}},{glyph:"story-webpage-section",tooltipId:"geostory.addWebPageSection",onClick:function(){b("sections",t,p.tQ.WEBPAGE)}}]}))}));var li=n(99902),ui=n.n(li),si=n(71335),pi=n(94745);function di(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return fi(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?fi(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function fi(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var yi=(0,pt.Z)("placeholder")(an.FormControl);const mi=function(e){var t,n,r,a,c=di((0,o.useState)([]),2),l=c[0],u=c[1],s=di((0,o.useState)({data:null==e||null===(t=e.thumbnail)||void 0===t?void 0:t.image}),2),p=s[0],d=s[1],f=di((0,o.useState)(null===(n=e.thumbnail)||void 0===n?void 0:n.title),2),y=f[0],m=f[1];return i().createElement(pi.Z,{fitContent:!0,title:i().createElement(yn.Z,{msgId:e.editing?"geostory.carouselEditTitle":"geostory.carouselAddTitle"}),show:!0,fade:!0,clickOutEnabled:!1,bodyClassName:"ms-flex modal-properties-container background-dialog",onClose:e.onClose,buttons:e.loading?[]:[{text:i().createElement(yn.Z,{msgId:e.editing?"save":"backgroundDialog.add"}),bsStyle:"primary",onClick:function(){e.update("thumbnail",{image:p.data,title:y}),e.onClose()}}]},i().createElement(an.Form,{style:{width:"100%"}},(a={FORMAT:i().createElement(yn.Z,{msgId:"map.errorFormat"}),SIZE:i().createElement(yn.Z,{msgId:"map.errorSize"})},l.length>0?i().createElement("div",{className:"dropzone-errorBox alert-danger"},i().createElement("p",null,i().createElement(yn.Z,{msgId:"map.error"})),l.map((function(e){return i().createElement("div",{id:"error"+e,key:"error"+e,className:"error"+e},a[e])}))):null),i().createElement(si.Z,{onUpdate:function(e,t){return d({data:e,url:t})},onError:function(e){return u(e)},message:i().createElement(yn.Z,{msgId:"backgroundDialog.thumbnailMessage"}),suggestion:"",map:{newThumbnail:D()(p,"url")||(null===(r=e.thumbnail)||void 0===r?void 0:r.image)||"NODATA"}}),i().createElement(an.FormGroup,null,i().createElement(an.ControlLabel,null,i().createElement(yn.Z,{msgId:"layerProperties.title"})),i().createElement(yi,{value:y,placeholder:"backgroundDialog.titlePlaceholder",onChange:function(e){return m(e.target.value)}}))))};var bi=n(25311),vi=n(45567),gi=n(55877),hi=n.n(gi),Oi=n(73723),wi=n.n(Oi);function Ei(){return(Ei=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Pi(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Si(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Si(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Si(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ji(){return(ji=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Ci(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Ti=["thumbnail","index","isSelected","disableEvent"],Ii=["onSort","sectionId","contents"];function ki(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Di(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ki(Object(n),!0).forEach((function(t){Ai(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ki(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ai(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Mi(){return(Mi=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function xi(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Ri(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ri(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ri(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ni(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var Li,_i=(Li=ui(),function(e){var t=(0,o.createRef)(),n=Pi((0,o.useState)(0),2),r=n[0],a=n[1],c=Pi((0,o.useState)(4),2),l=c[0],u=c[1];(0,o.useEffect)((function(){if(e.expandable)u(2);else{var t=(n=e.containerWidth-80)<=420?2:n>420&&n<=640?3:n>640&&n<=768?4:n>768&&n<=1200?6:n>1200&&n<=1400?8:10;u(t)}var n}),[e.containerWidth]);var s=e.expandable?36:12;(0,o.useEffect)((function(){if(!e.expandable){var t=L()(e.items,{id:e.currentContentId});a(t+1)}}),[e.currentContentId]);var p=(0,o.useCallback)((function(n){var o,i,c=n.deltaY,u=null==t?void 0:t.current;c>0?u&&(i=Math.max(Math.min(r+l,Math.floor((null===(o=e.items)||void 0===o?void 0:o.length)-l/2)),Math.floor(l/2)+1),a(i)):u&&function(){var t,n=Math.max(Math.min(r-l,Math.floor((null===(t=e.items)||void 0===t?void 0:t.length)-l/2)-1),Math.floor(l/2));a(n)}(),n.preventDefault()}),[t]);return(0,o.useEffect)((function(){var e=Pi(document.getElementsByClassName("items-wrapper"),1)[0];return null==e||e.addEventListener("wheel",p),function(){null==e||e.addEventListener("wheel",p)}}),[p]),i().createElement(Li,Ei({},e,{ref:t,numberOfCards:l,requestToChangeActive:a,activeItemIndex:r,gutter:s}))}),Zi=function(e){return function(t){var n=(0,o.createRef)(),r=function(e){var n,r,o,i,a,c=L()(t.items,(function(e){return e.id===t.selectedId}));[37,38].includes(e.keyCode)&&(n=37===e.keyCode?null===(r=t.items)||void 0===r||null===(o=r[0===c?0:c-1])||void 0===o?void 0:o.id:null===(i=t.items)||void 0===i||null===(a=i[c===t.items.length-1?c:c+1])||void 0===a?void 0:a.id,t.update('sections[{"id":"'.concat(t.sectionId,'"}].contents[{"id":"').concat(n,'"}].carouselToggle'),!0))},a=function(){t.update('sections[{"id":"'.concat(t.sectionId,'"}].contents[{"id":"').concat(t.id,'"}].carouselToggle'),!0)};return(0,o.useEffect)((function(){var e,t,n=(e=document.getElementsByClassName("items-wrapper"),t=1,function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Ci(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ci(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0];return null==n||n.addEventListener("keydown",r),null==n||n.addEventListener("onclick",a),function(){null==n||n.removeEventListener("keydown",r),null==n||n.removeEventListener("onclick",a)}}),[a]),i().createElement(e,ji({ref:n},t,{onClick:a}))}}((0,bi.Z)((function(e){var t=e.thumbnail,n=e.index,r=e.isSelected,o=e.disableEvent,a=Ni(e,Ti);return a.isDraggable&&a.connectDragSource&&a.connectDragSource(i().createElement("div",{tabIndex:n,className:mt()("carousel-item",{"carousel-item-selected":r,"disable-event":o}),onClick:a.onClick},i().createElement("div",{className:"carousel-item-inner-wrapper",style:{backgroundImage:"url(".concat((null==t?void 0:t.image)||wi(),")")}},i().createElement("span",{className:"carousel-item-inner"},(null==t?void 0:t.title)||"Item ".concat(n+1)),i().createElement("span",{className:"carousel-item-inner-index"},n+1))))}))),Wi=(0,vi.Z)((function(e){var t,n,r,a,c,l,u=e.mode,s=e.add,d=e.update,f=e.remove,y=e.sectionId,m=e.isMapBackground,b=e.contentId,v=e.items,g=e.contentToolbar,h=void 0===g?qr:g,O=e.cardComponent,w=e.expandable,E=e.containerWidth,P=xi((0,o.useState)(!1),2),S=P[0],j=P[1],C=xi((0,o.useState)(void 0),2),T=C[0],I=C[1],k=xi((0,o.useState)({}),2),A=k[0],M=k[1],x=u===p.nl.EDIT,N=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:T,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"replace",o=R()(e)?"":".".concat(e);d('sections[{"id":"'.concat(y,'"}].contents[{"id":"').concat(n,'"}]')+o,t,r)},L=v.some((function(e){var t=e.background,n=(t=void 0===t?{}:t).editMap;return void 0!==n&&n}));return i().createElement(i().Fragment,null,i().createElement("div",{className:"ms-section-carousel"},x&&i().createElement(h,{addDisabled:!m||(t=(Z()(v,{id:b})||{}).background,n=(t=void 0===t?{}:t).map,r=(n=void 0===n?{}:n).layers,a=void 0===r?[]:r,c=(Z()(a,{id:p.e1})||{}).features,l=void 0===c?[]:c,!Z()(l,{contentRefId:b})),add:s,editMap:L,remove:function(){return f('sections[{"id":"'.concat(y,'"}]'))},tools:["add","remove"]}),i().createElement(_i,{expandable:w,containerWidth:E,editable:x,currentContentId:b,items:v,gutter:12,activePosition:"center",chevronWidth:60,alwaysShowChevrons:!0,showSlither:!0,rightChevron:i().createElement(an.Glyphicon,{glyph:"chevron-right"}),leftChevron:i().createElement(an.Glyphicon,{glyph:"chevron-left"}),classes:{itemsInnerWrapper:mt()("items-inner-wrapper",{"items-inner-wrapper-view":u===p.nl.VIEW}),rightChevronWrapper:"chevron-wrapper right-chevron",leftChevronWrapper:"chevron-wrapper left-chevron",itemsWrapper:"items-wrapper"}},v.map((function(e,t){return i().createElement(i().Fragment,null,x&&i().createElement(h,{editMap:L,markerDisabled:!m||(null==e?void 0:e.id)!==b,edit:function(){return function(e){I(null==e?void 0:e.id),j(!0),M(null==e?void 0:e.thumbnail)}(e)},remove:function(){var n,r,o,i;return o=null==e?void 0:e.id,i=0===t&&v.length>0?null===(n=v[t+1])||void 0===n?void 0:n.id:null===(r=v[t-1])||void 0===r?void 0:r.id,f('sections[{"id":"'.concat(y,'"}].contents[{"id":"').concat(o,'"}]')),void(b===o&&d('sections[{"id":"'.concat(y,'"}].contents[{"id":"').concat(i,'"}].hideContent'),!1))},forceDelBtnDisable:(null==e?void 0:e.id)===b,add:s,marker:function(){return function(e){N("background.map.mapDrawControl",!0,null==e?void 0:e.id),N("background.editMap",!0,null==e?void 0:e.id),D()(e,"background.map.mapInfoControl")&&N("background.map",{mapInfoControl:!1,resetMapInfo:!0},null==e?void 0:e.id,"merge")}(e)},tools:["edit","remove","marker"]}),i().createElement(O,Mi({key:t,index:t,items:v,update:d,sectionId:y,selectedId:b,isSelected:(null==e?void 0:e.id)===b,disableEvent:L},e)))})))),S&&i().createElement(mi,{thumbnail:A,update:N,onClose:function(){return j(!1)}}))}));const Fi=function(e){var t=e.onSort,n=e.sectionId,r=e.contents,o=void 0===r?[]:r,a=Ni(e,Ii);return i().createElement(Wi,Mi({containerId:n,isDraggable:!0,onSort:function(e,r,o,i){if(o.containerId===i.containerId){var a='sections[{ "id": "'.concat(n,'" }].contents[{"id":"').concat(i.id,'"}]'),c='sections[{ "id": "'.concat(n,'" }].contents'),l=e,u=hi()();t(a,c,l,u,'sections[{ "id": "'.concat(n,'" }].contents[{"id":"').concat(u,'"}]'))}}},Di(Di({},a),{},{sectionId:n}),{cardComponent:Zi,items:o.map((function(e){var t=e.id,n=e.thumbnail;return{id:t,thumbnail:void 0===n?{}:n,background:e.background}}))}))};function Ui(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Bi(){return(Bi=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Vi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Hi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Vi(Object(n),!0).forEach((function(t){Gi(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Vi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Gi(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const zi=(0,$e.compose)(yo,(0,$e.withStateHandlers)({textEditorActive:!1},{bubblingTextEditing:function(){return function(e){return{textEditorActiveClass:e?" ms-text-editor-active":""}}}}))((function(e){var t,n=e.add,r=void 0===n?function(){}:n,o=e.editMedia,a=void 0===o?function(){}:o,c=e.editWebPage,l=void 0===c?function(){}:c,u=e.onVisibilityChange,s=void 0===u?function(){}:u,d=e.update,f=void 0===d?function(){}:d,y=e.updateBackground,m=void 0===y?function(){}:y,b=e.updateCurrentPage,v=void 0===b?function(){}:b,g=e.remove,h=void 0===g?function(){}:g,O=e.id,w=e.background,E=void 0===w?{}:w,P=e.path,S=e.contents,j=void 0===S?[]:S,C=e.mode,T=e.sectionType,I=e.inViewRef,k=e.viewWidth,A=e.viewHeight,M=e.focusedContent,x=e.contentId,R=e.bubblingTextEditing,N=void 0===R?function(){}:R,L=e.textEditorActiveClass,_=void 0===L?"":L,W=e.expandableMedia,F=void 0!==W&&W,U=e.storyTheme,B=e.mediaViewer,V=e.contentToolbar,H=e.inView,G=e.sections,z=void 0===G?[]:G,q=e.storyFonts,K=e.onSort,$=void 0===K?function(){}:K,Y=e.isDrawEnabled,Q=M&&M.hideContent&&D()(M,"target.id")===x,X=Q?"hidden":"visible",J=F&&E&&"map"===E.type?" ms-expandable-background":"",ee=Hi(Hi({},null==U?void 0:U.overlay),C===p.nl.VIEW&&{maxHeight:A-350,overflowY:"auto"})||{},te=(null==U?void 0:U.general)||{},ne=A-(C===p.nl.EDIT?200:180),re=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=Z()(j,{id:x})||{},n=t.contents,r=void 0===n?[]:n;return e.filter((function(e){return p.ID.CAROUSEL===T&&1===r.length?"remove"!==e:e}))};return i().createElement("section",{className:"ms-section ms-section-immersive".concat(J),id:O,ref:I},i().createElement(Uo,Bi({},E,{mode:C,disableToolbarPortal:!0,tools:(t={},Gi(t,p.Tr.IMAGE,["editMedia","fit","size","align","theme"]),Gi(t,p.Tr.MAP,["editMedia","editMap","size","align","theme"].concat(Y?"closeDraw":[])),Gi(t,p.Tr.VIDEO,["editMedia","fit","size","align","theme","muted","autoplay","loop"]),t),scrollContainerSelector:"#ms-sections-container",add:r,editMedia:a,expandable:F,path:P,update:m,updateCurrentPage:v,remove:h,sectionType:T,sectionId:O,backgroundId:E.id,key:E.id,width:k,height:A,backgroundPlaceholder:{background:"url(".concat(zo(),")"),backgroundSize:"600px auto"},storyTheme:te,mediaViewer:B,contentToolbar:V,inView:H})),i().createElement(ro,{tools:Gi({},p.bT.COLUMN,["size","align","theme"]),className:"ms-section-contents".concat(_),contents:j,mode:C,add:r,updateCurrentPage:v,editMedia:a,editWebPage:l,update:f,remove:h,sectionId:O,viewWidth:k,viewHeight:A,contentProps:{onVisibilityChange:s,contentWrapperStyle:{minHeight:ne,visibility:X},expandable:F,mediaViewer:B,contentToolbar:V,overrideTools:function(e){return Object.fromEntries(Object.entries(e).map((function(e){var t,n,r=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(t,n)||function(e,t){if(e){if("string"==typeof e)return Ui(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ui(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],i=r[1];return[o,re(i)]})))}},focusedContent:M,bubblingTextEditing:N,sectionType:T,storyTheme:ee,sections:z,storyFonts:q}),i().createElement(Fi,{sectionId:O,contentId:x,contents:j,update:f,remove:h,expandable:F,add:function(){return r('sections[{"id": "'.concat(O,'"}].contents'),void 0,p.bT.COLUMN,"geostory.builder.defaults.titleGeocarouselContent"),void f('sections[{"id":"'.concat(O,'"}].contents[{"id":"').concat(x,'"}].hideContent'),!0)},contentToolbar:V,mode:C,onSort:$,isMapBackground:(null==E?void 0:E.type)===p.Tr.MAP,containerWidth:k}),C===p.nl.EDIT&&!Q&&i().createElement(ir,{containerWidth:k,containerHeight:A,buttons:[{glyph:"story-title-section",tooltipId:"geostory.addTitleSection",onClick:function(){r("sections",O,p.ID.TITLE)}},{glyph:"story-banner-section",tooltipId:"geostory.addBannerSection",onClick:function(){r("sections",O,p.ID.BANNER)}},{glyph:"story-paragraph-section",tooltipId:"geostory.addParagraphSection",onClick:function(){r("sections",O,p.ID.PARAGRAPH)}},{glyph:"story-immersive-content",tooltipId:"geostory.addImmersiveContent",onClick:function(){return r("sections",O,p.ID.IMMERSIVE)}},{glyph:"story-media-section",tooltipId:"geostory.addMediaSection",onClick:function(){r("sections",O,p.tQ.MEDIA)}},{glyph:"story-webpage-section",tooltipId:"geostory.addWebPageSection",onClick:function(){r("sections",O,p.tQ.WEBPAGE)}}]}))}));function qi(e){return(qi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var Ki;function $i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Yi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Qi(e,t){return(Qi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Xi(e,t){return!t||"object"!==qi(t)&&"function"!=typeof t?Ji(e):t}function Ji(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ea(e){return(ea=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ta(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var na=(ta(Ki={},p.ID.IMMERSIVE,$o),ta(Ki,p.ID.CAROUSEL,zi),ta(Ki,p.ID.PARAGRAPH,Jo),ta(Ki,p.tQ.MEDIA,Jo),ta(Ki,p.tQ.WEBPAGE,Jo),ta(Ki,p.ID.TITLE,oi),ta(Ki,p.ID.BANNER,ci),ta(Ki,"UNKNOWN",(function(e){var t=e.type,n=e.inViewRef;return i().createElement("div",{ref:n,className:"ms-section ms-section-unknown"},"WARNING: unknown session of type ",t)})),Ki),ra=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Qi(e,t)}(c,e);var t,n,r,o,a=(r=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ea(r);if(o){var n=ea(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Xi(this,e)});function c(){var e;$i(this,c);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return ta(Ji(e=a.call.apply(a,[this].concat(n))),"state",{height:0}),e}return t=c,(n=[{key:"render",value:function(){var e=na[this.props.type]||na.UNKNOWN;return i().createElement(e,{sectionType:this.props.type,id:this.props.id,add:this.props.add,update:this.props.update,inViewRef:this.props.inViewRef,editMedia:this.props.editMedia,expandableMedia:this.props.expandableMedia,editWebPage:this.props.editWebPage,updateCurrentPage:this.props.updateCurrentPage,remove:this.props.remove,mode:this.props.mode,cover:this.props.cover,contents:this.props.contents,viewWidth:this.props.viewWidth,viewHeight:this.props.viewHeight,focusedContent:this.props.focusedContent,storyTheme:this.props.storyTheme,mediaViewer:this.props.mediaViewer,contentToolbar:this.props.contentToolbar,inView:this.props.inView,sections:this.props.sections,storyFonts:this.props.storyFonts,onSort:this.props.onSort,isDrawEnabled:this.props.isDrawEnabled})}}])&&Yi(t.prototype,n),c}(i().Component);ta(ra,"propTypes",{id:st().string,type:st().oneOf(p.lg.SectionTypes),storyType:st().oneOf(p.lg.StoryTypes),add:st().func,update:st().func,editMedia:st().func,editWebPage:st().func,remove:st().func,updateCurrentPage:st().func,mode:st().oneOf(p.lg.Modes),contents:st().array,viewHeight:st().number,viewWidth:st().number,inViewRef:st().func,excludeClassName:st().string,cover:st().bool,focusedContent:st().object,expandableMedia:st().bool,storyTheme:st().object,mediaViewer:st().func,contentToolbar:st().func,inView:st().bool,sections:st().array,storyFonts:st().array,onSort:st().func,isDrawEnabled:st().bool}),ta(ra,"defaultProps",{id:"",add:function(){},update:function(){},editMedia:function(){},editWebPage:function(){},updateCurrentPage:function(){},remove:function(){},onSort:function(){},storyType:p.Ln.CASCADE,viewHeight:0,viewWidth:0,mode:p.nl.VIEW,expandableMedia:!1,sections:[],storyFonts:[]});const oa=hr({threshold:[0,.25,.5,.75,1],rootMargin:"-200px 0px 0px 0px"})(ra);function ia(e){return(ia="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function aa(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ca(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function la(e,t){return(la=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ua(e,t){return!t||"object"!==ia(t)&&"function"!=typeof t?sa(e):t}function sa(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function pa(e){return(pa=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function da(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var fa=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&la(e,t)}(c,e);var t,n,r,o,a=(r=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=pa(r);if(o){var n=pa(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return ua(this,e)});function c(){var e;aa(this,c);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return da(sa(e=a.call.apply(a,[this].concat(n))),"getAdjustedSelector",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.replace(/#\d|^#-\d/g,(function(e,t){return t?"#\\"+t[1]+t[2]:"#\\3"+e[1]+" "}))})),da(sa(e),"getFocusedTarget",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.props.targets,n=e.props.padding,r=void 0===n?{}:n;return t.map((function(t){var n=t.selector,o=null;try{var i=window.document.querySelector(e.getAdjustedSelector(n));if(i){var a=i.getBoundingClientRect(),c=a.top,l=a.right,u=a.bottom,s=a.left;o={x:s-r,y:c-r,w:l-s+2*r,h:u-c+2*r}}}catch(e){console.warn(e)}finally{return o}})).filter((function(e){return e}))})),da(sa(e),"getHolePath",(function(t){var n=t.x,r=t.y,o=t.w,i=t.h,a=e.props.borderRadius,c=void 0===a?8:a;return"M ".concat(n," ").concat(r+c," q 0 -").concat(c," ").concat(c," -").concat(c," h ").concat(o-2*c," q ").concat(c," 0 ").concat(c," ").concat(c," v ").concat(i-2*c," q 0 ").concat(c," -").concat(c," ").concat(c," h-").concat(o-2*c," q -").concat(c," 0 -").concat(c," -").concat(c," v-").concat(i-2*c)})),da(sa(e),"getPath",(function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.getFocusedTarget(),o="M 0 0 h ".concat(n," v ").concat(t," h -").concat(n," v -").concat(t),i=r.map(e.getHolePath);return o+i.join(" ")})),e}return t=c,(n=[{key:"render",value:function(){var e=this,t=this.props,n=t.onMaskClicked,r=t.stopEventsOnTargets,o=void 0!==r&&r,a=t.targets,c=this.getFocusedTarget(a.filter((function(e){var t=e.stopEventsOnTarget;return o||t})));return i().createElement("div",{style:{position:"fixed",height:"100vh",width:"100vw",top:0,left:0,zIndex:1e6,pointerEvents:"none"}},i().createElement(Ke.Z,null,(function(t){var r=t.width,o=t.height;return i().createElement("svg",{width:r,height:o,xmlns:"http://www.w3.org/2000/svg"},i().createElement("path",{d:e.getPath(o,r),fill:"rgba(0,0,0,0.7)",fillRule:"evenodd",pointerEvents:"visiblePainted",onClick:n}),c.map((function(t,n){return i().createElement("path",{key:n,d:e.getHolePath(t),fill:"transparent",pointerEvents:"visiblePainted"})})))})))}}])&&ca(t.prototype,n),c}(i().Component);function ya(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ma(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ya(Object(n),!0).forEach((function(t){ba(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ya(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ba(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}da(fa,"propTypes",{targets:st().arrayOf(st().shape({selector:st().string,stopEventsOnTarget:st().bool})),padding:st().number,borderRadius:st().number,onMaskClicked:st().func,stopEventsOnTargets:st().bool}),da(fa,"defaultProps",{targets:[],padding:0,borderRadius:8,onMaskClicked:function(){},stopEventsOnTargets:!1});var va=(0,nt.Z)((function(e){var t=e.sections;return 0===(void 0===t?[]:t).length}),(function(e){var t=e.add,n=void 0===t?function(){}:t;return{iconFit:!1,style:{position:"relative",width:"50%",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},glyph:"geostory",title:i().createElement(yn.Z,{msgId:"geostory.emptyTitle"}),description:i().createElement(yn.Z,{msgId:"geostory.emptyDescription"}),content:i().createElement(ir,{addButtonClassName:"square-button-md",containerWidth:"100%",containerHeight:"100%",buttons:[{glyph:"story-title-section",tooltipId:"geostory.addTitleSection",onClick:function(){n("sections",0,p.ID.TITLE)}},{glyph:"story-banner-section",tooltipId:"geostory.addBannerSection",onClick:function(){n("sections",0,p.ID.BANNER)}},{glyph:"story-paragraph-section",tooltipId:"geostory.addParagraphSection",onClick:function(){n("sections",0,p.ID.PARAGRAPH)}},{glyph:"story-immersive-section",tooltipId:"geostory.addImmersiveContent",onClick:function(){n("sections",0,p.ID.IMMERSIVE)}},{glyph:"story-immersive-section",tooltipId:"geostory.addGeocarouselContent",onClick:function(){n("sections",0,p.ID.CAROUSEL)}},{glyph:"story-media-section",tooltipId:"geostory.addMediaSection",onClick:function(){n("sections",0,p.tQ.MEDIA)}},{glyph:"code",tooltipId:"geostory.addWebPageSection",onClick:function(){n("sections",0,p.tQ.WEBPAGE)}}]})}}))(Ke.Z),ga=function(e){var t=e.width;return e.mode===p.nl.EDIT?"":t<640?"sm":t>=640&&t<1024?"md":""};const ha=(0,$e.compose)(tt,lt,function(e){var t=e.showFocusMask,n=void 0===t?function(){}:t,r=e.defaultTargets,o=void 0===r?{selector:".ms-geostory-map-editor"}:r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=a.padding,l=void 0===c?0:c,u=a.borderRadius,s=void 0===u?8:u,p=a.stopEventsOnTargets,d=void 0!==p&&p,f=a.onMaskClicked,y=void 0===f?function(){}:f;return(0,$e.branch)(n,(function(e){return(0,$e.nest)((function(e){var t=e.focusedContent,n=e.children;return i().createElement(i().Fragment,null,n,i().createElement(fa,{targets:[t,o],padding:l,borderRadius:s,stopEventsOnTargets:d,onMaskClicked:y}))}),e)}))}({showFocusMask:function(e){var t=e.focusedContent,n=(t=void 0===t?{}:t).target;return(void 0===n?{}:n).id}}))((function(e){var t=e.mode,n=void 0===t?p.nl.VIEW:t,r=e.sections,o=void 0===r?[]:r,a=e.add,c=void 0===a?function(){}:a,l=e.onVisibilityChange,u=void 0===l?function(){}:l,s=e.updateCurrentPage,d=void 0===s?function(){}:s,f=e.editMedia,y=void 0===f?function(){}:f,m=e.editWebPage,b=void 0===m?function(){}:m,v=e.update,g=void 0===v?function(){}:v,h=e.remove,O=void 0===h?function(){}:h,w=e.focusedContent,E=e.isContentFocused,P=void 0!==E&&E,S=e.getSize,j=void 0===S?ga:S,C=e.theme,T=void 0===C?{}:C,I=e.mediaViewer,k=e.contentToolbar,D=e.storyFonts,A=e.onSort,M=void 0===A?function(){}:A,x=e.isDrawEnabled,R=void 0!==x&&x;return i().createElement(qe.Z,{className:"ms-cascade-story ms-".concat(n)},i().createElement(va,{sections:o,add:c},(function(e){var t,r=e.width,a=e.height,l=j({width:r,height:a,mode:n}),s=l?" ms-".concat(l):"",p="sm"===l,f=T&&Ar()(T)&&T||{};return i().createElement("div",{id:"ms-sections-container",className:"ms-sections-container".concat(s," ms-sections-hyperlinks"),style:ma(ma({},null==f?void 0:f.general),P&&{overflow:"hidden"})},(null==f||null===(t=f.link)||void 0===t?void 0:t.color)&&i().createElement("style",{dangerouslySetInnerHTML:{__html:"\n            .ms-sections-hyperlinks .ms-text-editor-main a,\n            .ms-sections-hyperlinks .ms-text-wrapper a,\n            .ms-sections-hyperlinks .ms-text-editor-main a:link,\n            .ms-sections-hyperlinks .ms-text-wrapper a:link,\n            .ms-sections-hyperlinks .ms-text-editor-main a:visited,\n            .ms-sections-hyperlinks .ms-text-wrapper a:visited,\n            .ms-sections-hyperlinks .ms-text-editor-main a:active,\n            .ms-sections-hyperlinks .ms-text-wrapper a:active {\n                color: ".concat(f.link.color,";\n                opacity: 1;\n            }\n            .ms-sections-hyperlinks .ms-text-editor-main a:hover,\n            .ms-sections-hyperlinks .ms-text-wrapper a:hover {\n                color: ").concat(f.link.color,";\n                opacity: 0.75;\n            }\n        ")}}),o.map((function(e){var t=e.contents,l=void 0===t?[]:t,s=e.id,m=e.type,v=e.cover;return i().createElement(oa,{focusedContent:w,onVisibilityChange:u,add:c,editMedia:y,expandableMedia:p,editWebPage:b,updateCurrentPage:d,update:g,remove:O,key:s,id:s,viewHeight:a,viewWidth:r,type:m,mode:n,contents:l,cover:v,storyTheme:f,mediaViewer:I,contentToolbar:k,sections:o,storyFonts:D,onSort:M,isDrawEnabled:R})})))})))}));var Oa=n(48860),wa=["id"];function Ea(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Pa(){return(Pa=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Sa(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ja(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Sa(Object(n),!0).forEach((function(t){Ca(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Sa(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ca(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ta=(0,Ir.Z)(Or.Z);const Ia=(0,$e.compose)((0,a.connect)((0,c.P1)(Q.jq,Q.z7,(function(e,t){return{resources:e,isContentFocused:t}}))),(0,$e.withProps)((function(e){var t=e.resources,n=e.resourceId,r=e.map,o=void 0===r?{}:r,i=ja(ja({},o),{},{layers:(o.layers||[]).map((function(e){return e||void 0}))}),a=Z()(t,{id:n})||{};return{map:(0,p.oH)(a.data,i)}})));var ka=(0,$e.compose)((0,a.connect)((0,c.P1)(Q.GC,(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{focusedEl:e}}))),(0,$e.withProps)((function(e){var t=e.focusedEl,n=(t=void 0===t?{}:t).resourceId,r=t.map;return{map:r||{},resourceId:n,disableReset:!r}}))),Da=(0,$e.withHandlers)({onChangeMap:function(e){var t=e.update,n=e.focusedContent,r=void 0===n?{}:n;return function(e,n){t("".concat(r.path,".map.").concat(e),n,"merge")}},onChange:function(e){var t=e.update,n=e.focusedContent,r=void 0===n?{}:n;return function(e,n){t(r.path+".".concat(e),n,"merge")}}}),Aa=(0,$e.compose)((0,a.connect)(null,{toggleAdvancedEditing:te.$Z}),(0,$e.withHandlers)({toggleAdvancedEditing:function(e){var t=e.toggleAdvancedEditing,n=void 0===t?function(){}:t,r=e.map,o=void 0===r?{}:r;return function(){var e=o.id,t=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(o,wa);n("inlineEditor",{data:t,id:e})}}})),Ma=(0,$e.withHandlers)({toggleEditing:function(e){var t=e.editMap,n=e.update,r=e.focusedContent;return function(){return n(r.path+".editMap",!t)}},onReset:function(e){var t=e.update,n=e.focusedContent,r=(n=void 0===n?{}:n).path,o=void 0===r?"":r;return function(){t(o+".map",void 0)}},discardAndClose:function(e){var t=e.update,n=e.focusedContent,r=void 0===n?{}:n;return function(e){t(r.path+".map",e),t(r.path+".editMap",!1)}}}),xa=function(e){return i().createElement(Ta,Pa({glyph:"repeat",bsStyle:"primary",className:"square-button-md no-border",tooltipId:"geostory.contentToolbar.resetMap",confirmTitle:i().createElement(yn.Z,{msgId:"geostory.contentToolbar.resetMapConfirm"}),confirmContent:i().createElement(yn.Z,{msgId:"geostory.contentToolbar.resetConfirmContent"})},e))},Ra=(0,$e.compose)((0,$e.withProps)((function(e){var t=e.pendingChanges,n=e.toggleEditing,r=e.disableReset,o=e.onReset,a=e.toggleAdvancedEditing,c=void 0===a?function(){}:a;return{buttons:[{glyph:"floppy-disk",disabled:!t,tooltipId:"geostory.contentToolbar.saveChanges",onClick:n},{renderButton:i().createElement(xa,{disabled:r,onClick:o})},{glyph:"pencil",tooltipId:"geostory.contentToolbar.advancedMapEditor",onClick:c}]}})),Oa.Z,(0,$e.withStateHandlers)((function(){return{editNode:void 0}}),{setEditNode:function(){return function(e){return{editNode:e}}},closeNodeEditor:function(){return function(){return{editNode:void 0}}}}),(0,$e.branch)((function(e){return!!e.editNode}),(0,$e.withProps)((function(e){var t=e.selectedNodes,n=void 0===t?[]:t,r=e.closeNodeEditor,o=void 0===r?function(){}:r;return{buttons:[{visible:1===n.length,tooltipId:"close",glyph:"1-close",onClick:o}]}})),(0,$e.withProps)((function(e){var t,n=e.selectedNodes,r=void 0===n?[]:n,o=e.setEditNode,i=void 0===o?function(){}:o,a=e.buttons,c=void 0===a?[]:a;return{buttons:[{visible:1===r.length,glyph:"wrench",tooltipId:"toc.toolLayerSettingsTooltip",onClick:function(){i(r[0])}}].concat((t=c,function(e){if(Array.isArray(e))return Ea(e)}(t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return Ea(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ea(e,t):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()))}})))),Na=(0,$e.compose)((0,$e.withPropsOnChange)(["focusedContent"],(function(e){var t=e.map,n=e.focusedEl;return{contentMap:(n=void 0===n?{}:n).map,lastSavedMap:t}})),(0,$e.withPropsOnChange)(["map"],(function(e){var t=e.map,n=e.lastSavedMap;return{pendingChanges:!Pr()(n,t)}}))),La=(0,$e.compose)((0,$e.withProps)((function(e){var t=e.toggleEditing;return{CloseBtn:function(e){return i().createElement(Or.Z,Pa({onClick:t},e))}}})),(0,$e.branch)((function(e){return e.pendingChanges}),(0,$e.withProps)((function(e){var t=e.discardAndClose,n=e.contentMap;return{CloseBtn:function(e){return i().createElement(Ta,Pa({onClick:function(){return t(n)},confirmTitle:i().createElement(yn.Z,{msgId:"geostory.contentToolbar.confirmCloseMapEditing"}),confirmContent:i().createElement(yn.Z,{msgId:"geostory.contentToolbar.pendingChangesDiscardConfirm"})},e))}}})))),_a=(0,$e.mapPropsStream)((function(e){var t=(0,$e.createEventHandler)(),n=t.stream,r=t.handler;return e.pluck("map").distinctUntilChanged((function(e,t){return Pr()(e,t)})).switchMap((function(e){return n.map((function(t){return{map:ja(ja({},e),t)}})).startWith({map:e})})).combineLatest(e,(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.map,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return ja(ja({},n),{},{onMapViewLocalChanges:r,map:t})}))})),Za=function(e,t){return void 0!==e&&void 0!==t&&e.toFixed(12)-t.toFixed(12)==0},Wa=(0,$e.withHandlers)({onMapViewChanges:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.update,n=e.editMap,r=void 0!==n&&n,o=e.onMapViewLocalChanges,i=e.map,a=(i=void 0===i?{}:i).center,c=void 0===a?{}:a,l=i.zoom,u=i.mapStateSource,s=i.resolution,p=i.resetPanAndZoom;return function(e){var n=e.center,i=void 0===n?{}:n,a=e.zoom,d=e.mapStateSource,f=e.resolution,y=Za(c.x,i.x)&&Za(c.y,i.y);!r||y&&l===a?p?t("map",{center:c,zoom:l,mapStateSource:u,resolution:s,resetPanAndZoom:!1},"merge"):o({center:i,zoom:a,mapStateSource:d,resolution:f}):t("map",{center:i,zoom:a,mapStateSource:hi()(),resolution:f,resetPanAndZoom:!1},"merge")}}}),Fa=n(5993),Ua=n(75927),Ba=n(51768),Va=n(15135),Ha=["tabs","activeTab","width","setActiveTab"];function Ga(){return(Ga=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function za(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var qa=(0,Va.Z)(an.NavItem);var Ka=n(79105),$a=n(43129),Ya=n(45869),Qa=n(87320),Xa=(0,pt.Z)(["placeholder","options"])($a.ZP);const Ja=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.map,n=void 0===t?{zoomControl:!0,mapInfoControl:!1}:t,r=e.onChangeMap,o=void 0===r?function(){}:r,a=n&&n.mapOptions||{},c=(0,p.kn)({mapOptions:a,zoomControl:!!S()(n.zoomControl)||n.zoomControl,mapInfoControl:!S()(n.mapInfoControl)&&n.mapInfoControl});return i().createElement(an.Form,{className:"ms-geostory-map-controls"},i().createElement(an.FormGroup,null,i().createElement(an.ControlLabel,null,i().createElement(yn.Z,{msgId:"geostory.mapEditor.zoom"})),i().createElement(Ya.Z,{onChange:function(){var e=!c.zoomControl;o("zoomControl",e),o("mapOptions.interactions",{doubleClickZoom:e,shiftDragZoom:e,pinchZoom:e})},className:"ms-geostory-map-controls-switch",checked:c.zoomControl}),i().createElement(Xa,{options:[{label:"geostory.mapEditor.topLeft",value:"topLeft"},{label:"geostory.mapEditor.topRight",value:"topRight"},{label:"geostory.mapEditor.bottomLeft",value:"bottomLeft"},{label:"geostory.mapEditor.bottomRight",value:"bottomRight"}],wrapperStyle:{marginTop:"10px"},value:c.mapOptions&&c.mapOptions.zoomPosition||"topLeft",clearable:!1,disabled:!c.zoomControl,onChange:function(e){return o("mapOptions.zoomPosition",e&&e.value?e.value:"topLeft")},placeholder:"geostory.builder.settings.titlePlaceholder"})),i().createElement(an.FormGroup,null,i().createElement(an.ControlLabel,null,i().createElement(yn.Z,{msgId:"geostory.mapEditor.pan"})),i().createElement(Ya.Z,{onChange:function(){var e=!(c.mapOptions&&c.mapOptions.interactions&&c.mapOptions.interactions.dragPan);o("mapOptions.interactions",{dragPan:e,keyboardPan:e})},className:"ms-geostory-map-controls-switch",checked:c.mapOptions&&c.mapOptions.interactions&&c.mapOptions.interactions.dragPan})),i().createElement(an.FormGroup,null,i().createElement(an.ControlLabel,null,i().createElement(yn.Z,{msgId:"geostory.mapEditor.identify"})),i().createElement(Ya.Z,{onChange:function(){var e=!c.mapInfoControl;o("mapInfoControl",e)},className:"ms-geostory-map-controls-switch",checked:c.mapInfoControl}),c.mapInfoControl&&i().createElement(Qa.Z,{disabled:!c.mapInfoControl,popoverMessage:"geostory.builder.settings.templateTooltip",infoFormat:c.mapOptions&&c.mapOptions.mapInfoFormat||"application/json",onInfoFormatChange:function(e){return o("mapOptions.mapInfoFormat",e)},selectProps:{wrapperStyle:{marginTop:10}}})))};var ec=n(16701),tc=(0,$e.withProps)((function(e){return{tabs:e.tabs||[{id:"toc",titleId:"geostory.mapEditor.toc",tooltipId:"geostory.mapEditor.toc",glyph:"1-layer",visible:!0,Component:ec.Z},{id:"settings",titleId:"geostory.mapEditor.settings",tooltipId:"geostory.mapEditor.settings",glyph:"wrench",visible:!0,Component:Ja}]}}));const nc=(0,$e.compose)((0,Ka.Z)("activeTab","setActiveTab","toc"),tc);var rc=(0,$e.compose)(Ba.Z,(0,$e.withProps)((function(e){var t=e.selectedNode;return{title:t&&t.title}})),(0,Fa.Z)("title"))((function(e){var t=e.title,n=e.description;return i().createElement("div",{className:"text-center"},i().createElement("div",{className:"mapstore-step-title"},t),i().createElement("div",{className:"mapstore-step-description"},n))})),oc=(0,Ba.Z)(Ua.Z),ic=nc((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.tabs,n=void 0===t?[]:t,r=e.activeTab,o=(e.width,e.setActiveTab),a=void 0===o?function(){}:o,c=za(e,Ha);return i().createElement("div",{key:"ms-geostory-map-settings-navbar",className:"ms-row-tab"},i().createElement("div",null,i().createElement(an.Nav,{bsStyle:"tabs",activeKey:r,justified:!0},n.map((function(e){return i().createElement(qa,{key:"ms-tab-settings-"+e.id,tooltipId:e.tooltipId,eventKey:e.id,onClick:function(){return a(e.id)}},i().createElement(an.Glyphicon,{glyph:e.glyph}))})))),i().createElement("div",null,n.filter((function(e){return e.id&&e.id===r})).filter((function(e){return e.Component})).map((function(e){return i().createElement(e.Component,Ga({},c,{key:"ms-geostory-tab-settings-body-"+e.id}))}))))}));const ac=(0,$e.branch)((function(e){var t=e.focusedContent;return(t=void 0===t?{}:t).path}),(0,$e.compose)((0,$e.defaultProps)({isFocused:!0,editMap:!0}),ka,Ia,Na,Da,Ma,Aa,Ra,La))((function(e){var t=e.mode,n=void 0===t?p.nl.VIEW:t,r=e.isFocused,o=void 0!==r&&r,a=e.map,c=void 0===a?{}:a,l=e.onChange,u=void 0===l?function(){}:l,s=e.onChangeMap,d=void 0===s?function(){}:s,f=e.onNodeSelect,y=void 0===f?function(){}:f,m=e.selectedNodes,b=e.buttons,v=void 0===b?[]:b,g=e.editNode,h=e.closeNodeEditor,O=e.CloseBtn,w=void 0===O?function(){return null}:O,E=e.isDrawEnabled,P=void 0!==E&&E;return n===p.nl.EDIT&&o&&!P?i().createElement("div",{key:"left-column",style:{order:-1,width:400,position:"relative"}},i().createElement(qe.Z,{className:"ms-geostory-map-editor",header:i().createElement("div",{className:"ms-geostory-map-editor-header text-center"},i().createElement(an.Row,null,i().createElement(an.Col,{md:12,className:"text-center",style:{overflow:"hidden",lineHeight:"52px"}},i().createElement(w,{glyph:"1-close",className:"pull-left on-close-btn square-button no-border ",tooltipId:"geostory.contentToolbar.closeMapEditing"}),i().createElement("div",{className:"mapstore-step-title"},i().createElement(yn.Z,{msgId:"geostory.mapEditor.configureMapOptions"})))),i().createElement(qn.Z,{transitionProps:!1,btnGroupProps:{className:"ms-geostory-map-editor-toolbar"},btnDefaultProps:{className:"square-button-md no-border",bsStyle:"primary",noTooltipWhenDisabled:!0},buttons:v}))},!!g&&[i().createElement(rc,{map:c,editNode:g}),i().createElement(oc,{closeNodeEditor:h,editNode:g,map:c,onChange:u})]||[i().createElement(ic,{map:c,onChange:u,onChangeMap:d,selectedNodes:m,onSelect:y})])):null}));var cc=n(64721),lc=n.n(cc),uc=n(16788),sc=n(7875),pc=n(52826);function dc(){return(dc=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function fc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function yc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fc(Object(n),!0).forEach((function(t){mc(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fc(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function mc(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const bc=function(e){var t=function(){return i().createElement("div",{className:"ms-media-error"},i().createElement(an.Glyphicon,{glyph:"exclamation-sign"}))},n=function(e){var t=e.style,n=void 0===t?{}:t;return i().createElement("div",{style:n,className:"ms-media-loader"},i().createElement(kn.Z,{size:52}))};return function(r){var o={},a=r.sectionType;if((a===p.ID.PARAGRAPH||a===p.ID.IMMERSIVE||a===p.ID.CAROUSEL)&&r.type===p.Tr.IMAGE){var c=((null==r?void 0:r.imgHeight)||9)/((null==r?void 0:r.imgWidth)||16)*100;o={paddingTop:"".concat(c,"%")}}return r.lazy?i().createElement(In,{key:r.loadingId,id:r.loadingId,debounceTime:r.debounceTime,loading:r.isLoading,onLoad:function(e){return r.onLoad(yc(yc({},r.loading),{},mc({},e,!1)))},loaderComponent:n,loaderStyle:o},i().createElement(e,dc({},r,{type:r.type,loaderComponent:n,loaderStyle:o,errorComponent:t}))):i().createElement(e,dc({},r,{key:r.id,type:r.mediaType||r.type,loaderComponent:n,errorComponent:t}))}};var vc=n(7848),gc=n(19983),hc=["autoplay"],Oc=["type"];function wc(){return(wc=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Ec(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Pc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ec(Object(n),!0).forEach((function(t){Sc(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ec(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Sc(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function jc(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var Cc={image:(0,$e.branch)((function(e){return e.resourceId}),(0,$e.compose)((0,a.connect)((0,c.P1)(Q.jq,(function(e){return{resources:e}}))),(0,$e.withProps)((function(e){var t=e.resources,n=e.resourceId;return(Z()(t,{id:n})||{}).data}))),(0,nt.Z)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.src,n=void 0===t?"":t,r=e.sectionType;return!n&&r!==p.ID.TITLE&&!lc()([p.ID.IMMERSIVE,p.ID.CAROUSEL],r)}),(function(){return{glyph:"picture"}})))(bc(uc.Z)),map:(0,$e.compose)((0,$e.branch)((function(e){return e.resourceId}),Ia),vc.Z,gc.Z,_a,Wa)(bc(sc.Z)),video:(0,$e.branch)((function(e){return e.resourceId}),(0,$e.compose)((0,a.connect)((0,c.P1)(Q.jq,(function(e){return{resources:e}}))),(0,$e.withProps)((function(e){var t=e.resources,n=e.resourceId,r=e.autoplay,o=(Z()(t,{id:n})||{}).data||{},i=o.autoplay;return Pc(Pc({},jc(o,hc)),{},{autoplay:void 0!==r?r:i})}))),(0,nt.Z)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.src,n=void 0===t?"":t,r=e.sectionType;return!n&&r!==p.ID.TITLE&&!lc()([p.ID.IMMERSIVE,p.ID.CAROUSEL],r)}),(function(){return{glyph:"play"}})))(bc(pc.Z))};const Tc=function(e){var t=e.type,n=jc(e,Oc),r=Cc[t];return r?i().createElement(r,wc({type:t},n)):null};var Ic=["resources"];function kc(){return(kc=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}const Dc=(0,a.connect)((0,c.P1)(Q.jq,(function(e){return{resources:e}})))((function(e){var t=e.resources,n=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(e,Ic);if(n.resourceId){var r=(Z()(t,{id:n.resourceId})||{}).data||{};return i().createElement(qr,kc({},r,n))}return i().createElement(qr,n)}));var Ac=["story","mode","onAdd","messages","fontFamilies","storyFonts","webFont","onUpdate","onBasicError","onUpdateMediaEditorSetting","mediaEditorSettings","geoCarouselSettings","onUpdateGeoCarouselSetting"];function Mc(){return(Mc=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var xc=function(e){var t=e.story,n=e.mode,r=void 0===n?p.nl.VIEW:n,a=e.onAdd,c=e.messages,l=e.fontFamilies,s=void 0===l?[]:l,f=e.storyFonts,y=void 0===f?[]:f,m=e.webFont,b=void 0===m?u():m,v=e.onUpdate,g=void 0===v?function(){}:v,h=e.onBasicError,O=void 0===h?function(){}:h,w=e.onUpdateMediaEditorSetting,E=e.mediaEditorSettings,P=e.geoCarouselSettings,S=e.onUpdateGeoCarouselSetting,j=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(e,Ac),C=(0,o.useCallback)((function(e){return(0,d.S$)(c,e)}),[c]),T=function(e,t,n,r){return a(e,t,n,r?C(r):C)};return(0,o.useEffect)((function(){window.__geostory_interaction=function(e,t){"scrollTo"===e&&(0,p.M1)(t,{behavior:"smooth"})}}),[]),(0,o.useEffect)((function(){g("settings.theme.fontFamilies",s,"merge"),E&&w(E),P&&S(P)}),[]),(0,o.useEffect)((function(){y.length>0&&y.filter((function(e){var t=e.src;return t&&!document.head.querySelector("link[href='".concat(t,"']"))})).length>0&&b.load((0,p.bm)(y,(function(){}),(function(){return O({message:"geostory.builder.settings.webFontLoadError"})})))}),[y]),i().createElement(qe.Z,{className:"ms-geostory",columns:[i().createElement(ac,Mc({},j,{add:T,update:g,mode:r}))]},i().createElement(ha,Mc({},t,j,{storyFonts:(0,p._R)(y),add:T,update:g,mode:r,mediaViewer:Tc,contentToolbar:Dc})))};xc.defaultProps={storyFonts:[],fontFamilies:[],onUpdateMediaEditorSetting:function(){}};const Rc=(0,s.rx)("GeoStory",{component:(0,a.connect)((0,c.zB)({mode:Q.eK,story:Q.Kg,messages:Ge.Ps,focusedContent:Q.FW,isContentFocused:Q.z7,theme:function(e){var t;return(null===(t=(0,Q.TQ)(e))||void 0===t?void 0:t.theme)||{}},storyFonts:Q.mm,isDrawEnabled:Q.HB}),{onAdd:y.IH,onUpdate:y.Vx,updateCurrentPage:y.RZ,onUpdateSetting:y.m7,remove:y.Od,onSort:y.pB,editMedia:m.Ql,editWebPage:y.o2,onBasicError:f.d,onUpdateMediaEditorSetting:y.Fu,onUpdateGeoCarouselSetting:y.Ml})(xc),reducers:{geostory:ze.Z},epics:r})},8316:(e,t,n)=>{"use strict";n.d(t,{Pz:()=>a,Ps:()=>c,KV:()=>l});var r=n(22222),o=n(91175),i=n.n(o),a=function(e){return e.locale&&e.locale.current||"en-US"},c=function(e){return e.locale&&e.locale.messages||{}},l=(0,r.P1)([a],(function(e){return i()(e.split("-"))}))},10284:(e,t,n)=>{"use strict";n.d(t,{sw:()=>v,oB:()=>g});var r=n(49977),o=n.n(r),i=n(27361),a=n.n(i),c=n(5055),l=n(7526);function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function p(e){var t="function"==typeof Map?new Map:void 0;return(p=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return d(e,arguments,m(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),y(r,e)})(e)}function d(e,t,n){return(d=f()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&y(o,n.prototype),o}).apply(null,arguments)}function f(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}n(24384);var b=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(o,e);var t,n,r=(t=o,n=f(),function(){var e,r=m(t);if(n){var o=m(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return s(this,e)});function o(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(n=r.call(this,e)).name="OGCError",n.code=t,n}return o}(p(Error)),v=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{tagNameProcessors:[l.stripPrefix],explicitArray:!1,mergeAttrs:!0};return o().Observable.bindNodeCallback((function(e,n){return(0,c.parseString)(e,t,n)}))(e)},g=function(e){return e.switchMap((function(e){return"string"==typeof e.data&&e.data.indexOf("ExceptionReport")>0?o().Observable.bindNodeCallback((function(e,t){return(0,c.parseString)(e,{tagNameProcessors:[l.stripPrefix],explicitArray:!1,mergeAttrs:!0},t)}))(e.data).map((function(e){var t=a()(e,"ExceptionReport.Exception.ExceptionText");throw new b(t||"Undefined OGC Service Error",a()(e,"ExceptionReport.Exception.exceptionCode"))})):o().Observable.of(e)}))}},59112:(e,t,n)=>{"use strict";n.d(t,{gP:()=>u,BC:()=>p,yQ:()=>d,fu:()=>f});var r=n(13218),o=n.n(r),i=n(27361),a=n.n(i),c=n(24262),l=n(86638),u=function(e){var t=e.label,n=RegExp("^/|/$|/{2,}");return!(!t||n.test(t))},s=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"title",t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:" - ";switch(e){case"title":var i=o()(t.title)?t.title[n]||t.title.default:t.title,a=i||t.name||"";return a;case"description":var c=t.description||"";return c;case"both":var l=o()(t.title)?t.title[n]||t.title.default:t.title,u=l||t.nam||"",s=t.description||"";return"".concat(u).concat(r&&s?r:"").concat(s);default:return t[e]}},p=function(e){var t=e.node,n=e.currentLocale,r=e.tooltipOptions,o=void 0===r?{separator:" - ",maxLength:807}:r,i=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:" - ";return s(e.tooltipOptions,e,t,n)}(t,n,o.separator)||"";return(i=i&&i.substring(0,o.maxLength)).length===o.maxLength&&(i+="..."),{title:s("title",t,n,o.separator),tooltipText:i}},d=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return t.filter((function(e){return e.nodes})).reduce((function(t,o){return t.push(r?o:{label:o.id.replace(/\./g,"/").replace(/\${dot}/g,"."),value:o.id}),o.nodes.length>0?t.concat(e(o.nodes,n+1,r)):t}),[])},f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=e.replace(/[^\.\/]+/g,(function(e){var n=a()((0,c._e)(e,t),"title");return o()(n)?n[(0,l.Kd)()]||n.default:t&&n||e}));return(n=n.replace(/\./g,"/")).replace(/\${dot}/g,".")}},83255:(e,t,n)=>{e.exports=n.p+"grid.svg"},11636:(e,t,n)=>{e.exports=n.p+"world.svg"},73723:(e,t,n)=>{e.exports=n.p+"MapStore2/web/client/components/geostory/contents/carousel/img/default.jpg"},75492:(e,t,n)=>{e.exports=n.p+"MapStore2/web/client/components/geostory/layouts/sections/patterns/dots.png"}}]);