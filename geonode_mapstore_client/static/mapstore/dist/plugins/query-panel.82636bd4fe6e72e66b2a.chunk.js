(self.webpackChunkgeonode_mapstore_client=self.webpackChunkgeonode_mapstore_client||[]).push([[8973],{1550:(e,t,r)=>{"use strict";r.d(t,{pP:()=>o,TR:()=>a,N7:()=>i,mq:()=>l,uv:()=>s,Qy:()=>u,IL:()=>p,Li:()=>c,OW:()=>f,ZO:()=>d,Um:()=>y,TF:()=>m,Ls:()=>b,Ec:()=>g,Eu:()=>h,JJ:()=>v,nZ:()=>O,YD:()=>w,GI:()=>F,Jb:()=>E,Uh:()=>P,LP:()=>S,xy:()=>j,o6:()=>x,FP:()=>C,Mo:()=>T,sO:()=>N,Px:()=>q,hd:()=>D,BV:()=>I,SO:()=>L,H0:()=>_,$X:()=>M,ou:()=>R,NE:()=>A});var n=r(97395),o="CHANGE_MAP_VIEW",a="CLICK_ON_MAP",i="CHANGE_MOUSE_POINTER",l="CHANGE_ZOOM_LVL",s="PAN_TO",u="ZOOM_TO_EXTENT",p="ZOOM_TO_POINT",c="CHANGE_MAP_CRS",f="CHANGE_MAP_SCALES",d="CHANGE_MAP_STYLE",y="CHANGE_ROTATION",m="CREATION_ERROR_LAYER",b="UPDATE_VERSION",g="INIT_MAP",h="RESIZE_MAP",v="CHANGE_MAP_LIMITS",O="SET_MAP_RESOLUTIONS",w="REGISTER_EVENT_LISTENER",F="UNREGISTER_EVENT_LISTENER",E="MOUSE_MOVE",P="MOUSE_OUT";function S(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{family:""};return(0,n.vU)({title:"warning",message:"map.errorLoadingFont",values:e,position:"tc",autoDismiss:10})}function j(e,t,r){return{type:p,pos:e,zoom:t,crs:r}}function x(e,t,r,n,a,i,l,s){return{type:o,center:e,zoom:t,bbox:r,size:n,mapStateSource:a,projection:i,viewerOptions:l,resolution:s}}function C(e,t){return{type:a,point:e,layer:t}}function T(e){return{type:i,pointer:e}}function N(e,t){return{type:l,zoom:e,mapStateSource:t}}function q(e,t,r){return{type:u,extent:e,crs:t,maxZoom:r}}function D(e,t){return{type:d,style:e,mapStateSource:t}}function I(e){var t=e.restrictedExtent,r=e.crs,n=e.minZoom;return{type:v,restrictedExtent:t,crs:r,minZoom:n}}function L(e){return{type:O,resolutions:e}}var _=function(e,t){return{type:w,eventName:e,toolName:t}},M=function(e,t){return{type:F,eventName:e,toolName:t}},R=function(e){return{type:E,position:e}},A=function(){return{type:P}}},47310:(e,t,r)=>{"use strict";r.d(t,{Z:()=>p});var n=r(75875),o=r.n(n),a=r(72500),i=r.n(a),l=r(27418),s=r.n(l),u={format:"json",bounded:0,polygon_geojson:1,priority:5};const p={geocode:function(e,t){var r=s()({q:e},u,t||{}),n=i().format({protocol:"https",host:"nominatim.openstreetmap.org",query:r});return o().get(n)},reverseGeocode:function(e,t){var r=s()({lat:e.lat,lon:e.lng},t||{},u),n=i().format({protocol:"https",host:"nominatim.openstreetmap.org/reverse",query:r});return o().get(n)}}},15047:(e,t,r)=>{"use strict";r.d(t,{b:()=>y});var n=r(27418),o=r.n(n);function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){l(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var s=function(e){return null===e?[]:e.map((function(e){return{properties:i({},e),id:e.osm_id,type:"Feature",bbox:e.boundingbox.map((function(e){return parseFloat(e)})).reduce((function(e,t,r){return e[function(e){switch(e){case 0:return 1;case 1:return 3;case 2:return 0;case 3:return 2;default:return-1}}(r)]=t,e}),[]),geometry:e.geojson||{type:"Point",coordinates:[parseFloat(e.lon),parseFloat(e.lat)]}}}))},u=r(59286),p=r(32420);var c=function(e){var t,r=e.searchText,n=e.staticFilter,o=e.blacklist,a=e.item,i=e.queriableAttributes,l=e.predicate,s=(0,u.generateTemplateString)(n||"")(a),p=r.split(" ").filter((function(e){return e})).filter((function(e){return o.indexOf(e.toLowerCase())<0}));return 0===p.length&&(p=r?[r]:[]),p.length>0&&(t="(".concat(p.map((function(e){return i.map((function(t){return"".concat(t," ").concat(l," '%").concat(e.replace("'","''"),"%'")})).join(" OR ")})).join(") AND (")).concat(")")),t?t.concat(s):s||null},f={nominatim:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{returnFullData:!1};return r(47310).Z.geocode(e,t).then((function(e){return t.returnFullData?e:s(e.data)}))},wfs:function(e,t){var r=t.url,n=t.typeName,a=t.queriableAttributes,i=void 0===a?[]:a,l=t.outputFormat,s=void 0===l?"application/json":l,u=t.predicate,f=void 0===u?"ILIKE":u,d=t.staticFilter,y=void 0===d?"":d,m=t.blacklist,b=void 0===m?[]:m,g=t.item,h=t.fromTextToFilter,v=void 0===h?c:h,O=t.returnFullData,w=void 0!==O&&O,F=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(t,["url","typeName","queriableAttributes","outputFormat","predicate","staticFilter","blacklist","item","fromTextToFilter","returnFullData"]),E=v({searchText:e,staticFilter:y,blacklist:b,item:g,queriableAttributes:i,predicate:f});return p.getFeatureSimple(r,o()({maxFeatures:10,typeName:n,outputFormat:s,cql_filter:E},F)).then((function(e){return w?e:e.features}))}},d={setService:function(e,t){f[e]=t},getService:function(e){return f[e]?f[e]:null}},y={Services:f,Utils:d}},76364:(e,t,r)=>{"use strict";r.d(t,{Vd:()=>g,Vj:()=>h});var n=r(72500),o=r.n(n),a=r(86494),i=r(27418),l=r.n(i),s=r(49977),u=r.n(s),p=r(15047),c=r(75875),f=r.n(c),d=r(84069);function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function m(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var b=function(e){var t=e.searchText,r=void 0===t?"":t,n=e.queriableAttributes,o=void 0===n?[]:n,i=e.predicate,l=void 0===i?"ILIKE":i,s=(0,a.head)(o),u=r.toLowerCase(),p="strToLowerCase(".concat(s,") ").concat(l," '%").concat(u,"%'");return(0,a.isNil)(s)?"":"("+p+")"},g=function(e){return e.distinctUntilChanged((function(e){var t=e.value,r=e.currentPage,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return!(n.value!==t||n.currentPage!==r)})).throttle((function(e){return u().Observable.timer(e.delayDebounce||0)})).merge(e.debounce((function(e){return u().Observable.timer(e.delayDebounce||0)}))).distinctUntilChanged().switchMap((function(e){if(e.performFetch){var t=(0,d.getWpsPayload)({attribute:e.attribute,layerName:e.typeName,maxFeatures:e.maxFeatures,startIndex:(e.currentPage-1)*e.maxFeatures,value:e.value});return u().Observable.fromPromise(f().post(e.url,t,{timeout:6e4,headers:{Accept:"application/json","Content-Type":"application/xml"}}).then((function(e){return{fetchedData:e.data,busy:!1}}))).catch((function(){return u().Observable.of({fetchedData:{values:[],size:0},busy:!1})})).startWith({busy:!0})}return u().Observable.of({fetchedData:{values:[],size:0},busy:!1})})).startWith({})},h=function(e){return u().Observable.merge(e.distinctUntilChanged((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.value,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.value;return t===n})).debounce((function(e){return u().Observable.timer(e.delayDebounce||0)})),e.distinctUntilChanged((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.filterProps,r=e.currentPage,n=arguments.length>1?arguments[1]:void 0,o=n.filterProps,a=n.currentPage;return t===o&&r===a}))).switchMap((function(e){if(e.performFetch){var t=o().parse(e.url,!0),r="";((0,a.endsWith)(t.pathname,"wfs")||(0,a.endsWith)(t.pathname,"wms")||(0,a.endsWith)(t.pathname,"ows")||(0,a.endsWith)(t.pathname,"wps"))&&(r=t.pathname.replace(/(wms|ows|wps|wfs)$/,"wfs")),t.query&&t.query.service&&delete t.query.service;var n=o().format(l()({},t,{search:null,pathname:r})),i=l()({},function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(Object(r),!0).forEach((function(t){m(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({url:n,typeName:e.filterProps&&e.filterProps.typeName||"",predicate:e.filterProps&&e.filterProps.predicate||"ILIKE",blacklist:e.filterProps&&e.filterProps.blacklist||[],maxFeatures:e.filterProps&&e.filterProps.maxFeatures||3,queriableAttributes:e.filterProps&&e.filterProps.queriableAttributes||[],returnFullData:!0,startIndex:((e.currentPage||1)-1)*(e.filterProps&&e.filterProps.maxFeatures||3),outputFormat:"application/json",staticFilter:"",fromTextToFilter:b,item:{},timeout:6e4,headers:{Accept:"application/json","Content-Type":"application/xml"},srsName:e.filterProps&&e.filterProps.srsName||"EPSG:4326"},t.query));return u().Observable.fromPromise(p.b.Utils.getService("wfs")(e.value,i).then((function(t){return{fetchedData:{values:t.features.map((function(e){return e.properties})),size:t.totalFeatures,features:t.features,crs:e.filterProps&&e.filterProps.srsName||"EPSG:4326"},busy:!1}}))).catch((function(){return u().Observable.of({fetchedData:{values:[],size:0,features:[]},busy:!1})})).startWith({busy:!0})}return u().Observable.of({fetchedData:{values:[],size:0,features:[]},busy:!1})})).startWith({})}},86850:(e,t,r)=>{"use strict";r.d(t,{Mc:()=>q,v$:()=>D,ED:()=>I});var n=r(72500),o=r.n(n),a=r(86494),i=r(49977),l=r.n(i),s=r(5055),u=r(7526),p=r(75875),c=r.n(p),f=r(47805),d=r(24262),y=r(10284),m=r(39156);function b(e){return function(e){if(Array.isArray(e))return g(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return g(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?g(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function O(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function w(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?O(Object(r),!0).forEach((function(t){F(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function F(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var E=r.n(m)()({wfsVersion:"1.1.0"}),P=E.getFeature,S=E.query,j=E.sortBy,x=E.propertyName,C=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.totalFeatures,r=e.features,n=v(e,["totalFeatures","features"]),o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=o.startIndex,i=arguments.length>2?arguments[2]:void 0;return i>t&&i===a+r.length&&t===r.length?w(w({},n),{},{features:r,totalFeatures:i}):w(w({},n),{},{features:r,totalFeatures:t})},T=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.pagination||!(0,a.isNil)(t.startIndex)&&!(0,a.isNil)(t.maxFeatures)&&{startIndex:t.startIndex,maxFeatures:t.maxFeatures}},N=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=(0,f.getWFSFilterData)(t,r),i=o().parse(e,!0),s=(0,a.isObject)(i.query)?i.query:{};s.service="WFS",s.outputFormat="json";var u=o().format({protocol:i.protocol,host:i.host,pathname:i.pathname,query:s});return l().Observable.defer((function(){return c().post(u,n,{timeout:6e4,headers:{Accept:"application/json","Content-Type":"application/json"}})})).let(y.oB).map((function(e){return C(e.data,T(t,r),r.totalFeatures)}))},q=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.search,r=void 0===t?{}:t,n=e.url,o=e.name,i=arguments.length>1?arguments[1]:void 0,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=l.sortOptions,u=l.propertyName,p=v(l,["sortOptions","propertyName"]);return N(r.url||n,i&&"object"===h(i)?w(w({},i),{},{typeName:o||i.typeName}):P(S(o,[].concat(b(s?[j(s.sortBy,s.sortOrder)]:[]),b(u?[x(u)]:[]),b(i?(0,a.castArray)(i):[]))),p),p).catch((function(e){if("OGCError"===e.name&&"NoApplicableCode"===e.code&&!s&&u&&u[0])return N(r.url||n,i&&"object"===h(i)?w(w({},i),{},{typeName:o||i.typeName}):P(S(o,[j(u[0])].concat(b(u?[x(u)]:[]),b(i?(0,a.castArray)(i):[]))),p),p);throw e}))},D=function(e){var t=e.layer;return l().Observable.defer((function(){return c().get(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.name,r=e.search,n=void 0===r?{}:r,a=e.url,i=e.describeFeatureTypeURL,l=o().parse(i||n.url||a,!0);return o().format(w(w({},l),{},{search:void 0,query:w(w({},l.query),{},{service:"WFS",version:"1.1.0",typeName:t,outputFormat:"application/json",request:"DescribeFeatureType"})}))}(t))})).let(y.oB)},I=function(e){var t=e.layer;return l().Observable.defer((function(){return c().get(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.name,r=e.search,n=void 0===r?{}:r,a=e.url,i=(0,d.getCapabilitiesUrl)({name:t,url:n&&n.url||a}),l=o().parse(i,!0);return o().format(w(w({},l),{},{search:void 0,query:w(w({},l.query),{},{service:"WFS",version:"1.1.1",request:"GetCapabilities"})}))}(t))})).let(y.oB).switchMap((function(e){return l().Observable.bindNodeCallback((function(e,t){return(0,s.parseString)(e,{tagNameProcessors:[u.stripPrefix],explicitArray:!1,mergeAttrs:!0},t)}))(e.data)}))}},49537:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>Gr});var n=r(86494),o=r(45697),a=r.n(o),i=r(24852),l=r.n(i),s=r(71703),u=r(6806),p=r(12838),c=r(22222),f=r(82904),d=r(4206),y=r(90825),m=r(40512),b=r(80416),g=r(1550),h=r(7878),v=r(95797),O=(r(65207),r(72986)),w=r.n(O),F=r(65539),E=r(5346),P=r(12346),S=r(30294),j=r(43129),x=r(20),C=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.item;return l().createElement("span",null,t&&t.name?l().createElement(E.Z,{msgId:t.name}):null)};const T=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.spatialOperations,r=void 0===t?[]:t,n=e.onChange,o=void 0===n?function(){}:n,a=e.value;return l().createElement(x.DropdownList,{valueField:"id",className:"geometry-operation-selector",onChange:o,data:r,valueComponent:C,value:a,itemComponent:C})};var N=r(31071),q=r(11847),D=r(2576);function I(e){return function(e){if(Array.isArray(e))return L(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return L(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?L(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function L(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var _=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.search,n=t.url;return(0,q.w0)(e,n)||(0,q.w0)(e,r&&r.url)},M=function(e){return(e||[]).filter((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.id;return"BBOX"!==t}))},R=r(49977),A=r.n(R),k=r(86850),B=r(78889),G={"xsd:normalizedString":"string","xsd:string":"string","xsd:date":"date","xsd:dateTime":"date","xsd:date-time":"date-time","xsd:time":"time","xsd:decimal":"number","xsd:int":"number","xsd:integer":"number","xsd:long":"number","xsd:negativeInteger":"number","xsd:nonNegativeInteger":"number","xsd:nonPositiveInteger":"number","xsd:positiveInteger":"number","xsd:short":"number","xsd:unsignedLong":"number","xsd:unsignedInt":"number","xsd:unsignedShort":"number","xsd:number":"number","xsd:boolean":"boolean","xsd:double":"number","xsd:float":"number"},Z=function(e){return(0,n.get)(e,"featureTypes[0].properties").filter((function(e){return 0!==e.type.indexOf("gml:")&&G[e.type]})).map((function(e){return{label:e.name,attribute:e.name,type:G[e.type],valueId:"id",valueLabel:"name",values:[]}}))},U=r(67076),V=r(73849);function W(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function z(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?W(Object(r),!0).forEach((function(t){H(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):W(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function H(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Q=function(e){return e.distinctUntilChanged((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.searchUrl,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.searchUrl;return t===n})).switchMap((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.crossLayerExpanded?R.Observable.of(t):e.filter((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.crossLayerExpanded;return t})).take(1)})).switchMap((function(e){var t=e.featureTypeName,r=e.searchUrl;return(0,k.ED)({layer:{name:t,url:r,search:{type:"wfs",url:r}}}).do((function(e){if(t=e,r=(0,n.get)(t,"WFS_Capabilities.Filter_Capabilities.Scalar_Capabilities.ArithmeticOperators.Functions.FunctionNames.FunctionName"),!(0,n.find)(r,(function(){return"queryCollection"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})._})))throw new Error("nocrosslayerfunctionalities");var t,r})).map((function(){return{loadingCapabilities:!1}})).catch((function(e){return R.Observable.of({errorObj:e,loadingAttributes:!1,loadingCapabilities:!1,featureTypeProperties:[]})})).startWith({loadingCapabilities:!0})})).startWith({})},$=function(e,t){return e.distinctUntilChanged((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.layer,r=void 0===t?{}:t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=n.layer;return o&&r.name===(o&&o.name)})).filter((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.layer;return!!t})).switchMap((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.layer;return R.Observable.defer((function(){return(0,k.v$)({layer:r})})).do((function(e){var r=(0,n.get)((0,B.findGeometryProperty)(e.data||{}),"name");r&&t("geometryName",r)})).map((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.data,r=void 0===t?{}:t;return Z(r)})).map((function(e){return{attributes:e,loadingAttributes:!1}})).startWith({loadingAttributes:!0}).catch((function(e){return R.Observable.of({errorObj:e,loadingAttributes:!1,featureTypeProperties:[]})}))})).catch((function(e){return R.Observable.of({errorObj:e,loadingAttributes:!1,loadingCapabilities:!1,featureTypeProperties:[]})})).startWith({})};const X=(0,U.compose)((0,U.withPropsOnChange)(["crossLayerFilter"],(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.crossLayerFilter,r=void 0===t?{}:t;return{queryCollection:(0,n.get)(r,"collectGeometries.queryCollection"),operation:(0,n.get)(r,"operation"),distance:(0,n.get)(r,"distance")}})),(0,U.withProps)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.layers,r=void 0===t?[]:t,o=e.queryCollection,a=void 0===o?{}:o;return{layer:(0,n.find)(r,(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.name;return t===a.typeName}))}})),(0,U.withHandlers)({setQueryCollectionParameter:function(e){var t=e.setCrossLayerFilterParameter,r=void 0===t?function(){}:t;return function(e,t){r("collectGeometries.queryCollection[".concat(e,"]"),t),"typeName"===e&&r("collectGeometries.queryCollection.filterFields",[])}},updateLogicCombo:function(e){var t=e.setCrossLayerFilterParameter,r=void 0===t?function(){}:t;return function(e,t){return r("collectGeometries.queryCollection.groupFields",[{id:e,logic:t,index:0}])}},setOperation:function(e){var t=e.setCrossLayerFilterParameter,r=void 0===t?function(){}:t;return function(e){return r("operation",e)}}}),(0,U.defaultProps)({dataStreamFactory:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.setQueryCollectionParameter,n=void 0===r?function(){}:r;return Q(e).combineLatest($(e,n),(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return z(z({},t),e)})).startWith({})}}),V.Z);var Y=r(43614),K=r(47805),J=r(38560),ee=r(80717);function te(e){return(te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function re(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ne(e,t){return(ne=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function oe(e,t){return!t||"object"!==te(t)&&"function"!=typeof t?ae(e):t}function ae(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ie(e){return(ie=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function le(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var se=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ne(e,t)}(s,e);var t,r,o,a,i=(o=s,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ie(o);if(a){var r=ie(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return oe(this,e)});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),le(ae(t=i.call(this,e)),"getCurrentFilter",(function(){return{featureTypeName:t.props.featureTypeName,groupFields:t.props.groupFields,filterFields:t.props.sendFilters&&t.props.sendFilters.attributeFilter&&t.props.filterFields.filter((function(e){return(0,K.checkOperatorValidity)(e.value,e.operator)}))||[],spatialField:t.props.sendFilters&&t.props.sendFilters.spatialFilter&&t.props.spatialField||{attribute:t.props.spatialField&&t.props.spatialField.attribute},pagination:t.props.pagination,filterType:t.props.filterType,ogcVersion:t.props.ogcVersion,sortOptions:t.props.sortOptions,crossLayerFilter:t.props.sendFilters&&t.props.sendFilters.crossLayerFilter&&(0,K.setupCrossLayerFilterDefaults)(t.props.crossLayerFilter)||null,hits:t.props.hits}})),le(ae(t),"isCurrentFilterChanged",(function(){var e=t.getCurrentFilter(),r={groupFields:e.groupFields,filterFields:e.filterFields,spatialField:e.spatialField,crossLayerFilter:e.crossLayerFilter},o=t.props.appliedFilter||{},a={groupFields:o.groupFields,filterFields:o.attributePanelExpanded&&o.filterFields||[],spatialField:o.spatialPanelExpanded&&o.spatialField||{attribute:t.props.spatialField&&t.props.spatialField.attribute},crossLayerFilter:o.crossLayerExpanded&&o.crossLayerFilter&&o.crossLayerFilter.operation?(0,K.setupCrossLayerFilterDefaults)(o.crossLayerFilter):null};return!(0,n.isEqual)(r,a)})),le(ae(t),"search",(function(){var e=t.getCurrentFilter();t.props.actions.onQuery(t.props.searchUrl,e,t.props.params),t.props.advancedToolbar&&t.props.actions.storeAppliedFilter()})),le(ae(t),"reset",(function(){if(t.props.actions.onChangeDrawingStatus("clean","","queryform",[]),t.props.actions.onReset(),t.props.advancedToolbar){var e={featureTypeName:t.props.featureTypeName,groupFields:[],filterFields:[],spatialField:{attribute:t.props.spatialField&&t.props.spatialField.attribute},pagination:t.props.pagination,filterType:t.props.filterType,ogcVersion:t.props.ogcVersion,sortOptions:t.props.sortOptions,crossLayerFilter:null,hits:t.props.hits};t.props.actions.onQuery(t.props.searchUrl,e,t.props.params),t.props.advancedToolbar&&t.props.actions.storeAppliedFilter()}})),le(ae(t),"restorePersistedFilter",(function(){t.props.actions.onRestoreFilter()})),t}return t=s,(r=[{key:"render",value:function(){var e=this,t=this.props.filterFields.filter((function(e){return e.exception})).length>0,r=this.props.allowEmptyFilter&&!this.props.advancedToolbar,o=this.props.filterFields.filter((function(e){return e.value||0===e.value})).length>0,a=(0,K.isFilterEmpty)(this.props),i=(0,K.isFilterEmpty)(this.props.appliedFilter),s=this.isCurrentFilterChanged(),u=o||this.props.spatialField.geometry||(0,K.isCrossLayerFilterValid)(this.props.crossLayerFilter),p=!(0,n.isEqual)(this.props.appliedFilter,this.props.storedFilter),c=r||a&&this.props.appliedFilter&&!i,f=t||!this.props.toolbarEnabled||a&&!c||!a&&(!u||!s),d=this.props.emptyFilterWarning&&a&&s,y=this.props.advancedToolbar?"queryform.apply":this.props.queryBtnMsgId,m=[{tooltipId:d?"queryform.emptyfilter":y,disabled:f,noTooltipWhenDisabled:!0,glyph:this.props.advancedToolbar?"ok":this.props.queryBtnGlyph,className:d?"square-button-md showWarning":"square-button-md",id:"query-toolbar-query",onClick:this.search}];if(this.props.advancedToolbar){var b=!p||this.props.loadingError||s,g=!p||!this.props.storedFilter||!this.props.toolbarEnabled,h=!this.props.appliedFilter||this.props.appliedFilter&&i||!this.props.toolbarEnabled;m=m.concat([{tooltipId:"queryform.save",disabled:b,noTooltipWhenDisabled:!0,glyph:"floppy-disk",id:"query-toolbar-save",onClick:this.props.actions.onSaveFilter},{tooltipId:"queryform.discard",disabled:g,noTooltipWhenDisabled:!0,glyph:"undo",id:"query-toolbar-discard",onClick:this.restorePersistedFilter},{tooltipId:"queryform.reset",glyph:"clear-filter",noTooltipWhenDisabled:!0,id:"reset",disabled:h,onClick:this.reset}])}else m=[{tooltipId:"queryform.reset",glyph:"clear-filter",noTooltipWhenDisabled:!0,id:"reset",disabled:!this.props.toolbarEnabled,onClick:this.reset}].concat(m);return l().createElement("div",{className:"container-fluid query-toolbar"},l().createElement(ee.Z,{btnDefaultProps:{bsStyle:"primary",className:"square-button-md",tooltipPosition:"bottom"},className:"queryFormToolbar row-fluid pull-right",buttons:m}),l().createElement(Y.Z,{show:!!this.props.showGeneratedFilter,bsSize:"large"},l().createElement(Y.Z.Header,null,l().createElement(Y.Z.Title,null,this.props.resultTitle)),l().createElement(Y.Z.Body,null,l().createElement("textarea",{style:{width:"862px",maxWidth:"862px",height:"236px",maxHeight:"236px"}},this.props.showGeneratedFilter)),l().createElement(Y.Z.Footer,null,l().createElement(J.Z,{style:{float:"right"},onClick:function(){return e.props.actions.onQuery(null,null)}},"Close"))))}}])&&re(t.prototype,r),s}(l().Component);le(se,"propTypes",{filterType:a().string,params:a().object,filterFields:a().array,groupFields:a().array,spatialField:a().object,sendFilters:a().object,crossLayerFilter:a().object,toolbarEnabled:a().bool,searchUrl:a().string,showGeneratedFilter:a().oneOfType([a().bool,a().string]),featureTypeName:a().string,actions:a().object,ogcVersion:a().string,titleMsgId:a().string,queryBtnMsgId:a().string,resultTitle:a().string,queryBtnGlyph:a().string,pagination:a().object,sortOptions:a().object,hits:a().bool,allowEmptyFilter:a().bool,emptyFilterWarning:a().bool,appliedFilter:a().object,storedFilter:a().object,advancedToolbar:a().bool,loadingError:a().bool}),le(se,"defaultProps",{sendFilters:{attributeFilter:!0,spatialFilter:!0,crossLayerFilter:!0},filterType:"OGC",params:{},groupFields:[],filterFields:[],spatialField:{},toolbarEnabled:!0,searchUrl:null,showGeneratedFilter:!1,featureTypeName:null,titleMsgId:"queryform.title",queryBtnMsgId:"queryform.query",resultTitle:"Generated Filter",queryBtnGlyph:"search",pagination:null,sortOptions:null,hits:!1,allowEmptyFilter:!1,emptyFilterWarning:!1,advancedToolbar:!1,loadingError:!1,actions:{onQuery:function(){},onReset:function(){},onChangeDrawingStatus:function(){},onSaveFilter:function(){},onRestoreFilter:function(){},storeAppliedFilter:function(){}}});const ue=se;var pe=r(76364),ce=r(86638),fe=r(38167),de=r(73378),ye=r(28878),me=r(59286),be=r(50966),ge=r(48384);function he(e){return(he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ve(){return(ve=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function Oe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function we(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Fe(e,t){return(Fe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ee(e,t){return!t||"object"!==he(t)&&"function"!=typeof t?Pe(e):t}function Pe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Se(e){return(Se=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function je(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var xe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Fe(e,t)}(s,e);var t,r,o,a,i=(o=s,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Se(o);if(a){var r=Se(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return Ee(this,e)});function s(){var e;Oe(this,s);for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return je(Pe(e=i.call.apply(i,[this].concat(r))),"state",{}),je(Pe(e),"renderWithTooltip",(function(t){if(e.props.tooltip.customizedTooltip){var r=e.props.tooltip.customizedTooltip;return l().createElement(r,null,t)}var n=l().createElement(S.Tooltip,{id:e.props.tooltip.id},"this.props.tooltip.message");return l().createElement(be.Z,{key:e.props.tooltip.overlayTriggerKey,placement:e.props.tooltip.placement,overlay:n},t)})),je(Pe(e),"renderPagination",(function(){var t=e.props.pagination.firstPage,r=e.props.pagination.lastPage;return l().createElement("div",{className:"autocomplete-toolbar"},!t&&l().createElement(S.Glyphicon,{className:e.props.prevPageIcon,glyph:e.props.prevPageIcon,onClick:function(){return e.props.pagination.loadPrevPage()}}),!r&&l().createElement(S.Glyphicon,{className:e.props.nextPageIcon,glyph:e.props.nextPageIcon,onClick:function(){return e.props.pagination.loadNextPage()}}))})),je(Pe(e),"renderField",(function(){var t,r={emptyList:function(){return e.props.busy?"Loading...":(0,ce.S$)(e.context.messages,"queryform.attributefilter.autocomplete.emptyList")},open:(0,ce.S$)(e.context.messages,"queryform.attributefilter.autocomplete.open"),emptyFilter:(0,ce.S$)(e.context.messages,"queryform.attributefilter.autocomplete.emptyFilter")},o=[];e.props.data&&e.props.data.length>0&&(o=e.props.data.map((function(e){return e}))),e.props.pagination&&e.props.pagination.paginated&&o.length>0&&o.push((je(t={},e.props.textField,""),je(t,e.props.valueField,""),je(t,"disabled",!0),je(t,"pagination",e.renderPagination()),t));var a=!1,i=e.props.loading?[]:o,s=e.props.itemComponent,u=l().createElement(x.Combobox,{dropUp:e.props.dropUp,busy:e.props.busy,data:i,disabled:e.props.disabled,itemComponent:function(t){return l().createElement(s,ve({textField:e.props.textField,valueField:e.props.valueField},t))},messages:e.props.messages||r,open:e.props.open,filter:!1,onChange:function(t){e.props.onChange(t,e.props.valueField),a=!0},onFocus:function(){return e.props.onFocus(e.props.data)},onSelect:function(t){var r=(0,n.head)(e.props.features.filter((function(r){return r.properties[e.props.valueField].toLowerCase()===t[e.props.valueField].toLowerCase()})));e.props.onSelect(t,r,e.props.srsName,e.props.style)},onToggle:function(t){var r=(0,n.head)(e.props.features.filter((function(t){return t.properties[e.props.valueField].toLowerCase()===e.props.selectedValue.toLowerCase()})));!t||e.props.selectedValue||e.props.selectedValue||a||e.props.onChange("",e.props.valueField),e.props.onToggle(t,r,e.props.pagination.currentPage),r&&!t&&e.props.onSelect(e.props.selectedValue,r,e.props.srsName,e.props.style),a=!1},textField:e.props.textField,valueField:e.props.valueField,value:e.props.selectedValue});return e.props.tooltip&&e.props.tooltip.enabled?e.renderWithTooltip(u):u})),e}return t=s,(r=[{key:"render",value:function(){var e=this.props.label?l().createElement("label",null,this.props.label):l().createElement("span",null);return l().createElement("div",{className:"autocompleteField"},e,this.renderField())}}])&&we(t.prototype,r),s}(l().Component);je(xe,"propTypes",{busy:a().bool,data:a().array,disabled:a().bool,dropUp:a().bool,features:a().array,filter:a().string,itemComponent:a().oneOfType([a().object,a().func]),label:a().string,loading:a().bool,messages:a().object,onChange:a().func,onFocus:a().func,onSelect:a().func,onToggle:a().func,onChangeDrawingStatus:a().func,style:a().style,open:a().bool,pagination:a().object,nextPageIcon:a().string,prevPageIcon:a().string,selectedValue:a().string,srsName:a().string,textField:a().string,tooltip:a().object,valueField:a().string}),je(xe,"contextTypes",{messages:a().object}),je(xe,"defaultProps",{dropUp:!1,features:[],filter:"",itemComponent:ge.Z,loading:!1,label:null,pagination:{paginated:!0,firstPage:!1,lastPage:!1,loadPrevPage:function(){},loadNextPage:function(){}},nextPageIcon:"chevron-right",prevPageIcon:"chevron-left",onFocus:function(){},onToggle:function(){},onChange:function(){},onChangeDrawingStatus:function(){},onSelect:function(){},srsName:"EPSG:4326",textField:"label",tooltip:{customizedTooltip:void 0,enabled:!1,id:"",message:void 0,overlayTriggerKey:"",placement:"top"},valueField:"value"});const Ce=xe;function Te(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ne(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Te(Object(r),!0).forEach((function(t){qe(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Te(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function qe(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}(0,U.setObservableConfig)(ye.Z);var De=(0,U.mapPropsStreamWithConfig)(ye.Z)((function(e){return e.take(1).switchMap((function(t){return t.autocompleteStreamFactory(e)})).combineLatest(e,(function(e,t){return Ne(Ne({},t),{},{data:(0,n.isArray)(e&&e.fetchedData&&e.fetchedData.values)?e.fetchedData.values:[],features:(0,n.isArray)(e&&e.fetchedData&&e.fetchedData.features)?e.fetchedData.features:[],valuesCount:e&&e.fetchedData&&e.fetchedData.size,srsName:e&&e.fetchedData&&e.fetchedData.crs,busy:e.busy})}))}))((function(e){var t=e.open,r=e.toggle,n=e.select,o=e.focus,a=e.change,i=e.changed,s=e.originalValue,u=e.value,p=e.valuesCount,c=e.onChangeDrawingStatus,f=e.loadNextPage,d=e.loadPrevPage,y=e.maxFeatures,m=e.currentPage,b=e.itemComponent,g=e.features,h=e.busy,v=e.data,O=e.loading,w=void 0!==O&&O,F=e.valueField,E=e.textField,P=e.filter,S=e.srsName,j=e.style,x=Math.ceil(p/y);return l().createElement(Ce,{pagination:{firstPage:1===m,lastPage:x<=m,paginated:!0,loadPrevPage:d,loadNextPage:f,currentPage:m},srsName:S,busy:h,dropUp:!1,data:v,open:t,onChangeDrawingStatus:c,valueField:F,textField:E,itemComponent:b,filter:P,onFocus:o,onToggle:r,onChange:a,onSelect:n,features:g,style:j,selectedValue:i?u:s||u,loading:w})})),Ie=(0,U.compose)((0,U.withPropsOnChange)(["valueField"],(function(){return{value:void 0}})),(0,U.withStateHandlers)((function(e){return{delayDebounce:0,performFetch:!1,open:!1,currentPage:1,maxFeatures:5,changed:e.value,value:e.value,onChangeDrawingStatus:e.onChangeDrawingStatus,itemComponent:e.itemComponent}}),{select:function(){return function(e){return{selected:e}}},change:function(e){return function(t,r){return e.selected||e.open||e.onChangeDrawingStatus("clean","","queryform",[],{}),{delayDebounce:500,selected:!1,changingPage:!1,changed:!0,performFetch:!(e.selected&&!e.changingPage),value:e.selected&&e.changingPage&&e.value||("string"==typeof t?t:t[r]),currentPage:e.changingPage?e.currentPage:1}}},focus:function(e){return function(t){return t&&0===t.length&&""===e.value?{delayDebounce:0,currentPage:1,performFetch:!0,isToggled:!1,open:!0}:e}},toggle:function(e){return function(){return{open:!!e.changingPage||!e.open}}},loadNextPage:function(e){return function(){return{currentPage:e.currentPage+1,performFetch:!0,changingPage:!0,delayDebounce:0}}},loadPrevPage:function(e){return function(){return{currentPage:e.currentPage-1,performFetch:!0,changingPage:!0,delayDebounce:0}}}}),(0,U.withHandlers)({select:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.options,r=e.onChangeSpatialFilterValue,n=void 0===r?function(){}:r,o=e.select,a=void 0===o?function(){}:o;return function(e,r,o,i){r&&n({geometry:r.geometry,value:e,feature:r,srsName:o,style:i,options:t,collectGeometries:t&&t.crossLayer?{queryCollection:{typeName:t.crossLayer.typeName,geometryName:t.crossLayer.geometryName,cqlFilter:(0,me.generateTemplateString)(t.crossLayer.cqlTemplate||"",K.escapeCQLStrings)(r)}}:void 0}),a(!0)}}}))(De),Le=r(4201);function _e(e){return(_e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Me(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Re(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ae(e,t){return(Ae=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ke(e,t){return!t||"object"!==_e(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Be(e){return(Be=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ge,Ze,Ue,Ve=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ae(e,t)}(i,e);var t,r,n,o,a=(n=i,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Be(n);if(o){var r=Be(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return ke(this,e)});function i(){return Me(this,i),a.apply(this,arguments)}return t=i,(r=[{key:"render",value:function(){return l().createElement("span",{className:this.props.customItemClassName?this.props.customItemClassName:""},this.props.item)}}])&&Re(t.prototype,r),i}(l().Component);Ge=Ve,Ze="propTypes",Ue={item:a().string,textField:a().string,customItemClassName:a().string,valueField:a().string},Ze in Ge?Object.defineProperty(Ge,Ze,{value:Ue,enumerable:!0,configurable:!0,writable:!0}):Ge[Ze]=Ue;const We=Ve;var ze=r(27418),He=r.n(ze),Qe=r(86267);function $e(e){return($e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Xe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ye(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ke(e,t){return(Ke=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Je(e,t){return!t||"object"!==$e(t)&&"function"!=typeof t?et(e):t}function et(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function tt(e){return(tt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function rt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var nt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ke(e,t)}(i,e);var t,r,n,o,a=(n=i,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=tt(n);if(o){var r=tt(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return Je(this,e)});function i(){var e;Xe(this,i);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return rt(et(e=a.call.apply(a,[this].concat(r))),"onUpdateBBOX",(function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"replace";"replace"===n&&(e.tempExtent[r]=!isNaN(parseFloat(t))&&parseFloat(t)||0);var o=[];for(var a in e.tempExtent)a&&o.push(e.tempExtent[a]);var i=(0,Qe.reprojectBbox)(o,"EPSG:4326",e.props.projection),l={type:e.props.geometry.type,coordinates:[[[i[0],i[1]],[i[0],i[3]],[i[2],i[3]],[i[2],i[1]],[i[0],i[1]]]],projection:e.props.geometry.projection};e.props.onChangeDrawingStatus(n,void 0,"queryform",[l])})),rt(et(e),"onUpdateCircle",(function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"replace";"replace"===n&&(e.tempCircle[r]=parseFloat(t));var o=isNaN(parseFloat(e.tempCircle.x))||isNaN(parseFloat(e.tempCircle.y))?[e.tempCircle.x,e.tempCircle.y]:(0,Qe.reproject)([e.tempCircle.x,e.tempCircle.y],"EPSG:4326",e.props.projection);o=void 0===o.x?{x:o[0],y:o[1]}:o;var a={x:isNaN(o.x)?0:o.x,y:isNaN(o.y)?0:o.y},i={type:e.props.geometry.type,center:a,coordinates:[a.x,a.y],radius:isNaN(e.tempCircle.radius)?0:e.tempCircle.radius,projection:e.props.geometry.projection};e.props.onChangeDrawingStatus(n,void 0,"queryform",[i],{geodesic:e.props.enableGeodesic})})),rt(et(e),"onModifyGeometry",(function(){"BBOX"===e.props.type?e.onUpdateBBOX(null,null,"endDrawing"):"Circle"===e.props.type&&e.onUpdateCircle(null,null,"endDrawing"),e.props.onShowPanel(!1)})),rt(et(e),"onClosePanel",(function(){e.resetGeom(),e.props.onShowPanel(!1)})),rt(et(e),"getStep",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return Math.min(1/Math.pow(10,Math.ceil(Math.min(e,21)/3)-2),1)})),rt(et(e),"getStepCircle",(function(t,r){var n=e.getStep(t);return"radius"===r&&!e.isWGS84()&&1e4*n||n})),rt(et(e),"getBBOXDimensions",(function(e){var t=(0,Qe.reprojectBbox)(e.extent,e.projection,"EPSG:4326");return{west:t[0],sud:t[1],est:t[2],north:t[3]}})),rt(et(e),"getCircleDimensions",(function(t){var r=(0,Qe.reproject)(t.center,t.projection,"EPSG:4326"),n=(0,Qe.reproject)(t.center,t.projection,e.props.projection),o=(0,Qe.reproject)([t.center[0]+t.radius,t.center[1]],t.projection,e.props.projection),a=Math.sqrt((o.x-n.x)*(o.x-n.x)+(o.y-n.y)*(o.y-n.y));return{x:r.x,y:r.y,radius:a}})),rt(et(e),"renderCoordinateField",(function(t,r){return l().createElement("div",null,l().createElement("div",{className:"detail-field-title"},r),l().createElement(de.Z,{style:{minWidth:"105px",margin:"auto"},type:"number",id:"queryform_bbox_"+r,step:e.getStep(e.props.zoom),defaultValue:e.roundValue(t,1e6),onChange:function(t){return e.onUpdateBBOX(t,r)}}))})),rt(et(e),"renderCircleField",(function(t,r){return l().createElement(de.Z,{type:"number",id:"queryform_circle_"+r,defaultValue:e.roundValue(t,"radius"!==r||e.isWGS84()?1e6:100),step:e.getStepCircle(e.props.zoom,r),onChange:function(t){return e.onUpdateCircle(t,r)}})})),rt(et(e),"renderDetailsContent",(function(){var t,r=e.props.geometry;if("BBOX"===e.props.type){var n=e.getBBOXDimensions(r);t=l().createElement("div",null,l().createElement("div",{className:"container-fluid"},l().createElement(S.Row,null,l().createElement(S.Col,{xs:4},l().createElement("span",null)),l().createElement(S.Col,{xs:4},e.renderCoordinateField(n.north,"north")),l().createElement(S.Col,{xs:4},l().createElement("span",null))),l().createElement(S.Row,null,l().createElement(S.Col,{xs:4},e.renderCoordinateField(n.west,"west")),l().createElement(S.Col,{xs:4},l().createElement("span",null)),l().createElement(S.Col,{xs:4},e.renderCoordinateField(n.est,"est"))),l().createElement(S.Row,null,l().createElement(S.Col,{xs:4},l().createElement("span",null)),l().createElement(S.Col,{xs:4},e.renderCoordinateField(n.sud,"sud")),l().createElement(S.Col,{xs:4},l().createElement("span",null)))),l().createElement("span",null,l().createElement("hr",{width:"90%"}),l().createElement("div",null,l().createElement("h5",null,l().createElement(fe.ZP.Message,{msgId:"queryform.spatialfilter.details.details_bbox_label"})))))}else if("Circle"===e.props.type){var o=e.getCircleDimensions(r),a=(0,Qe.getUnits)(e.props.projection);t=l().createElement("div",null,l().createElement("div",{className:"container-fluid"},l().createElement(S.Row,null,l().createElement(S.Col,{xs:2},l().createElement("span",null)),l().createElement(S.Col,{xs:2},l().createElement("span",{className:"details-circle-attribute-name"},"x:")),l().createElement(S.Col,{xs:4},e.renderCircleField(o.x,"x")),l().createElement(S.Col,{xs:4},l().createElement("span",null))),l().createElement(S.Row,null,l().createElement(S.Col,{xs:2},l().createElement("span",null)),l().createElement(S.Col,{xs:2},l().createElement("span",{className:"details-circle-attribute-name"},"y:")),l().createElement(S.Col,{xs:4},e.renderCircleField(o.y,"y")),l().createElement(S.Col,{xs:4},l().createElement("span",null))),l().createElement(S.Row,null,l().createElement(S.Col,{xs:2},l().createElement("span",null)),l().createElement(S.Col,{xs:2},l().createElement("span",{className:"details-circle-attribute-name"},l().createElement(fe.ZP.Message,{msgId:"queryform.spatialfilter.details.radius",msgParams:{unit:"degrees"===a?"°":a}}),":")),l().createElement(S.Col,{xs:4},e.renderCircleField(o.radius,"radius")),l().createElement(S.Col,{xs:4},l().createElement("span",null)))),l().createElement("span",null,l().createElement("hr",{width:"90%"}),l().createElement("div",null,l().createElement("h5",null,l().createElement(fe.ZP.Message,{msgId:"queryform.spatialfilter.details.details_circle_label"})))))}return t})),rt(et(e),"isWGS84",(function(){return"EPSG:4326"===e.props.projection})),rt(et(e),"roundValue",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e6;return Math.round(e*t)/t})),rt(et(e),"resetGeom",(function(){"BBOX"===e.props.type?e.resetBBOX():"Circle"===e.props.type&&e.resetCircle()})),rt(et(e),"resetBBOX",(function(){for(var t in e.extent)t&&(document.getElementById("queryform_bbox_"+t).value=e.roundValue(e.extent[t],1e6),e.onUpdateBBOX(e.extent[t],t))})),rt(et(e),"resetCircle",(function(){document.getElementById("queryform_circle_radius").value=e.roundValue(e.circle.radius,100),e.onUpdateCircle(e.circle.radius,"radius"),document.getElementById("queryform_circle_x").value=e.roundValue(e.circle.x,e.isWGS84()?1e6:100),e.onUpdateCircle(e.circle.x,"x"),document.getElementById("queryform_circle_y").value=e.roundValue(e.circle.y,e.isWGS84()?1e6:100),e.onUpdateCircle(e.circle.y,"y")})),e}return t=i,(r=[{key:"componentDidMount",value:function(){var e=this.props.geometry;"BBOX"===this.props.type?(this.extent=this.getBBOXDimensions(e),this.tempExtent=He()({},this.extent)):"Circle"===this.props.type&&(this.circle=this.getCircleDimensions(e),this.tempCircle=He()({},this.circle))}},{key:"render",value:function(){var e=this;return l().createElement(P.Z,{buttons:[{key:"confirm",glyph:"ok",tooltipId:"confirm",onClick:function(){return e.onModifyGeometry()}},{key:"reset",tooltipId:"queryform.reset",glyph:"clear-filter",onClick:function(){return e.resetGeom()}},{key:"close",glyph:"1-close",onClick:function(){return e.onClosePanel(!1)}}],title:l().createElement(fe.ZP.Message,{msgId:"queryform.spatialfilter.details.details_header"}),locked:!0,expanded:!0,className:"details-panel",bsStyle:"primary"},this.renderDetailsContent())}}])&&Ye(t.prototype,r),i}(l().Component);rt(nt,"propTypes",{useMapProjection:a().bool,geometry:a().object,type:a().string,onShowPanel:a().func,onChangeDrawingStatus:a().func,zoom:a().number,projection:a().string,enableGeodesic:a().bool}),rt(nt,"defaultProps",{useMapProjection:!0,geometry:null,type:null,onShowPanel:function(){},onChangeDrawingStatus:function(){}});const ot=nt;function at(e){return(at="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function it(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function lt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function st(e,t){return(st=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ut(e,t){return!t||"object"!==at(t)&&"function"!=typeof t?pt(e):t}function pt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ct(e){return(ct=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ft(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var dt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&st(e,t)}(s,e);var t,r,o,a,i=(o=s,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ct(o);if(a){var r=ct(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return ut(this,e)});function s(){var e;it(this,s);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return ft(pt(e=i.call.apply(i,[this].concat(r))),"state",{open:!1}),ft(pt(e),"getFilter",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"*",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"=",n={filterFields:[{attribute:e.props.searchAttribute,operator:r,value:t,type:"list"}]};e.props.dependsOn&&(n.groupFields=[{id:1,logic:"AND",index:0}],n.filterFields[0].groupId=1,e.props.multivalue?(n.groupFields.push({id:2,logic:"OR",groupId:1,index:1}),e.props.dependsOn.value instanceof Array?e.props.dependsOn.value.forEach((function(t){n.filterFields.push({attribute:e.props.dependsOn.field,operator:e.props.dependsOn.operator||"=",value:t,groupId:2,type:"list"})})):n.filterFields.push({attribute:e.props.dependsOn.field,operator:e.props.dependsOn.operator||"=",value:e.props.dependsOn.value,groupId:2,type:"list"})):n.filterFields.push({attribute:e.props.dependsOn.field,operator:e.props.dependsOn.operator||"=",value:e.props.dependsOn.value,groupId:1,type:"list"}));var o=(0,K.toOGCFilter)(e.props.typeName,n,e.props.wfs,e.props.sort||{sortBy:e.props.searchAttribute,sortOrder:"ASC"});return o})),ft(pt(e),"changeZoneValue",(function(t,r,n){var o;e.setState({open:!1}),o=e.props.multivalue?{value:n.map((function(e){return e.id})),feature:n.map((function(e){return e.feature}))}:{value:[n],feature:[e.values.filter((function(e){return e.id===n}))[0].feature]},e.props.onChange(e.props.zoneId,o)})),e}return t=s,(r=[{key:"UNSAFE_componentWillReceiveProps",value:function(e){e.values&&!(0,n.isEqual)(this.props.values,e.values)&&e.values.length>0&&this.setState({open:!0})}},{key:"render",value:function(){var e=this;this.values=[],this.props.values&&this.props.values.length>0&&(this.values=this.props.values.map((function(t){var r=t;e.props.valueField.split(".").forEach((function(e){r=r?r[e]:null}));var n=t;return e.props.textField.split(".").forEach((function(e){n=n?n[e]:null})),{id:r,name:n,feature:t}})));var t=this.props.label?l().createElement("label",null,this.props.label):l().createElement("span",null),r=this.props.error;return r&&(r="object"!==at(r)?r:r.status+" "+r.statusText+": "+r.data),l().createElement("div",{className:"zone-combo"},t,l().createElement(Le.Z,{key:(new Date).getTime(),busy:this.props.busy,disabled:this.props.disabled,fieldRowId:this.props.zoneId,valueField:"id",textField:"name",fieldOptions:this.values,fieldValue:this.props.value,fieldName:"zone",fieldException:r,options:{defaultOpen:this.state.open},groupBy:this.props.groupBy?function(t){return t.feature.properties[e.props.groupBy]}:function(){},multivalue:this.props.multivalue,comboFilter:this.props.comboFilter,onSelect:this.props.onSelect,onUpdateField:this.changeZoneValue,onToggle:function(t){if(t&&(!e.props.values||e.props.values.length<1)){var r=e.getFilter(e.props.searchText,e.props.searchMethod);e.props.onSearch(!0,e.props.zoneId),e.props.onFilter(e.props.url,r,e.props.zoneId)}}}))}}])&&lt(t.prototype,r),s}(l().Component);ft(dt,"propTypes",{zoneId:a().number,url:a().string,typeName:a().string,wfs:a().string,busy:a().bool,values:a().array,value:a().oneOfType([a().object,a().number,a().string,a().array]),label:a().string,searchText:a().string,searchMethod:a().string,searchAttribute:a().string,sort:a().object,error:a().oneOfType([a().object,a().string]),comboFilter:a().oneOfType([a().bool,a().string,a().func]),groupBy:a().oneOfType([a().string,a().func]),multivalue:a().bool,open:a().bool,disabled:a().bool,dependsOn:a().object,valueField:a().string,textField:a().string,onSearch:a().func,onFilter:a().func,onChange:a().func,onSelect:a().func}),ft(dt,"contextTypes",{messages:a().object}),ft(dt,"defaultProps",{open:!1,zoneId:null,url:null,typeName:null,wfs:"1.1.0",busy:!1,values:[],value:null,valueField:null,textField:null,label:null,disabled:!1,error:null,searchText:"*",searchMethod:"ilike",searchAttribute:null,comboFilter:"contains",multivalue:!0,groupBy:null,onSearch:function(){},onFilter:function(){},onChange:function(){},onSelect:function(){}});const yt=dt;function mt(e){return(mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function bt(){return(bt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function gt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ht(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function vt(e,t){return(vt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ot(e,t){return!t||"object"!==mt(t)&&"function"!=typeof t?wt(e):t}function wt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ft(e){return(Ft=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Et(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Pt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&vt(e,t)}(s,e);var t,r,o,a,i=(o=s,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ft(o);if(a){var r=Ft(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return Ot(this,e)});function s(){var e;gt(this,s);for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return Et(wt(e=i.call.apply(i,[this].concat(r))),"getMethodFromId",(function(t){return(0,n.find)(e.props.spatialMethodOptions,(function(e){return e&&e.id===t}))||null})),Et(wt(e),"renderHeader",(function(){var t=(0,ce.S$)(e.context.messages,"queryform.spatialfilter.spatial_filter_header");return l().createElement("span",null,l().createElement("span",{style:{cursor:"pointer"},onClick:e.props.actions.onExpandSpatialFilterPanel.bind(null,!e.props.spatialPanelExpanded)},t),l().createElement("button",{onClick:e.props.actions.onExpandSpatialFilterPanel.bind(null,!e.props.spatialPanelExpanded),className:"close"},e.props.spatialPanelExpanded?l().createElement(S.Glyphicon,{glyph:"glyphicon glyphicon-collapse-down"}):l().createElement(S.Glyphicon,{glyph:"glyphicon glyphicon-expand"})))})),Et(wt(e),"renderSpatialHeader",(function(){var t=e.getMethodFromId(e.props.spatialField.method);return l().createElement("div",null,l().createElement(S.Row,{className:"logicHeader inline-form filter-field-row filter-field-fixed-row"},l().createElement(S.Col,{xs:6},l().createElement("div",null,l().createElement(fe.ZP.Message,{msgId:"queryform.spatialfilter.filterType"}))),l().createElement(S.Col,{xs:6},l().createElement(Le.Z,{itemComponent:function(t){return l().createElement(We,bt({customItemClassName:e.getMethodFromId(t.item)&&e.getMethodFromId(t.item).customItemClassName||""},t))},fieldOptions:e.props.spatialMethodOptions.map((function(t){return(0,ce.S$)(e.context.messages,t.name)||t.name})),placeholder:(0,ce.S$)(e.context.messages,"queryform.spatialfilter.combo_placeholder"),fieldName:"method",fieldRowId:(new Date).getTime(),fieldValue:(0,ce.S$)(e.context.messages,t?t.name:"")||t&&t.name||"",onUpdateField:e.updateSpatialMethod}))))})),Et(wt(e),"renderDwithin",(function(){return l().createElement(S.Row,{className:"container-fluid filter-field-fixed-row"},l().createElement(S.Col,{xs:6,className:"filter-text-desc"},l().createElement(fe.ZP.Message,{msgId:"queryform.spatialfilter.dwithin_label"})),l().createElement(S.Col,{xs:6},l().createElement(de.Z,{type:"number",min:"0",defaultValue:"0",disabled:!e.props.spatialField.geometry,id:"queryform_dwithin_field",onChange:function(t){return e.props.actions.onChangeDwithinValue(t,name)}})))})),Et(wt(e),"renderZoneFields",(function(){return e.props.spatialField.method&&"ZONE"===e.props.spatialField.method&&e.props.spatialField.zoneFields&&e.props.spatialField.zoneFields.length>0?e.props.spatialField.zoneFields.map((function(t){return l().createElement(yt,{key:t.id,open:t.open,zoneId:t.id,url:t.url,typeName:t.typeName,wfs:t.wfs,busy:t.busy,label:t.label,values:t.values,value:t.value,valueField:t.valueField,textField:t.textField,searchText:t.searchText,searchMethod:t.searchMethod,searchAttribute:t.searchAttribute,sort:t.sort,error:t.error,disabled:t.disabled,dependsOn:t.dependson,groupBy:t.groupBy,multivalue:t.multivalue,onSearch:e.props.actions.zoneSearch,onFilter:e.props.actions.zoneFilter,onChange:e.props.actions.zoneChange})})):null})),Et(wt(e),"renderRoiPanel",(function(){var t=e.getMethodFromId(e.props.spatialField.method),r=t&&t.filterProps&&t.filterProps.valueField&&e.props.spatialField&&e.props.spatialField.value&&e.props.spatialField.value[t.filterProps.valueField];return l().createElement(S.Panel,null,l().createElement("div",{className:"container-fluid"},l().createElement(S.Row,{className:"filter-field-row filter-field-fixed-row"},l().createElement(S.Col,{xs:6},l().createElement("span",null,t&&t.name||t.id)),l().createElement(S.Col,{xs:6},l().createElement(Ie,{originalValue:r,key:e.props.spatialField.method,options:t,autocompleteStreamFactory:pe.Vj,valueField:t&&t.filterProps&&t.filterProps.valueField,textField:t&&t.filterProps&&t.filterProps.valueField,url:t&&t.url,filter:"contains",onChangeSpatialFilterValue:e.props.actions.onChangeSpatialFilterValue,onChangeDrawingStatus:function(){var t;(t=e.props.actions).onChangeDrawingStatus.apply(t,arguments)},filterProps:t&&t.filterProps})))))})),Et(wt(e),"renderSpatialPanel",(function(t,r,n){return l().createElement(S.Panel,{className:"spatial-panel"},e.props.spatialMethodOptions.length>1?e.renderSpatialHeader():l().createElement("span",null),e.renderZoneFields(),e.props.spatialField.method&&e.getMethodFromId(e.props.spatialField.method)&&"wfsGeocoder"===e.getMethodFromId(e.props.spatialField.method).type?e.renderRoiPanel():null,e.props.spatialOperations.length>1?l().createElement(S.Panel,null,l().createElement("div",null,t),n&&"DWITHIN"===n.id?e.renderDwithin():null,l().createElement(S.Row,null,l().createElement(S.Col,{xs:12},r))):l().createElement("span",null))})),Et(wt(e),"renderButtons",(function(){var t=[],r=e.props.showDetailsButton&&e.props.spatialField.geometry&&(e.props.spatialField.method&&"BBOX"===e.props.spatialField.method||"Circle"===e.props.spatialField.method),n=e.props.spatialField.geometry&&e.props.spatialField.geometry.coordinates;return r&&t.push({glyph:"pencil",onClick:function(){return e.props.actions.onShowSpatialSelectionDetails(!0)},tooltipId:"queryform.spatialfilter.details.detail_button_label"}),n&&t.push({glyph:"clear-filter",tooltipId:"queryform.spatialfilter.remove",bsStyle:e.props.clearFilterOptions.buttonStyle,className:e.props.clearFilterOptions.className,onClick:function(){return e.resetSpatialFilter()}}),t})),Et(wt(e),"updateSpatialMethod",(function(t,r,o){e.props.actions.onShowSpatialSelectionDetails(!1);var a=e.props.spatialMethodOptions.filter((function(t){return o===((0,ce.S$)(e.context.messages,t.name)||t.name)}))[0].id,i=e.getMethodFromId(a);if(e.props.actions.onSelectSpatialMethod(a,r),"wfsGeocoder"!==e.getMethodFromId(a).type)switch(a){case"ZONE":e.changeDrawingStatus("clean","","queryform",[]);break;case"Viewport":e.changeDrawingStatus("clean","","queryform",[]),e.props.actions.onSelectViewportSpatialMethod();break;default:e.changeDrawingStatus("start",a,"queryform",[],{geodesic:!!(0,n.isNil)(i.geodesic)||i.geodesic,stopAfterDrawing:!0})}else e.changeDrawingStatus("clean","","queryform",[])})),Et(wt(e),"updateSpatialOperation",(function(t,r,n){var o=e.props.spatialOperations.filter((function(t){return n===(0,ce.S$)(e.context.messages,t.name)}))[0].id;e.props.actions.onSelectSpatialOperation(o,r)})),Et(wt(e),"resetSpatialFilter",(function(){e.changeDrawingStatus("clean","","queryform",[]),e.props.actions.onRemoveSpatialSelection(),e.props.actions.onShowSpatialSelectionDetails(!1)})),Et(wt(e),"changeDrawingStatus",(function(t,r,n,o,a){e.props.actions.onChangeDrawingStatus(t,void 0!==r?r:e.props.spatialField.method,n,o,a)})),e}return t=s,(r=[{key:"render",value:function(){var e=this,t=this.props.spatialOperations.filter((function(t){return e.props.spatialField.operation===t.id}))[0],r=l().createElement("span",null);"ZONE"!==this.props.spatialField.method&&"Viewport"!==this.props.spatialField.method&&this.getMethodFromId(this.props.spatialField.method)&&"wfsGeocoder"!==this.getMethodFromId(this.props.spatialField.method).type&&(r=this.props.spatialField.geometry?null:l().createElement("span",null,l().createElement("div",{className:"m-label m-caption text-center"},l().createElement(fe.ZP.Message,{msgId:"queryform.spatialfilter.draw_start_label"}))));var o=this.getMethodFromId(this.props.spatialField.method),a=this.props.showDetailsPanel?l().createElement(ot,{useMapProjection:this.props.useMapProjection,enableGeodesic:!!(0,n.isNil)(o.geodesic)||o.geodesic,geometry:this.props.spatialField.geometry,type:this.props.spatialField.method,onShowPanel:this.props.actions.onShowSpatialSelectionDetails,onChangeDrawingStatus:this.changeDrawingStatus,zoom:this.props.zoom,projection:this.props.projection}):l().createElement("span",null),i=l().createElement(S.Row,{className:"filter-field-row inline-form filter-field-fixed-row"},l().createElement(S.Col,{xs:6},l().createElement(fe.ZP.Message,{msgId:"queryform.spatialfilter.geometric_operation"})),l().createElement(S.Col,{xs:6},l().createElement(Le.Z,{fieldOptions:this.props.spatialOperations.map((function(t){return(0,ce.S$)(e.context.messages,t.name)})),fieldName:"operation",fieldRowId:(new Date).getTime(),fieldValue:(0,ce.S$)(this.context.messages,t?t.name:""),onUpdateField:this.updateSpatialOperation})));return l().createElement("div",{className:"query-filter-container"},this.props.withContainer?l().createElement(P.Z,{id:"spatialFilterPanel",header:this.renderHeader(),buttons:this.renderButtons(),collapsible:!0,expanded:this.props.spatialPanelExpanded,onSwitch:function(t){return e.props.actions.onExpandSpatialFilterPanel(t)}},this.renderSpatialPanel(i,r,t)):this.renderSpatialPanel(i,r,t),a)}}])&&ht(t.prototype,r),s}(l().Component);Et(Pt,"propTypes",{useMapProjection:a().bool,spatialField:a().object,spatialOperations:a().array,spatialMethodOptions:a().array,spatialPanelExpanded:a().bool,showDetailsButton:a().bool,clearFilterOptions:a().object,showDetailsPanel:a().bool,withContainer:a().bool,actions:a().object,zoom:a().number,projection:a().string}),Et(Pt,"contextTypes",{messages:a().object}),Et(Pt,"defaultProps",{useMapProjection:!0,spatialField:{},spatialPanelExpanded:!0,showDetailsButton:!0,clearFilterOptions:{className:"square-button-sm no-border",buttonStyle:"default"},showDetailsPanel:!1,withContainer:!0,spatialMethodOptions:[],spatialOperations:[],actions:{onExpandSpatialFilterPanel:function(){},onSelectSpatialMethod:function(){},onSelectSpatialOperation:function(){},onChangeSpatialFilterValue:function(){},onChangeDrawingStatus:function(){},onRemoveSpatialSelection:function(){},onShowSpatialSelectionDetails:function(){},onSelectViewportSpatialMethod:function(){},onChangeRegion:function(){},onChangeDwithinValue:function(){},zoneFilter:function(){},zoneSearch:function(){},zoneChange:function(){}}});const St=Pt;function jt(e){return(jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function xt(){return(xt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function Ct(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Tt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Nt(e,t){return(Nt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function qt(e,t){return!t||"object"!==jt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Dt(e){return(Dt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function It(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Lt=X((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.crossLayerExpanded,r=void 0===t||t,n=e.spatialOperations,o=e.expandCrossLayerFilterPanel,a=void 0===o?function(){}:o,i=e.layers,s=void 0===i?[]:i,u=e.errorObj,p=e.loadingAttributes,c=e.loadingCapabilities,f=e.searchUrl,d=e.queryCollection,y=void 0===d?{}:d,m=e.attributes,b=void 0===m?[]:m,g=e.operation,h=e.updateLogicCombo,v=void 0===h?function(){}:h,O=e.resetCrossLayerFilter,w=void 0===O?function(){}:O,F=e.setOperation,x=void 0===F?function(){}:F,C=e.setQueryCollectionParameter,q=void 0===C?function(){}:C,L=e.addCrossLayerFilterField,R=void 0===L?function(){}:L,A=e.updateCrossLayerFilterField,k=void 0===A?function(){}:A,B=e.removeCrossLayerFilterField,G=void 0===B?function(){}:B,Z=y.typeName,U=y.geometryName,V=y.filterFields,W=y.groupFields,z=void 0===W?[{id:1,logic:"OR",index:0}]:W,H=s.filter((function(e){return!_(f,e)})),Q=function(){return s.length&&H.length?l().createElement(D.Z,{bsStyle:"link",text:l().createElement(E.Z,{msgId:"queryform.crossLayerFilter.errors.layersExcluded"})}):null};return l().createElement(P.Z,{loading:c,expanded:r&&!c&&!u,error:u,errorMsgId:"queryPanel",buttons:I(Z?[{glyph:"clear-filter",tooltipId:"queryform.crossLayerFilter.clear",onClick:function(){return w()}}]:[]),onSwitch:a,title:l().createElement(E.Z,{msgId:"queryform.crossLayerFilter.title"})},l().createElement(S.Row,{className:"inline-form filter-field-fixed-row"},l().createElement(S.Col,{xs:6},l().createElement("div",null,l().createElement(E.Z,{msgId:"queryform.crossLayerFilter.targetLayer"})," ",Q())),l().createElement(S.Col,{xs:6},l().createElement(j.ZP,{clearable:!1,disabled:c||!!u,isLoading:p,options:s.filter((function(e){return _(f,e)})).map((function(e){return{label:e.title||e.name,value:e.name}})),placeholder:l().createElement(E.Z,{msgId:"queryform.crossLayerFilter.placeholder"}),filter:"contains",value:Z,onChange:function(e){q("typeName",e&&e.value)}}))),Z&&U?l().createElement(S.Row,{className:"inline-form filter-field-fixed-row"},l().createElement(S.Col,{xs:6},l().createElement("div",null,l().createElement(E.Z,{msgId:"queryform.crossLayerFilter.operation"}))),l().createElement(S.Col,{xs:6},l().createElement(T,{value:g,onChange:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.id;return x(t)},spatialOperations:M(n)}))):null,Z&&U&&g?l().createElement(S.Row,{className:"filter-field-fixed-row"},l().createElement(S.Col,{xs:12},l().createElement(N.Z,{autocompleteEnabled:!1,withContainer:!1,attributes:b,groupLevels:-1,filterFields:V,actions:{onUpdateLogicCombo:v,onAddFilterField:R,onUpdateFilterField:k,onRemoveFilterField:G},groupFields:z,filterField:!0}))):null)})),_t=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Nt(e,t)}(i,e);var t,r,n,o,a=(n=i,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Dt(n);if(o){var r=Dt(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return qt(this,e)});function i(){return Ct(this,i),a.apply(this,arguments)}return t=i,(r=[{key:"render",value:function(){if(""!==this.props.featureTypeError)return l().createElement("div",{style:{margin:"0 auto","text-align":"center"}},this.props.featureTypeErrorText);var e=l().createElement("div",{className:"m-header"},this.props.header,l().createElement(ue,{sendFilters:{attributeFilter:this.props.attributePanelExpanded,spatialFilter:this.props.spatialPanelExpanded,crossLayerFilter:this.props.crossLayerExpanded},params:this.props.params,filterFields:this.props.filterFields,groupFields:this.props.groupFields,spatialField:this.props.spatialField,toolbarEnabled:this.props.toolbarEnabled,searchUrl:this.props.searchUrl,showGeneratedFilter:this.props.showGeneratedFilter,featureTypeName:this.props.featureTypeName,ogcVersion:this.props.ogcVersion,filterType:this.props.filterType,actions:this.props.queryToolbarActions,resultTitle:this.props.resultTitle,pagination:this.props.pagination,sortOptions:this.props.sortOptions,crossLayerFilter:this.props.crossLayerFilterOptions.crossLayerFilter,hits:this.props.hits,allowEmptyFilter:this.props.allowEmptyFilter,emptyFilterWarning:this.props.emptyFilterWarning,appliedFilter:this.props.appliedFilter,storedFilter:this.props.storedFilter,advancedToolbar:this.props.advancedToolbar,loadingError:this.props.loadingError}));return this.props.attributes.length>0?l().createElement(F.Z,{header:e,className:"mapstore-query-builder",id:"query-form-panel"},l().createElement(N.Z,{buttonStyle:this.props.buttonStyle,removeGroupButtonIcon:this.props.removeGroupButtonIcon,autocompleteEnabled:this.props.autocompleteEnabled,maxFeaturesWPS:this.props.maxFeaturesWPS,attributes:this.props.attributes,groupLevels:this.props.groupLevels,filterFields:this.props.filterFields,groupFields:this.props.groupFields,removeButtonIcon:this.props.removeButtonIcon,addButtonIcon:this.props.addButtonIcon,attributePanelExpanded:this.props.attributePanelExpanded,actions:this.props.attributeFilterActions}),this.props.toolsOptions.hideSpatialFilter?null:l().createElement(St,{useMapProjection:this.props.useMapProjection,spatialField:this.props.spatialField,clearFilterOptions:this.props.clearFilterOptions,spatialOperations:this.props.spatialOperations,spatialMethodOptions:this.props.spatialMethodOptions,showDetailsButton:this.props.showDetailsButton,spatialPanelExpanded:this.props.spatialPanelExpanded,showDetailsPanel:this.props.showDetailsPanel,actions:this.props.spatialFilterActions,zoom:this.props.zoom,projection:this.props.projection}),this.props.toolsOptions.hideCrossLayer?null:l().createElement(Lt,xt({spatialOperations:this.props.spatialOperations,crossLayerExpanded:this.props.crossLayerExpanded,searchUrl:this.props.searchUrl,featureTypeName:this.props.featureTypeName},this.props.crossLayerFilterOptions,this.props.crossLayerFilterActions))):l().createElement("div",{style:{margin:"0 auto",width:"60px"}},l().createElement(w(),{spinnerName:"three-bounce",overrideSpinnerClassName:"spinner"}))}}])&&Tt(t.prototype,r),i}(l().Component);It(_t,"propTypes",{params:a().object,featureTypeConfigUrl:a().string,useMapProjection:a().bool,attributes:a().array,featureTypeError:a().string,featureTypeErrorText:a().node,groupLevels:a().number,maxFeaturesWPS:a().number,filterFields:a().array,groupFields:a().array,spatialField:a().object,removeButtonIcon:a().string,addButtonIcon:a().string,attributePanelExpanded:a().bool,showDetailsButton:a().bool,spatialPanelExpanded:a().bool,crossLayerExpanded:a().bool,showDetailsPanel:a().bool,toolbarEnabled:a().bool,searchUrl:a().string,showGeneratedFilter:a().oneOfType([a().bool,a().string]),filterType:a().string,featureTypeName:a().string,ogcVersion:a().string,attributeFilterActions:a().object,spatialFilterActions:a().object,queryToolbarActions:a().object,resultTitle:a().string,pagination:a().object,sortOptions:a().object,spatialOperations:a().array,spatialMethodOptions:a().array,crossLayerFilterOptions:a().object,crossLayerFilterActions:a().object,hits:a().bool,clearFilterOptions:a().object,buttonStyle:a().string,removeGroupButtonIcon:a().string,maxHeight:a().number,allowEmptyFilter:a().bool,autocompleteEnabled:a().bool,emptyFilterWarning:a().bool,header:a().node,zoom:a().number,projection:a().string,toolsOptions:a().object,appliedFilter:a().object,storedFilter:a().object,advancedToolbar:a().bool,loadingError:a().bool}),It(_t,"defaultProps",{params:{},featureTypeConfigUrl:null,useMapProjection:!0,groupLevels:1,buttonStyle:"default",removeGroupButtonIcon:"trash",groupFields:[],filterFields:[],attributes:[],spatialMethodOptions:[],spatialOperations:[],featureTypeError:"",spatialField:{},crossLayerFilter:null,removeButtonIcon:"trash",addButtonIcon:"glyphicon glyphicon-plus",attributePanelExpanded:!0,spatialPanelExpanded:!0,showDetailsPanel:!1,toolbarEnabled:!0,searchUrl:"",showGeneratedFilter:!1,featureTypeName:null,pagination:null,sortOptions:null,hits:!1,maxHeight:830,allowEmptyFilter:!1,autocompleteEnabled:!0,emptyFilterWarning:!1,advancedToolbar:!1,loadingError:!1,attributeFilterActions:{onAddGroupField:function(){},onAddFilterField:function(){},onRemoveFilterField:function(){},onUpdateFilterField:function(){},onUpdateExceptionField:function(){},onUpdateLogicCombo:function(){},onRemoveGroupField:function(){},onChangeCascadingValue:function(){},onExpandAttributeFilterPanel:function(){}},spatialFilterActions:{onExpandSpatialFilterPanel:function(){},onSelectSpatialMethod:function(){},onSelectSpatialOperation:function(){},onChangeDrawingStatus:function(){},onRemoveSpatialSelection:function(){},onShowSpatialSelectionDetails:function(){},onSelectViewportSpatialMethod:function(){},onChangeDwithinValue:function(){}},crossLayerFilterOptions:{},crossLayerFilterActions:{},queryToolbarActions:{onQuery:function(){},onReset:function(){},onChangeDrawingStatus:function(){},onSaveFilter:function(){},onRestoreFilter:function(){}},toolsOptions:{}});const Mt=_t;function Rt(){return(Rt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var At=(0,r(17252).Z)((function(e){return l().createElement("div",Rt({className:"square-button pull-right no-border",style:{display:"flex"}},e),l().createElement(S.Glyphicon,{glyph:"exclamation-mark",className:"text-danger"}))}));const kt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.loadingError,r=e.onToggleQuery,n=void 0===r?function(){}:r,o=e.buttonStyle,a=void 0===o?"default":o;return l().createElement("div",{className:"mapstore-block-width"},l().createElement(J.Z,{id:"toc-query-close-button",key:"menu-button",className:"square-button no-border",bsStyle:a,onClick:function(){return n()}},l().createElement(S.Glyphicon,{glyph:"arrow-left"})),t&&l().createElement(At,{popover:{text:l().createElement(E.Z,{msgId:"queryform.loadingError"})}})||l().createElement("div",{className:"square-button pull-right no-border",style:{display:"flex"}},l().createElement(S.Glyphicon,{glyph:"filter",className:"text-primary"})))};var Bt=r(99534),Gt=r(94745),Zt=r(75875),Ut=r.n(Zt),Vt=r(97395),Wt=r(84069),zt=r(37275),Ht=r(24260),Qt=r(69842),$t=r(88113);const Xt={isAutoCompleteEnabled:function(e,t){return e.ofType(v.S0).switchMap((function(e){var r=(0,zt.y9)(e.url,{version:"1.0.0",REQUEST:"DescribeProcess",IDENTIFIER:"gs:PagedUnique"},(0,$t.kS)(t.getState()));return null===r?A().Observable.of((0,h.NV)(!1)):A().Observable.fromPromise(Ut().post(r,null,{timeout:5e3,headers:{Accept:"application/json","Content-Type":"application/xml"}}).then((function(e){return e.data}))).switchMap((function(e){return(0,n.startsWith)(e,"<ows:ExceptionReport")?A().Observable.of((0,h.NV)(!1)):A().Observable.of((0,h.NV)(!0))})).catch((function(){return A().Observable.of((0,h.NV)(!1))}))}))},fetchAutocompleteOptionsEpic:function(e,t){return e.ofType(h.l1).debounce((function(e){return A().Observable.timer(e.fieldOptions.delayDebounce||0)})).filter((function(e){return"value"===e.fieldName&&"string"===e.fieldType&&t.getState().queryform.autocompleteEnabled})).switchMap((function(e){var r=t.getState(),o=(0,Qt.Vx)(r),a=r.queryform&&r.queryform.filterFields&&r.queryform.filterFields.filter((function(t){return t.rowId===e.rowId}))[0];if("selected"===e.fieldOptions.selected)return A().Observable.from([(0,h.$J)(a,[],0)]);var i=(0,Wt.getWpsPayload)({attribute:a.attribute,layerName:(0,Ht.HY)(r),layerFilter:(0,Qt.Vc)(r)||(0,Qt.hI)(r),maxFeatures:o,startIndex:(e.fieldOptions.currentPage-1)*o,value:e.fieldValue}),l=(0,zt.y9)(r.query.url,{outputFormat:"json"},(0,$t.kS)(t.getState()));return null===l?A().Observable.of((0,h.NV)(!1)):A().Observable.fromPromise(Ut().post(l,i,{timeout:6e4,headers:{Accept:"application/json","Content-Type":"application/xml"}}).then((function(e){return e.data}))).switchMap((function(t){var r=(0,n.isArray)(t.values)?t.values:[t.values],o=t.size;return A().Observable.from([(0,h.$J)(a,r,o),(0,h.js)(e.rowId,!0)])})).startWith((0,h.jR)(!0,a)).catch((function(){return A().Observable.from([(0,h.$J)(a,[],0),(0,Vt.vU)({title:"warning",message:"warning",action:{label:"warning"},autoDismiss:3,position:"tr"}),(0,h.js)(e.rowId,!0)])})).concat([(0,h.jR)(!1,a)])}))}};var Yt=r(75982),Kt=r(75110);function Jt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function er(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Jt(Object(r),!0).forEach((function(t){tr(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Jt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function tr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const rr={handleLayerFilterPanel:function(e,t){var r=t.getState;return e.ofType(m.Xs).switchMap((function(){var t=(0,Kt.Iz)(r()),o=t||{},a=o.url,i=o.name,l=o.layerFilter,s=t&&t.search&&t.search.url;return A().Observable.of((0,v.gT)(s||a,i),(0,h.F)(l),(0,m.HH)(l),(0,f.Xg)("queryPanel","enabled",!0)).merge(A().Observable.of((0,v.jG)()).filter((function(){return!(0,n.get)(r(),"query.isLayerFilter")})),e.ofType(h.Wm).switchMap((function(e){var o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.crossLayerFilter,r=e.spatialField,o=e.filterFields;return!!(o&&(0,n.head)(o)||r&&r.method&&r.operation&&r.geometry||t&&t.collectGeometries&&t.operation)}(e.filterObj)?er({},(0,n.get)(r(),"queryform",{})):void 0;return o&&(o.filterFields=o.attributePanelExpanded&&o.filterFields||[],o.spatialField=o.spatialPanelExpanded&&o.spatialField||null,o.crossLayerFilter=o.crossLayerExpanded&&(0,K.setupCrossLayerFilterDefaults)(o.crossLayerFilter)||null),A().Observable.of(function(e,t){return(0,b.He)(e,{layerFilter:t})}(t.id,o))}))).let(function(e){return function(t){return t.takeUntil(e.ofType(f.kM).filter((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.control,r=e.property;return"queryPanel"===t&&(!r||"enabled"===r)})).merge(e.ofType(Yt.nk)))}}(e)).concat(A().Observable.from([(0,v.jG)(),(0,h.mc)(),(0,d.Yf)("clean","","queryform",[],{})]))}))},restoreSavedFilter:function(e,t){var r=t.getState;return e.ofType(m.H1).switchMap((function(){var e={typeName:(0,n.get)(r(),"state.query.typeName")},t=(0,n.get)(r(),"state.query.url"),o=(0,n.get)(r(),"layerFilter.persisted");return A().Observable.of((0,d.Yf)("clean","","queryform",[]),(0,h.F)(o),(0,h.yC)(t,o,e),(0,v.Xc)())}))},onApplyFilter:function(e,t){var r=t.getState;return e.ofType(m.MY).map((function(){var e=er({},(0,n.get)(r(),"queryform",{}));return(0,m.Xr)(e)}))}};var nr=r(13292),or=r.n(nr);const ar={updateSpatialFilterValue:function(e){return e.ofType(h.Wi).switchMap((function(e){var t=e.feature,r=e.srsName,n=e.style,o=e.options;return R.Observable.of((0,d.Yf)("drawOrEdit",t.geometry.type,"queryform",[t],{editEnabled:!1,stopAfterDrawing:!0,featureProjection:r},n)).concat(t&&o&&o.autoZoom?[(0,g.Px)(or()(t),r)]:[])}))}};var ir=r(827),lr=r(72500),sr=r(31255),ur=r(85148);function pr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function cr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?pr(Object(r),!0).forEach((function(t){fr(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function fr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function dr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function yr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?dr(Object(r),!0).forEach((function(t){mr(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):dr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function mr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function br(e){return(br="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var gr=function(e){return{geometry:e.featureTypes[0].properties.filter((function(e){return 0===e.type.indexOf("gml:")})).map((function(e){return{label:e.name,attribute:e.name,type:"geometry",valueId:"id",valueLabel:"name",values:[]}})),original:e,attributes:Z(e)}};function hr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function vr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?hr(Object(r),!0).forEach((function(t){Or(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Or(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var wr={};var Fr=r(97301),Er=r(46905),Pr=r(67306),Sr=r(55105),jr=r(24262),xr=r(81756);function Cr(e){return(Cr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Tr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Nr(e,t){return(Nr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function qr(e,t){return!t||"object"!==Cr(t)&&"function"!=typeof t?Dr(e):t}function Dr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ir(e){return(Ir=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Lr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _r(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Lr(Object(r),!0).forEach((function(t){Mr(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Lr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Mr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Rr=h.mc.bind(null,"query"),Ar=(0,s.connect)((function(e){return{useMapProjection:e.queryform.useMapProjection,groupLevels:e.queryform.groupLevels,groupFields:e.queryform.groupFields,filterFields:e.queryform.filterFields,attributes:e.query&&e.query.typeName&&e.query.featureTypes&&e.query.featureTypes[e.query.typeName]&&e.query.featureTypes[e.query.typeName].attributes,featureTypeError:e.query&&e.query.typeName&&e.query.featureTypes&&e.query.featureTypes[e.query.typeName]&&e.query.featureTypes[e.query.typeName].error,spatialField:e.queryform.spatialField,showDetailsPanel:e.queryform.showDetailsPanel,toolbarEnabled:e.queryform.toolbarEnabled,attributePanelExpanded:e.queryform.attributePanelExpanded,autocompleteEnabled:e.queryform.autocompleteEnabled,crossLayerExpanded:e.queryform.crossLayerExpanded,crossLayerFilterOptions:_r({layers:(0,Qt.GK)(e),crossLayerFilter:(0,Qt.qh)(e)},e.queryform.crossLayerFilterOptions||{}),maxFeaturesWPS:e.queryform.maxFeaturesWPS,spatialPanelExpanded:e.queryform.spatialPanelExpanded,featureTypeConfigUrl:e.query&&e.query.url,searchUrl:e.query&&e.query.url,featureTypeName:e.query&&e.query.typeName,ogcVersion:"1.1.0",params:{typeName:e.query&&e.query.typeName},resultTitle:"Query Result",showGeneratedFilter:!1,allowEmptyFilter:!0,emptyFilterWarning:!0,maxHeight:e.map&&e.map.present&&e.map.present.size&&e.map.present.size.height,zoom:((0,ir.Od)(e)||{}).zoom,projection:((0,ir.Od)(e)||{}).projection}}),(function(e){return{attributeFilterActions:(0,p.DE)({onAddGroupField:h.kQ,onAddFilterField:h.jW,onRemoveFilterField:h.JG,onUpdateFilterField:h.q$,onUpdateExceptionField:h.OZ,onUpdateLogicCombo:h.Nc,onRemoveGroupField:h.I5,onChangeCascadingValue:h.QL,toggleMenu:h.js,onExpandAttributeFilterPanel:h.I},e),spatialFilterActions:(0,p.DE)({onChangeSpatialFilterValue:h.uo,onExpandSpatialFilterPanel:h.ku,onSelectSpatialMethod:h.HT,onSelectViewportSpatialMethod:h.lg,onSelectSpatialOperation:h.VF,onChangeDrawingStatus:d.Yf,onRemoveSpatialSelection:h.Ry,onShowSpatialSelectionDetails:h.ZH,onChangeDwithinValue:h.AQ,zoneFilter:h.eJ,zoneSearch:h.uM,zoneChange:h.uP},e),queryToolbarActions:(0,p.DE)({onQuery:h.yC,onReset:Rr,onSaveFilter:m.no,onRestoreFilter:m.Nd,storeAppliedFilter:m.Rb,onChangeDrawingStatus:d.Yf},e),crossLayerFilterActions:(0,p.DE)({expandCrossLayerFilterPanel:h.EU,setCrossLayerFilterParameter:h.IV,addCrossLayerFilterField:h.N5,updateCrossLayerFilterField:h.bn,removeCrossLayerFilterField:h.Bm,resetCrossLayerFilter:h.F2},e)}}))(Mt),kr=(0,c.P1)([function(e){return e.controls&&e.controls.toolbar&&"toc"===e.controls.toolbar.active},Kt.Bt,function(e){return e.layers&&e.layers.settings||{expanded:!1,options:{opacity:1}}},function(e){return e.controls&&e.controls.queryPanel&&e.controls.queryPanel.enabled||!1},function(e){return(0,Sr.ic)(e,{height:!0})},Pr.Wy,Qt.Vc,Qt.hI,function(e){return e&&e.query&&e.query.isLayerFilter},Kt.P_],(function(e,t,r,n,o,a,i,l,s,u){return{enabled:e,groups:t,settings:r,querypanelEnabled:n,layout:a?{}:o,appliedFilter:i,storedFilter:l,advancedToolbar:s,loadingError:u}})),Br=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Nr(e,t)}(s,e);var t,r,o,a,i=(o=s,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ir(o);if(a){var r=Ir(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return qr(this,e)});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),Mr(Dr(t=i.call(this,e)),"getNoBackgroundLayers",(function(e){return"background"!==e.name})),Mr(Dr(t),"renderSidebar",(function(){return l().createElement(u.Z,{open:t.props.querypanelEnabled,sidebar:t.renderQueryPanel(),sidebarClassName:"query-form-panel-container",touch:!1,styles:{sidebar:_r(_r({},t.props.layout),{},{zIndex:1024,width:600}),overlay:{zIndex:1023,width:0},root:{right:t.props.querypanelEnabled?0:"auto",width:"0",overflow:"visible"},content:{overflowY:"auto"}}},l().createElement("div",null))})),Mr(Dr(t),"onToggle",(function(){t.props.advancedToolbar&&!(0,n.isEqual)(t.props.appliedFilter,t.props.storedFilter)?t.setState((function(){return{showModal:!0}})):t.props.onToggleQuery()})),Mr(Dr(t),"restoreAndClose",(function(){t.setState((function(){return{showModal:!1}})),t.props.onRestoreFilter(),t.props.onToggleQuery()})),Mr(Dr(t),"storeAndClose",(function(){t.setState((function(){return{showModal:!1}})),t.props.onSaveFilter(),t.props.onToggleQuery()})),Mr(Dr(t),"renderQueryPanel",(function(){return l().createElement("div",{className:"mapstore-query-builder"},l().createElement(Ar,{header:l().createElement(kt,{loadingError:t.props.loadingError,onToggleQuery:t.onToggle}),spatialOperations:t.props.spatialOperations,spatialMethodOptions:t.props.spatialMethodOptions,toolsOptions:t.props.toolsOptions,featureTypeErrorText:l().createElement(xr.Z,{msgId:"layerProperties.featureTypeError"}),appliedFilter:t.props.appliedFilter,storedFilter:t.props.storedFilter,advancedToolbar:t.props.advancedToolbar,loadingError:t.props.loadingError}),l().createElement(Bt.Z,null,l().createElement(Gt.Z,{fade:!0,show:t.state.showModal,title:l().createElement(xr.Z,{msgId:"queryform.changedFilter"}),size:"xs",onClose:function(){return t.setState((function(){return{showModal:!1}}))},buttons:[{bsStyle:"primary",text:l().createElement(xr.Z,{msgId:"yes"}),onClick:t.storeAndClose},{bsStyle:"primary",text:l().createElement(xr.Z,{msgId:"no"}),onClick:t.restoreAndClose}]},l().createElement("div",{className:"ms-alert"},l().createElement("div",{className:"ms-alert-center"},l().createElement(xr.Z,{msgId:t.props.loadingError?"queryform.changedFilterWithErrorAlert":"queryform.changedFilterAlert"}))))))})),t.state={showModal:!1},t}return t=s,(r=[{key:"UNSAFE_componentWillReceiveProps",value:function(e){!0===e.querypanelEnabled&&!1===this.props.querypanelEnabled&&this.props.onInit()}},{key:"render",value:function(){return this.renderSidebar()}}])&&Tr(t.prototype,r),s}(l().Component);Mr(Br,"propTypes",{id:a().number,buttonContent:a().node,groups:a().array,settings:a().object,querypanelEnabled:a().bool,groupStyle:a().object,groupPropertiesChangeHandler:a().func,layerPropertiesChangeHandler:a().func,onToggleGroup:a().func,onToggleLayer:a().func,onToggleQuery:a().func,onZoomToExtent:a().func,retrieveLayerData:a().func,onSort:a().func,onInit:a().func,onSettings:a().func,hideSettings:a().func,updateSettings:a().func,updateNode:a().func,removeNode:a().func,activateRemoveLayer:a().bool,activateLegendTool:a().bool,activateZoomTool:a().bool,activateSettingsTool:a().bool,visibilityCheckType:a().string,settingsOptions:a().object,layout:a().object,toolsOptions:a().object,appliedFilter:a().object,storedFilter:a().object,advancedToolbar:a().bool,onSaveFilter:a().func,onRestoreFilter:a().func}),Mr(Br,"defaultProps",{groupPropertiesChangeHandler:function(){},layerPropertiesChangeHandler:function(){},retrieveLayerData:function(){},onToggleGroup:function(){},onToggleLayer:function(){},onToggleQuery:function(){},onZoomToExtent:function(){},onSettings:function(){},onInit:function(){},updateNode:function(){},removeNode:function(){},activateLegendTool:!0,activateZoomTool:!0,activateSettingsTool:!0,activateRemoveLayer:!0,visibilityCheckType:"checkbox",settingsOptions:{},querypanelEnabled:!1,layout:{},toolsOptions:{},onSaveFilter:function(){},onRestoreFilter:function(){}});const Gr={QueryPanelPlugin:(0,s.connect)(kr,{groupPropertiesChangeHandler:b.WO,layerPropertiesChangeHandler:b.He,retrieveLayerData:y.k,onToggleGroup:(0,jr.toggleByType)("groups",b.bh),onToggleLayer:(0,jr.toggleByType)("layers",b.bh),onToggleQuery:f.Xi.bind(null,"queryPanel",null),onSort:(0,jr.sortUsing)(jr.sortLayers,b.MK),onSettings:b.RP,onInit:v.Xc,onZoomToExtent:g.Px,hideSettings:b.sF,updateSettings:b.VP,updateNode:b.tV,removeNode:b.ZF,onSaveFilter:m.no,onRestoreFilter:m.Nd})(Br),reducers:{queryform:Er.Z,query:Fr.Z,layerFilter:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:wr,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case m.y6:return vr(vr({},wr),{},{persisted:t.filter,applied:t.filter});case m.H1:return vr(vr({},e),{},{applied:e.persisted});case m.g$:return vr(vr({},e),{},{applied:t.filter});case m.Xk:return vr(vr({},e),{},{persisted:e.applied});case h.Eg:return vr(vr({},e),{},{applied:void 0});default:return e}}},epics:_r(_r(_r({featureTypeSelectedEpic:function(e,t){return e.ofType(v.S0).filter((function(e){return e.url&&e.typeName})).switchMap((function(e){var r=t.getState();if((0,Ht.hk)(r,e.typeName)){var n=gr((0,Ht.qj)(r,e.typeName)),o=n.geometry[0]&&n.geometry[0].attribute?n.geometry[0].attribute:"the_geom";return A().Observable.of((0,h.DD)(o))}return A().Observable.defer((function(){return Ut().get(zt.ZP.filterUrlParams(e.url,(0,$t.kS)(t.getState()))+"?service=WFS&version=1.1.0&request=DescribeFeatureType&typeName="+e.typeName+"&outputFormat=application/json")})).map((function(t){if("object"===br(t.data)&&t.data.featureTypes&&t.data.featureTypes[0]){var r=gr(t.data),n=r.geometry[0]&&r.geometry[0].attribute?r.geometry[0].attribute:"the_geom";return A().Observable.from([(0,h.DD)(n),(0,v.rG)(e.typeName,r)])}try{JSON.parse(t.data)}catch(t){return A().Observable.from([(0,v.t3)(e.typeName,"Error from WFS: "+t.message),Vt.vU({title:"warning",message:"layerProperties.featureTypeErrorInvalidJSON",autoDismiss:3,position:"tc"})])}return A().Observable.from([(0,v.t3)(e.typeName,"Error: feature types are empty")])})).mergeAll().catch((function(t){return A().Observable.of((0,v.t3)(e.typeName,t.message||t.statusText))}))}))},wfsQueryEpic:function(e,t){return e.ofType(v.Qq).switchMap((function(r){var o,a,i,l=(a=(i=t.getState()).query&&i.query.featureTypes&&i.query.featureTypes[i.query.typeName]&&i.query.featureTypes[i.query.typeName].attributes&&i.query.featureTypes[i.query.typeName].attributes[0]&&i.query.featureTypes[i.query.typeName].attributes[0].attribute||null)?{sortBy:a,sortOrder:"A"}:{},s=(null==r||null===(o=r.filterObj)||void 0===o?void 0:o.sortOptions)||l,u=Ht.b0.totalFeatures(t.getState()),p=zt.ZP.filterUrlParams(r.searchUrl,(0,$t.kS)(t.getState())),c=(0,Kt.Iz)(t.getState())||{},f=c.layerFilter,d=c.params,y=(0,n.find)(Object.keys(d||{}),(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"cql_filter"===e.toLowerCase()})),m=(0,K.mergeFiltersToOGC)({ogcVersion:"1.1.0"},y,f,r.filterObj),b=function(e,t,r){var o=(0,sr.u$)(r),a=(0,ur.jo)({id:o},"time")(r),i=(0,Kt.CA)(r,o)||{},l=(0,n.get)(i,'params["time"]');if((0,sr.DK)(r)&&a&&l){var s=(0,lr.parse)(e)||{};return{url:(0,lr.format)(cr(cr({},s),{},{query:cr(cr({},s.query),{},{time:l})})),options:t}}return{url:e,options:t}}(p,r.queryOptions||{},t.getState()),g=b.url,h=b.options,O=yr(yr({},r.filterObj.pagination),{},{totalFeatures:u,sortOptions:s},h);return A().Observable.merge((0,k.Mc)(yr(yr({},c),{},{name:r.filterObj.featureTypeName||c.name,search:yr(yr({},c.search),{},{url:g})}),m,O).map((function(e){return(0,v.w_)(e,r.searchUrl,r.filterObj,r.queryOptions,r.reason)})).catch((function(e){return A().Observable.of((0,v.Lm)(e))})).startWith((0,v.Fs)(!0)).concat(A().Observable.of((0,v.Fs)(!1)))).takeUntil(e.ofType(v.VN))}))},viewportSelectedEpic:function(e,t){return e.ofType(h.On,g.pP).switchMap((function(e){var r=e.type===g.pP?e:(0,ir.Od)(t.getState());if((e.type===h.On||e.type===g.pP&&"Viewport"===(0,Qt.BU)(t.getState()))&&r.bbox&&r.bbox.bounds&&r.bbox.crs){var n=Object.keys(r.bbox.bounds).reduce((function(e,t){return He()({},e,mr({},t,parseFloat(r.bbox.bounds[t])))}),{});return A().Observable.of((0,h.ds)(Qe.default.getViewportGeometry(n,r.bbox.crs)))}return A().Observable.empty()}))},redrawSpatialFilterEpic:function(e,t){return e.ofType(v.R1).switchMap((function(){var e=t.getState(),r=(0,Qt.vE)(e),n={type:"Feature",geometry:{type:(0,Qt.a8)(e),coordinates:(0,Qt.G$)(e)}},o=(0,Qt.Nl)(e)?(0,d.Yf)("drawOrEdit",r.method||"","queryform",[n],{featureProjection:(0,Qt.IM)(e),drawEnabled:!1,editEnabled:!1}):(0,d.Yf)("clean",r.method||"","queryform",[],{drawEnabled:!1,editEnabled:!1});return A().Observable.of(o)}))}},Xt),ar),rr)}},81756:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});var n=r(71703),o=r(5346);const a=(0,n.connect)((function(e){return{locale:e.locale&&e.locale.currentLocale,messages:e.locale&&e.locale.messages||[]}}))(o.Z)},88113:(e,t,r)=>{"use strict";r.d(t,{b6:()=>u,PG:()=>p,_x:()=>c,Mm:()=>f,dP:()=>d,SX:()=>y,ZL:()=>m,_S:()=>b,iH:()=>g,R7:()=>h,Q7:()=>v,n7:()=>O,bA:()=>w,hm:()=>F,E2:()=>E,Cb:()=>P,eK:()=>S,Im:()=>j,e8:()=>x,$t:()=>C,kS:()=>T,y:()=>N,l2:()=>q,HN:()=>D});var n=r(22222),o=r(86494),a=r(827);function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){s(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var u=function(e){return(0,o.get)(e,"catalog.services")},p=(0,n.P1)((function(e){return(0,o.get)(e,"catalog.default.staticServices")}),u,(function(e,t){return l(l({},t),(0,o.pick)(e,"default_map_backgrounds"))})),c=function(e){return(0,o.get)(e,"catalog.default.tileSizes",[256,512])},f=function(e){return(0,o.get)(e,"controls.metadataexplorer.group")},d=function(e){return(0,o.get)(e,"catalog.saving")},y=function(e){return(0,o.get)(e,"catalog.result")},m=function(e){return(0,o.get)(e,"catalog.openCatalogServiceList")},b=function(e){return(0,o.get)(e,"catalog.newService")},g=function(e){return(0,o.get)(e,"catalog.newService.type","csw")},h=function(e){return(0,o.get)(e,'catalog.services["'.concat((0,o.get)(e,"catalog.selectedService"),'"]'))},v=function(e){return(0,o.get)(e,'catalog.services["'.concat((0,o.get)(e,"catalog.selectedService"),'"].type'),function(e){return(0,o.get)(e,'catalog.default.staticServices["'.concat((0,o.get)(e,"catalog.selectedService"),'"].type'),"csw")}(e))},O=function(e){return(0,o.get)(e,'catalog.services["'.concat((0,o.get)(e,"catalog.selectedService"),'"].layerOptions'),{})},w=function(e){return(0,o.get)(e,"catalog.searchOptions")},F=function(e){return(0,o.get)(e,"catalog.loadingError")},E=function(e){return(0,o.get)(e,"catalog.loading",!1)},P=function(e){return(0,o.get)(e,"catalog.selectedService")},S=function(e){return(0,o.get)(e,"catalog.mode","view")},j=function(e){return(0,o.get)(e,"catalog.layerError")},x=function(e){return(0,o.get)(e,"catalog.searchOptions.text","")},C=function(e){return"metadataexplorer"===(0,o.get)(e,"controls.toolbar.active")||(0,o.get)(e,"controls.metadataexplorer.enabled")},T=function(e){return((0,o.get)(e,"localConfig.authenticationRules")||[]).filter((function(e){return"authkey"===e.method})).map((function(e){return e.authkeyParamName}))||[]},N=function(e){return(0,o.get)(e,"catalog.pageSize",4)},q=function(e){return(0,o.get)(e,"catalog.delayAutoSearch",1e3)},D=(0,n.zB)({projection:a.uy})},67306:(e,t,r)=>{"use strict";r.d(t,{Wy:()=>a,i$:()=>i,P0:()=>l});var n=r(22222),o=r(24684),a=function(e){return e&&e.dashboard&&e.dashboard.editor&&e.dashboard.editor.available},i=function(e){return e&&e.dashboard&&e.dashboard.editing},l=function(e){return e&&e.dashboard&&e.dashboard.showConnections};(0,n.P1)(o.F,(function(e){return e&&e.dashboard&&e.dashboard.resource}),(function(e){return e&&e.browser&&e.browser.mobile}),(function(e,t,r){return r?!r:t&&t.canEdit||isNaN(e.substr(-4))}))},69842:(e,t,r)=>{"use strict";r.d(t,{qh:()=>c,GK:()=>f,Nl:()=>d,vE:()=>y,gC:()=>m,hI:()=>b,Vc:()=>g,BU:()=>h,Vx:()=>v,a8:()=>O,IM:()=>w,G$:()=>F});var n=r(86494),o=r(22222),a=r(75110),i=r(8316),l=r(86638);function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){p(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function p(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var c=function(e){return(0,n.get)(e,"queryform.crossLayerFilter")},f=function(e){return((0,a.l2)(e)||[]).filter((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.type,r=e.group;return"wms"===t&&"background"!==r})).map((function(t){var r=t.title;return u(u({},function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(t,["title"])),{},{title:(0,l.MZ)((0,i.Pz)(e),r)})}))},d=function(e){return(0,n.get)(e,"queryform.spatialField.geometry")},y=function(e){return(0,n.get)(e,"queryform.spatialField")},m=(0,o.P1)((function(e){return(0,n.get)(e,"queryform.attributePanelExpanded")}),(function(e){return(0,n.get)(e,"queryform.spatialPanelExpanded")}),(function(e){return(0,n.get)(e,"queryform.crossLayerExpanded")}),(function(e,t,r){return{attributePanelExpanded:e,spatialPanelExpanded:t,crossLayerExpanded:r}})),b=function(e){return(0,n.get)(e,"layerFilter.persisted")},g=function(e){return(0,n.get)(e,"layerFilter.applied")},h=function(e){return(0,n.get)(e,"queryform.spatialField.method")},v=function(e){return(0,n.get)(e,"queryform.maxFeaturesWPS")},O=function(e){return d(e)&&d(e).type||"Polygon"},w=function(e){return d(e)&&d(e).projection||"EPSG =4326"},F=function(e){return d(e)&&d(e).coordinates||[]}},24684:(e,t,r)=>{"use strict";r.d(t,{F:()=>o,y:()=>a});var n=r(86494),o=function(e){return(0,n.get)(e,"router.location.pathname")||"/"},a=function(e){return(0,n.get)(e,"router.location.search")||""}},84069:(e,t,r)=>{function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var o=r(47805),a=o.isFilterValid,i=o.toOGCFilterParts,l=r(2245)({}).and;e.exports={getWpsPayload:function(e){var t,r=e.layerName,o=e.layerFilter,s=e.attribute,u=e.maxFeatures,p=e.startIndex,c=e.value,f=c?'<ogc:PropertyIsLike matchCase="false" wildCard="*" singleChar="." escapeChar="!">   <ogc:PropertyName>'+s+"</ogc:PropertyName>   <ogc:Literal>*"+c+"*</ogc:Literal></ogc:PropertyIsLike>":"",d=o&&!o.disabled&&a(o)?i(o,"1.1.0","ogc"):[];return'<wps:Execute xmlns:wps="http://www.opengis.net/wps/1.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" version="1.0.0" service="WPS" xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd">  <ows:Identifier xmlns:ows="http://www.opengis.net/ows/1.1">gs:PagedUnique</ows:Identifier>  <wps:DataInputs>    <wps:Input>      <ows:Identifier xmlns:ows="http://www.opengis.net/ows/1.1">features</ows:Identifier>      <ows:Title xmlns:ows="http://www.opengis.net/ows/1.1">features</ows:Title>      <wps:Data />      <wps:Reference xmlns:xlink="http://www.w3.org/1999/xlink" mimeType="text/xml" xlink:href="http://geoserver/wfs" method="POST">        <wps:Body>         <wfs:GetFeature xmlns:wfs="http://www.opengis.net/wfs" service="WFS" version="1.0.0">           <wfs:Query typeName="'+r+'">'+(f.length>0||d.length>0?'<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc" xmlns:gml="http://www.opengis.net/gml">'+l.apply(void 0,(t=d,function(e){if(Array.isArray(e))return n(e)}(t)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).concat([f]))+"</ogc:Filter>":"")+'             <ogc:SortBy xmlns:ogc="http://www.opengis.net/ogc">               <ogc:SortProperty>                 <ogc:PropertyName>'+s+'</ogc:PropertyName>               </ogc:SortProperty>             </ogc:SortBy>           </wfs:Query>         </wfs:GetFeature>       </wps:Body>     </wps:Reference>   </wps:Input>   <wps:Input>     <ows:Identifier xmlns:ows="http://www.opengis.net/ows/1.1">fieldName</ows:Identifier>     <ows:Title xmlns:ows="http://www.opengis.net/ows/1.1">fieldName</ows:Title>     <wps:Data>       <wps:LiteralData>'+s+'</wps:LiteralData>     </wps:Data>   </wps:Input>   <wps:Input>     <ows:Identifier xmlns:ows="http://www.opengis.net/ows/1.1">maxFeatures</ows:Identifier>     <ows:Title xmlns:ows="http://www.opengis.net/ows/1.1">maxFeatures</ows:Title>     <wps:Data>       <wps:LiteralData>'+u+'</wps:LiteralData>     </wps:Data>   </wps:Input>   <wps:Input>     <ows:Identifier xmlns:ows="http://www.opengis.net/ows/1.1">startIndex</ows:Identifier>     <ows:Title xmlns:ows="http://www.opengis.net/ows/1.1">startIndex</ows:Title>     <wps:Data>       <wps:LiteralData>'+p+'</wps:LiteralData>     </wps:Data>   </wps:Input> </wps:DataInputs> <wps:ResponseForm>   <wps:RawDataOutput mimeType="application/json">     <ows:Identifier xmlns:ows="http://www.opengis.net/ows/1.1">result</ows:Identifier>   </wps:RawDataOutput> </wps:ResponseForm></wps:Execute>'}}},28492:(e,t,r)=>{(e.exports=r(9252)()).push([e.id,"",""])},65207:(e,t,r)=>{var n=r(28492);"string"==typeof n&&(n=[[e.id,n,""]]),r(14246)(n,{}),n.locals&&(e.exports=n.locals)}}]);