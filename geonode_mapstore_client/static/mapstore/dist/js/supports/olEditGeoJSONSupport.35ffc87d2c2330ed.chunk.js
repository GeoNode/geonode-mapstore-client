(self.webpackChunkgeonode_mapstore_client=self.webpackChunkgeonode_mapstore_client||[]).push([[1073,35341],{102496:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>z});var n=r(273517),o=r(754602),i=r(712651),a=r(229132),l=r(54620),u=r(736128),s=r(429276),c=r(927733),f=r(113628),d=r(200953),h=r(330503),y=r(694974),p=r(934142),m=r(644294),g=r(611217),v=r(652490),w=r(207434),_=r(764932),b=r(334338),P=r(360918),O=r(987021),A=r.n(O),x=r(958704),j=r(305493);function S(e){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S(e)}function G(e){return function(e){if(Array.isArray(e))return k(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||X(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function C(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Y(n.key),n)}}function M(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function E(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?M(Object(r),!0).forEach((function(t){F(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):M(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function F(e,t,r){return(t=Y(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Y(e){var t=function(e){if("object"!=S(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=S(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==S(t)?t:t+""}function D(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,a,l=[],u=!0,s=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(l.push(n.value),l.length!==t);u=!0);}catch(e){s=!0,o=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(s)throw o}}return l}}(e,t)||X(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function X(e,t){if(e){if("string"==typeof e)return k(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?k(e,t):void 0}}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var B=new u.A,T=function(e,t){var r=e.getView().getProjection().getCode();return(0,_.transformLineToArcs)(t.map((function(e){var t=(0,_.reproject)(e,r,"EPSG:4326");return[t.x,t.y]}))).map((function(e){var t=(0,_.reproject)(e,"EPSG:4326",r);return[t.x,t.y]}))};function I(e){return e.find((function(e){return void 0!==e[2]}))?e.map((function(e){var t=D(e,3),r=t[0],n=t[1],o=t[2];return[r,n,void 0===o?0:o]})):e}function L(e){var t=null==e?void 0:e.type;return"Point"===t?{type:"Point",coordinates:I([e.coordinates])[0]}:"LineString"===t?{type:"LineString",coordinates:I(e.coordinates)}:"Polygon"===t?{type:"Polygon",coordinates:e.coordinates.map(I)}:e}function N(e){var t=e.map,r=e.olFeature,n=e.feature,o=e.modifyPropertiesToFeatureProperties,i=void 0===o?function(){return{}}:o,a=t.getView().getProjection().getCode(),l=r.clone(),u=l.get("@properties")||{},s=u.geometryType;if("Circle"===s&&l.getGeometry()instanceof y.A&&(u=E(E({},u),{},{radius:l.getGeometry().getRadius()}),l.setGeometry(new m.A(l.getGeometry().getCenter()))),"Circle"===s&&l.getGeometry()instanceof b.A){u=E(E({},u),l.get("@properties"));var c=l.getGeometry().getGeometries();l.setGeometry(c[c.length-1].clone())}var f=B.writeFeatureObject(l,{featureProjection:a,dataProjection:"EPSG:4326"}).geometry;return E(E({},n),{},{geometry:L(f),properties:i(u,n)})}function R(e,t){if(void 0===t)return e;var r=A()(e).toRgb(),n=r.r,o=r.g,i=r.b;return"rgba(".concat([n,o,i,t].join(", "),")")}const J=function(){return e=function e(){var t,r,n=this,f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),F(this,"_onSingleClick",(function(){n._draw&&!n._draw.active&&(n._draw.setActive(!0),n._modify.setActive(!1))})),this._map=f.map;var h=f.geojson;this._featureToModifyProperties=(0,j.Nv)({getGeometryType:null==f?void 0:f.getGeometryType});var y=j.Or,m=f.onEditEnd?f.onEditEnd:function(){},_=(0,j.zY)(f.style),b=!!f.enablePolygonHoles,O=!1,A=new o.A({wrapX:!1,format:new u.A,features:[]});this._layer=new i.A({source:A,style:this._createStyleFunction({map:this._map,style:_}),zIndex:1/0}),this.setGeoJSON(h),this._modify=new a.A({source:A,style:function(e){var t,r,o,i;return e.get("features").forEach((function(t){var r=t.get("@modifyGeometry"),o=t.get("@properties")||{},i=o.geometryType,a=o.radius;if(r&&"Circle"===i){var l,u,s=e.getGeometry().getCoordinates(),c=t.getGeometry().getGeometries(),f=c[1].getCoordinates(),d=n._map.getView().getProjection(),h=a;s[0]===f[0]&&s[1]===f[1]||(l=(0,w.pd)(f,d,"EPSG:4326"),u=(0,w.pd)(s,d,"EPSG:4326"),h=(0,v.Yf)(l,u));var y=(0,p.kj)((0,w.pd)(f,d,"EPSG:4326"),h,128);y.transform("EPSG:4326",d),c[0].setCoordinates(y.getCoordinates()),r.setGeometries(c),t.set("@properties",E(E({},t.get("@properties")),{},{radius:h}))}})),new s.Ay({image:new c.A({stroke:new d.A({color:R(null==_||null===(t=_.cursor)||void 0===t?void 0:t.color,null==_||null===(r=_.cursor)||void 0===r?void 0:r.opacity),width:null==_||null===(o=_.cursor)||void 0===o?void 0:o.width}),radius:null==_||null===(i=_.cursor)||void 0===i?void 0:i.radius})})}}),this._modify.on("modifystart",(function(e){e.features.forEach((function(e){var t=e.getGeometry();"GeometryCollection"===t.getType()&&e.set("@modifyGeometry",t.clone(),!0)}))})),this._modify.on("modifyend",(function(e){e.features.forEach((function(e){var t=e.get("@modifyGeometry");t&&(e.setGeometry(t),e.unset("@modifyGeometry",!0))})),m(n._normalizeGeoJSONResult((function(t){var r=e.features.getArray().find((function(e){return e.getId()===t.id}));return r?N({map:n._map,olFeature:r,feature:t,modifyPropertiesToFeatureProperties:y}):t})))})),this._map.addInteraction(this._modify),this._map.addLayer(this._layer),this._map.on("singleclick",this._onSingleClick),"LineString"===(null==h||null===(t=h.geometry)||void 0===t?void 0:t.type)&&(this._draw=new l.Ay({type:"LineString",stopClick:!0,freehandCondition:x.Zm,style:function(e){var t,r,o,i,a,l,u,f,h,y,p,m,v=D(A.getFeatures(),1)[0],w=(v.get("@properties")||{}).geodesic,b=v.getGeometry().getCoordinates(),P=e.getGeometry().get("@coordinates"),x=!O&&[b[b.length-1],e.getGeometry().getCoordinates()],j=P||x;return[].concat(G(j?[new s.Ay({geometry:new g.A(j),stroke:new d.A(E({color:R(null==_||null===(t=_.lineDrawing)||void 0===t?void 0:t.color,null==_||null===(r=_.lineDrawing)||void 0===r?void 0:r.opacity),width:null==_||null===(o=_.lineDrawing)||void 0===o?void 0:o.width},(null==_||null===(i=_.lineDrawing)||void 0===i?void 0:i.dashLength)&&{lineDash:[_.lineDrawing.dashLength]}))})].concat(G(w?[new s.Ay({geometry:new g.A(T(n._map,j)),stroke:new d.A(E({color:R(null==_||null===(a=_.line)||void 0===a?void 0:a.color,null==_||null===(l=_.line)||void 0===l?void 0:l.opacity),width:null==_||null===(u=_.line)||void 0===u?void 0:u.width},(null==_||null===(f=_.line)||void 0===f?void 0:f.dashLength)&&{lineDash:[_.line.dashLength]}))})]:[])):[]),[new s.Ay({image:new c.A({stroke:new d.A({color:R(null==_||null===(h=_.cursor)||void 0===h?void 0:h.color,null==_||null===(y=_.cursor)||void 0===y?void 0:y.opacity),width:null==_||null===(p=_.cursor)||void 0===p?void 0:p.width}),radius:null==_||null===(m=_.cursor)||void 0===m?void 0:m.radius})})])},geometryFunction:function(e,t){var r=t,n=D(A.getFeatures(),1)[0];r||(r=new g.A([]));var o=n.getGeometry().getCoordinates();return r.setCoordinates([].concat(G(o),G(e))),r.set("@coordinates",[o[o.length-1]].concat(G(e))),r}}),this._map.addInteraction(this._draw),this._draw.setActive(!1),this._draw.on("drawstart",(function(){(O=!O)||(n._draw.setActive(!1),n._modify.setActive(!0))})),this._draw.on("drawend",(function(e){n._draw.setActive(!1),n._modify.setActive(!0),O=!1,m(n._normalizeGeoJSONResult((function(t){return N({map:n._map,olFeature:e.feature,feature:t,modifyPropertiesToFeatureProperties:y})})))}))),"Polygon"===(null==h||null===(r=h.geometry)||void 0===r?void 0:r.type)&&b&&(this._draw=new P.A({type:"Polygon",stopClick:!0,style:function(e){var t,r,o,i;return"Point"===e.getGeometry().getType()?new s.Ay({image:new c.A({stroke:new d.A({color:R(null==_||null===(t=_.cursor)||void 0===t?void 0:t.color,null==_||null===(r=_.cursor)||void 0===r?void 0:r.opacity),width:null==_||null===(o=_.cursor)||void 0===o?void 0:o.width}),radius:null==_||null===(i=_.cursor)||void 0===i?void 0:i.radius})}):n._createStyleFunction({map:n._map,style:_})(e)}}),this._map.addInteraction(this._draw),this._draw.setActive(!1),this._draw.on("drawstart",(function(){O=!0})),this._draw.on("drawend",(function(e){n._draw.setActive(!1),n._modify.setActive(!0),O=!1,m(n._normalizeGeoJSONResult((function(t){return e.feature.getId()===t.id?N({map:n._map,olFeature:e.feature,feature:t,modifyPropertiesToFeatureProperties:y}):t})))})))},(t=[{key:"setGeoJSON",value:function(e){var t=this;this._layer&&(this._geojson=E({},e),this._features="Feature"===(null==e?void 0:e.type)?[e]:null==e?void 0:e.features,this._layer.getSource().clear(),this._layer.getSource().addFeatures(this._features.map((function(e){return function(e){var t=e.feature,r=e.featureToModifyProperties,n=void 0===r?function(){return{}}:r,o=e.map.getView().getProjection().getCode(),i=B.readFeature(t,{featureProjection:o,dataProjection:"EPSG:4326"}),a=n(t),l=a.geodesic,u=a.geometryType,s=a.radius;if(i.set("@properties",a),l&&"Circle"===u&&s){var c=(0,p.kj)(t.geometry.coordinates,s,128).transform("EPSG:4326",o).getCoordinates();return i.setGeometry(new b.A([new p.Ay(c),i.getGeometry()])),i}if("Circle"===u&&s){var f=i.getGeometry().clone();i.set("@geometry",f),i.setGeometry(new y.A(f.getCoordinates(),s))}return i}({map:t._map,feature:e,featureToModifyProperties:t._featureToModifyProperties})}))))}},{key:"remove",value:function(){this._modify&&(this._map.removeInteraction(this._modify),this._modify=null),this._draw&&(this._map.removeInteraction(this._draw),this._draw=null),this._layer&&(this._map.removeLayer(this._layer),this._layer=null),this._onSingleClick&&this._map.un("singleclick",this._onSingleClick)}},{key:"_normalizeGeoJSONResult",value:function(e){var t,r=this._features.map(e);return"Feature"===(null===(t=this._geojson)||void 0===t?void 0:t.type)?r[0]:{type:"FeatureCollection",features:r}}},{key:"_createStyleFunction",value:function(e){var t=e.map,r=e.style;return function(e){var n,o,i,a,l,u,y,m,v,w,_,b,P,O,A,x,j=e.getGeometry().getType(),S=e.get("@properties")||{},C=S.geodesic,M=S.geometryType,F=new c.A({stroke:new d.A({color:R(null==r||null===(n=r.coordinatesNode)||void 0===n?void 0:n.color,null==r||null===(o=r.coordinatesNode)||void 0===o?void 0:o.opacity),width:null==r||null===(i=r.coordinatesNode)||void 0===i?void 0:i.width}),radius:null==r||null===(a=r.coordinatesNode)||void 0===a?void 0:a.radius}),Y=new d.A(E({color:R(null==r||null===(l=r.line)||void 0===l?void 0:l.color,null==r||null===(u=r.line)||void 0===u?void 0:u.opacity),width:null==r||null===(y=r.line)||void 0===y?void 0:y.width},(null==r||null===(m=r.line)||void 0===m?void 0:m.dashLength)&&{lineDash:[r.line.dashLength]})),D=new d.A(E({color:R(null==r||null===(v=r.lineDrawing)||void 0===v?void 0:v.color,null==r||null===(w=r.lineDrawing)||void 0===w?void 0:w.opacity),width:null==r||null===(_=r.lineDrawing)||void 0===_?void 0:_.width},(null==r||null===(b=r.lineDrawing)||void 0===b?void 0:b.dashLength)&&{lineDash:[r.lineDrawing.dashLength]})),X=new f.A({color:R(null==r||null===(P=r.areaDrawing)||void 0===P?void 0:P.color,null==r||null===(O=r.areaDrawing)||void 0===O?void 0:O.opacity)}),k=new f.A({color:R(null==r||null===(A=r.area)||void 0===A?void 0:A.color,null==r||null===(x=r.area)||void 0===x?void 0:x.opacity)});return C&&"Circle"===M&&"GeometryCollection"===j?[new s.Ay({geometry:e.get("@modifyGeometry")||e.getGeometry(),stroke:D,fill:X}),new s.Ay({geometry:e.get("@geometry"),image:F})]:"Circle"===j?[new s.Ay({stroke:D,fill:X}),new s.Ay({geometry:e.get("@geometry"),image:F})]:"LineString"===j?[new s.Ay(E(E({},C&&{geometry:new g.A(T(t,e.getGeometry().getCoordinates()))}),{},{stroke:C?Y:D}))].concat(G(C?[new s.Ay({stroke:D})]:[]),[new s.Ay({geometry:new h.A(e.getGeometry().getCoordinates()),image:F})]):"Polygon"===j?[new s.Ay(E(E({},C&&{geometry:new p.Ay(e.getGeometry().getCoordinates().map((function(e){return T(t,e)})))}),{},{stroke:C?Y:D,fill:C?k:X}))].concat(G(C?[new s.Ay({stroke:D})]:[]),[new s.Ay({geometry:new h.A(e.getGeometry().getCoordinates().reduce((function(e,t){return[].concat(G(e),G(t))}),[])),image:F})]):new s.Ay({image:F})}}}])&&C(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}(),z=function(e){var t=e.map,r=e.active,o=e.geojson,i=e.onEditEnd,a=e.style,l=e.enablePolygonHoles,u=void 0!==l&&l,s=e.getGeometryType,c=(0,n.useRef)();return(0,n.useEffect)((function(){return t&&r&&(c.current=new J({map:t,geojson:o,getGeometryType:s,onEditEnd:i,style:a,enablePolygonHoles:u})),function(){c.current&&(c.current.remove(),c.current=null)}}),[t,r,u]),(0,n.useEffect)((function(){c.current&&c.current.setGeoJSON(o)}),[o]),null}},305493:(e,t,r)=>{"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function a(e,t,r){return(t=function(e){var t=function(e){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e){return i({wireframe:{color:"#000000",opacity:1,depthFailColor:"#000000",depthFailOpacity:.4,width:.5},lineDrawing:{color:"#000000",opacity:1,depthFailColor:"#000000",depthFailOpacity:.4,width:3,dashLength:8},line:{color:"#ffcc33",opacity:1,depthFailColor:"#ffcc33",depthFailOpacity:.4,width:2},areaDrawing:{color:"#ffffff",opacity:.5,depthFailColor:"#ffffff",depthFailOpacity:.25},area:{color:"#ffffff",opacity:.5,depthFailColor:"#ffffff",depthFailOpacity:.25},cursor:{color:"#ff0000",width:2,radius:4},coordinatesNode:{color:"#333333",width:2,radius:5}},e)}r.d(t,{Nv:()=>s,Or:()=>c,zY:()=>l});var u=function(e){var t;return null==e||null===(t=e.geometry)||void 0===t?void 0:t.type},s=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).getGeometryType,t=void 0===e?u:e;return function(e){return i(i({},null==e?void 0:e.properties),{},{geometryType:t(e)})}},c=function(e,t){return i(i({},null==t?void 0:t.properties),void 0!==(null==e?void 0:e.radius)&&{radius:e.radius})}},360918:(e,t,r)=>{"use strict";r.d(t,{A:()=>m});var n=r(934142),o=r(502871),i=r(322809),a=r(54620),l=r(142770);function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){y(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function f(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(f=function(){return!!e})()}function d(e){return d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},d(e)}function h(e,t){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},h(e,t)}function y(e,t,r){return(t=p(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function p(e){var t=function(e){if("object"!=u(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=u(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==u(t)?t:t+""}const m=function(e){function t(e){var r;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),y(r=function(e,t,r){return t=d(t),function(e,t){if(t&&("object"==u(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,f()?Reflect.construct(t,r||[],d(e).constructor):t.apply(e,r))}(this,t,[c(c({},e),{},{type:"Polygon",geometryFunction:e.geometryFunction?function(t,n){return e.geometryFunction(t,r._geometryFn(t,n))}:function(e,t){return r._geometryFn(e,t)}})]),"setMap",(function(e){this.getMap()&&this.getMap().removeInteraction(this._select),e&&e.addInteraction(this._select),a.Ay.prototype.setMap.call(this,e)})),y(r,"setActive",(function(e){this._select.getFeatures().clear(),a.Ay.prototype.setActive.call(this,e)})),y(r,"removeLastPoint",(function(){this._feature&&this._feature.getGeometry().getCoordinates()[0].length>2&&a.Ay.prototype.removeLastPoint.call(this)})),y(r,"getPolygon",(function(){return this._polygon})),y(r,"_startDrawing",(function(e){var t=this.getMap();this._feature=e.feature;var r=e.feature.getGeometry().getCoordinates()[0][0];this._current=null,t.forEachFeatureAtPixel(t.getPixelFromCoordinate(r),function(e,t){if(!this._current&&this._features(e,t)){var n=e.getGeometry();if("Polygon"===n.getType()&&n.intersectsCoordinate(r))this._polygonIndex=!1,this._polygon=n,this._current=e;else if("MultiPolygon"===n.getType()&&n.intersectsCoordinate(r))for(var o,i=0;n.getPolygon(i);i++)if((o=n.getPolygon(i)).intersectsCoordinate(r)){this._polygonIndex=i,this._polygon=o,this._current=e;break}}}.bind(this),{layerFilter:this.layers_}),this._select.getFeatures().clear(),this._current?this._select.getFeatures().push(this._current):(this.setActive(!1),this.setActive(!0))})),y(r,"_finishDrawing",(function(e){e.hole=e.feature,e.feature=this._select.getFeatures().item(0),this.dispatchEvent({type:"modifystart",features:[this._current]});var t=e.hole.getGeometry().getCoordinates()[0];if(t.length>=3)if(!1!==this._polygonIndex){for(var r,n=e.feature.getGeometry(),a=new o.A([]),l=0;n.getPolygon(l);l++)r=n.getPolygon(l),l===this._polygonIndex?(r.appendLinearRing(new i.A(t)),a.appendPolygon(r)):a.appendPolygon(r);e.feature.setGeometry(a)}else this.getPolygon().appendLinearRing(new i.A(t));this.dispatchEvent({type:"modifyend",features:[this._current]}),this._feature=null,this._select.getFeatures().clear()})),y(r,"_geometryFn",(function(e,t){var r=e[0].pop();return this.getPolygon()&&!this.getPolygon().intersectsCoordinate(r)||(this.lastOKCoord=[r[0],r[1]]),e[0].push([this.lastOKCoord[0],this.lastOKCoord[1]]),t&&t.setCoordinates([e[0].concat([e[0][0]])]),new n.Ay(e)})),r._select=new l.A({style:e.style}),r._select.setActive(!1),e.layers&&("function"==typeof e.layers?r.layers_=e.layers:e.layers.indexOf&&(r.layers_=function(t){return e.layers.indexOf(t)>=0})),"function"==typeof e.featureFilter)r._features=e.featureFilter;else if(e.featureFilter){var s=e.featureFilter;r._features=function(e){return s.indexOf?!!s[s.indexOf(e)]:!!s.item(s.getArray().indexOf(e))}}else r._features=function(){return!0};return r.on("drawstart",r._startDrawing.bind(r)),r.on("drawend",r._finishDrawing.bind(r)),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}(t,e),r=t,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(a.Ay)},935341:function(e){e.exports=function(){"use strict";function e(e,n,o,i,a){!function e(r,n,o,i,a){for(;i>o;){if(i-o>600){var l=i-o+1,u=n-o+1,s=Math.log(l),c=.5*Math.exp(2*s/3),f=.5*Math.sqrt(s*c*(l-c)/l)*(u-l/2<0?-1:1);e(r,n,Math.max(o,Math.floor(n-u*c/l+f)),Math.min(i,Math.floor(n+(l-u)*c/l+f)),a)}var d=r[n],h=o,y=i;for(t(r,o,n),a(r[i],d)>0&&t(r,o,i);h<y;){for(t(r,h,y),h++,y--;a(r[h],d)<0;)h++;for(;a(r[y],d)>0;)y--}0===a(r[o],d)?t(r,o,y):t(r,++y,i),y<=n&&(o=y+1),n<=y&&(i=y-1)}}(e,n,o||0,i||e.length-1,a||r)}function t(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function r(e,t){return e<t?-1:e>t?1:0}var n=function(e){void 0===e&&(e=9),this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function o(e,t,r){if(!r)return t.indexOf(e);for(var n=0;n<t.length;n++)if(r(e,t[n]))return n;return-1}function i(e,t){a(e,0,e.children.length,t,e)}function a(e,t,r,n,o){o||(o=y(null)),o.minX=1/0,o.minY=1/0,o.maxX=-1/0,o.maxY=-1/0;for(var i=t;i<r;i++){var a=e.children[i];l(o,e.leaf?n(a):a)}return o}function l(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function u(e,t){return e.minX-t.minX}function s(e,t){return e.minY-t.minY}function c(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function f(e){return e.maxX-e.minX+(e.maxY-e.minY)}function d(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function h(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function y(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function p(t,r,n,o,i){for(var a=[r,n];a.length;)if(!((n=a.pop())-(r=a.pop())<=o)){var l=r+Math.ceil((n-r)/o/2)*o;e(t,l,r,n,i),a.push(r,l,l,n)}}return n.prototype.all=function(){return this._all(this.data,[])},n.prototype.search=function(e){var t=this.data,r=[];if(!h(e,t))return r;for(var n=this.toBBox,o=[];t;){for(var i=0;i<t.children.length;i++){var a=t.children[i],l=t.leaf?n(a):a;h(e,l)&&(t.leaf?r.push(a):d(e,l)?this._all(a,r):o.push(a))}t=o.pop()}return r},n.prototype.collides=function(e){var t=this.data;if(!h(e,t))return!1;for(var r=[];t;){for(var n=0;n<t.children.length;n++){var o=t.children[n],i=t.leaf?this.toBBox(o):o;if(h(e,i)){if(t.leaf||d(e,i))return!0;r.push(o)}}t=r.pop()}return!1},n.prototype.load=function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0;t<e.length;t++)this.insert(e[t]);return this}var r=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var n=this.data;this.data=r,r=n}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this},n.prototype.insert=function(e){return e&&this._insert(e,this.data.height-1),this},n.prototype.clear=function(){return this.data=y([]),this},n.prototype.remove=function(e,t){if(!e)return this;for(var r,n,i,a=this.data,l=this.toBBox(e),u=[],s=[];a||u.length;){if(a||(a=u.pop(),n=u[u.length-1],r=s.pop(),i=!0),a.leaf){var c=o(e,a.children,t);if(-1!==c)return a.children.splice(c,1),u.push(a),this._condense(u),this}i||a.leaf||!d(a,l)?n?(r++,a=n.children[r],i=!1):a=null:(u.push(a),s.push(r),r=0,n=a,a=a.children[0])}return this},n.prototype.toBBox=function(e){return e},n.prototype.compareMinX=function(e,t){return e.minX-t.minX},n.prototype.compareMinY=function(e,t){return e.minY-t.minY},n.prototype.toJSON=function(){return this.data},n.prototype.fromJSON=function(e){return this.data=e,this},n.prototype._all=function(e,t){for(var r=[];e;)e.leaf?t.push.apply(t,e.children):r.push.apply(r,e.children),e=r.pop();return t},n.prototype._build=function(e,t,r,n){var o,a=r-t+1,l=this._maxEntries;if(a<=l)return i(o=y(e.slice(t,r+1)),this.toBBox),o;n||(n=Math.ceil(Math.log(a)/Math.log(l)),l=Math.ceil(a/Math.pow(l,n-1))),(o=y([])).leaf=!1,o.height=n;var u=Math.ceil(a/l),s=u*Math.ceil(Math.sqrt(l));p(e,t,r,s,this.compareMinX);for(var c=t;c<=r;c+=s){var f=Math.min(c+s-1,r);p(e,c,f,u,this.compareMinY);for(var d=c;d<=f;d+=u){var h=Math.min(d+u-1,f);o.children.push(this._build(e,d,h,n-1))}}return i(o,this.toBBox),o},n.prototype._chooseSubtree=function(e,t,r,n){for(;n.push(t),!t.leaf&&n.length-1!==r;){for(var o=1/0,i=1/0,a=void 0,l=0;l<t.children.length;l++){var u=t.children[l],s=c(u),f=(d=e,h=u,(Math.max(h.maxX,d.maxX)-Math.min(h.minX,d.minX))*(Math.max(h.maxY,d.maxY)-Math.min(h.minY,d.minY))-s);f<i?(i=f,o=s<o?s:o,a=u):f===i&&s<o&&(o=s,a=u)}t=a||t.children[0]}var d,h;return t},n.prototype._insert=function(e,t,r){var n=r?e:this.toBBox(e),o=[],i=this._chooseSubtree(n,this.data,t,o);for(i.children.push(e),l(i,n);t>=0&&o[t].children.length>this._maxEntries;)this._split(o,t),t--;this._adjustParentBBoxes(n,o,t)},n.prototype._split=function(e,t){var r=e[t],n=r.children.length,o=this._minEntries;this._chooseSplitAxis(r,o,n);var a=this._chooseSplitIndex(r,o,n),l=y(r.children.splice(a,r.children.length-a));l.height=r.height,l.leaf=r.leaf,i(r,this.toBBox),i(l,this.toBBox),t?e[t-1].children.push(l):this._splitRoot(r,l)},n.prototype._splitRoot=function(e,t){this.data=y([e,t]),this.data.height=e.height+1,this.data.leaf=!1,i(this.data,this.toBBox)},n.prototype._chooseSplitIndex=function(e,t,r){for(var n,o,i,l,u,s,f,d=1/0,h=1/0,y=t;y<=r-t;y++){var p=a(e,0,y,this.toBBox),m=a(e,y,r,this.toBBox),g=(o=p,i=m,void 0,void 0,void 0,void 0,l=Math.max(o.minX,i.minX),u=Math.max(o.minY,i.minY),s=Math.min(o.maxX,i.maxX),f=Math.min(o.maxY,i.maxY),Math.max(0,s-l)*Math.max(0,f-u)),v=c(p)+c(m);g<d?(d=g,n=y,h=v<h?v:h):g===d&&v<h&&(h=v,n=y)}return n||r-t},n.prototype._chooseSplitAxis=function(e,t,r){var n=e.leaf?this.compareMinX:u,o=e.leaf?this.compareMinY:s;this._allDistMargin(e,t,r,n)<this._allDistMargin(e,t,r,o)&&e.children.sort(n)},n.prototype._allDistMargin=function(e,t,r,n){e.children.sort(n);for(var o=this.toBBox,i=a(e,0,t,o),u=a(e,r-t,r,o),s=f(i)+f(u),c=t;c<r-t;c++){var d=e.children[c];l(i,e.leaf?o(d):d),s+=f(i)}for(var h=r-t-1;h>=t;h--){var y=e.children[h];l(u,e.leaf?o(y):y),s+=f(u)}return s},n.prototype._adjustParentBBoxes=function(e,t,r){for(var n=r;n>=0;n--)l(t[n],e)},n.prototype._condense=function(e){for(var t=e.length-1,r=void 0;t>=0;t--)0===e[t].children.length?t>0?(r=e[t-1].children).splice(r.indexOf(e[t]),1):this.clear():i(e[t],this.toBBox)},n}()}}]);