"use strict";(self.webpackChunkgeonode_mapstore_client=self.webpackChunkgeonode_mapstore_client||[]).push([[7316],{11610(e,t,r){r.d(t,{A:()=>S});var o=r(273517),n=r.n(o),i=r(875763),a=r(605556),s=r.n(a),p=r(240452),l=r.n(p),u=r(104567),c=r.n(u),d=r(39128),m=r.n(d),y=r(6683),v=r(995531),f=r(417497);function h(e){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h(e)}function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,o)}return r}function b(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach(function(t){E(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function O(e){return function(e){if(Array.isArray(e))return P(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return P(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?P(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function P(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=Array(t);r<t;r++)o[r]=e[r];return o}function w(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,k(o.key),o)}}function A(e,t,r){return t=C(t),function(e,t){if(t&&("object"==h(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,L()?Reflect.construct(t,r||[],C(e).constructor):t.apply(e,r))}function L(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(L=function(){return!!e})()}function C(e){return C=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},C(e)}function T(e,t){return T=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},T(e,t)}function E(e,t,r){return(t=k(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function k(e){var t=function(e){if("object"!=h(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=h(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==h(t)?t:t+""}var j=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),n=0;n<r;n++)o[n]=arguments[n];return E(e=A(this,t,[].concat(o)),"updateZIndex",function(t){var r=t||e.props.position;if(e.provider){var o=e.props.map.imageryLayers._layers.indexOf(e.provider),n=O(e.props.map.imageryLayers._layers).sort(function(t,o){return(t===e.provider?r:t._position)-(o===e.provider?r:o._position)}).indexOf(e.provider)-o;0!==n&&O(new Array(Math.abs(n)).keys()).forEach(function(){e.props.map.imageryLayers[n>0?"raise":"lower"](e.provider)}),e.props.map.scene.requestRender()}}),E(e,"setDetachedLayerVisibility",function(t,r){var o;if(null===(o=e.layer)||void 0===o||!o.setVisible)return t?(e.removeLayer(),e.createLayer(r.type,b(b({},r.options),{},{visibility:t}),r.position,r.map,r.securityToken),void(e.layer.add&&e.layer.add())):void e.removeLayer();e.layer.setVisible(t)}),E(e,"setImageryLayerVisibility",function(t,r){if(!e.provider)return t?(e.addLayer(r),void e.updateZIndex()):void e.removeLayer();e.provider.show=!!t}),E(e,"setLayerVisibility",function(t){var r,o=e.getVisibilityOption(e.props),n=e.getVisibilityOption(t);n!==o&&(null!==(r=e.layer)&&void 0!==r&&r.detached?e.setDetachedLayerVisibility(n,t):e.setImageryLayerVisibility(n,t),t.map.scene.requestRender())}),E(e,"getVisibilityOption",function(e){var t=e.options,r=void 0===t?{}:t,o=e.zoom,n=e.resolutions,i=void 0===n?(0,y._7)():n,a=l()(o),s=r||{},p=s.visibility,u=s.minResolution,d=void 0===u?-1/0:u,m=s.maxResolution,v=void 0===m?1/0:m;if(!s.disableResolutionLimits&&!c()(i[a])){var f=i[a];if(!(f<v&&f>=d))return!1}return!!p}),E(e,"setLayerOpacity",function(t){t!==(e.props.options&&void 0!==e.props.options.opacity?e.props.options.opacity:1)&&e.layer&&e.provider&&(e.provider.alpha=t,e.props.map.scene.requestRender())}),E(e,"createLayer",function(t,r,o,n,a){if(t){var s=null!=r&&r.url?(0,f.Ht)(m()(r.url)[0]):void 0;void 0!==s&&(e._isProxy=s,e._prevIsProxy=e._isProxy);var p=b(b(b({},r),o?{zIndex:o}:null),{},{position:o,securityToken:a},e._isProxy?{forceProxy:e._isProxy}:null);e.layer=i.default.createLayer(t,p,n),e.layer&&(e.layer.layerName=r.name,e.layer.layerId=r.id),null===e.layer&&e.props.onCreationError(r),e.props.map.scene.requestRender()}}),E(e,"updateLayer",function(t,r){var o=i.default.updateLayer(t.type,e.layer,b(b({},t.options),{},{securityToken:t.securityToken,forceProxy:e._isProxy,imageryLayersTreeUpdatedCount:t.imageryLayersTreeUpdatedCount,position:t.position}),b(b({},r.options),{},{securityToken:r.securityToken,forceProxy:e._prevIsProxy,imageryLayersTreeUpdatedCount:r.imageryLayersTreeUpdatedCount,position:r.position}),e.props.map);o&&(e.removeLayer(),e.layer=o,t.options.visibility&&e.addLayer(t)),e.updateZIndex(t.position),t.map.scene.requestRender()}),E(e,"addLayerInternal",function(t){t.options.useForElevation?e.props.map.terrainProvider=e.layer:(e.provider=e.props.map.imageryLayers.addImageryProvider(e.layer),e.provider._position=e.props.position,void 0!==t.options.opacity&&(e.provider.alpha=t.options.opacity)),e.props.onImageryLayersTreeUpdate(),t.map.scene.requestRender()}),E(e,"_addLayer",function(t){var r,o;if(e.layer&&!e.layer.detached&&(e.addLayerInternal(t),e.props.options.refresh&&e.layer.updateParams)){var n=0;e.refreshTimer=setInterval(function(){var r=e.layer.updateParams(Object.assign({},e.props.options.params,{_refreshCounter:n++}));e.removeLayer(),e.layer=r,e.addLayerInternal(t),e.props.map.scene.requestRender()},e.props.options.refresh)}null!==(r=e.layer)&&void 0!==r&&r.detached&&null!==(o=e.layer)&&void 0!==o&&o.add&&e.layer.add()}),E(e,"addLayer",function(t){var r;if(void 0===e._isProxy&&null!=t&&null!==(r=t.options)&&void 0!==r&&r.url){var o=m()(t.options.url);return(0,v.A)(o[0],{noProxy:!0}).finally(function(){e._isProxy=!!(0,f.Ht)(o[0]),e.updateLayer(t,e.props),e._prevIsProxy=e._isProxy})}return e._addLayer(t)}),E(e,"removeLayer",function(t){var r,o;e.layer.destroy&&e.layer.destroy();var n=t||e.provider;n&&(e.props.map.imageryLayers.remove(n),e.props.onImageryLayersTreeUpdate()),null!==(r=e.layer)&&void 0!==r&&r.detached&&null!==(o=e.layer)&&void 0!==o&&o.remove&&e.layer.remove(),e.props.map.scene.requestRender()}),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&T(e,t)}(t,e),r=t,(o=[{key:"componentDidMount",value:function(){var e=this.getVisibilityOption(this.props);this.createLayer(this.props.type,b(b({},this.props.options),{},{visibility:e}),this.props.position,this.props.map,this.props.securityToken),this.props.options&&this.layer&&e&&(this.addLayer(this.props),this.updateZIndex(),this.provider&&this.props.onImageryLayersTreeUpdate())}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=this;this.setLayerVisibility(e);var r=e.options&&void 0!==e.options.opacity?e.options.opacity:1;if(this.setLayerOpacity(r),e.position!==this.props.position&&(this.updateZIndex(e.position),this.provider&&(this.provider._position=e.position),this.props.onImageryLayersTreeUpdate()),this.props.options&&this.props.options.params&&this.layer.updateParams&&e.options.visibility&&Object.keys(this.props.options.params).reduce(function(r,o){return e.options.params[o]!==t.props.options.params[o]||r},!1)){var o=this.provider,n=this.layer.updateParams(e.options.params);this.layer=n,this.addLayer(e),setTimeout(function(){t.removeLayer(o)},1e3)}this.updateLayer(e,this.props)}},{key:"componentWillUnmount",value:function(){var e;this.layer&&this.props.map&&!this.props.map.isDestroyed()&&(this.layer.detached&&null!==(e=this.layer)&&void 0!==e&&e.remove?this.layer.remove():this.removeLayer(),this.refreshTimer&&clearInterval(this.refreshTimer))}},{key:"render",value:function(){var e=this;if(this.props.children){var t=this.layer,r=t?n().Children.map(this.props.children,function(r){return r?n().cloneElement(r,{container:t,styleName:e.props.options&&e.props.options.styleName}):null}):null;return n().createElement(n().Fragment,null,r)}return i.default.renderLayer(this.props.type,this.props.options,this.props.map,this.props.map.id,this.layer)}}])&&w(r.prototype,o),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,o}(n().Component);E(j,"propTypes",{map:s().object,type:s().string,options:s().object,onCreationError:s().func,position:s().number,securityToken:s().string,zoom:s().number,imageryLayersTreeUpdatedCount:s().number,onImageryLayersTreeUpdate:s().func});const S=j},548371(e,t,r){r.d(t,{A:()=>J});var o=r(267980),n=r(336946),i=r(564453),a=r(41476),s=r(123905),p=r(149192),l=r(591978),u=r(367817),c=r(766067),d=r(697422),m=r(86881),y=r(149785),v=r(622569),f=r(489970),h=r(566334),g=r(205672),b=(r(574230),r(788392),r(477005)),O=r(605556),P=r.n(O),w=r(45388),A=r.n(w),L=r(273517),C=r.n(L),T=r(310340),E=r.n(T),k=r(779893),j=r(770260),S=r(6683),_=r(764932),I=r(568562),x=r.n(I),D=r(809136),M=r.n(D),F=r(593737),R=r.n(F),H=["type"];function U(e){return U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},U(e)}function N(){return N=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)({}).hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},N.apply(null,arguments)}function V(e,t){if(e){if("string"==typeof e)return Z(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Z(e,t):void 0}}function Z(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=Array(t);r<t;r++)o[r]=e[r];return o}function z(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,o)}return r}function W(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?z(Object(r),!0).forEach(function(t){X(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):z(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function B(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Y(o.key),o)}}function G(e,t,r){return t=$(t),function(e,t){if(t&&("object"==U(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,q()?Reflect.construct(t,r||[],$(e).constructor):t.apply(e,r))}function q(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(q=function(){return!!e})()}function $(e){return $=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},$(e)}function K(e,t){return K=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},K(e,t)}function X(e,t,r){return(t=Y(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Y(e){var t=function(e){if("object"!=U(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=U(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==U(t)?t:t+""}var Q=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return X(e=G(this,t,[].concat(a)),"state",{renderError:null,imageryLayersTreeUpdatedCount:0}),X(e,"onClick",function(t,r){if(e.props.onClick&&null!==r.position){var o=t.camera.pickEllipsoid(r.position,t.scene.globe.ellipsoid),i=e.getIntersectedFeatures(t,r.position),a=j.Ay.getMouseXYZ(t,r)||o&&n.A.fromCartesian(o);if(a){var s,p=180*a.latitude/Math.PI,l=180*a.longitude/Math.PI,u=Math.round(a.height);null!==(s=e.map)&&void 0!==s&&null!==(s=s.msElevationLayers)&&void 0!==s&&s[0]&&(u=e.getElevation(a.longitude,a.latitude));var c=(90-p)/180*e.props.standardHeight*(e.props.zoom+1),d=(180+l)/360*e.props.standardWidth*(e.props.zoom+1);e.props.onClick({pixel:{x:d,y:c},height:e.props.mapOptions&&e.props.mapOptions.terrainProvider||i.length>0?a.height:void 0,cartographic:a,latlng:{lat:p,lng:l,z:u},crs:"EPSG:4326",intersectedFeatures:i,resolution:(0,S._7)()[Math.round(e.props.zoom)]})}}}),X(e,"onMouseMove",function(t){var r;if(e.props.onMouseMove&&t.endPosition&&null!==(r=e.map)&&void 0!==r&&r.camera){var o=e.map.camera.pickEllipsoid(t.endPosition,e.map.scene.globe.ellipsoid),i=j.Ay.getMouseXYZ(e.map,t)||o&&n.A.fromCartesian(o);if(i){var a,s=e.getIntersectedFeatures(e.map,t.endPosition),p=Math.round(i.height);null!==(a=e.map)&&void 0!==a&&null!==(a=a.msElevationLayers)&&void 0!==a&&a[0]&&(p=e.getElevation(i.longitude,i.latitude)),e.props.onMouseMove({y:180*i.latitude/Math.PI,x:180*i.longitude/Math.PI,z:p,crs:"EPSG:4326",intersectedFeatures:s})}}}),X(e,"getDocument",function(){return e.props.document||document}),X(e,"getMapOptions",function(e){var t={};if(e.terrainProvider){var r=e.terrainProvider,o=r.type,n=function(e,t){if(null==e)return{};var r,o,n=function(e,t){if(null==e)return{};var r={};for(var o in e)if({}.hasOwnProperty.call(e,o)){if(-1!==t.indexOf(o))continue;r[o]=e[o]}return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)r=i[o],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}(r,H);switch(o){case"cesium":t.terrainProvider=new i.A(n);break;case"ellipsoid":t.terrainProvider=new p.A}}return Object.assign({},e,t)}),X(e,"getCenter",function(){var t=e.map.scene.globe.pick(new c.A(e.map.camera.position,e.map.camera.direction),e.map.scene);t||(t=o.A.add(o.A.clone(e.map.camera.position),o.A.multiplyByScalar(o.A.clone(e.map.camera.direction),1e5,new o.A),new o.A));var r=n.A.fromCartesian(new o.A(t.x,t.y,t.z));return{longitude:u.A.toDegrees(r.longitude),latitude:u.A.toDegrees(r.latitude),height:r.height}}),X(e,"getZoomFromHeight",function(t){return Math.log2(e.props.zoomToHeight/t)+1}),X(e,"getHeightFromZoom",function(t){return e.props.zoomToHeight/Math.pow(2,t-1)}),X(e,"getIntersectedFeatures",function(e,t){var r=e.scene.drillPick(t).filter(function(e){var t,r,o,n=(null==e||null===(t=e.id)||void 0===t?void 0:t._msIsQueryable)||(null==e||null===(r=e.primitive)||void 0===r?void 0:r._msIsQueryable);return n?n():!(!1===(null==e||null===(o=e.id)||void 0===o||null===(o=o.entityCollection)||void 0===o||null===(o=o.owner)||void 0===o?void 0:o.queryable))});if(r){var o=r.reduce(function(e,t){var r,o,n,i,a,s,p=null;if(t instanceof v.A&&null!=t&&null!==(r=t.tileset)&&void 0!==r&&r.msId){i=t.tileset.msId;var l=t.getPropertyIds();a=Object.fromEntries(l.map(function(e){return[e,t.getProperty(e)]}))}else if(null!=t&&null!==(o=t.id)&&void 0!==o&&o._msGetFeatureById||null!=t&&null!==(n=t.primitive)&&void 0!==n&&n._msGetFeatureById){var u,c,d=((null==t||null===(u=t.id)||void 0===u?void 0:u._msGetFeatureById)||(null==t||null===(c=t.primitive)||void 0===c?void 0:c._msGetFeatureById))(t.id);a=d.feature.properties,p=d.feature.geometry,s=d.feature.id,i=d.msId}if(!a||!i)return e;var m=W({type:"Feature",properties:a,geometry:p},s&&{id:s});return W(W({},e),{},X({},i,e[i]?[].concat(function(e){return function(e){if(Array.isArray(e))return Z(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||V(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e[i]),[m]):[m]))},[]);return Object.keys(o).map(function(e){return{id:e,features:o[e]}})}return[]}),X(e,"gestureStartListener",function(e){e.preventDefault()}),X(e,"setMousePointer",function(t){e.map&&(E().findDOMNode(e).getElementsByClassName("cesium-viewer")[0].style.cursor=t||"auto")}),X(e,"_updateMapPositionFromNewProps",function(t){var r=e.getCenter(),n=e.map.camera.positionCartographic,i=e.getZoomFromHeight(n.height),a=function(e,t){return void 0!==e&&void 0!==t&&Math.abs(e.toFixed(12)-t.toFixed(12))<=1e-12};if(void 0!==t.center){var s=!a(t.center.x,r.longitude)||!a(t.center.y,r.latitude),p=t.zoom!==i;if(s||p){var l,u={destination:o.A.fromDegrees(t.center.x,t.center.y,void 0!==t.zoom?e.getHeightFromZoom(t.zoom):n.height),orientation:null===(l=t.viewerOptions)||void 0===l?void 0:l.orientation};e.setView(u)}}}),X(e,"setView",function(t){e.map.camera.cancelFlight(),e.map.camera.setView(t)}),X(e,"subscribeClickEvent",function(t){var r={LEFT_UP:y.A.LEFT_UP,LEFT_DOWN:y.A.LEFT_DOWN,LEFT_CLICK:y.A.LEFT_CLICK,PINCH_START:y.A.PINCH_START,PINCH_END:y.A.PINCH_END,PINCH_MOVE:y.A.PINCH_MOVE},o=new(A().Subject),n=new(A().Subject);Object.keys(r).forEach(function(t){return e.hand.setInputAction(function(e){n.next({type:r[t],movement:e}),o.next({type:r[t],movement:e})},r[t])}),n.filter(function(e){return e.type===r.PINCH_END}).switchMap(function(){return A().Observable.of(!0).concat(A().Observable.of(!1).delay(500))}).startWith(!1).switchMap(function(e){return e?A().Observable.never():o}).filter(function(e){return e.type===r.LEFT_DOWN}).switchMap(function(e){var t=e.movement;return o.filter(function(e){return e.type===r.LEFT_CLICK}).takeUntil(A().Observable.timer(500).merge(o.filter(function(e){return e.type!==r.LEFT_UP&&e.type!==r.LEFT_CLICK||e.type===r.LEFT_UP&&(o=t&&t.position,n=e.movement&&e.movement.position,!(o&&n&&o.x===n.x&&o.y===n.y));var o,n})))}).subscribe(function(r){var o=r.movement;return e.onClick(t,o)}),e.clickStream$=o,e.pauserStream$=n}),X(e,"registerHooks",function(){e.props.hookRegister.registerHook(S.fh),e.props.hookRegister.registerHook(S.H2),e.props.hookRegister.registerHook(S.jY,function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=r.crs,n=r.duration,i=(0,_.reprojectBbox)(t,o,"EPSG:4326");if(e.map.camera.flyTo){var a=d.A.fromDegrees(i[0],i[1],i[2],i[3]);e.map.camera.flyTo({destination:a,duration:n,complete:e.updateMapInfoState})}})}),X(e,"updateMapInfoState",function(){var t=e.getCenter(),r=e.map.camera.positionCartographic,o=e.getZoomFromHeight(r.height),n={height:Math.round(e.props.standardWidth*(o+1)),width:Math.round(e.props.standardHeight*(o+1))},i=e.map.camera.computeViewRectangle();e.props.onMapViewChanges({x:t.longitude,y:t.latitude,crs:"EPSG:4326"},o,{bounds:i?{minx:u.A.toDegrees(i.west),miny:u.A.toDegrees(i.south),maxx:u.A.toDegrees(i.east),maxy:u.A.toDegrees(i.north)}:{minx:-180,miny:-90,maxx:180,maxy:90},crs:"EPSG:4326",rotation:0},n,e.props.id,e.props.projection,{cameraPosition:{longitude:u.A.toDegrees(r.longitude),latitude:u.A.toDegrees(r.latitude),height:r.height},orientation:{heading:e.map.camera.heading,pitch:e.map.camera.pitch,roll:e.map.camera.roll}},(0,S._7)()[Math.round(o)])}),X(e,"updateInteractions",function(t){var r,o=W(W({},null===(r=t.mapOptions)||void 0===r?void 0:r.interactions),!t.interactive&&{dragPan:!1,mouseWheelZoom:!1});e.map.scene.screenSpaceCameraController.enableZoom=!(!1===o.mouseWheelZoom),e.map.scene.screenSpaceCameraController.enableRotate=!(!1===o.dragPan),e.map.scene.screenSpaceCameraController.enableTranslate=!(!1===o.dragPan),e.map.scene.screenSpaceCameraController.enableTilt=!(!1===o.dragPan)}),X(e,"resetMapLighting",function(e){var t=new g.A;e.scene.light=t}),X(e,"updateLighting",function(t,r){var n,i,a=null==t||null===(n=t.mapOptions)||void 0===n?void 0:n.lighting,s=null==r||null===(i=r.mapOptions)||void 0===i?void 0:i.lighting;if(t&&!M()(a,s)){e.resetMapLighting(e.map),e._flashLightListener&&(e.map.scene.preRender.removeEventListener(e._flashLightListener),e._flashLightListener=void 0);var p=null==s?void 0:s.value;if("flashlight"===p){var u=new f.A({direction:e.map.scene.camera.directionWC,intensity:3});e.map.scene.light=u,e._flashLightListener=function(e){e.light.direction=o.A.clone(e.camera.directionWC,e.light.direction)},e.map.scene.preRender.addEventListener(e._flashLightListener)}else if("dateTime"===p){var c=(null==s?void 0:s.dateTime)||(new Date).toISOString(),d=l.A.fromDate(new Date(c));e.map.clock.shouldAnimate=!1,e.map.clock.currentTime=d}else{var m=l.A.now();e.map.clock.currentTime=m,e.map.clock.shouldAnimate=!0}}}),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&K(e,t)}(t,e),r=t,(O=[{key:"UNSAFE_componentWillMount",value:function(){this.getDocument().addEventListener("gesturestart",this.gestureStartListener)}},{key:"componentDidMount",value:function(){var e,t,r,n,i,p,l,u,c,d,v,f,g,O,P,w,A,L,C,T,E,k,j,S=this,_=document.querySelector((null===(e=this.props.mapOptions)||void 0===e||null===(e=e.attribution)||void 0===e?void 0:e.container)||"#footer-attribution-container"),I=new s.A(this.getDocument().getElementById(this.props.id),Object.assign({imageryProvider:new h.A,baseLayerPicker:!1,animation:!1,fullscreenButton:!1,geocoder:!1,homeButton:!1,infoBox:!1,sceneModePicker:!1,selectionIndicator:!1,timeline:!1,navigationHelpButton:!1,navigationInstructionsInitiallyVisible:!1,creditContainer:_||void 0,requestRenderMode:!0,maximumRenderTimeChange:1/0,skyBox:!1,scene3DOnly:!0},this.getMapOptions(this.props.mapOptions)));I.screenSpaceEventHandler.removeInputAction(y.A.LEFT_DOUBLE_CLICK),this.props.errorPanel&&(I.cesiumWidget.showErrorPanel=function(e,t,r){S.setState({renderError:{title:e,message:t,error:r}})}),this.props.registerHooks&&this.registerHooks(),!1!==(null===(t=this.props.mapOptions)||void 0===t?void 0:t.navigationTools)&&I.extend(b.A,{enableCompass:null===(j=this.props.mapOptions)||void 0===j?void 0:j.navigationTools,enableZoomControls:!1,enableDistanceLegend:!1}),I.scene.globe.baseColor=a.A.WHITE,I.imageryLayers.removeAll(),I.camera.moveEnd.addEventListener(this.updateMapInfoState),this.hand=new m.A(I.scene.canvas),this.subscribeClickEvent(I),this.hand.setInputAction(x()(this.onMouseMove.bind(this),500),y.A.MOUSE_MOVE);var D,M,F=[null!==(r=null===(n=this.props.viewerOptions)||void 0===n||null===(n=n.cameraPosition)||void 0===n?void 0:n.longitude)&&void 0!==r?r:null===(i=this.props.center)||void 0===i?void 0:i.x,null!==(p=null===(l=this.props.viewerOptions)||void 0===l||null===(l=l.cameraPosition)||void 0===l?void 0:l.latitude)&&void 0!==p?p:null===(u=this.props.center)||void 0===u?void 0:u.y,null!==(c=null===(d=this.props.viewerOptions)||void 0===d||null===(d=d.cameraPosition)||void 0===d?void 0:d.height)&&void 0!==c?c:this.getHeightFromZoom(this.props.zoom)];void 0!==F[0]&&void 0!==F[1]&&I.camera.setView({destination:(D=o.A).fromDegrees.apply(D,F),orientation:null===(M=this.props.viewerOptions)||void 0===M?void 0:M.orientation}),this.setMousePointer(this.props.mousePointer),this.map=I;var R=this.map.scene;if(this.updateInteractions(this.props),R.skyAtmosphere.show=null===(v=null===(f=this.props.mapOptions)||void 0===f?void 0:f.showSkyAtmosphere)||void 0===v||v,R.fog.enabled=null!==(g=null===(O=this.props.mapOptions)||void 0===O?void 0:O.enableFog)&&void 0!==g&&g,R.globe.showGroundAtmosphere=null!==(P=null===(w=this.props.mapOptions)||void 0===w?void 0:w.showGroundAtmosphere)&&void 0!==P&&P,R.globe.depthTestAgainstTerrain=null!==(A=null===(L=this.props.mapOptions)||void 0===L?void 0:L.depthTestAgainstTerrain)&&void 0!==A&&A,null!==(C=this.props.mapOptions)&&void 0!==C&&C.minimumZoomDistance||null!==(T=this.props.mapOptions)&&void 0!==T&&T.maximumZoomDistance){var H,U,N=null===(H=this.props.mapOptions)||void 0===H?void 0:H.minimumZoomDistance,V=null===(U=this.props.mapOptions)||void 0===U?void 0:U.maximumZoomDistance;N&&(I.scene.screenSpaceCameraController.minimumZoomDistance=N),V&&(I.scene.screenSpaceCameraController.maximumZoomDistance=V)}I.scene.screenSpaceCameraController.enableCollisionDetection=null===(E=null===(k=this.props.mapOptions)||void 0===k?void 0:k.enableCollisionDetection)||void 0===E||E,this.updateLighting({},this.props),this.forceUpdate(),I.scene.requestRender()}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){return e.mousePointer!==this.props.mousePointer&&this.setMousePointer(e.mousePointer),e.mapStateSource!==this.props.id&&this._updateMapPositionFromNewProps(e),!1}},{key:"componentDidUpdate",value:function(e){var t,r,n,i,a,s,p,l,u;if(null!==(t=this.props)&&void 0!==t&&t.orientate&&e&&!M()(this.props.orientate,null==e?void 0:e.orientate)){var c={destination:o.A.fromDegrees(parseFloat(this.props.orientate.x),parseFloat(this.props.orientate.y),this.getHeightFromZoom(parseFloat(this.props.orientate.z))),orientation:{heading:parseFloat(this.props.orientate.heading),pitch:parseFloat(this.props.orientate.pitch),roll:parseFloat(this.props.orientate.roll)}};this.map.camera.cancelFlight(),this.map.camera.flyTo(c,this.props.mapOptions.defaultFlightOptions)}e&&this.props.mapOptions.showSkyAtmosphere!==(null==e||null===(r=e.mapOptions)||void 0===r?void 0:r.showSkyAtmosphere)&&(this.map.scene.skyAtmosphere.show=this.props.mapOptions.showSkyAtmosphere),e&&this.props.mapOptions.showGroundAtmosphere!==(null==e||null===(n=e.mapOptions)||void 0===n?void 0:n.showGroundAtmosphere)&&(this.map.scene.globe.showGroundAtmosphere=this.props.mapOptions.showGroundAtmosphere),e&&this.props.mapOptions.enableFog!==(null==e||null===(i=e.mapOptions)||void 0===i?void 0:i.enableFog)&&(this.map.scene.fog.enabled=this.props.mapOptions.enableFog),e&&this.props.mapOptions.depthTestAgainstTerrain!==(null==e||null===(a=e.mapOptions)||void 0===a?void 0:a.depthTestAgainstTerrain)&&(this.map.scene.globe.depthTestAgainstTerrain=this.props.mapOptions.depthTestAgainstTerrain),e&&this.props.mapOptions.enableCollisionDetection!==(null==e||null===(s=e.mapOptions)||void 0===s?void 0:s.enableCollisionDetection)&&(this.map.scene.screenSpaceCameraController.enableCollisionDetection=null===(u=this.props.mapOptions.enableCollisionDetection)||void 0===u||u),(null==e?void 0:e.interactive)===this.props.interactive&&M()(null==e||null===(p=e.mapOptions)||void 0===p?void 0:p.interactions,null===(l=this.props)||void 0===l||null===(l=l.mapOptions)||void 0===l?void 0:l.interactions)||this.updateInteractions(this.props),this.updateLighting(e,this.props)}},{key:"componentWillUnmount",value:function(){var e;this.clickStream$.complete(),this.pauserStream$.complete(),this.hand.destroy(),this.getDocument().removeEventListener("gesturestart",this.gestureStartListener),null!==(e=this.map)&&void 0!==e&&null!==(e=e.cesiumNavigation)&&void 0!==e&&e.destroy&&this.map.cesiumNavigation.destroy(),this.map.destroy()}},{key:"getElevation",value:function(e,t){var r,o=this.map.msElevationLayers||[];return null!=o&&null!==(r=o[0])&&void 0!==r&&r.getElevation?o[0].getElevation({longitude:e,latitude:t}):void 0}},{key:"render",value:function(){var e,t=this,r=this.map,o=this.props.projection,n=r?C().Children.map(this.props.children,function(e){return e?C().cloneElement(e,{map:r,projection:o,onCreationError:t.props.onCreationError,zoom:t.props.zoom,imageryLayersTreeUpdatedCount:t.state.imageryLayersTreeUpdatedCount,onImageryLayersTreeUpdate:R()(function(){return t.setState(function(e){return{imageryLayersTreeUpdatedCount:e.imageryLayersTreeUpdatedCount+1}})},50)}):null}):null,i=this.props.errorPanel;return C().createElement("div",{id:this.props.id,style:this.props.style},n,i?C().createElement(i,{show:!!this.state.renderError,error:null===(e=this.state.renderError)||void 0===e?void 0:e.error,onReload:function(){return t.props.onReload()}}):null)}}])&&B(r.prototype,O),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,O}(C().Component);X(Q,"propTypes",{id:P().string,document:P().object,center:k.Ay.PropTypes.center,zoom:P().number.isRequired,mapStateSource:k.Ay.PropTypes.mapStateSource,projection:P().string,onMapViewChanges:P().func,onCreationError:P().func,onClick:P().func,onMouseMove:P().func,mapOptions:P().object,standardWidth:P().number,standardHeight:P().number,mousePointer:P().string,zoomToHeight:P().number,registerHooks:P().bool,hookRegister:P().object,viewerOptions:P().object,orientate:P().object,zoomControl:P().bool,errorPanel:P().func,onReload:P().func,style:P().object,interactive:P().bool}),X(Q,"defaultProps",{id:"map",onMapViewChanges:function(){},onClick:function(){},onCreationError:function(){},projection:"EPSG:3857",mapOptions:{},standardWidth:512,standardHeight:512,zoomToHeight:8e7,registerHooks:!0,hookRegister:{registerHook:S.R7},orientate:void 0,viewerOptions:{orientation:{heading:0,pitch:-1*Math.PI/2,roll:0}},onReload:function(){},interactive:!0});const J=(0,L.forwardRef)(function(e,t){var r,o,n=(r=(0,L.useState)(1),o=2,function(e){if(Array.isArray(e))return e}(r)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var o,n,i,a,s=[],p=!0,l=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;p=!1}else for(;!(p=(o=i.call(r)).done)&&(s.push(o.value),s.length!==t);p=!0);}catch(e){l=!0,n=e}finally{try{if(!p&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw n}}return s}}(r,o)||V(r,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=n[0],a=n[1];return C().createElement(Q,N({key:i,ref:t},e,{onReload:function(){return a(i+1)}}))})},770260(e,t,r){r.d(t,{Ay:()=>p,hm:()=>s});var o=r(336946),n=r(491446),i=r(433052),a=r(623e3);function s(e,t){var r=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).pickObjectsLimit,n=void 0===r?Number.MAX_VALUE:r,s=e.scene,p=e.camera,l=t.position||t.endPosition,u=s.pick(l),c=s.pickPosition(l);if(!((null==u?void 0:u.primitive)instanceof a.A)&&!((null==u?void 0:u.primitive)instanceof i.A)&&u&&c)return{cartesian:c,cartographic:o.A.fromCartesian(c),feature:u};var d,m=p.getPickRay(l),y=s.drillPickFromRay(m,n).find(function(e){var t=e.exclude,r=e.object,o=e.position;return!t&&o&&r})||null;if(y)return{cartesian:y.position,cartographic:o.A.fromCartesian(y.position),feature:null==y||null===(d=y.object)||void 0===d?void 0:d.primitive};var v=s.globe.pick(m,s);return v?{cartesian:v,cartographic:o.A.fromCartesian(v)}:{}}const p={getMouseXYZ:function(e,t){var r=e.scene,i=t.position||t.endPosition;if(!i)return null;if(e.scene.drillPick(i).find(function(e){var t;return!(!1===(null==e||null===(t=e.id)||void 0===t||null===(t=t.entityCollection)||void 0===t||null===(t=t.owner)||void 0===t?void 0:t.queryable))})){var a=r.globe.depthTestAgainstTerrain,s=r.pickTranslucentDepth;r.globe.depthTestAgainstTerrain=!0,r.pickTranslucentDepth=!0;var p=r.pickPosition(i);if(r.globe.depthTestAgainstTerrain=a,r.pickTranslucentDepth=s,p)return o.A.fromCartesian(p)}var l=e.camera.getPickRay(i),u=e.scene.globe.pick(l,e.scene),c=r._globe.ellipsoid;if(n.A(u)){var d=c.cartesianToCartographic(u),m=function(e,t){if(null!==t.position){var r=e.scene,o=r._globe.ellipsoid;return r.camera.pickEllipsoid(t.position||t.endPosition,o)}return null}(e,t);return m&&(d.height=r._globe.getHeight(d),d.cartesian=m,d.position=u),d}return null},getMouseTile:function(e,t){var r=e.scene;if(!t.position)return null;var o=e.camera.getPickRay(t.position);return e.scene.globe.pickTile(o,r)}}}}]);