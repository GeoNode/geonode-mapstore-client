/*! For license information please see layer-download.e5e0dcf5cfc82b46.chunk.js.LICENSE.txt */
(self.webpackChunkgeonode_mapstore_client=self.webpackChunkgeonode_mapstore_client||[]).push([[17004],{654456:(e,t,r)=>{"use strict";r.d(t,{GW:()=>u,IY:()=>a,Ii:()=>g,Jj:()=>y,KF:()=>l,LO:()=>O,Lk:()=>R,Lm:()=>n,MN:()=>S,Mb:()=>E,P:()=>T,Rb:()=>m,UR:()=>h,V8:()=>v,VZ:()=>x,Ve:()=>d,Xi:()=>b,Z4:()=>A,ZJ:()=>i,_Z:()=>f,cv:()=>c,f4:()=>p,jF:()=>w,oR:()=>D,pF:()=>s,qD:()=>o,qu:()=>j,x5:()=>P}),r(995531);var n="LAYER_SELECTED_FOR_SEARCH",o="FEATURE_TYPE_SELECTED",a="FEATURE_TYPE_LOADED",i="FEATURE_LOADED",l="FEATURE_LOADING",s="FEATURE_TYPE_ERROR",u="FEATURE_ERROR",c="QUERY_CREATE",p="QUERY:UPDATE_QUERY",d="QUERY_RESULT",f="QUERY_ERROR",m="RESET_QUERY",y="QUERY",v="INIT_QUERY_PANEL",b="QUERY:TOGGLE_SYNC_WMS",g="QUERY:TOGGLE_LAYER_FILTER";function O(){return{type:b}}function h(){return{type:g}}function w(){return{type:v}}function E(e,t){return{type:o,url:e,typeName:t,fields:arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],owner:arguments.length>3?arguments[3]:void 0}}function S(e,t,r){return{type:a,typeName:e,featureType:t,owner:r}}function A(e,t){return{type:s,typeName:e,error:t}}function P(e){return{type:l,isLoading:e}}function j(e,t,r,n,o){return{type:d,searchUrl:t,filterObj:r,result:e,queryOptions:n,reason:o}}function R(e){return{type:f,error:e}}function D(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.updates,r=e.reason,n=e.useLayerFilter;return{type:p,updates:t,reason:r,useLayerFilter:n}}function x(e,t,r){return{type:c,searchUrl:e,filterObj:t,owner:r}}function T(e,t,r,n){return{type:y,searchUrl:e,filterObj:t,queryOptions:r,reason:n}}},926560:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var n=r(916589),o=r(739875),a=r(509820);function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}var l=["renderPopover","popoverOptions"];function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e,t,r){return(t=function(e){var t=function(e){if("object"!=i(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=i(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==i(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const c=(0,n.compose)((0,n.withProps)((function(e){var t=e.renderPopover,r=e.popoverOptions;return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){u(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}(t?{renderPopover:t,popoverOptions:r}:{},function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(e,l))})),(0,n.branch)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.renderPopover,r=e.popoverOptions;return t&&!!r}),a.A,o.A))},509820:(e,t,r)=>{"use strict";r.d(t,{A:()=>O});var n=r(273517),o=r.n(n),a=r(551258),i=r(8117),l=r(590179),s=r.n(l),u=r(310340),c=r.n(u);function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}var d=["popoverOptions","keyProp"];function f(){return f=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},f.apply(null,arguments)}function m(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,y(n.key),n)}}function y(e){var t=function(e){if("object"!=p(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=p(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==p(t)?t:t+""}function v(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(v=function(){return!!e})()}function b(e){return b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},b(e)}function g(e,t){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},g(e,t)}const O=function(e){return function(t){function r(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),function(e,t,r){return t=b(t),function(e,t){if(t&&("object"==p(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,v()?Reflect.construct(t,r||[],b(e).constructor):t.apply(e,r))}(this,r,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&g(e,t)}(r,t),n=r,l=[{key:"render",value:function(){var t=null,r=this.props,n=r.popoverOptions,l=r.keyProp,u=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(r,d);return o().createElement("span",{className:"mapstore-info-popover"},o().createElement(e,f({},s()(u,["renderPopover","tooltipId"]),{key:l,ref:function(e){t=e}})),o().createElement(a.A,{placement:n.placement,shouldUpdatePosition:!0,show:!0,target:function(){return c().findDOMNode(t)}},o().createElement(i.AM,n.props,n.content)))}}],l&&m(n.prototype,l),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,l}(o().Component)}},628304:(e,t,r)=>{"use strict";r.d(t,{A:()=>d});var n=r(273517),o=r.n(n),a=r(8117),i=r(711030),l=["disabled","id","visible","onClick","glyph","active","className"];function s(){return s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},s.apply(null,arguments)}var u={width:0,padding:0,borderWidth:0},c={},p=function(e){return e?c:u};const d=(0,n.forwardRef)((function(e,t){var r=e.disabled,n=e.id,u=e.visible,c=e.onClick,d=e.glyph,f=e.active,m=e.className,y=void 0===m?"square-button-md":m,v=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(e,l);return o().createElement(i.A,s({ref:t},v,{bsStyle:f?"success":"primary",disabled:r,id:"fg-".concat(n),style:p(u),className:y,onClick:function(){return!r&&c()}}),o().createElement(a.e6,{glyph:d}))}))},3162:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var n=r(273517),o=r.n(n),a=r(158208);function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){u(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function u(e,t,r){return(t=function(e){var t=function(e){if("object"!=i(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=i(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==i(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.style,r=void 0===t?{}:t,n=e.mainViewStyle,i=void 0===n?{}:n,l=e.contentStyle,u=void 0===l?{}:l,c=e.imageStyle,p=void 0===c?{}:c,d=e.glyph,f=void 0===d?"info-sign":d,m=e.iconFit,y=e.title,v=e.tooltip,b=e.tooltipId,g=e.description,O=e.content;return o().createElement("div",{className:"empty-state-container",style:s({height:m?"100%":void 0},r)},o().createElement("div",{key:"main-view",className:"empty-state-main-view",style:s({height:m?"100%":void 0},i)},f?o().createElement("div",{key:"glyph",className:"empty-state-image",style:s({height:m?"100%":void 0},p)},o().createElement(a.A,{iconFit:m,tooltip:v,tooltipId:b,glyph:f})):null,y?o().createElement("h1",{key:"title"},y):null,g?o().createElement("p",{key:"description",className:"empty-state-description"},g):null),o().createElement("div",{key:"content",className:"empty-state-content",style:u},O))}},158208:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var n=r(273517),o=r.n(n),a=r(8117),i=r(993456),l=(0,r(739875).A)(a.e6);const s=function(e){var t=e.glyph,r=void 0===t?"info-sign":t,n=e.tooltip,a=e.tooltipId,s=e.iconFit,u=e.padding,c=void 0===u?0:u,p=e.margin,d=void 0===p?0:p;return o().createElement(i.A,null,(function(e){var t=e.width,i=e.height;return o().createElement(l,{glyph:r,tooltip:n,tooltipId:a,style:{display:"inline-block",padding:c+"px",margin:d+"px",textAlign:"center",fontSize:s?Math.min(t,i)-2*c-2*d:t-2*c-2*d}})}))}},551258:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});const n=(0,r(380959).A)(r(8117).hJ)},563864:(e,t,r)=>{"use strict";r.d(t,{A:()=>u});var n=r(273517),o=r.n(n),a=r(501882),i=r.n(a),l=r(916589),s=r(3162);const u=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s.A;return(0,l.branch)(e,(function(){return function(e){return o().createElement(r,t&&i()(t)?t(e):t)}}))}},348317:(e,t,r)=>{"use strict";r.d(t,{A:()=>y});var n=r(273517),o=r.n(n),a=r(605556),i=r.n(a);function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,f(n.key),n)}}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}function p(e,t){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},p(e,t)}function d(e,t,r){return(t=f(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function f(e){var t=function(e){if("object"!=l(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=l(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==l(t)?t:t+""}var m=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t,r){return t=c(t),function(e,t){if(t&&("object"==l(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,u()?Reflect.construct(t,r||[],c(e).constructor):t.apply(e,r))}(this,t,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&p(e,t)}(t,e),r=t,(n=[{key:"render",value:function(){var e=this;return o().createElement("label",{className:"mapstore-switch-btn ".concat(this.props.className)},o().createElement("input",{type:"checkbox",disabled:this.props.disabled,checked:this.props.checked,onChange:function(){return e.props.onChange(!e.props.checked)}}),o().createElement("span",{onClick:function(){return e.props.onClick(!e.props.checked)},className:"m-slider"}))}}])&&s(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n}(o().Component);d(m,"propTypes",{disabled:i().bool,className:i().string,checked:i().bool,onChange:i().func,onClick:i().func}),d(m,"defaultProps",{className:"",checked:!1,onChange:function(){},onClick:function(){}});const y=m},545567:(e,t,r)=>{"use strict";r.d(t,{EV:()=>B,Gw:()=>G,o0:()=>M,sq:()=>U});var n=r(23412),o=r.n(n),a=r(956449),i=r.n(a),l=r(499084),s=r.n(l),u=r(269843),c=r.n(u),p=r(223805),d=r.n(p),f=r(45388),m=r.n(f),y=r(738805),v=r(692114),b=r(995531),g=r(102685),O=r(112585),h=r(492312),w=r(193275),E=r(79738),S=["totalFeatures","features"],A=["sortOptions","propertyName"];function P(e){return function(e){if(Array.isArray(e))return j(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return j(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?j(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function j(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function R(e){return R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},R(e)}function D(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function x(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function T(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?x(Object(r),!0).forEach((function(t){C(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):x(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function C(e,t,r){return(t=function(e){var t=function(e){if("object"!=R(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=R(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==R(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var F=(0,w.A)({wfsVersion:"1.1.0"}),N=F.getFeature,I=F.query,L=F.sortBy,k=F.propertyName,_=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"json",a=(0,g.zD)(t,r),i=o().parse((0,E.t)(e),!0),l=d()(i.query)?i.query:{};l.service="WFS",l.outputFormat=n;var s=o().format({protocol:i.protocol,host:i.host,pathname:i.pathname,query:l});return r.layer&&"vector"===r.layer.type?m().Observable.defer((function(){return new Promise((function(e){var n,o=function(e,t){if(t.filterFields&&0!==t.filterFields.length){var r=e.features.filter((0,g.Jt)(t));e.features=r,e.numberMatched=r.length,e.numberReturned=r.length,e.totalFeatures=r.length}return t.sortOptions&&t.sortOptions.sortBy&&t.sortOptions.sortOrder&&"NONE"!==t.sortOptions.sortOrder&&e.features.sort((function(e,r){var n=e.properties[t.sortOptions.sortBy],o=r.properties[t.sortOptions.sortBy],a=n.toLowerCase().localeCompare(o.toLowerCase());return"ASC"===t.sortOptions.sortOrder?a:-1*a})),e}({crs:{type:"name",properties:{name:"urn:ogc:def:crs:EPSG::4326"}},numberMatched:(n=r.layer.features).length,numberReturned:n.length,timeStamp:"2020-07-20T11:36:20.118Z",totalFeatures:n.length,type:"FeatureCollection",features:n},t);e(o)}))})):{data:a,queryString:s}},M=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0;if(r.layer&&"vector"===r.layer.type)return _(e,t,r,n);var o=_(e,t,r,n),a=o.data,i=o.queryString;return m().Observable.defer((function(){return b.A.post(i,a,{timeout:6e4,responseType:"arraybuffer",headers:{Accept:"application/xml","Content-Type":"application/xml"}})}))},W=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(r.layer&&"vector"===r.layer.type)return _(e,t,r);var n=_(e,t,r),o=n.data,a=n.queryString;return m().Observable.defer((function(){return b.A.post(a,o,T({timeout:6e4,headers:{Accept:"application/json","Content-Type":"application/xml"}},null==r?void 0:r.requestOptions))})).let(h.m9).map((function(e){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.totalFeatures,r=e.features,n=D(e,S),o=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).startIndex,a=arguments.length>2?arguments[2]:void 0;return a>t&&a===o+r.length&&t===r.length?T(T({},n),{},{features:r,totalFeatures:a}):T(T({},n),{},{features:r,totalFeatures:t})}(e.data,function(){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).pagination||!c()(e.startIndex)&&!c()(e.maxFeatures)&&{startIndex:e.startIndex,maxFeatures:e.maxFeatures}}(t,r),r.totalFeatures)}))},G=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.search,r=void 0===t?{}:t,n=e.url,o=e.name,a=arguments.length>1?arguments[1]:void 0,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},u=l.sortOptions,c=l.propertyName,p=D(l,A);return W(r.url||n,a&&"object"===R(a)?T(T({},a),{},{typeName:o||a.typeName}):N(I(o,[].concat(P(u?[L(u.sortBy,u.sortOrder)]:[]),P(c?[k(c)]:[]),P(a?s()(a):[]))),p),p).catch((function(e){if("OGCError"===e.name&&"NoApplicableCode"===e.code&&!u&&c&&c[0])return W(r.url||n,a&&"object"===R(a)?T(T({},a),{},{typeName:o||a.typeName}):N(I(o,[L(i()(c)?c[0]:c)].concat(P(c?[k(c)]:[]),P(a?s()(a):[]))),p),p);throw e}))},U=function(e){var t=e.layer;return m().Observable.defer((function(){return b.A.get(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.name,r=e.search,n=void 0===r?{}:r,a=e.url,i=e.describeFeatureTypeURL,l=o().parse((0,E.t)(i||n.url||a),!0);return o().format(T(T({},l),{},{search:void 0,query:T(T({},l.query),{},{service:"WFS",version:"1.1.0",typeName:t,outputFormat:"application/json",request:"DescribeFeatureType"})}))}(t))})).let(h.m9)},B=function(e){var t=e.layer;return m().Observable.defer((function(){return b.A.get(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.name,r=e.search,n=void 0===r?{}:r,a=e.url,i=(0,O.wk)({name:t,url:n&&n.url||a}),l=o().parse(i,!0);return o().format(T(T({},l),{},{search:void 0,query:T(T({},l.query),{},{service:"WFS",version:"1.1.1",request:"GetCapabilities"})}))}(t))})).let(h.m9).switchMap((function(e){return m().Observable.bindNodeCallback((function(e,t){return(0,y.parseString)(e,{tagNameProcessors:[v.stripPrefix],explicitArray:!1,mergeAttrs:!0},t)}))(e.data)}))}},909309:(e,t,r)=>{"use strict";r.d(t,{l:()=>l});var n=r(45388),o=r(995531),a=r(492312),i=r(325177),l=function(e,t){return n.Observable.defer((function(){return o.A.get((0,i.Sd)(e,{version:"1.0.0",REQUEST:"DescribeProcess",IDENTIFIER:t}),{timeout:5e3,headers:{Accept:"application/json","Content-Type":"application/xml"}})})).let(a.m9)}},37916:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>xr});var n={};r.r(n),r.d(n,{checkExportDataEntriesEpic:()=>yr,checkWPSAvailabilityEpic:()=>ur,closeExportDownload:()=>fr,fetchFormatsWFSDownload:()=>pr,openDownloadTool:()=>cr,resetExportDataResultsOnLogout:()=>br,serializeCookieOnExportDataChange:()=>vr,setExportDataResultsOnLoginSuccessAndMapConfigLoaded:()=>gr,showInfoBubbleMessageEpic:()=>mr,startFeatureExportDownload:()=>dr});var o=r(273517),a=r.n(o),i=r(811668),l=r(801081),s="LAYERDOWNLOAD:CHECK_WPS_AVAILABILITY",u="LAYERDOWNLOAD:CHECKING_WPS_AVAILABILITY",c="LAYERDOWNLOAD:DOWNLOAD_FEATURES",p="LAYERDOWNLOAD:DOWNLOAD_FINISHED",d="LAYERDOWNLOAD:FORMAT_SELECTED",f="LAYERDOWNLOAD:CLEAR_DOWNLOAD_OPTIONS",m="LAYERDOWNLOAD:FORMAT_FETCH",y="LAYERDOWNLOAD:FORMAT_UPDATE",v="LAYERDOWNLOAD:SET_WPS_AVAILABLE",b="LAYERDOWNLOAD:SET_SERVICE",g="LAYERDOWNLOAD:SET_EXPORT_DATA_RESULTS",O="LAYERDOWNLOAD:ADD_EXPORT_DATA_RESULT",h="LAYERDOWNLOAD:UPDATE_EXPORT_DATA_RESULT",w="LAYERDOWNLOAD:REMOVE_EXPORT_DATA_RESULT",E="LAYERDOWNLOAD:REMOVE_EXPORT_DATA_RESULTS",S="LAYERDOWNLOAD:CHECK_EXPORT_DATA_ENTRIES",A="LAYERDOWNLOAD:CHECKING_EXPORT_DATA_ENTRIES",P="LAYERDOWNLOAD:SERIALIZE_COOKIE",j="LAYERDOWNLOAD:SHOW_INFO_BUBBLE_MESSAGE",R="LAYERDOWNLOAD:SHOW_INFO_BUBBLE",D="LAYERDOWNLOAD:SET_INFO_BUBBLE_MESSAGE",x=function(e){return{type:u,checking:e}},T=function(e,t){return{type:d,key:e,value:t}},C=function(){return{type:p}},F=function(e){return{type:v,value:e}},N=function(e){return{type:b,service:e}},I=function(e){return{type:g,results:e}},L=function(e,t){return{type:h,id:e,newProps:t}},k=function(e){return{type:A,checking:e}},_=function(e,t,r,n){return{type:j,msgId:e,msgParams:t,level:r,duration:n}},M=function(e){return{type:R,show:e}},W=r(415392),G=r(904059),U=r(401631),B=r(307679),Y=r(806653),V=function(e){var t;return null==e||null===(t=e.layerdownload)||void 0===t?void 0:t.service},q=(0,l.Mz)(U.py,Y.fQ,B.ZT,(function(e,t,r){return e?t:null!=r&&r.name?{featureTypeName:r.name,filterType:"OGC",ogcVersion:"1.1.0"}:null})),H=function(e){var t;return null==e||null===(t=e.layerdownload)||void 0===t?void 0:t.results},X=r(286447),z=r(605556),K=r.n(z),Z=r(324713),J=r.n(Z),$=r(45228),Q=r.n($),ee=r(8117),te=r(750042),re=r.n(te),ne=r(275705),oe=r(711520),ae=r(406250),ie=r(8571),le=r(3162),se=r(192016),ue=r(858156),ce=r.n(ue),pe=r(400912),de=r.n(pe),fe=r(185015),me=r.n(fe),ye=r(348317);function ve(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}const be=function(e){var t,r,n=e.cropDataSetVisible,o=void 0!==n&&n,i=e.cropDataSetEnabled,l=void 0!==i&&i,s=e.donwloadFilteredVisible,u=void 0!==s&&s,c=e.downloadFilteredEnabled,p=void 0!==c&&c,d=e.advancedOptionsVisible,f=void 0!==d&&d,m=e.compressionOptions,y=void 0===m?["CCITT RLE","LZW","JPEG","ZLib","PackBits","Deflate"]:m,v=e.selectedCompression,b=e.tileWidth,g=e.tileHeight,O=e.quality,h=e.onChange,w=void 0===h?function(){}:h,E=(t=a().useState(!1),r=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,l=[],s=!0,u=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=a.call(r)).done)&&(l.push(n.value),l.length!==t);s=!0);}catch(e){u=!0,o=e}finally{try{if(!s&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw o}}return l}}(t,r)||function(e,t){if(e){if("string"==typeof e)return ve(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ve(e,t):void 0}}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),S=E[0],A=E[1];return a().createElement(a().Fragment,null,o&&a().createElement("div",{className:"mapstore-downloadwpsoptions-menuitem"},a().createElement(ye.A,{checked:l,onClick:function(e){return w("cropDataSet",e)}}),a().createElement(ie.A,{msgId:"layerdownload.cropDataSet"})),u&&a().createElement("div",{className:"mapstore-downloadwpsoptions-menuitem"},a().createElement(ye.A,{checked:p,onClick:function(e){return w("downloadFilteredDataSet",e)}}),a().createElement(ie.A,{msgId:"layerdownload.downloadFilteredDataSet"})),f&&a().createElement("div",{className:"mapstore-downloadwpsoptions-advanced-options"},a().createElement(ee.$n,{className:"no-border",onClick:function(){return A(!S)}},a().createElement(ee.e6,{glyph:"chevron-".concat(S?"down":"right")})),a().createElement(ie.A,{msgId:"layerdownload.advancedOptions"})),S&&f&&a().createElement("div",{className:"mapstore-downloadwpsoptions-advanced"},a().createElement("div",{className:"mapstore-downloadwpsoptions-advanced-menuitem"},a().createElement(ie.A,{msgId:"layerdownload.compression"}),a().createElement(se.Ay,{clearable:!0,value:v,options:y.map((function(e){return me()(e)?{value:e,label:e}:e})),onChange:function(e){return w("compression",null==e?void 0:e.value)}})),a().createElement("div",{className:"mapstore-downloadwpsoptions-advanced-menuitem"},a().createElement(ie.A,{msgId:"layerdownload.quality"}),a().createElement("div",{className:"mapstore-downloadwpsoptions-advanced-menuitem-control"},a().createElement(ee.MJ,{placeholder:"0.75",type:"number",min:"0",max:"1",value:O||"",onChange:function(e){return w("quality",e.target.value)}}))),a().createElement("div",{className:"mapstore-downloadwpsoptions-advanced-menuitem"},a().createElement(ie.A,{msgId:"layerdownload.tileWidth"}),a().createElement("div",{className:"mapstore-downloadwpsoptions-advanced-menuitem-control"},a().createElement(ee.MJ,{placeholder:"256",type:"number",min:"0",value:b||"",onChange:function(e){return w("tileWidth",e.target.value&&e.target.value.length>0?"".concat(parseInt(e.target.value,10)):"")}}),a().createElement("span",null,"px"))),a().createElement("div",{className:"mapstore-downloadwpsoptions-advanced-menuitem"},a().createElement(ie.A,{msgId:"layerdownload.tileHeight"}),a().createElement("div",{className:"mapstore-downloadwpsoptions-advanced-menuitem-control"},a().createElement(ee.MJ,{placeholder:"256",type:"number",min:"0",value:g||"",onChange:function(e){return w("tileHeight",e.target.value&&e.target.value.length>0?"".concat(parseInt(e.target.value,10)):"")}}),a().createElement("span",null,"px")))))};function ge(e){return ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ge(e)}function Oe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ae(n.key),n)}}function he(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(he=function(){return!!e})()}function we(e){return we=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},we(e)}function Ee(e,t){return Ee=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ee(e,t)}function Se(e,t,r){return(t=Ae(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ae(e){var t=function(e){if("object"!=ge(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=ge(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ge(t)?t:t+""}var Pe=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Se(r=function(e,t,r){return t=we(t),function(e,t){if(t&&("object"==ge(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,he()?Reflect.construct(t,r||[],we(e).constructor):t.apply(e,r))}(this,t,[e]),"getSelectedFormat",(function(){return ce()(r.props,"downloadOptions.selectedFormat")})),Se(r,"getSelectedSRS",(function(){return ce()(r.props,"downloadOptions.selectedSrs")||r.props.defaultSrs||ce()(de()(r.props.srsList),"name")})),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ee(e,t)}(t,e),r=t,(n=[{key:"render",value:function(){var e,t=this;return a().createElement("form",null,!this.props.hideServiceSelector&&this.props.wpsAvailable&&this.props.wfsAvailable&&a().createElement(a().Fragment,null,a().createElement("label",null,a().createElement(ie.A,{msgId:"layerdownload.service"})),a().createElement(se.Ay,{clearable:!1,value:this.props.service,onChange:function(e){return t.props.setService(e.value)},options:this.props.services})),a().createElement("label",null,a().createElement(ie.A,{msgId:"layerdownload.format"})),a().createElement(se.Ay,{clearable:!1,isLoading:this.props.formatsLoading,onOpen:function(){return t.props.formatOptionsFetch(t.props.layer)},value:null===(e=this.props.downloadOptions)||void 0===e?void 0:e.selectedFormat,noResultsText:a().createElement(ie.A,{msgId:"layerdownload.format"}),onChange:function(e){return t.props.onChange("selectedFormat",e.value)},options:this.props.formats.map((function(e){return{value:e.name,label:e.label||e.name}}))}),a().createElement("label",null,a().createElement(ie.A,{msgId:"layerdownload.srs"})),a().createElement(se.Ay,{clearable:!1,value:this.getSelectedSRS(),onChange:function(e){return t.props.onChange("selectedSrs",e.value)},options:this.props.srsList.map((function(e){return{value:e.name,label:e.label||e.name}}))}),this.props.wpsOptionsVisible&&a().createElement(be,{cropDataSetVisible:!0,donwloadFilteredVisible:this.props.downloadFilteredVisible,advancedOptionsVisible:this.props.wpsAdvancedOptionsVisible,cropDataSetEnabled:this.props.downloadOptions.cropDataSet,downloadFilteredEnabled:this.props.downloadOptions.downloadFilteredDataSet,selectedCompression:this.props.downloadOptions.compression,quality:this.props.downloadOptions.quality,tileWidth:this.props.downloadOptions.tileWidth,tileHeight:this.props.downloadOptions.tileHeight,onChange:this.props.onChange}),this.props.virtualScroll?null:a().createElement(ee.Sc,{checked:this.props.downloadOptions.singlePage,onChange:function(){return t.props.onChange("singlePage",!t.props.downloadOptions.singlePage)}},a().createElement(ie.A,{msgId:"layerdownload.downloadonlycurrentpage"})))}}])&&Oe(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n}(a().Component);Se(Pe,"propTypes",{wpsAvailable:K().bool,wfsAvailable:K().bool,service:K().string,downloadOptions:K().object,formatOptionsFetch:K().func,formats:K().array,srsList:K().array,setService:K().func,onChange:K().func,defaultSrs:K().string,wpsOptionsVisible:K().bool,wpsAdvancedOptionsVisible:K().bool,downloadFilteredVisible:K().bool,layer:K().object,formatsLoading:K().bool,virtualScroll:K().bool,services:K().arrayOf(K().object),hideServiceSelector:K().bool}),Se(Pe,"defaultProps",{wpsAvailable:!1,wfsAvailable:!0,service:"wps",downloadOptions:{},formatsLoading:!1,formats:[],srsList:[],wpsOptionsVisible:!1,wpsAdvancedOptionsVisible:!1,downloadFilteredVisible:!1,virtualScroll:!0,services:[{value:"wps",label:"WPS"},{value:"wfs",label:"WFS"}],hideServiceSelector:!1});const je=Pe;var Re=r(711030),De=r(525859);function xe(e){return xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xe(e)}function Te(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Le(n.key),n)}}function Ce(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Ce=function(){return!!e})()}function Fe(e){return Fe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Fe(e)}function Ne(e,t){return Ne=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ne(e,t)}function Ie(e,t,r){return(t=Le(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Le(e){var t=function(e){if("object"!=xe(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=xe(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==xe(t)?t:t+""}var ke=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return Ie(e=function(e,t,r){return t=Fe(t),function(e,t){if(t&&("object"==xe(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Ce()?Reflect.construct(t,r||[],Fe(e).constructor):t.apply(e,r))}(this,t,[].concat(n)),"onClose",(function(){e.props.onClose()})),Ie(e,"renderIcon",(function(){return e.props.loading?a().createElement("div",{style:{float:"left"}},a().createElement(re(),{spinnerName:"circle",noFadeIn:!0})):a().createElement(ee.e6,{glyph:"download"})})),Ie(e,"handleExport",(function(){var t=e.props,r=t.url,n=t.filterObj,o=t.downloadOptions,a=t.defaultSrs,i=t.srsList,l=t.onExport,s=t.layer,u=t.attributes,c=t.customAttributeSettings,p=o&&o.selectedSrs||a||(i[0]||{}).name,d=(0,De.Eo)(u,c);l(r||s.url,n,Q()({},o,{selectedSrs:p},{propertyName:d}))})),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ne(e,t)}(t,e),r=t,(n=[{key:"componentDidUpdate",value:function(e){this.props.enabled!==e.enabled&&this.props.enabled&&(this.props.onClearDownloadOptions(),"wms"===this.props.layer.type&&this.props.onCheckWPSAvailability(this.props.url||this.props.layer.url,this.props.defaultSelectedService))}},{key:"render",value:function(){var e,t,r,n=this,o=function(e){return n.props.formats.filter((function(t){var r,o,a=t.validServices,i=t.type,l=void 0===i?"vector":i;return(!a||J()(a,(function(t){return t===e}))>-1)&&("vector"===l&&(null===(r=n.props.layer.search)||void 0===r?void 0:r.url)||"raster"===l&&!(null!==(o=n.props.layer.search)&&void 0!==o&&o.url))}))},i=o("wfs"),l=o("wps"),s=i.length>0?i.filter((function(e){return n.props.wfsFormats.find((function(t){return t.name.toLowerCase()===e.name.toLowerCase()}))})):this.props.wfsFormats,u=Boolean(null===(e=this.props.layer.search)||void 0===e?void 0:e.url);return this.props.enabled?a().createElement(ae.A,null,a().createElement(oe.A,{id:"mapstore-export",draggable:!1,modal:!0},a().createElement("span",{role:"header"},a().createElement("span",{className:"about-panel-title"},a().createElement(ie.A,{msgId:"layerdownload.title"})),a().createElement("button",{onClick:this.onClose,className:"settings-panel-close close"},this.props.closeGlyph?a().createElement(ee.e6,{glyph:this.props.closeGlyph}):a().createElement("span",null,"×"))),a().createElement("div",{role:"body"},this.props.checkingWPSAvailability?a().createElement(ne.A,{size:100,style:{margin:"0 auto"}}):this.props.wpsAvailable||u?a().createElement(je,{wpsAvailable:this.props.wpsAvailable,wfsAvailable:u,service:this.props.service,downloadOptions:this.props.downloadOptions,setService:this.props.setService,onChange:this.props.onDownloadOptionChange,formatOptionsFetch:"wfs"===this.props.service?this.props.onFormatOptionsFetch:function(){},formatsLoading:this.props.formatsLoading,formats:"wfs"===this.props.service?s:l,srsList:this.props.srsList,defaultSrs:this.props.defaultSrs,wpsOptionsVisible:"wps"===this.props.service,wpsAdvancedOptionsVisible:!(null!==(t=this.props.layer.search)&&void 0!==t&&t.url),downloadFilteredVisible:!(null===(r=this.props.layer.search)||void 0===r||!r.url),layer:this.props.layer,virtualScroll:this.props.virtualScroll,customAttributesSettings:this.props.customAttributeSettings,attributes:this.props.attributes,hideServiceSelector:this.props.hideServiceSelector}):a().createElement(le.A,{title:a().createElement(ie.A,{msgId:"layerdownload.noSupportedServiceFound"})})),!this.props.checkingWPSAvailability&&a().createElement("div",{role:"footer"},a().createElement(Re.A,{bsStyle:"primary",className:"download-button",disabled:!this.props.downloadOptions.selectedFormat||this.props.loading,onClick:this.handleExport},this.renderIcon()," ",a().createElement(ie.A,{msgId:"layerdownload.export"}))))):null}}])&&Te(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n}(a().Component);Ie(ke,"propTypes",{filterObj:K().object,closeGlyph:K().string,url:K().string,wpsAvailable:K().bool,service:K().string,defaultSelectedService:K().string,enabled:K().bool,loading:K().bool,checkingWPSAvailability:K().bool,onClose:K().func,onExport:K().func,onCheckWPSAvailability:K().func,setService:K().func,onDownloadOptionChange:K().func,onClearDownloadOptions:K().func,onFormatOptionsFetch:K().func,downloadOptions:K().object,wfsFormats:K().array,formats:K().array,srsList:K().array,defaultSrs:K().string,layer:K().object,formatsLoading:K().bool,virtualScroll:K().bool,customAttributeSettings:K().object,attributes:K().array,hideServiceSelector:K().bool}),Ie(ke,"defaultProps",{onExport:function(){},onClose:function(){},onCheckWPSAvailability:function(){},setService:function(){},onDownloadOptionChange:function(){},onClearDownloadOptions:function(){},onFormatOptionsFetch:function(){},checkingWPSAvailability:!1,layer:{},closeGlyph:"1-close",wpsAvailable:!1,service:"wfs",defaultSelectedService:"wps",wfsFormats:[],formats:[{name:"application/json",label:"GeoJSON",type:"vector",validServices:["wps"]},{name:"application/arcgrid",label:"ArcGrid",type:"raster",validServices:["wps"]},{name:"image/tiff",label:"TIFF",type:"raster",validServices:["wps"]},{name:"application/wfs-collection-1.0",label:"wfs-collection-1.0",type:"vector",validServices:["wps"]},{name:"application/wfs-collection-1.1",label:"wfs-collection-1.1",type:"vector",validServices:["wps"]},{name:"application/zip",label:"Shapefile",type:"vector",validServices:["wps"]},{name:"text/csv",label:"CSV",type:"vector",validServices:["wps"]}],formatsLoading:!1,srsList:[{name:"native",label:"Native"},{name:"EPSG:4326",label:"WGS84"}],virtualScroll:!0,downloadOptions:{},hideServiceSelector:!1});const _e=ke;var Me=r(563864),We=r(306840),Ge=r(112585),Ue=a().createElement(ee.$n,{bsStyle:"primary",bsSize:"small",className:"mapstore-exportdataresults-item-failed"},a().createElement(ee.e6,{glyph:"exclamation-sign"}));const Be=(0,Me.A)((function(e){var t=e.results;return!(void 0===t?[]:t).length}),{title:a().createElement(ie.A,{msgId:"exportDataResults.emptyStateMessage"})})((function(e){var t=e.loading,r=void 0!==t&&t,n=e.results,o=void 0===n?[]:n,i=e.currentLocale,l=e.onRemoveResult,s=void 0===l?function(){}:l;return r?a().createElement(ne.A,{size:100,style:{margin:"0 auto",padding:"10px"}}):a().createElement("div",{className:"mapstore-exportdataresults-container"},o.map((function(e){var t=e.id,r=e.layerName,n=e.layerTitle,o=e.startTime,l=e.status,u=e.result,c=(0,Ge.ez)({name:r,title:n},i),p=new Date(o),d=function(e){return e<10?"0".concat(e):"".concat(e)},f="".concat(d(p.getDate()),"/").concat(d(p.getMonth()+1),"/").concat(p.getFullYear()," ").concat(d(p.getHours()),":").concat(d(p.getMinutes()));return a().createElement("div",{key:t,className:"mapstore-exportdataresults-item"},a().createElement("div",{className:"mapstore-exportdataresults-item-name"},c),a().createElement("div",{className:"mapstore-exportdataresults-item-date"},f),a().createElement("div",{className:"mapstore-exportdataresults-item-buttons"},"pending"===l&&a().createElement(ne.A,{size:22,style:{marginLeft:"2px"}}),"failed"===l&&u&&u.msgId?a().createElement(We.A,{placement:"top",overlay:a().createElement(ee.m_,{id:"exportresults-failure-tooltip"},a().createElement(ie.A,{msgId:u.msgId,msgParams:u.msgParams}))},Ue):null,"failed"!==l||u&&u.msgId?null:Ue,"completed"===l&&a().createElement("a",{href:u,target:"_blank",rel:"noopener noreferrer"},a().createElement(ee.$n,{bsStyle:"primary",bsSize:"small"},a().createElement(ee.e6,{glyph:"floppy-disk"}))),a().createElement(ee.$n,{bsStyle:"primary",bsSize:"small",onClick:function(){return s(t)}},a().createElement(ee.e6,{glyph:"trash"}))))})))}));var Ye=r(32485),Ve=r.n(Ye);function qe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}const He=function(e){var t,r=e.show,n=e.arrowDirection,o=void 0===n?"bottom":n,i=e.className,l=e.containerClassName,s=e.children;return a().createElement("div",{className:Ve().apply(void 0,["mapstore-info-bubble"].concat((t=r?["mapstore-info-bubble-visible"]:[],function(e){if(Array.isArray(e))return qe(e)}(t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return qe(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?qe(e,t):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),[i]))},a().createElement("div",{className:Ve()("mapstore-info-bubble-container",l)},a().createElement("div",{className:Ve()("mapstore-info-bubble-arrow-container","arrow-".concat(o))},a().createElement("div",{className:"mapstore-info-bubble-arrow"})),a().createElement("div",{className:"mapstore-info-bubble-inner"},s)))},Xe=function(e){var t=e.msgId,r=e.msgParams,n=e.level,o=void 0===n?"normal":n,i=e.className;return a().createElement("div",{className:Ve()("mapstore-info-bubble-default-inner","mapstore-info-bubble-default-inner-level-".concat(o),i)},t?a().createElement(ie.A,{msgId:t,msgParams:r}):null)};var ze=r(926560),Ke=r(628304),Ze=(0,ze.A)(Ke.A),Je=r(45388),$e=r.n(Je),Qe=r(907309),et=r.n(Qe),tt=r(244383),rt=r.n(tt),nt=r(318938),ot=r.n(nt),at=r(499084),it=r.n(at),lt=r(791936),st=r(738805),ut=r(692114),ct=r(541033),pt=r.n(ct),dt=r(980971),ft=r(654456),mt=r(883832),yt=r(754364),vt=r(538704),bt=r(130711),gt=r(131127),Ot=r(501719),ht=r(545567),wt=r(909309),Et=r(395950),St=r.n(Et),At=r(590179),Pt=r.n(At),jt=r(325177),Rt=r(264053);function Dt(e){return Dt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Dt(e)}function xt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Tt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?xt(Object(r),!0).forEach((function(t){Ct(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ct(e,t,r){return(t=function(e){var t=function(e){if("object"!=Dt(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=Dt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Dt(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ft(e){return function(e){if(Array.isArray(e))return It(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Nt(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Nt(e,t){if(e){if("string"==typeof e)return It(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?It(e,t):void 0}}function It(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var Lt=function(e){var t=e.type,r=e.data;return"TEXT"===t?(0,jt.oW)((0,jt.Xs)((0,jt.Gr)(r.data),r.mimeType)):(0,jt.Nj)(r.mimeType,r.href,r.method,(0,jt.Gr)(r.requestBodyData))},kt=function(e,t,r){if(e&&t){var n=(0,Rt.p4)(e,(l=(i={layerName:t.layerName,ROI:t.ROI,roiCRS:t.roiCRS,dataFilter:t.dataFilter,targetCRS:t.targetCRS}).layerName,s=i.ROI,u=i.roiCRS,c=i.dataFilter,p=i.targetCRS,(0,Rt.Yy)("gs:DownloadEstimator",[(0,jt.XH)("layerName",(0,jt.oW)((0,jt.mC)(l)))].concat(Ft(s?[(0,jt.XH)("ROI",Lt(s))]:[]),Ft(u?[(0,jt.XH)("RoiCRS",(0,jt.oW)((0,jt.mC)(u)))]:[]),Ft(c?[(0,jt.XH)("filter",Lt(c))]:[]),Ft(p?[(0,jt.XH)("targetCRS",(0,jt.oW)((0,jt.mC)(p)))]:[])))),{outputsExtractor:(0,Rt.$t)(Rt.J7)}),o=t.resultOutput||t.outputFormat||"application/zip",a=(0,Rt.p4)(e,function(e){var t=e.layerName,r=e.dataFilter,n=e.outputFormat,o=e.targetCRS,a=e.roiCRS,i=e.ROI,l=e.cropToROI,s=e.asynchronous,u=e.outputAsReference,c=e.resultOutput,p=e.writeParameters;return(0,Rt.Yy)("gs:Download",[(0,jt.XH)("layerName",(0,jt.oW)((0,jt.mC)(t))),(0,jt.XH)("outputFormat",(0,jt.oW)((0,jt.mC)(n)))].concat(Ft(i?[(0,jt.XH)("ROI",Lt(i))]:[]),Ft(r?[(0,jt.XH)("filter",Lt(r))]:[]),Ft(o?[(0,jt.XH)("targetCRS",(0,jt.oW)((0,jt.mC)(o)))]:[]),Ft(a?[(0,jt.XH)("RoiCRS",(0,jt.oW)((0,jt.mC)(a)))]:[]),[(0,jt.XH)("cropToROI",(0,jt.oW)((0,jt.mC)(l?"true":"false")))],Ft(p&&St()(p).length>0?[(0,jt.Xk)(ot()(p).map((function(e){var t,r,n=(r=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,l=[],s=!0,u=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=a.call(r)).done)&&(l.push(n.value),l.length!==t);s=!0);}catch(e){u=!0,o=e}finally{try{if(!s&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw o}}return l}}(t,r)||Nt(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=n[0],a=n[1];return(0,jt._y)(o,a)})).join(""))]:[])),(0,jt.mk)(s?(0,jt.ru)(!0,!0,u?(0,jt.Xi)(c,!0,"result"):(0,jt.Cs)("result",c)):(0,jt.Cs)("result",c)))}(Tt(Tt({},Pt()(t,"notifyDownloadEstimatorSuccess","attribute")),{},{outputAsReference:!!t.asynchronous&&t.outputAsReference,resultOutput:o})),r,{headers:{"Content-Type":"application/xml",Accept:"application/xml, ".concat(o)}});return n.catch((function(){throw new Error("DownloadEstimatorException")})).mergeMap((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(e.length>0&&"result"===e[0].identifier&&"true"===e[0].data)return t.notifyDownloadEstimatorSuccess?Je.Observable.of("DownloadEstimatorSuccess").concat(a):a;throw new Error("DownloadEstimatorFailed")}))}var i,l,s,u,c,p;return Je.Observable.empty()},_t=r(102685),Mt=r(564116),Wt=r(764932),Gt=r(492312),Ut=r(193275),Bt=r(184435),Yt=r(112206);function Vt(e){return Vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Vt(e)}function qt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ht(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?qt(Object(r),!0).forEach((function(t){Xt(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):qt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Xt(e,t,r){return(t=function(e){var t=function(e){if("object"!=Vt(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=Vt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Vt(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function zt(e){return function(e){if(Array.isArray(e))return Zt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Kt(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Kt(e,t){if(e){if("string"==typeof e)return Zt(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Zt(e,t):void 0}}function Zt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var Jt={gml3:"GML3.1",GML2:"GML2","DXF-ZIP":"DXF-ZIP","application/vnd.google-earth.kml+xml":"KML","OGR-CSV":"OGR-CSV","OGR-FileGDB":"OGR-GeoDatabase","OGR-GPKG":"OGR-GeoPackage","OGR-KML":"OGR-KML","OGR-MIF":"OGR-MIF","OGR-TAB":"OGR-TAB","SHAPE-ZIP":"Shapefile",gml32:"GML3.2","application/json":"GeoJSON",csv:"CSV","application/x-gpkg":"GeoPackage",excel:"excel",excel2007:"excel2007"},$t=(0,Ut.A)({wfsVersion:"1.1.0"}),Qt=$t.getFeature,er=$t.query,tr=$t.sortBy,rr=$t.propertyName,nr=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=null!==(e=null==t?void 0:t.params)&&void 0!==e?e:{};return null==r?void 0:r[Object.keys(r).find((function(e){return"cql_filter"===(null==e?void 0:e.toLowerCase())}))]},or=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.url,r=e.filterObj,n=void 0===r?{}:r,o=e.layerFilter,a=e.layer,i=e.downloadOptions,l=void 0===i?{}:i,s=e.options,u=s.sortOptions,c=s.propertyNames,p=nr(a),d=(0,_t.o2)({ogcVersion:"1.1.0",addXmlnsToRoot:!0,xmlnsToAdd:['xmlns:ogc="http://www.opengis.net/ogc"','xmlns:gml="http://www.opengis.net/gml"']},o,n,p);return(0,ht.o0)(t,Qt(er(n.featureTypeName,[].concat(zt(u?[tr(u.sortBy,u.sortOrder)]:[]),zt(c?[rr(c)]:[]),zt(d?it()(d):[])),{srsName:l.selectedSrs})),s,l.selectedFormat)},ar=function(e){var t=ce()(e,"filterObj.featureTypeName"),r=(0,Mt.ic)(ce()(e,"downloadOptions.selectedFormat"));return r&&r.extension?t+"."+r.extension:t},ir=function(e){return e.query&&e.query.featureTypes&&e.query.featureTypes[e.query.typeName]&&e.query.featureTypes[e.query.typeName].attributes&&e.query.featureTypes[e.query.typeName].attributes[0]&&e.query.featureTypes[e.query.typeName].attributes[0].attribute||null},lr=function(e){switch(e.code){case"ProcessFailed":return{msgId:"layerdownload.wpsExecuteError.processFailed",msgParams:{exceptionReport:e.message}};case"NoStatusLocation":case"NoExecutionId":case"UnexpectedProcessStatus":return{msgId:"layerdownload.wpsExecuteError.badResponse",msgParams:{eCode:e.code}};case"ExecuteProcessXHRFailed":return{msgId:"layerdownload.wpsExecuteError.executeProcessXhrFailed"};case"GetExecutionStatusXHRFailed":return{msgId:"layerdonwload.wpsExecuteError.getExecutionStatusXhrFailed"};default:return{msgId:"layerdownload.wpsExecuteError.unexpectedError"}}},sr=function(e){var t=(0,Ot.dt)(e);if(null!=t&&t.id){var r=document.cookie.split(";").filter((function(e){return e.indexOf("exportDataResults_".concat(t.id,"="))>-1}))[0];if(r){var n=JSON.parse(decodeURIComponent(r.split("=")[1])).results;return $e().Observable.of(I(n.filter((function(e){return"pending"!==e.status}))))}}return $e().Observable.empty()},ur=function(e,t){return e.ofType(s).switchMap((function(e){var r=e.url,n=e.selectedService;return(0,wt.l)(r,"gs:DownloadEstimator,gs:Download").switchMap((function(e){return $e().Observable.defer((function(){return new Promise((function(t,r){return(0,st.parseString)(e.data,{tagNameProcessors:[ut.stripPrefix]},(function(e,n){return e?r(e):t(n)}))}))}))})).flatMap((function(e){var r,o,a,i=t.getState(),l=(0,B.ZT)(i),s=[null==e||null===(r=e.ProcessDescriptions)||void 0===r||null===(r=r.ProcessDescription)||void 0===r||null===(r=r[0])||void 0===r||null===(r=r.Identifier)||void 0===r?void 0:r[0],null==e||null===(o=e.ProcessDescriptions)||void 0===o||null===(o=o.ProcessDescription)||void 0===o||null===(o=o[1])||void 0===o||null===(o=o.Identifier)||void 0===o?void 0:o[0]],u=J()(s,(function(e){return"gs:DownloadEstimator"===e}))>-1&&J()(s,(function(e){return"gs:Download"===e}))>-1,c=null===(a=l.search)||void 0===a?void 0:a.url,p=u&&("wps"===n||!c);return $e().Observable.of(N(p?"wps":"wfs"),F(u),x(!1))})).catch((function(){return $e().Observable.of(N("wfs"),F(!1),x(!1))})).startWith(x(!0))}))},cr=function(e){return e.ofType(G.dC).switchMap((function(e){var t;return $e().Observable.from([(0,W.KP)("layerdownload"),T("singlePage",!1)].concat(zt(null!==(t=e.layer.search)&&void 0!==t&&t.url?[(0,ft.VZ)(e.layer.url,{featureTypeName:e.layer.name})]:[])))}))},pr=function(e){return e.ofType(m).switchMap((function(e){return(0,ht.EV)(e).map((function(e){return t=function(e){var t=ce()(e,"WFS_Capabilities.OperationsMetadata.Operation"),r=et()(t,(function(e){return"GetFeature"===e.name})),n=ce()(r,"Parameter"),o=et()(n,(function(e){return"outputFormat"===e.name})).Value,a=rt()(Jt,o);return ot()(a).map((function(e){var t,r,n=(r=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,l=[],s=!0,u=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=a.call(r)).done)&&(l.push(n.value),l.length!==t);s=!0);}catch(e){u=!0,o=e}finally{try{if(!s&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw o}}return l}}(t,r)||Kt(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());return{name:n[0],label:n[1]}}))}(e),{type:y,wfsFormats:t};var t}))}))},dr=function(e,t){return e.ofType(c).switchMap((function(r){var n,o,a,i,l,s,u,c=t.getState(),p=(c.featuregrid||{}).virtualScroll,d=void 0!==p&&p,f=V(c),m=(0,B.ZT)(c),y=(0,gt.HC)(c),v=(0,X.Pd)(c),b=r.downloadOptions.propertyName?[(0,Yt.Dh)((0,Y.uT)(c,m.name))].concat(zt(r.downloadOptions.propertyName)):null,g=m.layerFilter;return"wps"===f?(o=!(null===(n=m.search)||void 0===n||!n.url),a=r.downloadOptions.cropDataSet&&!!y&&!!y.bounds,i=nr(m),l={layerName:m.name,outputFormat:r.downloadOptions.selectedFormat,asynchronous:!0,outputAsReference:!0,targetCRS:r.downloadOptions.selectedSrs&&"native"!==r.downloadOptions.selectedSrs?r.downloadOptions.selectedSrs:void 0,cropToROI:a,dataFilter:r.downloadOptions.downloadFilteredDataSet?{type:"TEXT",data:{mimeType:"text/xml; subtype=filter/1.1",data:(0,_t.o2)({ogcVersion:"1.1.0",addXmlnsToRoot:!0,xmlnsToAdd:['xmlns:ogc="http://www.opengis.net/ogc"','xmlns:gml="http://www.opengis.net/gml"']},m.layerFilter,r.filterObj,i)}}:void 0,ROI:a?{type:"TEXT",data:{mimeType:"application/wkt",data:(0,Bt.U)((0,Wt.bboxToFeatureGeometry)(y.bounds))}}:void 0,roiCRS:a?y.crs||"EPSG:4326":void 0,writeParameters:Ht(Ht(Ht({},r.downloadOptions.tileWidth?{tilewidth:r.downloadOptions.tileWidth}:{}),r.downloadOptions.tileHeight?{tileheight:r.downloadOptions.tileHeight}:{}),r.downloadOptions.compression?Ht({compression:r.downloadOptions.compression},r.downloadOptions.quality?{quality:r.downloadOptions.quality}:{}):{}),notifyDownloadEstimatorSuccess:!0,attribute:o&&b?b:void 0},s={id:pt()(),layerName:m.name,layerTitle:m.title,status:"pending"},u={outputsExtractor:(0,Rt.$t)(Rt.$V)},kt(r.url,l,u).takeUntil(e.ofType(w).filter((function(e){return e.id===s.id})).take(1)).flatMap((function(e){var t,r;return"DownloadEstimatorSuccess"===e?$e().Observable.of((r=Ht(Ht({},s),{},{startTime:(new Date).getTime()}),{type:O,result:r}),_("layerdownload.exportResultsMessages.newExport"),C(),(0,W.KP)("layerdownload","enabled")):(t=$e().Observable).of.apply(t,zt(e&&e.length>0&&e[0].href?[L(s.id,{status:"completed",result:e[0].href}),_("layerdownload.exportResultsMessages.exportSuccess",{layerTitle:(0,Ge.ez)(m,v)},"success")]:[L(s.id,{status:"failed",result:{msgId:"layerdonwload.exportResultsMessages.invalidHref"}}),_("layerdownload.exportResultsMessages.exportFailure",{layerTitle:(0,Ge.ez)(m,v)},"danger")]))})).catch((function(e){var t;return(t=$e().Observable).of.apply(t,zt(e.message&&e.message.indexOf("DownloadEstimator")>-1?[(0,mt.z3)({error:e,title:"layerdownload.error.downloadEstimatorTitle",message:"layerdownload.error.downloadEstimatorFailed"}),C()]:[L(s.id,{status:"failed",result:lr(e)}),_("layerdownload.exportResultsMessages.exportFailure",{layerTitle:(0,Ge.ez)(m,v)},"danger")]))}))):or({url:r.url,downloadOptions:r.downloadOptions,filterObj:r.filterObj,layer:m,layerFilter:g,options:{pagination:!d&&ce()(r,"downloadOptions.singlePage")?r.filterObj&&r.filterObj.pagination:null,propertyNames:b}}).do((function(e){var t=e.data;if("application/xml"===e.headers["content-type"]){var r=String.fromCharCode.apply(null,new Uint8Array(t));if(0===r.indexOf("<ows:ExceptionReport"))throw r}})).catch((function(){return or({url:r.url,downloadOptions:r.downloadOptions,filterObj:r.filterObj,layer:m,layerFilter:g,options:{pagination:!d&&ce()(r,"downloadOptions.singlePage")?r.filterObj&&r.filterObj.pagination:null,sortOptions:(e=ir(t.getState()),e?{sortBy:e,sortOrder:"A"}:{}),propertyNames:r.downloadOptions.propertyName?[].concat(zt(r.downloadOptions.propertyName),[(0,Yt.Dh)((0,Y.uT)(c,m.name))]):null}}).do((function(e){var t=e.data,n=e.headers;if("application/xml"===n["content-type"]){var o=String.fromCharCode.apply(null,new Uint8Array(t));if(0===o.indexOf("<ows:ExceptionReport"))throw o}(0,lt.saveAs)(new Blob([t],{type:n&&n["content-type"]}),ar(r))}));var e})).do((function(e){var t=e.data,n=e.headers;(0,lt.saveAs)(new Blob([t],{type:n&&n["content-type"]}),ar(r))})).map((function(){return C()})).catch((function(e){return $e().Observable.of((0,mt.z3)({error:e,title:"layerdownload.error.title",message:"layerdownload.error.invalidOutputFormat",autoDismiss:5,position:"tr"}),C())}))}))},fr=function(e,t){return e.ofType(W.x7).filter((function(e){return"queryPanel"===e.control&&!(0,bt.sY)(t.getState())&&(0,bt.sl)(t.getState())})).switchMap((function(){return $e().Observable.of((0,W.KP)("layerdownload"))}))},mr=function(e){return e.ofType(j).concatMap((function(){var e,t,r,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return $e().Observable.of((e=n.msgId,t=n.msgParams,r=n.level,{type:D,msgId:e,msgParams:t,level:r}),M(!0)).delay(10).concat($e().Observable.of(M(!1)).delay(n.duration||3e3)).concat($e().Observable.empty().delay(1e3))}))},yr=function(e,t){return e.ofType(S).exhaustMap((function(){var e=t.getState(),r=(H(e)||[]).filter((function(e){return"completed"===e.status}));return r.length>0?$e().Observable.forkJoin(r.map((function(e){var t=e.result,r=t.indexOf("executionId="),n=t.slice(r),o=n.indexOf("&"),a=(o>-1?n.slice(0,o):n).slice(12),i=t.indexOf("?"),l=t.slice(0,i);return(0,Rt.HN)(l,a).let(Gt.m9).catch((function(){return $e().Observable.of(null)})).map((function(t){return t?null:e.id}))}))).flatMap((function(e){return $e().Observable.of((t=e.filter((function(e){return!!e})),{type:E,ids:t}),{type:P},k(!1));var t})).startWith(k(!0)):$e().Observable.empty()}))},vr=function(e,t){return e.ofType(O,w,h,P).filter((function(){return(0,Ot.M3)(t.getState())})).do((function(){var e=t.getState(),r=H(e),n=(0,Ot.dt)(e).id,o=JSON.stringify({results:r});document.cookie="exportDataResults_".concat(n,"=").concat(encodeURIComponent(o))})).flatMap((function(){return $e().Observable.empty()}))},br=function(e){return e.ofType(vt.mO).switchMap((function(){return e.ofType(yt.T_).switchMap((function(){return $e().Observable.of(I([]))})).takeUntil(e.ofType(dt.LK))}))},gr=function(e,t){return e.ofType(vt.mO).switchMap((function(){return sr(t.getState()).concat(e.ofType(yt._x).switchMap((function(){return sr(t.getState())})).takeUntil(e.ofType(dt.LK)))}))};function Or(e){return Or="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Or(e)}function hr(e){return function(e){if(Array.isArray(e))return wr(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return wr(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?wr(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function wr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function Er(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Sr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Er(Object(r),!0).forEach((function(t){Ar(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Er(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ar(e,t,r){return(t=function(e){var t=function(e){if("object"!=Or(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=Or(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Or(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Pr=r(393149),jr=["onClick","selectedNodes","status","itemComponent","statusTypes"];function Rr(){return Rr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Rr.apply(null,arguments)}var Dr=(0,i.connect)((function(){return{}}),{onClick:G.RG})((function(e){var t,r=e.onClick,n=e.selectedNodes,o=e.status,i=e.itemComponent,l=e.statusTypes,s=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(e,jr),u=i,c=null==n||null===(t=n[0])||void 0===t?void 0:t.node;return![l.LAYER].includes(o)||!("wms"===(null==c?void 0:c.type)||null!=c&&c.search)||null!=c&&c.error?null:a().createElement(u,Rr({},s,{glyph:"download",tooltipId:"toc.toolDownloadTooltip",onClick:function(){var e;return r({url:(null===(e=c.search)||void 0===e?void 0:e.url)||c.url,name:c.name,id:c.id})}}))}));const xr=(0,Pr.i1)("LayerDownload",{component:(0,i.connect)((0,l.j8)({url:Y.yr,filterObj:q,enabled:function(e){var t;return null==e||null===(t=e.controls)||void 0===t||null===(t=t.layerdownload)||void 0===t?void 0:t.enabled},downloadOptions:function(e){var t;return null==e||null===(t=e.layerdownload)||void 0===t?void 0:t.downloadOptions},loading:function(e){var t;return null==e||null===(t=e.layerdownload)||void 0===t?void 0:t.loading},wfsFormats:function(e){var t;return null==e||null===(t=e.layerdownload)||void 0===t?void 0:t.wfsFormats},formatsLoading:function(e){var t;return null==e||null===(t=e.layerdownload)||void 0===t?void 0:t.formatsLoading},layer:B.ZT,wpsAvailable:function(e){var t;return null==e||null===(t=e.layerdownload)||void 0===t?void 0:t.wpsAvailable},service:V,checkingWPSAvailability:function(e){var t;return null==e||null===(t=e.layerdownload)||void 0===t?void 0:t.checkingWPSAvailability},virtualScroll:function(e){return e&&e.featuregrid&&e.featuregrid.virtualScroll},customAttributeSettings:U.b0,attributes:Y.NY}),{onExport:function(e,t,r){return{type:c,url:e,filterObj:t,downloadOptions:r}},setService:N,onDownloadOptionChange:T,onClearDownloadOptions:function(){return{type:f}},onFormatOptionsFetch:function(e){return{type:m,layer:e}},onCheckWPSAvailability:function(e,t){return{type:s,url:e,selectedService:t}},onClose:function(){return(0,W.KP)("layerdownload")}})(_e),containers:{TOC:{doNotHide:!0,name:"LayerDownload",target:"toolbar",Component:Dr,position:11},FeatureEditor:{doNotHide:!0,name:"LayerDownload",position:20,target:"toolbar",Component:(0,i.connect)((0,l.j8)({isDownloadOpen:function(e){var t;return null==e||null===(t=e.controls)||void 0===t||null===(t=t.layerdownload)||void 0===t?void 0:t.enabled}}),{onClick:function(){return(0,W.KP)("layerdownload")}})((function(e){var t=e.disabled,r=e.results,n=void 0===r?[]:r,o=e.mode,i=e.isDownloadOpen,l=e.onClick,s=void 0===l?function(){}:l;return a().createElement(Ze,{id:"download-grid",keyProp:"download-grid",tooltipId:"featuregrid.toolbar.downloadGridData",disabled:t||0===n.length,active:i,visible:"VIEW"===o,onClick:s,glyph:"download"})}))},MapFooter:{doNotHide:!0,name:"LayerDownload",position:1,tool:(0,i.connect)((0,l.j8)({active:function(e){var t;return null==e||null===(t=e.controls)||void 0===t||null===(t=t.exportDataResults)||void 0===t?void 0:t.enabled},showInfoBubble:function(e){var t;return null==e||null===(t=e.layerdownload)||void 0===t?void 0:t.showInfoBubble},infoBubbleMessage:function(e){var t;return null==e||null===(t=e.layerdownload)||void 0===t?void 0:t.infoBubbleMessage},checkingExportDataEntries:function(e){var t;return null==e||null===(t=e.layerdownload)||void 0===t?void 0:t.checkingExportDataEntries},results:H,currentLocale:X.Pd}),{onToggle:W.KP.bind(null,"exportDataResults","enabled"),onActive:function(){return{type:S}},onRemoveResult:function(e){return{type:w,id:e}}})((function(e){var t=e.active,r=void 0!==t&&t,n=e.showInfoBubble,o=void 0!==n&&n,i=e.infoBubbleMessage,l=void 0===i?{}:i,s=e.checkingExportDataEntries,u=e.results,c=void 0===u?[]:u,p=e.currentLocale,d=e.onToggle,f=void 0===d?function(){}:d,m=e.onActive,y=void 0===m?function(){}:m,v=e.onRemoveResult;return a().useEffect((function(){r&&y()}),[r]),a().createElement(a().Fragment,null,c.length>0?a().createElement("div",{id:"mapstore-export-data-results-button-container"},a().createElement(We.A,{placement:"left",overlay:a().createElement(ee.m_,{id:"mapstore-export-data-results-tooltip"},a().createElement(ie.A,{msgId:"exportDataResults.title"}))},a().createElement(ee.$n,{bsStyle:"primary",bsSize:"small",onClick:function(){return f()}},a().createElement(ee.e6,{glyph:"download"}))),a().createElement(He,{show:o,className:"mapstore-export"},a().createElement(Xe,l))):null,a().createElement("div",null,r&&a().createElement(ae.A,null,a().createElement(oe.A,{id:"mapstore-export-data-results",draggable:!1,modal:!0},a().createElement("span",{role:"header"},a().createElement("span",{className:"about-panel-title"},a().createElement(ie.A,{msgId:"exportDataResults.title"})),a().createElement("button",{onClick:function(){return f()},className:"settings-panel-close close"},a().createElement(ee.e6,{glyph:"1-close"}))),a().createElement("div",{role:"body"},a().createElement(Be,{loading:s,results:c,currentLocale:p,onRemoveResult:v}))))))}))}},epics:n,reducers:{layerdownload:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{downloadOptions:{singlePage:!0}},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case c:return Sr(Sr({},e),{},{loading:!0});case d:return Sr(Sr({},e),{},{downloadOptions:Sr(Sr({},e.downloadOptions),{},Ar({},t.key,t.value))});case f:return Sr(Sr({},e),{},{downloadOptions:{singlePage:!0}});case m:return Sr(Sr({},e),{},{layer:t.layer,wfsFormats:[],formatsLoading:!0});case p:return Sr(Sr({},e),{},{loading:!1});case y:return Sr(Sr({},e),{},{wfsFormats:t.wfsFormats,formatsLoading:!1});case b:return Sr(Sr({},e),{},{service:t.service});case v:return Sr(Sr({},e),{},{wpsAvailable:t.value});case u:return Sr(Sr({},e),{},{checkingWPSAvailability:t.checking});case g:return Sr(Sr({},e),{},{results:t.results});case O:return Sr(Sr({},e),{},{results:[].concat(hr(e.results||[]),[t.result])});case h:var r=J()(e.results||[],{id:t.id});return Sr(Sr({},e),{},{results:r>-1?[].concat(hr(e.results.slice(0,r)),[Sr(Sr({},e.results[r]),t.newProps||{})],hr(e.results.slice(r+1))):e.results});case w:return Sr(Sr({},e),{},{results:(e.results||[]).filter((function(e){return e.id!==t.id}))});case E:return Sr(Sr({},e),{},{results:(e.results||[]).filter((function(e){return-1===J()(t.ids,(function(t){return t===e.id}))}))});case R:return Sr(Sr({},e),{},{showInfoBubble:t.show});case D:return Sr(Sr({},e),{},{infoBubbleMessage:{msgId:t.msgId,msgParams:t.msgParams,level:t.level}});case A:return Sr(Sr({},e),{},{checkingExportDataEntries:t.checking});default:return e}}}})},564116:(e,t,r)=>{"use strict";r.d(t,{Ud:()=>i,ic:()=>s,x9:()=>a});var n=r(400912),o=r.n(n),a={json:"ext-json",wmc:"ext-wmc"},i={json:"JSON",wmc:"WMC"},l=[{outputFormat:"shape-zip",extension:"zip"},{outputFormat:"csv",extension:"csv"},{outputFormat:"excel",extension:"xls"},{outputFormat:"excel2007",extension:"xlsx"},{outputFormat:"dxf",extension:"dxf"},{outputFormat:"dxf-zip",extension:"zip"},{outputFormat:"application/vnd.google-earth.kml+xml",extension:"kml"},{outputFormat:"application/json",extension:"json"},{outputFormat:"gml3",extension:"gml"},{outputFormat:"GML2",extension:"gml"},{outputFormat:"application/vnd.googlxml",extension:"kml"},{outputFormat:"OGR-CSV",extension:"csv"},{outputFormat:"OGR-FileGDB",extension:"gdb"},{outputFormat:"OGR-GPKG",extension:"gpkg"},{outputFormat:"OGR-KML",extension:"kml"},{outputFormat:"OGR-MIF",extension:"mif"},{outputFormat:"OGR-TAB",extension:"tab"},{outputFormat:"SHAPE-ZIP",extension:"zip"},{outputFormat:"gml32",extension:"gml"},{outputFormat:"application/x-gpk",extension:"gpk"}],s=function(e){return o()(l.filter((function(t){return t.outputFormat===e})))||function(e){var t=e.split(/[^\w]/)[1];return t?{outputFormat:e,extension:t.toLowerCase()}:void 0}(e)}},791936:function(e,t,r){var n,o=o||function(e){"use strict";if(!(void 0===e||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var t=e.document,r=function(){return e.URL||e.webkitURL||e},n=t.createElementNS("http://www.w3.org/1999/xhtml","a"),o="download"in n,a=/constructor/i.test(e.HTMLElement)||e.safari,i=/CriOS\/[\d]+/.test(navigator.userAgent),l=function(t){(e.setImmediate||e.setTimeout)((function(){throw t}),0)},s=function(e){setTimeout((function(){"string"==typeof e?r().revokeObjectURL(e):e.remove()}),4e4)},u=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e},c=function(t,c,p){p||(t=u(t));var d,f=this,m="application/octet-stream"===t.type,y=function(){!function(e,t){for(var r=(t=[].concat(t)).length;r--;){var n=e["on"+t[r]];if("function"==typeof n)try{n.call(e,e)}catch(e){l(e)}}}(f,"writestart progress write writeend".split(" "))};if(f.readyState=f.INIT,o)return d=r().createObjectURL(t),void setTimeout((function(){var e,t;n.href=d,n.download=c,e=n,t=new MouseEvent("click"),e.dispatchEvent(t),y(),s(d),f.readyState=f.DONE}));!function(){if((i||m&&a)&&e.FileReader){var n=new FileReader;return n.onloadend=function(){var t=i?n.result:n.result.replace(/^data:[^;]*;/,"data:attachment/file;");e.open(t,"_blank")||(e.location.href=t),t=void 0,f.readyState=f.DONE,y()},n.readAsDataURL(t),void(f.readyState=f.INIT)}d||(d=r().createObjectURL(t)),m?e.location.href=d:e.open(d,"_blank")||(e.location.href=d),f.readyState=f.DONE,y(),s(d)}()},p=c.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,r){return t=t||e.name||"download",r||(e=u(e)),navigator.msSaveOrOpenBlob(e,t)}:(p.abort=function(){},p.readyState=p.INIT=0,p.WRITING=1,p.DONE=2,p.error=p.onwritestart=p.onprogress=p.onwrite=p.onabort=p.onerror=p.onwriteend=null,function(e,t,r){return new c(e,t||e.name||"download",r)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);e.exports?e.exports.saveAs=o:null!==r.amdD&&null!==r.amdO&&(void 0===(n=function(){return o}.call(t,r,t,e))||(e.exports=n))},913195:e=>{var t=Math.floor,r=Math.random;e.exports=function(e,n){return e+t(r()*(n-e+1))}},258253:(e,t,r)=>{var n=r(913195),o=r(936800),a=r(217400),i=parseFloat,l=Math.min,s=Math.random;e.exports=function(e,t,r){if(r&&"boolean"!=typeof r&&o(e,t,r)&&(t=r=void 0),void 0===r&&("boolean"==typeof t?(r=t,t=void 0):"boolean"==typeof e&&(r=e,e=void 0)),void 0===e&&void 0===t?(e=0,t=1):(e=a(e),void 0===t?(t=e,e=0):t=a(t)),e>t){var u=e;e=t,t=u}if(r||e%1||t%1){var c=s();return l(e+c*(t-e+i("1e-"+((c+"").length-1))),t)}return n(e,t)}}}]);