(self.webpackChunkgeonode_mapstore_client=self.webpackChunkgeonode_mapstore_client||[]).push([[9010],{55105:(e,t,n)=>{"use strict";n.d(t,{Nr:()=>y,ic:()=>d,Jz:()=>v,VM:()=>m,CF:()=>p});var r=n(91175),l=n.n(r),o=n(827),a=n(52259);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s=function(e){return e.maplayout&&e.maplayout.layout||{}},y=function(e){return e.maplayout&&e.maplayout.boundingMapRect||{}},d=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=s(e);return n&&Object.keys(n).filter((function(e){return t[e]})).reduce((function(e,t){return u(u({},e),{},c({},t,n[t]))}),{})||{}},f=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=s(e),r=!!l()(t.filter((function(e){return n[e.key]})).map((function(e){return"not"===e.type?n[e.key]!==e.value&&n[e.key]:n[e.key]===e.value})));return r},v=function(e){return f(e,[{key:"right",value:658}])},m=function(e){return f(e,[{key:"bottom",value:30,type:"not"}])},p=function(e){var t=(0,o.Od)(e),n=y(e);return n&&t&&t.size&&{left:(0,a.parseLayoutValue)(n.left,t.size.width),bottom:(0,a.parseLayoutValue)(n.bottom,t.size.height),right:(0,a.parseLayoutValue)(n.right,t.size.width),top:(0,a.parseLayoutValue)(n.top,t.size.height)}}},73443:(e,t,n)=>{"use strict";n.d(t,{rs:()=>r,AY:()=>l,SW:()=>o,yB:()=>a,oG:()=>i,oz:()=>u,id:()=>c,gc:()=>s,cE:()=>y,rG:()=>d,Vj:()=>f,nY:()=>v});var r="GEONODE:SAVING_RESOURCE",l="GEONODE:SAVE_SUCCESS",o="GEONODE:SAVE_ERROR",a="GEONODE:CLEAR_SAVE",i="GEONODE:SAVE_CONTENT",u="GEONODE:SAVE_DIRECT_CONTENT";function c(){return{type:r}}function s(e){return{type:l,success:e}}function y(e){return{type:o,error:e}}function d(){return{type:a}}function f(e,t,n,r){return{type:i,id:e,metadata:t,reload:n,showNotifications:r}}function v(){return{type:u}}},28261:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var r=n(67294),l=n.n(r),o=n(45697),a=n.n(o),i=["id","className","style","children"];function u(){return u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},u.apply(this,arguments)}function c(e){var t=e.id,n=e.className,r=e.style,o=e.children,a=function(e,t){if(null==e)return{};var n,r,l=function(e,t){if(null==e)return{};var n,r,l={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}(e,i),c=n?" "+n:"";return l().createElement(l().Fragment,null,l().createElement("div",u({},a,{id:t,className:"gn-spinner".concat(c),style:r}),l().createElement("div",null)),o)}c.propTypes={id:a().string,className:a().string,style:a().object},c.defaultProps={};const s=c},51605:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r.Z});var r=n(28261)},32247:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(67294);function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}const o=function(e,t){var n,o,a=function(){if("undefined"==typeof window)return t;try{var n=window.localStorage.getItem(e);return n?JSON.parse(n):t}catch(n){return console.log("Error to get item key “".concat(e,"”:"),n),t}},i=(n=(0,r.useState)(a),o=2,function(e){if(Array.isArray(e))return e}(n)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,l,o=[],a=!0,i=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(e){i=!0,l=e}finally{try{a||null==n.return||n.return()}finally{if(i)throw l}}return o}}(n,o)||function(e,t){if(e){if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}(n,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=i[0],c=i[1];return(0,r.useEffect)((function(){c(a())}),[]),(0,r.useEffect)((function(){var e=function(){c(a())};return window.addEventListener("localStorage",e),function(){window.removeEventListener("localStorage",e)}}),[]),[u,function(t){try{var n=t instanceof Function?t(u):t;c(n),window.localStorage.setItem(e,JSON.stringify(n)),window.dispatchEvent(new Event("localStorage"))}catch(t){console.log("Error “".concat(e,"”:"),t)}}]}},33096:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>pe});var r=n(67294),l=n.n(r),o=n(22843),a=n(33664),i=n(22222),u=n(57588),c=n(92222),s=n(32244),y=n(94943),d=n(89255),f=n(23570),v=n.n(f),m=n(80416),p=n(96909),b=n(82904),g=n(60604),S=n(99009),E=n(9082),O=n(93222),h="GEONODE:REQUEST_DATASET_AVAILABLE_STYLES",w="GEONODE:CREATE_GEONODE_STYLE",j="GEONODE:DELETE_GEONODE_STYLE",P=n(73443),C=n(17621),N=n.n(C),T=n(35721);function k(e,t){if(e){if("string"==typeof e)return A(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?A(e,t):void 0}}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function D(e){var t=e.type,n=e.title,r=N()("hsl(".concat(Math.floor(270*Math.random()),", 90%, 70%)")).toHexString();switch(t){case"raster":return"@mode 'Flat'; @styleTitle '"+n+"'; \n* {\n\traster-channels: auto;\n\traster-opacity: 1;\n}\n";case"point":default:return"@mode 'Flat'; @styleTitle '"+n+"'; \n* {\n\tmark: symbol('square');\n\t:mark {\n\t\tfill: "+r+";\n\t\tsize: 4;\n\t}\n}\n";case"linestring":return"@mode 'Flat'; @styleTitle '"+n+"'; \n* {\n\tstroke: "+r+";\n}\n";case"polygon":return"@mode 'Flat'; @styleTitle '"+n+"'; \n* {\n\tfill: "+r+";\n}\n"}}function L(e){var t=e.name;return"geonode:".concat(v()(),"_ms_").concat(t)}const x={gnCreateStyle:function(e,t){return e.ofType(w).switchMap((function(e){var n,r,l,o,a=t.getState(),i=(null==e||null===(n=e.options)||void 0===n?void 0:n.styleService)||(0,O.Z0)(a),u=L({name:e.title.toLowerCase().replace(/\W/g,"")}),c=e.layer||(0,O.Vf)(a),s={title:e.title,description:"",msStyleJSON:null,msEditorType:"visual",gnLayerName:c.name,gnDatasetPk:null==c||null===(r=c.extendedParams)||void 0===r||null===(l=r.mapLayer)||void 0===l||null===(o=l.dataset)||void 0===o?void 0:o.pk},y=(0,O.lC)(a);return d.Observable.defer((function(){return E.ZP.createStyle({baseUrl:null==i?void 0:i.baseUrl,code:D({type:y,title:e.title}),format:"css",styleName:u,metadata:s})})).switchMap((function(){return d.Observable.of((0,m.tV)(c.id,"layer",{availableStyles:[].concat((t=c.availableStyles,function(e){if(Array.isArray(e))return A(e)}(t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||k(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),[{format:"css",metadata:s,name:u,title:e.title}])}),(0,g.W)(c.id,S.s1,"override",{}),(0,m.Xy)({style:u},!0),(0,p.Nf)("edit"),(0,P.nY)());var t}))}))},gnDeleteStyle:function(e,t){return e.ofType(j).switchMap((function(e){var n,r=t.getState(),l=(null==e||null===(n=e.options)||void 0===n?void 0:n.styleService)||(0,O.Z0)(r),o=e.layer||(0,O.Vf)(r),a=function(){var t,n=(o.availableStyles||[]).filter((function(t){return t.name!==e.styleName}));return d.Observable.of((0,m.tV)(o.id,"layer",{availableStyles:n}),(0,g.W)(o.id,S.s1,"override",{}),(0,m.Xy)({style:(null==n||null===(t=n[0])||void 0===t?void 0:t.name)||""},!0),(0,p.Nf)("edit"),(0,P.nY)())};return d.Observable.defer((function(){return d.Observable.defer((function(){return E.ZP.deleteStyle({baseUrl:null==l?void 0:l.baseUrl,styleName:e.styleName})}))})).switchMap((function(){return a()})).catch((function(){return a()}))}))},gnRequestDatasetAvailableStyles:function(e,t){return e.ofType(h).switchMap((function(e){var n,r=t.getState(),l=(null==e||null===(n=e.options)||void 0===n?void 0:n.styleService)||(0,O.Z0)(r);return d.Observable.concat(d.Observable.of((0,b.Xg)("visualStyleEditor","enabled",!0)),d.Observable.defer((function(){return function(e){var t,n,r,l,o,a,i=e.layer,u=e.styleService,c=null==i||null===(t=i.extendedParams)||void 0===t||null===(n=t.mapLayer)||void 0===n||null===(r=n.dataset)||void 0===r?void 0:r.subtype,s=(null==i?void 0:i.availableStyles)||[];return 0===s.length?function(e,t){var n,r="visual";return e?E.ZP.getStyleCodeByName({baseUrl:null==t?void 0:t.baseUrl,styleName:(0,T.UH)(e)}).then((function(e){var t=e||{},n=t.metadata,r=void 0===n?{}:n,l=t.code,o=t.format,a=t.languageVersion,i=(0,T.BB)(r);return{msEditorType:null==i?void 0:i.msEditorType,msStyleJSON:null==i?void 0:i.msStyleJSON,code:l,format:o,languageVersion:a}})).catch((function(){return{msEditorType:r,msStyleJSON:null,code:n}})):new Promise((function(e){return e({msStyleJSON:null,msEditorType:r,code:n})}))}(null==i||null===(l=i.extendedParams)||void 0===l||null===(o=l.mapLayer)||void 0===o||null===(a=o.dataset)||void 0===a?void 0:a.default_style,u).then((function(e){var t,n,r,l=e||{},o=l.msEditorType,a=l.msStyleJSON,s=l.code,y=l.format,d=l.languageVersion,f=i.name.split(":"),v=1===f.length?f[0]:f[f.length-1],m=L({name:v}),p={title:v,description:"",msStyleJSON:a,msEditorType:o,gnDatasetPk:null==i||null===(t=i.extendedParams)||void 0===t||null===(n=t.mapLayer)||void 0===n||null===(r=n.dataset)||void 0===r?void 0:r.pk};return E.ZP.createStyle(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(Object(n),!0).forEach((function(t){Z(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({baseUrl:null==u?void 0:u.baseUrl,code:s||D({type:c,title:v}),format:s&&y?y:"css",styleName:m,metadata:p},s&&y&&{languageVersion:d})).then((function(){return[[{name:m,title:v,metadata:p,format:y}],!0]}))})):new Promise((function(e){return e([s])}))}({layer:e.layer,styleService:l})})).switchMap((function(t){var n,r,o,a,i=(o=t,a=1,function(e){if(Array.isArray(e))return e}(o)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,l,o=[],a=!0,i=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(e){i=!0,l=e}finally{try{a||null==n.return||n.return()}finally{if(i)throw l}}return o}}(o,a)||k(o,a)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0],u=(null==e||null===(n=e.options)||void 0===n?void 0:n.style)||(null==i||null===(r=i[0])||void 0===r?void 0:r.name);return d.Observable.concat(d.Observable.defer((function(){return E.ZP.getStylesInfo({baseUrl:null==l?void 0:l.baseUrl,styles:i})})).switchMap((function(t){return d.Observable.of((0,m.tV)(e.layer.id,"layer",{availableStyles:t}),(0,m.Xy)({style:u},!0),(0,g.W)(e.layer.id,S.s1,"override",{}),(0,p.Nf)("edit"))})))})))}))},gnUpdateStyleInfoOnSave:function(e,t){return e.ofType(p.ch).switchMap((function(){var e=t.getState(),n=(0,O.Vf)(e);return d.Observable.of((0,m.tV)(n.id,"layers",{style:n.style}))}))}};var U=n(1550),V=n(5346),_=n(93473),M=n(99534),G=n(94745),z=n(3828),R=n(51605),J=n(55105),F=n(93451),Y=n(15135),B=n(75110),W=n(32247),X=n(83958),$=n(90702),q=n(66287),H=n(86300);function Q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function K(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(n),!0).forEach((function(t){ee(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Q(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ee(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function te(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,l,o=[],a=!0,i=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(e){i=!0,l=e}finally{try{a||null==n.return||n.return()}finally{if(i)throw l}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return ne(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ne(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ne(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var re=(0,Y.Z)(_.Z);function le(){return le=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},le.apply(this,arguments)}function oe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ae(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?oe(Object(n),!0).forEach((function(t){ie(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ie(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ue(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,l,o=[],a=!0,i=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(e){i=!0,l=e}finally{try{a||null==n.return||n.return()}finally{if(i)throw l}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return ce(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ce(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ce(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var se=(0,F.Z)("placeholder")(u.FormControl),ye=(0,Y.Z)(_.Z),de=(0,a.connect)((0,i.P1)([O.QW,O.gB,O.aN,O.p,B.l2],(function(e,t,n,r,l){var o;return{isStyleChanged:void 0!==e&&void 0!==t&&e!==t,loading:n,error:!(null==r||null===(o=r.edit)||void 0===o||!o.status),layerLoading:l&&l.some((function(e){return e.loading}))}})),{onClick:p.Lc})((function(e){var t=e.variant,n=e.onClick,r=e.size,o=e.isStyleChanged,a=e.error,i=e.loading,u=e.layerLoading,c=e.msgId,s=void 0===c?"save":c,y=!(!i&&!a);return l().createElement(ye,{className:o?"gn-pending-changes-icon":"",variant:t||"primary",size:r,disabled:y,onClick:y?function(){}:function(){return n()}},l().createElement(V.Z,{msgId:s})," ",(i||u)&&l().createElement(R.Z,null))})),fe=(0,a.connect)((0,i.P1)([O.Vf,O.lC,O.Ed,O.gB,O.i7,function(e){var t,n;return null==e||null===(t=e.controls)||void 0===t||null===(n=t.visualStyleEditor)||void 0===n?void 0:n.tmpCode}],(function(e,t,n,r,l,o){var a;return{geometryType:t,format:n,selectedStyle:null==e||null===(a=e.availableStyles)||void 0===a?void 0:a.find((function(e){return e.name===l})),code:r,tmpCode:o}})),{onSelect:p.p2,onUpdateMetadata:p.bB,onUpdate:p.Lc,onStoreTmpCode:b.Xg.bind(null,"visualStyleEditor","tmpCode")})((function(e){var t=e.code,n=e.format,o=e.geometryType,a=e.onSelect,i=e.selectedStyle,u=e.onUpdateMetadata,c=e.onUpdate,s=e.tmpCode,y=e.onStoreTmpCode,d=(0,r.useRef)(),f=te((0,r.useState)([]),2),v=f[0],m=f[1],p=te((0,r.useState)(),2),b=p[0],g=p[1];(0,r.useEffect)((function(){return d.current=!0,(0,H.YD)().then((function(e){d.current&&m(e)})),function(){d.current=!1}}),[]);var S=(0,r.useRef)();S.current=function(e){e?y(t):(g(void 0),s&&a(s))},(0,r.useEffect)((function(){return function(){y("")}}),[]);var E=v.filter((function(e){return e.types.includes(o)}));return(null==E?void 0:E.length)>0?l().createElement($.Z,{placement:"right",onOpen:function(e){S.current(e)},content:l().createElement("div",{className:"gn-visual-style-editor-templates"},l().createElement("ul",null,E.map((function(e,t){var r;return l().createElement("li",{key:t,className:"gn-visual-style-editor-template".concat(b===t?" selected":""),onClick:function(){return function(e,t){var r,l=e.code;g(t);var o=(null==i||null===(r=i.metadata)||void 0===r?void 0:r.title)||(null==i?void 0:i.label)||(null==i?void 0:i.title)||(null==i?void 0:i.name)||"";(0,q.getStyleParser)(n).writeStyle(K(K({},l),{},{name:o})).then((function(e){d.current&&a(e)}))}(e,t)}},l().createElement("div",{className:"gn-visual-style-editor-template-preview"},null!=e&&null!==(r=e.preview)&&void 0!==r&&r.config?l().createElement(X.Z,e.preview.config):null==e?void 0:e.preview),l().createElement("div",{className:"gn-visual-style-editor-template-title"},e.title))}))),l().createElement("div",{className:"gn-visual-style-editor-templates-footer"},l().createElement(re,{size:"xs",disabled:void 0===b,variant:"primary",onClick:function(){y(t),u({styleJSON:null}),c()}},l().createElement(V.Z,{msgId:"gnviewer.applyStyle"}))))},l().createElement(re,{size:"xs"},l().createElement(V.Z,{msgId:"gnviewer.copyFrom"}))):null})),ve=(0,a.connect)((0,i.P1)([O.Vf,O.gc,O.Z0,O.QW,function(e){var t,n;return null==e||null===(t=e.controls)||void 0===t||null===(n=t.visualStyleEditor)||void 0===n?void 0:n.enabled},function(e){return(0,J.ic)(e,{height:!0})},B.Iz],(function(e,t,n,r,l,o,a){return{layer:e,temporaryStyleId:t,styleService:n,initialCode:r,enabled:l,style:o,originalStyle:null==a?void 0:a.style}})),{onUpdateStatus:p.Nf,onUpdateParams:m.Xy,onInit:p.E0,onReset:p.Wv.bind(null,void 0,!1),onSave:p.Lc,onClose:b.Xg.bind(null,"visualStyleEditor","enabled",!1),onZoomTo:U.Px,onCreate:function(e,t){return{type:w,title:e,options:t}},onDelete:function(e,t){return{type:j,styleName:e,options:t}},onUpdateNode:m.tV},(function(e,t,n){var r,l,o,a=(null===(r=n.styleService)||void 0===r?void 0:r.baseUrl)===(null===(l=e.styleService)||void 0===l?void 0:l.baseUrl)&&(null===(o=e.styleService)||void 0===o?void 0:o.isStatic),i=n.styleService&&!a?ae(ae({},n.styleService),{},{isStatic:!0}):ae({},e.styleService);return ae(ae(ae(ae({},n),e),t),{},{styleService:i})}))((function(e){var t=e.layer,n=e.editorConfig,o=e.styleService,a=e.onInit,i=e.onReset,s=e.temporaryStyleId,y=e.showLayerProperties,d=e.initialCode,f=e.enabled,v=e.onClose,m=e.onZoomTo,p=e.onCreate,b=e.onDelete,g=e.style,S=ue((0,r.useState)(!1),2),O=S[0],h=S[1],w=ue((0,r.useState)(!1),2),j=w[0],P=w[1],C=ue((0,r.useState)(""),2),N=C[0],T=C[1],k=ue((0,W.Z)("style-notifcation",!1),2),A=k[0],I=k[1],Z=ue((0,r.useState)(!1),2),D=Z[0],L=Z[1],x=(0,r.useRef)();return x.current=function(){s&&E.ZP.deleteStyle({baseUrl:o.baseUrl,styleName:s})},(0,r.useEffect)((function(){function e(){x.current()}return a(o),window.addEventListener("beforeunload",e),function(){window.removeEventListener("beforeunload",e),i()}}),[]),f&&t.id?l().createElement("div",{className:"gn-visual-style-editor",style:g},y&&l().createElement("div",{className:"gn-visual-style-editor-layer-info"},l().createElement("div",{className:"gn-visual-style-editor-layer-title"},t.title),t.bbox&&l().createElement(ye,{onClick:function(){var e=t.bbox.bounds,n=e.minx,r=e.miny,l=e.maxx,o=e.maxy;m([n,r,l,o],t.bbox.crs)},tooltipId:"gnviewer.zoomToLayer"},l().createElement(u.Glyphicon,{glyph:"zoom-to"})),l().createElement(ye,{onClick:function(){i(),v()},className:"square-button"},l().createElement(u.Glyphicon,{glyph:"1-close"}))),l().createElement("div",{className:"gn-visual-style-editor-toolbar"},y&&l().createElement(de,{variant:"primary",size:"xs",msgId:"gnviewer.applyStyle"}),l().createElement(fe,null)),!D&&!A&&l().createElement("div",{className:"gn-visual-style-editor-alert alert-info"},l().createElement("div",{className:"gn-visual-style-editor-alert-message"},l().createElement(V.Z,{msgId:"gnviewer.stylesFirstClone"}),l().createElement(ye,{size:"xs",variant:"transparent",onClick:function(){I(!0)}},l().createElement("p",null,l().createElement(V.Z,{msgId:"gnviewer.dismissMessage"})))),l().createElement(ye,{size:"xs",variant:"transparent",onClick:function(){L(!0)}},l().createElement(u.Glyphicon,{glyph:"remove"}))),l().createElement("div",{className:"gn-visual-style-editor-body"},l().createElement("div",null,l().createElement(c.m2,{key:d,config:n}))),l().createElement(M.Z,null,l().createElement(G.Z,{title:l().createElement(V.Z,{msgId:"gnviewer.createStyleTitle"}),fitContent:!0,clickOutEnabled:!1,show:O,onClose:function(){h(!1),T("")},buttons:[{text:l().createElement(V.Z,{msgId:"gnviewer.createStyleClose"}),onClick:function(){h(!1),T("")}},{text:l().createElement(V.Z,{msgId:"gnviewer.createStyleCreate"}),bsStyle:"primary",onClick:function(){h(!1),p(N),T("")}}]},l().createElement("div",{style:{padding:"1rem"}},l().createElement(u.ControlLabel,null,l().createElement(V.Z,{msgId:"gnviewer.createStyleTitleInput"})," "),l().createElement(se,{value:N,onChange:function(e){var t;return T(null==e||null===(t=e.target)||void 0===t?void 0:t.value)}})))),l().createElement(M.Z,null,l().createElement(G.Z,{title:l().createElement(V.Z,{msgId:"gnviewer.deleteStyleTitle"}),show:j,fitContent:!0,clickOutEnabled:!1,onClose:function(){P(!1)},buttons:[{text:l().createElement(V.Z,{msgId:"gnviewer.deleteStyleCancel"}),onClick:function(){P(!1)}},{text:l().createElement(V.Z,{msgId:"gnviewer.deleteStyleConfirm"}),bsStyle:"danger",onClick:function(){b(t.style),P(!1)}}]},l().createElement("div",{style:{padding:"1rem"}},l().createElement(V.Z,{msgId:"gnviewer.deleteStyleMessage"}))))):null})),me=(0,a.connect)((0,i.P1)([O.Vf,z.HG,z.V$],(function(e,t,n){return{layer:e,enabled:!(null==t||!t.includes("change_resourcebase")),isNew:n}})),{onClick:function(e,t){return{type:h,layer:e,options:t}}})((function(e){var t,n=e.layer,r=e.status,o=e.onClick,a=void 0===o?function(){}:o,i=e.enabled,c=e.isNew,s=e.btnProps,y=void 0===s?{}:s,d=e.hide,f=e.selectedStyle;return d||"LAYER"!==r||null==n||null===(t=n.extendedParams)||void 0===t||!t.mapLayer||!i&&!c?null:l().createElement(ye,le({variant:"primary",className:"square-button-md"},y,{onClick:function(e){e.stopPropagation(),e.preventDefault(),a(n,{style:f})},onMouseDown:function(e){e.stopPropagation(),e.preventDefault()}}),l().createElement(u.Glyphicon,{glyph:"dropper"}))}));const pe=(0,o.rx)("VisualStyleEditor",{component:ve,containers:{ActionNavbar:{name:"SaveStyle",Component:de},TOC:{target:"toolbar",Component:me},LayerSettings:{target:"style-button",Component:me}},reducers:{styleeditor:s.Z},epics:ae(ae({},y.ZP),x)})}}]);