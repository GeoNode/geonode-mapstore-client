"use strict";(self.webpackChunkgeonode_mapstore_client=self.webpackChunkgeonode_mapstore_client||[]).push([[2677],{50173(e,t,r){r.d(t,{A:()=>l});var n=r(273517),o=r.n(n),i=r(444003);function a(){return a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a.apply(null,arguments)}const l=function(e){return function(t){var r;return o().createElement(e,a({mapType:(0,i.Jq)(null==t||null===(r=t.map)||void 0===r?void 0:r.visualizationMode)},t))}}},109054(e,t,r){r.d(t,{A:()=>h});var n=r(273517),o=r.n(n),i=r(593737),a=r.n(i),l=r(605556),s=r.n(l),u=r(310340),c=r.n(u);function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}function f(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,g(n.key),n)}}function d(e,t,r){return t=m(t),function(e,t){if(t&&("object"==p(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,y()?Reflect.construct(t,r||[],m(e).constructor):t.apply(e,r))}function y(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(y=function(){return!!e})()}function m(e){return m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},m(e)}function b(e,t){return b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},b(e,t)}function v(e,t,r){return(t=g(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function g(e){var t=function(e){if("object"!=p(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=p(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==p(t)?t:t+""}const h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.debounceTime,r=e.querySelector,n=e.closest,i=void 0!==n&&n;return function(e){var n;return n=function(n){function l(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),v(n=d(this,l,[e]),"findDomNode",function(){if(!n.isMounded)return null;var e=c().findDOMNode(n);return e&&i&&r?e.closest(r||"*"):e&&(r?e.querySelector(r):e)}),n.width=void 0,n.height=void 0,n.skipOnMount=e.skipOnMount,n.div=null,n.onResize=a()(function(){var e;return(e=n.props).onResize.apply(e,arguments)},void 0!==t?t:e.debounceTime||1e3),n.ro=new ResizeObserver(function(e){e.forEach(function(e){var t=e.contentRect,r=t.width,o=t.height,i=n.props.handleWidth&&n.width!==r,a=n.props.handleHeight&&n.height!==o;n.skipOnMount||!i&&!a||n.onResize({width:r,height:o}),n.width=r,n.height=o,n.skipOnMount=!1})}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&b(e,t)}(l,n),s=l,(u=[{key:"componentDidMount",value:function(){this.isMounded=!0,this.div=this.findDomNode(),this.div&&this.ro.observe(this.div)}},{key:"componentDidUpdate",value:function(){this.div=this.findDomNode(),this.div&&this.ro.observe(this.div)}},{key:"componentWillUnmount",value:function(){var e=this.findDomNode();e&&this.ro&&this.ro.unobserve&&this.ro.unobserve(e)}},{key:"render",value:function(){return o().createElement(e,this.props)}}])&&f(s.prototype,u),Object.defineProperty(s,"prototype",{writable:!1}),s;var s,u}(o().Component),v(n,"propTypes",{handleWidth:s().bool,handleHeight:s().bool,onResize:s().func}),v(n,"defaultProps",{onResize:function(){},handleWidth:!0,handleHeight:!0}),n}}},129519(e,t,r){r.d(t,{A:()=>i});var n=r(811668),o=r(8571);const i=(0,n.connect)(function(e){return{locale:e.locale&&e.locale.currentLocale,messages:e.locale&&e.locale.messages||[]}})(o.A)},159686(e,t,r){r.d(t,{A:()=>f});var n=r(916589),o=r(245528),i=r(45388),a=r.n(i);function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach(function(t){c(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function c(e,t,r){return(t=function(e){var t=function(e){if("object"!=l(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=l(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==l(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var p=(0,n.mapPropsStreamWithConfig)(o.A);const f=(0,n.compose)((0,n.defaultProps)({dataStreamFactory:function(){return a().Observable.of({})}}),p(function(e){return e.take(1).switchMap(function(t){return t.dataStreamFactory(e.startWith(t),t)}).combineLatest(e,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(u({},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),e)})}))},223062(e,t,r){r.d(t,{$A:()=>q,$P:()=>Fe,AM:()=>te,AW:()=>V,Ap:()=>K,Bb:()=>Ee,Bo:()=>Ae,CS:()=>Le,DB:()=>_,Dt:()=>Pe,EV:()=>l,Fc:()=>$,Gs:()=>oe,Jd:()=>ne,Js:()=>se,Ke:()=>de,Kh:()=>fe,Lp:()=>A,MI:()=>T,Mj:()=>v,PN:()=>M,Q5:()=>R,QJ:()=>C,Ro:()=>I,Rx:()=>x,T:()=>y,TF:()=>f,TK:()=>P,TS:()=>Se,Tk:()=>Te,Tq:()=>w,Ur:()=>Q,Vq:()=>xe,Wu:()=>he,XD:()=>Ne,Xb:()=>O,YX:()=>ce,Zi:()=>ye,Zs:()=>k,Zv:()=>pe,bA:()=>De,bB:()=>be,bY:()=>Ie,cH:()=>B,cL:()=>we,ds:()=>h,eQ:()=>c,et:()=>J,g:()=>re,g5:()=>N,g8:()=>W,gJ:()=>i,hA:()=>Oe,hT:()=>le,hX:()=>ge,hr:()=>a,hz:()=>G,j3:()=>E,jR:()=>X,k8:()=>b,kR:()=>U,lS:()=>ee,m5:()=>p,mj:()=>Y,pp:()=>d,pr:()=>u,qG:()=>Z,qS:()=>ae,qT:()=>g,qi:()=>m,qq:()=>L,qu:()=>me,rQ:()=>z,ue:()=>H,vH:()=>s,vT:()=>ue,wK:()=>Ce,wd:()=>ie,y$:()=>S,yP:()=>ve,yq:()=>F,yz:()=>D,ze:()=>j});var n=r(995531);function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}var i="ADD_FILTER_FIELD",a="REMOVE_FILTER_FIELD",l="UPDATE_FILTER_FIELD",s="UPDATE_EXCEPTION_FIELD",u="ADD_GROUP_FIELD",c="UPDATE_LOGIC_COMBO",p="REMOVE_GROUP_FIELD",f="CHANGE_CASCADING_VALUE",d="EXPAND_ATTRIBUTE_PANEL",y="EXPAND_SPATIAL_PANEL",m="QUERYFORM:EXPAND_CROSS_LAYER",b="QUERYFORM:SET_CROSS_LAYER_PARAMETER",v="QUERYFORM:RESET_CROSS_LAYER_FILTER",g="SELECT_SPATIAL_METHOD",h="SELECT_VIEWPORT_SPATIAL_METHOD",O="UPDATE_GEOMETRY",F="SELECT_SPATIAL_OPERATION",E="CHANGE_SPATIAL_ATTRIBUTE",w="CHANGE_SPATIAL_FILTER_VALUE",j="REMOVE_SPATIAL_SELECT",S="SHOW_SPATIAL_DETAILS",P="QUERY_FORM_SEARCH",T="QUERY_FORM_RESET",A="SHOW_GENERATED_FILTER",x="CHANGE_DWITHIN_VALUE",C="ZONE_SEARCH",I="ZONE_SEARCH_ERROR",D="ZONE_FILTER",L="ZONE_CHANGE",N="ZONES_RESET",q="SIMPLE_FILTER_FIELD_UPDATE",_="ADD_SIMPLE_FILTER_FIELD",R="REMOVE_SIMPLE_FILTER_FIELD",M="REMOVE_ALL_SIMPLE_FILTER_FIELDS",k="UPDATE_FILTER_FIELD_OPTIONS",U="LOADING_FILTER_FIELD_OPTIONS",G="QUERYFORM:ADD_CROSS_LAYER_FILTER_FIELD",z="QUERYFORM:UPDATE_CROSS_LAYER_FILTER_FIELD",B="QUERYFORM:REMOVE_CROSS_LAYER_FILTER_FIELD",V="QUERYFORM:UPDATE_CROSS_LAYER_FILTER_FIELD_OPTIONS",W="SET_AUTOCOMPLETE_MODE",H="TOGGLE_AUTOCOMPLETE_MENU",Q="QUERYFORM:LOAD_FILTER",Y="QUERYFORM:UPSERT_FILTERS",X="QUERYFORM:REMOVE_FILTERS",Z="QUERYFORM:CHANGE_MAP_EDITOR",K=function(e){return{type:Z,mapData:e}};function J(e){return{type:i,groupId:e}}function $(e,t){return{type:u,groupId:e,index:t}}function ee(e){return{type:a,rowId:e}}function te(e,t){return{type:H,rowId:e,status:t,layerFilterType:arguments.length>2&&void 0!==arguments[2]?arguments[2]:"filterField"}}function re(e,t,r,n){return{type:l,rowId:e,fieldName:t,fieldValue:r,fieldType:n,fieldOptions:arguments.length>4&&void 0!==arguments[4]?arguments[4]:{}}}function ne(e,t){return{type:s,rowId:e,exceptionMessage:t}}function oe(e,t){return{type:c,groupId:e,logic:t}}function ie(e){return{type:W,status:e}}function ae(e){return{type:p,groupId:e}}function le(e){return{type:f,attributes:e}}function se(e){return{type:d,expand:e}}function ue(e){return{type:y,expand:e}}function ce(e){return{type:m,expand:e}}function pe(e,t){return{type:b,key:e,value:t}}function fe(e,t){return{type:g,fieldName:t,method:e}}function de(){return{type:h}}function ye(e){return{type:O,geometry:e}}function me(e,t){return{type:F,fieldName:t,operation:e}}function be(e){return{type:E,attribute:e}}function ve(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.feature,r=e.srsName,n=e.collectGeometries,o=e.style,i=e.options,a=e.value;return{type:w,value:a,collectGeometries:n,options:i,geometry:t&&t.geometry,feature:t,srsName:r,style:o}}function ge(){return{type:j}}function he(e){return{type:S,show:e}}function Oe(e){return{type:x,distance:e}}function Fe(e,t){return{type:P,searchUrl:e,filterObj:t}}function Ee(e){return{type:Q,filter:e}}function we(e){return{type:T,skip:e}}function je(e,t){return{type:I,error:e,id:t}}function Se(e,t){return{type:C,active:e,id:t}}function Pe(e,t,r){return function(i){return n.A.post(e,t,{timeout:1e4,headers:{Accept:"application/json","Content-Type":"text/plain"}}).then(function(n){var a=n.data;if("object"!==o(a))try{a=JSON.parse(a)}catch(n){i(je("Search result broken ("+e+":   "+t+"): "+n.message,r))}i(function(e,t){return{type:D,data:e,id:t}}(a,r)),i(Se(!1,r))}).catch(function(e){i(je(e,r))})}}function Te(e,t){return{type:L,id:e,value:t}}function Ae(e){return{type:G,rowId:(new Date).getTime(),groupId:e}}function xe(e,t,r,n){return{type:z,rowId:e,fieldName:t,fieldValue:r,fieldType:n,fieldOptions:arguments.length>4&&void 0!==arguments[4]?arguments[4]:{}}}function Ce(e){return{type:B,rowId:e}}function Ie(){return{type:v}}function De(e,t){return{type:U,status:e,filterField:t,layerFilterType:arguments.length>2&&void 0!==arguments[2]?arguments[2]:"filterField"}}function Le(e,t,r){return{type:k,filterField:e,options:t,valuesCount:r}}function Ne(e,t,r){return{type:V,filterField:e,options:t,valuesCount:r}}},367091(e,t,r){r.d(t,{A:()=>u});var n=r(916589),o=r(109054);function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach(function(t){s(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function s(e,t,r){return(t=function(e){var t=function(e){if("object"!=i(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=i(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==i(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(0,n.compose)((0,n.withStateHandlers)(function(){return{resize:0}},{onResize:function(e){var t=e.resize,r=void 0===t?0:t;return function(){return{resize:r+1}}}}),(0,o.A)({debounceTime:e}),(0,n.withProps)(function(e){var t=e.options,r=e.resize;return{options:l(l({},t),{},{resize:r})}}))}},405624(e,t,r){r.r(t),r.d(t,{default:()=>xo});var n=r(809136),o=r.n(n),i=r(605556),a=r.n(i),l=r(273517),s=r.n(l),u=r(811668),c=r(999990),p=r(706702),f=r(801081),d=r(223062),y=r(415392),m=r(400580);const b=(0,u.connect)(function(e){return{groupLevels:e.queryform.groupLevels,groupFields:e.queryform.groupFields,filterFields:e.queryform.filterFields,attributes:e.query&&e.query.typeName&&e.query.featureTypes&&e.query.featureTypes[e.query.typeName]&&e.query.featureTypes[e.query.typeName].attributes,attributePanelExpanded:e.queryform.attributePanelExpanded,autocompleteEnabled:e.queryform.autocompleteEnabled,maxFeaturesWPS:e.queryform.maxFeaturesWPS}},function(e){return{actions:(0,p.zH)({onAddGroupField:d.Fc,onAddFilterField:d.et,onRemoveFilterField:d.lS,onUpdateFilterField:d.g,onUpdateExceptionField:d.Jd,onUpdateLogicCombo:d.Gs,onRemoveGroupField:d.qS,onChangeCascadingValue:d.hT,toggleMenu:d.AM,onExpandAttributeFilterPanel:d.Js},e),controlActions:(0,p.zH)({onToggleQuery:y.KP.bind(null,"queryPanel",null)},e)}})(m.A);var v=r(131127),g=r(432267),h=r(717140),O=r(356513),F=r.n(O),E=r(104567),w=r.n(E),j=r(8117),S=r(590421),P=r(628017),T=r(712901),A=r(645617),x=r(908437),C=r.n(x),I=r(916589),D=r(245528),L=r(102685),N=r(7157),q=r(962028),_=r.n(q),R=r(455268),M=r(306840),k=r(897286);function U(e){return U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},U(e)}function G(){return G=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},G.apply(null,arguments)}function z(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Y(n.key),n)}}function B(e,t,r){return t=W(t),function(e,t){if(t&&("object"==U(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,V()?Reflect.construct(t,r||[],W(e).constructor):t.apply(e,r))}function V(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(V=function(){return!!e})()}function W(e){return W=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},W(e)}function H(e,t){return H=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},H(e,t)}function Q(e,t,r){return(t=Y(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Y(e){var t=function(e){if("object"!=U(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=U(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==U(t)?t:t+""}var X=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return Q(e=B(this,t,[].concat(n)),"state",{}),Q(e,"renderWithTooltip",function(t){if(e.props.tooltip.customizedTooltip){var r=e.props.tooltip.customizedTooltip;return s().createElement(r,null,t)}var n=s().createElement(j.m_,{id:e.props.tooltip.id},"this.props.tooltip.message");return s().createElement(M.A,{key:e.props.tooltip.overlayTriggerKey,placement:e.props.tooltip.placement,overlay:n},t)}),Q(e,"renderPagination",function(){var t=e.props.pagination.firstPage,r=e.props.pagination.lastPage;return s().createElement("div",{className:"autocomplete-toolbar"},!t&&s().createElement(j.e6,{className:e.props.prevPageIcon,glyph:e.props.prevPageIcon,onClick:function(){return e.props.pagination.loadPrevPage()}}),!r&&s().createElement(j.e6,{className:e.props.nextPageIcon,glyph:e.props.nextPageIcon,onClick:function(){return e.props.pagination.loadNextPage()}}))}),Q(e,"renderField",function(){var t={emptyList:function(){return e.props.busy?"Loading...":(0,P.kA)(e.context.messages,"queryform.attributefilter.autocomplete.emptyList")},open:(0,P.kA)(e.context.messages,"queryform.attributefilter.autocomplete.open"),emptyFilter:(0,P.kA)(e.context.messages,"queryform.attributefilter.autocomplete.emptyFilter")},r=[];e.props.data&&e.props.data.length>0&&(r=e.props.data.map(function(e){return e})),e.props.pagination&&e.props.pagination.paginated&&r.length>0&&r.push(Q(Q(Q(Q({},e.props.textField,""),e.props.valueField,""),"disabled",!0),"pagination",e.renderPagination()));var n=!1,o=e.props.loading?[]:r,i=e.props.itemComponent,a=s().createElement(R.Combobox,{dropUp:e.props.dropUp,busy:e.props.busy,data:o,disabled:e.props.disabled,itemComponent:function(t){return s().createElement(i,G({textField:e.props.textField,valueField:e.props.valueField},t))},messages:e.props.messages||t,open:e.props.open,filter:!1,onChange:function(t){e.props.onChange(t,e.props.valueField),n=!0},onFocus:function(){return e.props.onFocus(e.props.data)},onSelect:function(t){var r=_()(e.props.features.filter(function(r){return r.properties[e.props.valueField].toLowerCase()===t[e.props.valueField].toLowerCase()}));e.props.onSelect(t,r,e.props.srsName,e.props.style)},onToggle:function(t){var r=_()(e.props.features.filter(function(t){return t.properties[e.props.valueField].toLowerCase()===e.props.selectedValue.toLowerCase()}));!t||e.props.selectedValue||e.props.selectedValue||n||e.props.onChange("",e.props.valueField),e.props.onToggle(t,r,e.props.pagination.currentPage),r&&!t&&e.props.onSelect(e.props.selectedValue,r,e.props.srsName,e.props.style),n=!1},textField:e.props.textField,valueField:e.props.valueField,value:e.props.selectedValue});return e.props.tooltip&&e.props.tooltip.enabled?e.renderWithTooltip(a):a}),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&H(e,t)}(t,e),r=t,(n=[{key:"render",value:function(){var e=this.props.label?s().createElement("label",null,this.props.label):s().createElement("span",null);return s().createElement("div",{className:"autocompleteField"},e,this.renderField())}}])&&z(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n}(s().Component);Q(X,"propTypes",{busy:a().bool,data:a().array,disabled:a().bool,dropUp:a().bool,features:a().array,filter:a().string,itemComponent:a().oneOfType([a().object,a().func]),label:a().string,loading:a().bool,messages:a().object,onChange:a().func,onFocus:a().func,onSelect:a().func,onToggle:a().func,onChangeDrawingStatus:a().func,style:a().style,open:a().bool,pagination:a().object,nextPageIcon:a().string,prevPageIcon:a().string,selectedValue:a().string,srsName:a().string,textField:a().string,tooltip:a().object,valueField:a().string}),Q(X,"contextTypes",{messages:a().object}),Q(X,"defaultProps",{dropUp:!1,features:[],filter:"",itemComponent:k.A,loading:!1,label:null,pagination:{paginated:!0,firstPage:!1,lastPage:!1,loadPrevPage:function(){},loadNextPage:function(){}},nextPageIcon:"chevron-right",prevPageIcon:"chevron-left",onFocus:function(){},onToggle:function(){},onChange:function(){},onChangeDrawingStatus:function(){},onSelect:function(){},srsName:"EPSG:4326",textField:"label",tooltip:{customizedTooltip:void 0,enabled:!1,id:"",message:void 0,overlayTriggerKey:"",placement:"top"},valueField:"value"});const Z=X;function K(e){return K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},K(e)}function J(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function $(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?J(Object(r),!0).forEach(function(t){ee(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):J(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function ee(e,t,r){return(t=function(e){var t=function(e){if("object"!=K(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=K(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==K(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}(0,I.setObservableConfig)(D.A);var te=(0,I.mapPropsStreamWithConfig)(D.A)(function(e){return e.take(1).switchMap(function(t){return t.autocompleteStreamFactory(e)}).combineLatest(e,function(e,t){return $($({},t),{},{data:C()(e&&e.fetchedData&&e.fetchedData.values)?e.fetchedData.values:[],features:C()(e&&e.fetchedData&&e.fetchedData.features)?e.fetchedData.features:[],valuesCount:e&&e.fetchedData&&e.fetchedData.size,srsName:e&&e.fetchedData&&e.fetchedData.crs,busy:e.busy})})})(function(e){var t=e.open,r=e.toggle,n=e.select,o=e.focus,i=e.change,a=e.changed,l=e.originalValue,u=e.value,c=e.valuesCount,p=e.onChangeDrawingStatus,f=e.loadNextPage,d=e.loadPrevPage,y=e.maxFeatures,m=e.currentPage,b=e.itemComponent,v=e.features,g=e.busy,h=e.data,O=e.loading,F=void 0!==O&&O,E=e.valueField,w=e.textField,j=e.filter,S=e.srsName,P=e.style,T=Math.ceil(c/y);return s().createElement(Z,{pagination:{firstPage:1===m,lastPage:T<=m,paginated:!0,loadPrevPage:d,loadNextPage:f,currentPage:m},srsName:S,busy:g,dropUp:!1,data:h,open:t,onChangeDrawingStatus:p,valueField:E,textField:w,itemComponent:b,filter:j,onFocus:o,onToggle:r,onChange:i,onSelect:n,features:v,style:P,selectedValue:a?u:l||u,loading:F})}),re=(0,I.compose)((0,I.withPropsOnChange)(["valueField"],function(){return{value:void 0}}),(0,I.withStateHandlers)(function(e){return{delayDebounce:0,performFetch:!1,open:!1,currentPage:1,maxFeatures:5,changed:e.value,value:e.value,onChangeDrawingStatus:e.onChangeDrawingStatus,itemComponent:e.itemComponent}},{select:function(){return function(e){return{selected:e}}},change:function(e){return function(t,r){return e.selected||e.open||e.onChangeDrawingStatus("clean","","queryform",[],{}),{delayDebounce:500,selected:!1,changingPage:!1,changed:!0,performFetch:!(e.selected&&!e.changingPage),value:e.selected&&e.changingPage&&e.value||("string"==typeof t?t:t[r]),currentPage:e.changingPage?e.currentPage:1}}},focus:function(e){return function(t){return t&&0===t.length&&""===e.value?{delayDebounce:0,currentPage:1,performFetch:!0,isToggled:!1,open:!0}:e}},toggle:function(e){return function(){return{open:!!e.changingPage||!e.open}}},loadNextPage:function(e){return function(){return{currentPage:e.currentPage+1,performFetch:!0,changingPage:!0,delayDebounce:0}}},loadPrevPage:function(e){return function(){return{currentPage:e.currentPage-1,performFetch:!0,changingPage:!0,delayDebounce:0}}}}),(0,I.withHandlers)({select:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.options,r=e.onChangeSpatialFilterValue,n=void 0===r?function(){}:r,o=e.select,i=void 0===o?function(){}:o;return function(e,r,o,a){r&&n({geometry:r.geometry,value:e,feature:r,srsName:o,style:a,options:t,collectGeometries:t&&t.crossLayer?{queryCollection:{typeName:t.crossLayer.typeName,geometryName:t.crossLayer.geometryName,cqlFilter:(0,N.bD)(t.crossLayer.cqlTemplate||"",L.mk)(r)}}:void 0}),i(!0)}}})),ne=re(te),oe=r(209250),ie=r(868097);function ae(e){return ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ae(e)}function le(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,fe(n.key),n)}}function se(e,t,r){return t=ce(t),function(e,t){if(t&&("object"==ae(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,ue()?Reflect.construct(t,r||[],ce(e).constructor):t.apply(e,r))}function ue(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(ue=function(){return!!e})()}function ce(e){return ce=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ce(e)}function pe(e,t){return pe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},pe(e,t)}function fe(e){var t=function(e){if("object"!=ae(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=ae(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ae(t)?t:t+""}var de,ye,me,be=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),se(this,t,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&pe(e,t)}(t,e),r=t,(n=[{key:"render",value:function(){return s().createElement("span",{className:this.props.customItemClassName?this.props.customItemClassName:""},this.props.item)}}])&&le(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n}(s().Component);de=be,ye="propTypes",me={item:a().string,textField:a().string,customItemClassName:a().string,valueField:a().string},(ye=fe(ye))in de?Object.defineProperty(de,ye,{value:me,enumerable:!0,configurable:!0,writable:!0}):de[ye]=me;const ve=be;var ge=r(764932);function he(e){return he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},he(e)}function Oe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Pe(n.key),n)}}function Fe(e,t,r){return t=we(t),function(e,t){if(t&&("object"==he(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Ee()?Reflect.construct(t,r||[],we(e).constructor):t.apply(e,r))}function Ee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Ee=function(){return!!e})()}function we(e){return we=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},we(e)}function je(e,t){return je=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},je(e,t)}function Se(e,t,r){return(t=Pe(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Pe(e){var t=function(e){if("object"!=he(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=he(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==he(t)?t:t+""}var Te=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return Se(e=Fe(this,t,[].concat(n)),"onUpdateBBOX",function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"replace";"replace"===n&&(e.tempExtent[r]=!isNaN(parseFloat(t))&&parseFloat(t)||0);var o=[];for(var i in e.tempExtent)i&&o.push(e.tempExtent[i]);var a=(0,ge.reprojectBbox)(o,"EPSG:4326",e.props.projection),l={type:e.props.geometry.type,coordinates:[[[a[0],a[1]],[a[0],a[3]],[a[2],a[3]],[a[2],a[1]],[a[0],a[1]]]],projection:e.props.geometry.projection};e.props.onChangeDrawingStatus(n,void 0,"queryform",[l])}),Se(e,"onUpdateCircle",function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"replace";"replace"===n&&(e.tempCircle[r]=parseFloat(t));var o=isNaN(parseFloat(e.tempCircle.x))||isNaN(parseFloat(e.tempCircle.y))?[e.tempCircle.x,e.tempCircle.y]:(0,ge.reproject)([e.tempCircle.x,e.tempCircle.y],"EPSG:4326",e.props.projection);o=void 0===o.x?{x:o[0],y:o[1]}:o;var i={x:isNaN(o.x)?0:o.x,y:isNaN(o.y)?0:o.y},a={type:e.props.geometry.type,center:i,coordinates:[i.x,i.y],radius:isNaN(e.tempCircle.radius)?0:e.tempCircle.radius,projection:e.props.geometry.projection};e.props.onChangeDrawingStatus(n,void 0,"queryform",[a],{geodesic:e.props.enableGeodesic})}),Se(e,"onModifyGeometry",function(){"BBOX"===e.props.type?e.onUpdateBBOX(null,null,"endDrawing"):"Circle"===e.props.type&&e.onUpdateCircle(null,null,"endDrawing"),e.props.onShowPanel(!1)}),Se(e,"onClosePanel",function(){e.resetGeom(),e.props.onShowPanel(!1)}),Se(e,"getStep",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return Math.min(1/Math.pow(10,Math.ceil(Math.min(e,21)/3)-2),1)}),Se(e,"getStepCircle",function(t,r){var n=e.getStep(t);return"radius"===r&&!e.isWGS84()&&1e4*n||n}),Se(e,"getBBOXDimensions",function(e){var t=(0,ge.reprojectBbox)(e.extent,e.projection,"EPSG:4326");return{west:t[0],sud:t[1],est:t[2],north:t[3]}}),Se(e,"getCircleDimensions",function(t){var r=(0,ge.reproject)(t.center,t.projection,"EPSG:4326"),n=(0,ge.reproject)(t.center,t.projection,e.props.projection),o=(0,ge.reproject)([t.center[0]+t.radius,t.center[1]],t.projection,e.props.projection),i=Math.sqrt((o.x-n.x)*(o.x-n.x)+(o.y-n.y)*(o.y-n.y));return{x:r.x,y:r.y,radius:i}}),Se(e,"renderCoordinateField",function(t,r){return s().createElement("div",null,s().createElement("div",{className:"detail-field-title"},r),s().createElement(A.A,{style:{minWidth:"105px",margin:"auto"},type:"number",id:"queryform_bbox_"+r,step:e.getStep(e.props.zoom),defaultValue:e.roundValue(t,1e6),onChange:function(t){return e.onUpdateBBOX(t,r)}}))}),Se(e,"renderCircleField",function(t,r){return s().createElement(A.A,{type:"number",id:"queryform_circle_"+r,defaultValue:e.roundValue(t,"radius"!==r||e.isWGS84()?1e6:100),step:e.getStepCircle(e.props.zoom,r),onChange:function(t){return e.onUpdateCircle(t,r)}})}),Se(e,"renderDetailsContent",function(){var t,r=e.props.geometry;if("BBOX"===e.props.type){var n=e.getBBOXDimensions(r);t=s().createElement("div",null,s().createElement("div",{className:"container-fluid"},s().createElement(j.fI,null,s().createElement(j.fv,{xs:4},s().createElement("span",null)),s().createElement(j.fv,{xs:4},e.renderCoordinateField(n.north,"north")),s().createElement(j.fv,{xs:4},s().createElement("span",null))),s().createElement(j.fI,null,s().createElement(j.fv,{xs:4},e.renderCoordinateField(n.west,"west")),s().createElement(j.fv,{xs:4},s().createElement("span",null)),s().createElement(j.fv,{xs:4},e.renderCoordinateField(n.est,"est"))),s().createElement(j.fI,null,s().createElement(j.fv,{xs:4},s().createElement("span",null)),s().createElement(j.fv,{xs:4},e.renderCoordinateField(n.sud,"sud")),s().createElement(j.fv,{xs:4},s().createElement("span",null)))),s().createElement("span",null,s().createElement("hr",{width:"90%"}),s().createElement("div",null,s().createElement("h5",null,s().createElement(T.Ay.Message,{msgId:"queryform.spatialfilter.details.details_bbox_label"})))))}else if("Circle"===e.props.type){var o=e.getCircleDimensions(r),i=(0,ge.getUnits)(e.props.projection);t=s().createElement("div",null,s().createElement("div",{className:"container-fluid"},s().createElement(j.fI,null,s().createElement(j.fv,{xs:2},s().createElement("span",null)),s().createElement(j.fv,{xs:2},s().createElement("span",{className:"details-circle-attribute-name"},"x:")),s().createElement(j.fv,{xs:4},e.renderCircleField(o.x,"x")),s().createElement(j.fv,{xs:4},s().createElement("span",null))),s().createElement(j.fI,null,s().createElement(j.fv,{xs:2},s().createElement("span",null)),s().createElement(j.fv,{xs:2},s().createElement("span",{className:"details-circle-attribute-name"},"y:")),s().createElement(j.fv,{xs:4},e.renderCircleField(o.y,"y")),s().createElement(j.fv,{xs:4},s().createElement("span",null))),s().createElement(j.fI,null,s().createElement(j.fv,{xs:2},s().createElement("span",null)),s().createElement(j.fv,{xs:2},s().createElement("span",{className:"details-circle-attribute-name"},s().createElement(T.Ay.Message,{msgId:"queryform.spatialfilter.details.radius",msgParams:{unit:"degrees"===i?"Â°":i}}),":")),s().createElement(j.fv,{xs:4},e.renderCircleField(o.radius,"radius")),s().createElement(j.fv,{xs:4},s().createElement("span",null)))),s().createElement("span",null,s().createElement("hr",{width:"90%"}),s().createElement("div",null,s().createElement("h5",null,s().createElement(T.Ay.Message,{msgId:"queryform.spatialfilter.details.details_circle_label"})))))}return t}),Se(e,"isWGS84",function(){return"EPSG:4326"===e.props.projection}),Se(e,"roundValue",function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e6;return Math.round(e*t)/t}),Se(e,"resetGeom",function(){"BBOX"===e.props.type?e.resetBBOX():"Circle"===e.props.type&&e.resetCircle()}),Se(e,"resetBBOX",function(){for(var t in e.extent)t&&(document.getElementById("queryform_bbox_"+t).value=e.roundValue(e.extent[t],1e6),e.onUpdateBBOX(e.extent[t],t))}),Se(e,"resetCircle",function(){document.getElementById("queryform_circle_radius").value=e.roundValue(e.circle.radius,100),e.onUpdateCircle(e.circle.radius,"radius"),document.getElementById("queryform_circle_x").value=e.roundValue(e.circle.x,e.isWGS84()?1e6:100),e.onUpdateCircle(e.circle.x,"x"),document.getElementById("queryform_circle_y").value=e.roundValue(e.circle.y,e.isWGS84()?1e6:100),e.onUpdateCircle(e.circle.y,"y")}),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&je(e,t)}(t,e),function(e,t){return t&&Oe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"componentDidMount",value:function(){var e=this.props.geometry;"BBOX"===this.props.type?(this.extent=this.getBBOXDimensions(e),this.tempExtent=Object.assign({},this.extent)):"Circle"===this.props.type&&(this.circle=this.getCircleDimensions(e),this.tempCircle=Object.assign({},this.circle))}},{key:"render",value:function(){var e=this;return s().createElement(oe.A,{buttons:[{key:"confirm",glyph:"ok",tooltipId:"confirm",onClick:function(){return e.onModifyGeometry()}},{key:"reset",tooltipId:"queryform.reset",glyph:"clear-filter",onClick:function(){return e.resetGeom()}},{key:"close",glyph:"1-close",onClick:function(){return e.onClosePanel(!1)}}],title:s().createElement(T.Ay.Message,{msgId:"queryform.spatialfilter.details.details_header"}),locked:!0,expanded:!0,className:"details-panel",bsStyle:"primary"},this.renderDetailsContent())}}])}(s().Component);Se(Te,"propTypes",{useMapProjection:a().bool,geometry:a().object,type:a().string,onShowPanel:a().func,onChangeDrawingStatus:a().func,zoom:a().number,projection:a().string,enableGeodesic:a().bool}),Se(Te,"defaultProps",{useMapProjection:!0,geometry:null,type:null,onShowPanel:function(){},onChangeDrawingStatus:function(){}});const Ae=Te;function xe(e){return xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xe(e)}function Ce(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_e(n.key),n)}}function Ie(e,t,r){return t=Le(t),function(e,t){if(t&&("object"==xe(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,De()?Reflect.construct(t,r||[],Le(e).constructor):t.apply(e,r))}function De(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(De=function(){return!!e})()}function Le(e){return Le=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Le(e)}function Ne(e,t){return Ne=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ne(e,t)}function qe(e,t,r){return(t=_e(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _e(e){var t=function(e){if("object"!=xe(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=xe(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==xe(t)?t:t+""}var Re=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return qe(e=Ie(this,t,[].concat(n)),"state",{open:!1}),qe(e,"getFilter",function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"*",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"=",n={filterFields:[{attribute:e.props.searchAttribute,operator:r,value:t,type:"list"}]};return e.props.dependsOn&&(n.groupFields=[{id:1,logic:"AND",index:0}],n.filterFields[0].groupId=1,e.props.multivalue?(n.groupFields.push({id:2,logic:"OR",groupId:1,index:1}),e.props.dependsOn.value instanceof Array?e.props.dependsOn.value.forEach(function(t){n.filterFields.push({attribute:e.props.dependsOn.field,operator:e.props.dependsOn.operator||"=",value:t,groupId:2,type:"list"})}):n.filterFields.push({attribute:e.props.dependsOn.field,operator:e.props.dependsOn.operator||"=",value:e.props.dependsOn.value,groupId:2,type:"list"})):n.filterFields.push({attribute:e.props.dependsOn.field,operator:e.props.dependsOn.operator||"=",value:e.props.dependsOn.value,groupId:1,type:"list"})),(0,L.T$)(e.props.typeName,n,e.props.wfs,e.props.sort||{sortBy:e.props.searchAttribute,sortOrder:"ASC"})}),qe(e,"changeZoneValue",function(t,r,n){var o;e.setState({open:!1}),o=e.props.multivalue?{value:n.map(function(e){return e.id}),feature:n.map(function(e){return e.feature})}:{value:[n],feature:[e.values.filter(function(e){return e.id===n})[0].feature]},e.props.onChange(e.props.zoneId,o)}),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ne(e,t)}(t,e),function(e,t){return t&&Ce(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"UNSAFE_componentWillReceiveProps",value:function(e){e.values&&!o()(this.props.values,e.values)&&e.values.length>0&&this.setState({open:!0})}},{key:"render",value:function(){var e=this;this.values=[],this.props.values&&this.props.values.length>0&&(this.values=this.props.values.map(function(t){var r=t;e.props.valueField.split(".").forEach(function(e){r=r?r[e]:null});var n=t;return e.props.textField.split(".").forEach(function(e){n=n?n[e]:null}),{id:r,name:n,feature:t}}));var t=this.props.label?s().createElement("label",null,this.props.label):s().createElement("span",null),r=this.props.error;return r&&(r="object"!==xe(r)?r:r.status+" "+r.statusText+": "+r.data),s().createElement("div",{className:"zone-combo"},t,s().createElement(ie.A,{key:(new Date).getTime(),busy:this.props.busy,disabled:this.props.disabled,fieldRowId:this.props.zoneId,valueField:"id",textField:"name",fieldOptions:this.values,fieldValue:this.props.value,fieldName:"zone",fieldException:r,options:{defaultOpen:this.state.open},groupBy:this.props.groupBy?function(t){return t.feature.properties[e.props.groupBy]}:function(){},multivalue:this.props.multivalue,comboFilter:this.props.comboFilter,onSelect:this.props.onSelect,onUpdateField:this.changeZoneValue,onToggle:function(t){if(t&&(!e.props.values||e.props.values.length<1)){var r=e.getFilter(e.props.searchText,e.props.searchMethod);e.props.onSearch(!0,e.props.zoneId),e.props.onFilter(e.props.url,r,e.props.zoneId)}}}))}}])}(s().Component);qe(Re,"propTypes",{zoneId:a().number,url:a().string,typeName:a().string,wfs:a().string,busy:a().bool,values:a().array,value:a().oneOfType([a().object,a().number,a().string,a().array]),label:a().string,searchText:a().string,searchMethod:a().string,searchAttribute:a().string,sort:a().object,error:a().oneOfType([a().object,a().string]),comboFilter:a().oneOfType([a().bool,a().string,a().func]),groupBy:a().oneOfType([a().string,a().func]),multivalue:a().bool,open:a().bool,disabled:a().bool,dependsOn:a().object,valueField:a().string,textField:a().string,onSearch:a().func,onFilter:a().func,onChange:a().func,onSelect:a().func}),qe(Re,"contextTypes",{messages:a().object}),qe(Re,"defaultProps",{open:!1,zoneId:null,url:null,typeName:null,wfs:"1.1.0",busy:!1,values:[],value:null,valueField:null,textField:null,label:null,disabled:!1,error:null,searchText:"*",searchMethod:"ilike",searchAttribute:null,comboFilter:"contains",multivalue:!0,groupBy:null,onSearch:function(){},onFilter:function(){},onChange:function(){},onSelect:function(){}});const Me=Re;function ke(e){return ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ke(e)}function Ue(){return Ue=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ue.apply(null,arguments)}function Ge(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Qe(n.key),n)}}function ze(e,t,r){return t=Ve(t),function(e,t){if(t&&("object"==ke(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Be()?Reflect.construct(t,r||[],Ve(e).constructor):t.apply(e,r))}function Be(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Be=function(){return!!e})()}function Ve(e){return Ve=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ve(e)}function We(e,t){return We=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},We(e,t)}function He(e,t,r){return(t=Qe(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Qe(e){var t=function(e){if("object"!=ke(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=ke(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ke(t)?t:t+""}var Ye=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return He(e=ze(this,t,[].concat(n)),"getMethodFromId",function(t){return F()(e.props.spatialMethodOptions,function(e){return e&&e.id===t})||null}),He(e,"renderHeader",function(){var t=(0,P.kA)(e.context.messages,"queryform.spatialfilter.spatial_filter_header");return s().createElement("span",null,s().createElement("span",{style:{cursor:"pointer"},onClick:e.props.actions.onExpandSpatialFilterPanel.bind(null,!e.props.spatialPanelExpanded)},t))}),He(e,"renderSpatialHeader",function(){var t=e.getMethodFromId(e.props.spatialField.method);return s().createElement("div",null,s().createElement(j.fI,{className:"logicHeader inline-form filter-field-row filter-field-fixed-row"},s().createElement(j.fv,{xs:6},s().createElement("div",null,s().createElement(T.Ay.Message,{msgId:"queryform.spatialfilter.filterType"}))),s().createElement(j.fv,{xs:6},s().createElement(ie.A,{itemComponent:function(t){return s().createElement(ve,Ue({customItemClassName:e.getMethodFromId(t.item)&&e.getMethodFromId(t.item).customItemClassName||""},t))},fieldOptions:e.props.spatialMethodOptions.map(function(t){return(0,P.kA)(e.context.messages,t.name)||t.name}),placeholder:(0,P.kA)(e.context.messages,"queryform.spatialfilter.combo_placeholder"),fieldName:"method",fieldRowId:(new Date).getTime(),fieldValue:(0,P.kA)(e.context.messages,t?t.name:"")||t&&t.name||"",onUpdateField:e.updateSpatialMethod}))))}),He(e,"renderDwithin",function(){return s().createElement(j.fI,{className:"container-fluid filter-field-fixed-row"},s().createElement(j.fv,{xs:6,className:"filter-text-desc"},s().createElement(T.Ay.Message,{msgId:"queryform.spatialfilter.dwithin_label"})),s().createElement(j.fv,{xs:6},s().createElement(A.A,{type:"number",min:"0",defaultValue:"0",disabled:!e.props.spatialField.geometry,id:"queryform_dwithin_field",onChange:function(t){return e.props.actions.onChangeDwithinValue(t,name)}})))}),He(e,"renderZoneFields",function(){return e.props.spatialField.method&&"ZONE"===e.props.spatialField.method&&e.props.spatialField.zoneFields&&e.props.spatialField.zoneFields.length>0?e.props.spatialField.zoneFields.map(function(t){return s().createElement(Me,{key:t.id,open:t.open,zoneId:t.id,url:t.url,typeName:t.typeName,wfs:t.wfs,busy:t.busy,label:t.label,values:t.values,value:t.value,valueField:t.valueField,textField:t.textField,searchText:t.searchText,searchMethod:t.searchMethod,searchAttribute:t.searchAttribute,sort:t.sort,error:t.error,disabled:t.disabled,dependsOn:t.dependson,groupBy:t.groupBy,multivalue:t.multivalue,onSearch:e.props.actions.zoneSearch,onFilter:e.props.actions.zoneFilter,onChange:e.props.actions.zoneChange})}):null}),He(e,"renderRoiPanel",function(){var t=e.getMethodFromId(e.props.spatialField.method),r=t&&t.filterProps&&t.filterProps.valueField&&e.props.spatialField&&e.props.spatialField.value&&e.props.spatialField.value[t.filterProps.valueField];return s().createElement(j.Zk,null,s().createElement("div",{className:"container-fluid"},s().createElement(j.fI,{className:"filter-field-row filter-field-fixed-row"},s().createElement(j.fv,{xs:6},s().createElement("span",null,t&&t.name||t.id)),s().createElement(j.fv,{xs:6},s().createElement(ne,{originalValue:r,key:e.props.spatialField.method,options:t,autocompleteStreamFactory:S.H6,valueField:t&&t.filterProps&&t.filterProps.valueField,textField:t&&t.filterProps&&t.filterProps.valueField,url:t&&t.url,filter:"contains",onChangeSpatialFilterValue:e.props.actions.onChangeSpatialFilterValue,onChangeDrawingStatus:function(){var t;(t=e.props.actions).onChangeDrawingStatus.apply(t,arguments)},filterProps:t&&t.filterProps})))))}),He(e,"renderSpatialPanel",function(t,r,n){return s().createElement(j.Zk,{className:"spatial-panel"},e.props.spatialMethodOptions.length>1?e.renderSpatialHeader():s().createElement("span",null),e.renderZoneFields(),e.props.spatialField.method&&e.getMethodFromId(e.props.spatialField.method)&&"wfsGeocoder"===e.getMethodFromId(e.props.spatialField.method).type?e.renderRoiPanel():null,e.props.spatialOperations.length>1?s().createElement(j.Zk,null,s().createElement("div",null,t),n&&"DWITHIN"===n.id?e.renderDwithin():null,s().createElement(j.fI,null,s().createElement(j.fv,{xs:12},r))):s().createElement("span",null))}),He(e,"renderButtons",function(){var t=[],r=e.props.showDetailsButton&&e.props.spatialField.geometry&&(e.props.spatialField.method&&"BBOX"===e.props.spatialField.method||"Circle"===e.props.spatialField.method),n=e.props.spatialField.geometry&&e.props.spatialField.geometry.coordinates;return r&&t.push({glyph:"pencil",onClick:function(){return e.props.actions.onShowSpatialSelectionDetails(!0)},tooltipId:"queryform.spatialfilter.details.detail_button_label"}),n&&t.push({glyph:"clear-filter",tooltipId:"queryform.spatialfilter.remove",bsStyle:e.props.clearFilterOptions.buttonStyle,className:e.props.clearFilterOptions.className,onClick:function(){return e.resetSpatialFilter()}}),t}),He(e,"updateSpatialMethod",function(t,r,n){e.props.actions.onShowSpatialSelectionDetails(!1);var o=e.props.spatialMethodOptions.filter(function(t){return n===((0,P.kA)(e.context.messages,t.name)||t.name)})[0].id,i=e.getMethodFromId(o);if(e.props.actions.onSelectSpatialMethod(o,r),"wfsGeocoder"!==e.getMethodFromId(o).type)switch(o){case"ZONE":e.changeDrawingStatus("clean","","queryform",[]);break;case"Viewport":e.changeDrawingStatus("clean","","queryform",[]),e.props.actions.onSelectViewportSpatialMethod();break;default:e.changeDrawingStatus("start",o,"queryform",[],{geodesic:!!w()(i.geodesic)||i.geodesic,stopAfterDrawing:!0})}else e.changeDrawingStatus("clean","","queryform",[])}),He(e,"updateSpatialOperation",function(t,r,n){var o=e.props.spatialOperations.filter(function(t){return n===(0,P.kA)(e.context.messages,t.name)})[0].id;e.props.actions.onSelectSpatialOperation(o,r)}),He(e,"resetSpatialFilter",function(){e.changeDrawingStatus("clean","","queryform",[]),e.props.actions.onRemoveSpatialSelection(),e.props.actions.onShowSpatialSelectionDetails(!1)}),He(e,"changeDrawingStatus",function(t,r,n,o,i){e.props.actions.onChangeDrawingStatus(t,void 0!==r?r:e.props.spatialField.method,n,o,i)}),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&We(e,t)}(t,e),function(e,t){return t&&Ge(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"render",value:function(){var e=this,t=this.props.spatialOperations.filter(function(t){return e.props.spatialField.operation===t.id})[0],r=s().createElement("span",null);"ZONE"!==this.props.spatialField.method&&"Viewport"!==this.props.spatialField.method&&this.getMethodFromId(this.props.spatialField.method)&&"wfsGeocoder"!==this.getMethodFromId(this.props.spatialField.method).type&&(r=this.props.spatialField.geometry?null:s().createElement("span",null,s().createElement("div",{className:"m-label m-caption text-center"},s().createElement(T.Ay.Message,{msgId:"queryform.spatialfilter.draw_start_label"}))));var n=this.getMethodFromId(this.props.spatialField.method),o=this.props.showDetailsPanel?s().createElement(Ae,{useMapProjection:this.props.useMapProjection,enableGeodesic:!!w()(n.geodesic)||n.geodesic,geometry:this.props.spatialField.geometry,type:this.props.spatialField.method,onShowPanel:this.props.actions.onShowSpatialSelectionDetails,onChangeDrawingStatus:this.changeDrawingStatus,zoom:this.props.zoom,projection:this.props.projection}):s().createElement("span",null),i=s().createElement(j.fI,{className:"filter-field-row inline-form filter-field-fixed-row"},s().createElement(j.fv,{xs:6},s().createElement(T.Ay.Message,{msgId:"queryform.spatialfilter.geometric_operation"})),s().createElement(j.fv,{xs:6},s().createElement(ie.A,{fieldOptions:this.props.spatialOperations.map(function(t){return(0,P.kA)(e.context.messages,t.name)}),fieldName:"operation",fieldRowId:(new Date).getTime(),fieldValue:(0,P.kA)(this.context.messages,t?t.name:""),onUpdateField:this.updateSpatialOperation})));return s().createElement("div",{className:"query-filter-container"},this.props.withContainer?s().createElement(oe.A,{id:"spatialFilterPanel",header:this.renderHeader(),buttons:this.renderButtons(),collapsible:!0,expanded:this.props.spatialPanelExpanded,onSwitch:function(t){return e.props.actions.onExpandSpatialFilterPanel(t)}},this.renderSpatialPanel(i,r,t)):this.renderSpatialPanel(i,r,t),o)}}])}(s().Component);He(Ye,"propTypes",{useMapProjection:a().bool,spatialField:a().object,spatialOperations:a().array,spatialMethodOptions:a().array,spatialPanelExpanded:a().bool,showDetailsButton:a().bool,clearFilterOptions:a().object,showDetailsPanel:a().bool,withContainer:a().bool,actions:a().object,zoom:a().number,projection:a().string}),He(Ye,"contextTypes",{messages:a().object}),He(Ye,"defaultProps",{useMapProjection:!0,spatialField:{},spatialPanelExpanded:!0,showDetailsButton:!0,clearFilterOptions:{className:"square-button no-border",buttonStyle:"default"},showDetailsPanel:!1,withContainer:!0,spatialMethodOptions:[],spatialOperations:[],actions:{onExpandSpatialFilterPanel:function(){},onSelectSpatialMethod:function(){},onSelectSpatialOperation:function(){},onChangeSpatialFilterValue:function(){},onChangeDrawingStatus:function(){},onRemoveSpatialSelection:function(){},onShowSpatialSelectionDetails:function(){},onSelectViewportSpatialMethod:function(){},onChangeRegion:function(){},onChangeDwithinValue:function(){},zoneFilter:function(){},zoneSearch:function(){},zoneChange:function(){}}});const Xe=Ye;var Ze=["useEmbeddedMap"],Ke=(0,u.connect)(function(e){return{useMapProjection:e.queryform.useMapProjection,spatialField:e.queryform.spatialField,showDetailsPanel:e.queryform.showDetailsPanel,spatialPanelExpanded:e.queryform.spatialPanelExpanded}},function(e){return{actions:(0,p.zH)({onChangeSpatialFilterValue:d.yP,onExpandSpatialFilterPanel:d.vT,onSelectSpatialMethod:d.Kh,onSelectViewportSpatialMethod:d.Ke,onSelectSpatialOperation:d.qu,onChangeDrawingStatus:h.VX,onRemoveSpatialSelection:d.hX,onShowSpatialSelectionDetails:d.Wu,onChangeDwithinValue:d.hA,zoneFilter:d.Dt,zoneSearch:d.TS,zoneChange:d.Tk},e)}})(Xe),Je=(0,u.connect)(function(e){return{zoom:((0,v.mg)(e)||{}).zoom,projection:((0,v.mg)(e)||{}).projection}})(Ke),$e=(0,u.connect)(function(e){return{zoom:((0,g.G_)(e)||{}).zoom,projection:((0,g.G_)(e)||{}).projection}})(Ke);var et=r(978632),tt=r.n(et),rt=r(45388),nt=r.n(rt),ot=r(545567),it=r(214158),at=r(872127),lt=r(159686);function st(e){return st="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},st(e)}function ut(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function ct(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ut(Object(r),!0).forEach(function(t){pt(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ut(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function pt(e,t,r){return(t=function(e){var t=function(e){if("object"!=st(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=st(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==st(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const ft=(0,I.compose)((0,I.withPropsOnChange)(["crossLayerFilter"],function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).crossLayerFilter,t=void 0===e?{}:e;return{queryCollection:tt()(t,"collectGeometries.queryCollection"),operation:tt()(t,"operation"),distance:tt()(t,"distance"),enabledAreaOfInterest:tt()(t,"enabledAreaOfInterest")}}),(0,I.withProps)(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.layers,r=void 0===t?[]:t,n=e.queryCollection,o=void 0===n?{}:n;return{layer:F()(r,function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).name===o.typeName})}}),(0,I.withHandlers)({setQueryCollectionParameter:function(e){var t=e.setCrossLayerFilterParameter,r=void 0===t?function(){}:t;return function(e,t){r("collectGeometries.queryCollection[".concat(e,"]"),t),"typeName"===e&&r("collectGeometries.queryCollection.filterFields",[])}},updateLogicCombo:function(e){var t=e.setCrossLayerFilterParameter,r=void 0===t?function(){}:t;return function(e,t){return r("collectGeometries.queryCollection.groupFields",[{id:e,logic:t,index:0}])}},setOperation:function(e){var t=e.setCrossLayerFilterParameter,r=void 0===t?function(){}:t;return function(e){return r("operation",e)}},setEnabledAreaOfInterest:function(e){var t=e.setCrossLayerFilterParameter,r=void 0===t?function(){}:t;return function(e){return r("enabledAreaOfInterest",e)}}}),(0,I.defaultProps)({dataStreamFactory:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).setQueryCollectionParameter,r=void 0===t?function(){}:t;return function(e){return e.distinctUntilChanged(function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).searchUrl===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).searchUrl}).switchMap(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.crossLayerExpanded?rt.Observable.of(t):e.filter(function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).crossLayerExpanded}).take(1)}).switchMap(function(e){var t=e.featureTypeName,r=e.searchUrl;return(0,ot.EV)({layer:{name:t,url:r,search:{type:"wfs",url:r}}}).do(function(e){if(t=e,r=tt()(t,"WFS_Capabilities.Filter_Capabilities.Scalar_Capabilities.ArithmeticOperators.Functions.FunctionNames.FunctionName"),!F()(r,function(){return"queryCollection"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})._}))throw new Error("nocrosslayerfunctionalities");var t,r}).map(function(){return{loadingCapabilities:!1}}).catch(function(e){return rt.Observable.of({errorObj:e,loadingAttributes:!1,loadingCapabilities:!1,featureTypeProperties:[]})}).startWith({loadingCapabilities:!0})}).startWith({})}(e).combineLatest(function(e,t){return e.distinctUntilChanged(function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).layer,t=void 0===e?{}:e,r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).layer;return r&&t.name===(r&&r.name)}).filter(function(){return!!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).layer}).switchMap(function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).layer;return rt.Observable.defer(function(){return(0,ot.sq)({layer:e})}).do(function(e){var r=tt()((0,it.lr)(e.data||{}),"name");r&&t("geometryName",r)}).map(function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).data,r=void 0===t?{}:t;return(0,at.wY)(r,null==e?void 0:e.fields)}).map(function(e){return{attributes:e,loadingAttributes:!1}}).startWith({loadingAttributes:!0}).catch(function(e){return rt.Observable.of({errorObj:e,loadingAttributes:!1,featureTypeProperties:[]})})}).catch(function(e){return rt.Observable.of({errorObj:e,loadingAttributes:!1,loadingCapabilities:!1,featureTypeProperties:[]})}).startWith({})}(e,r),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return ct(ct({},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),e)}).startWith({})}}),lt.A);var dt=r(8571),yt=r(192016),mt=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).item;return s().createElement("span",null,e&&e.name?s().createElement(dt.A,{msgId:e.name}):null)};const bt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.spatialOperations,r=void 0===t?[]:t,n=e.onChange,o=void 0===n?function(){}:n,i=e.value;return s().createElement(R.DropdownList,{valueField:"id",className:"geometry-operation-selector",onChange:o,data:r,valueComponent:mt,value:i,itemComponent:mt})};var vt=r(79738),gt=r(168995),ht=r(348317);function Ot(e){return function(e){if(Array.isArray(e))return Ft(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Ft(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ft(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ft(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var Et=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.search,n=t.url;return(0,vt.qo)(e,n)||(0,vt.qo)(e,r&&r.url)},wt=function(e){return(e||[]).filter(function(){return"BBOX"!==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).id})};function jt(e){return jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},jt(e)}function St(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Pt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?St(Object(r),!0).forEach(function(t){Tt(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):St(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function Tt(e,t,r){return(t=function(e){var t=function(e){if("object"!=jt(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=jt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==jt(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var At=(0,I.compose)((0,u.connect)(function(e){return{attributes:e.query&&e.query.typeName&&e.query.featureTypes&&e.query.featureTypes[e.query.typeName]&&e.query.featureTypes[e.query.typeName].attributes,crossLayerExpanded:e.queryform.crossLayerExpanded,crossLayerFilterOptions:Pt({layers:(0,g.u6)(e),crossLayerFilter:(0,g.jy)(e)},e.queryform.crossLayerFilterOptions||{}),searchUrl:e.query&&e.query.url,featureTypeName:e.query&&e.query.typeName}},function(e){return{crossLayerFilterActions:(0,p.zH)({expandCrossLayerFilterPanel:d.YX,setCrossLayerFilterParameter:d.Zv,addCrossLayerFilterField:d.Bo,updateCrossLayerFilterField:d.Vq,removeCrossLayerFilterField:d.wK,resetCrossLayerFilter:d.bY,toggleMenu:function(e,t){return(0,d.AM)(e,t,"crossLayer")}},e)}}),(0,I.withProps)(function(e){var t=e.crossLayerFilterOptions,r=e.crossLayerFilterActions;return Pt(Pt({},t),r)}),ft)(function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.crossLayerExpanded,o=void 0===n||n,i=r.spatialOperations,a=r.expandCrossLayerFilterPanel,l=void 0===a?function(){}:a,u=r.layers,c=void 0===u?[]:u,p=r.errorObj,f=r.loadingAttributes,d=r.loadingCapabilities,y=r.searchUrl,b=r.queryCollection,v=void 0===b?{}:b,g=r.attributes,h=void 0===g?[]:g,O=r.operation,F=r.enabledAreaOfInterest,E=void 0===F||F,w=r.updateLogicCombo,S=void 0===w?function(){}:w,P=r.resetCrossLayerFilter,T=void 0===P?function(){}:P,A=r.setOperation,x=void 0===A?function(){}:A,C=r.setEnabledAreaOfInterest,I=void 0===C?function(){}:C,D=r.setQueryCollectionParameter,L=void 0===D?function(){}:D,N=r.addCrossLayerFilterField,q=void 0===N?function(){}:N,_=r.updateCrossLayerFilterField,R=void 0===_?function(){}:_,M=r.removeCrossLayerFilterField,k=void 0===M?function(){}:M,U=r.toggleMenu,G=void 0===U?function(){}:U,z=v.typeName,B=v.geometryName,V=v.filterFields,W=v.groupFields,H=void 0===W?[{id:1,logic:"OR",index:0}]:W,Q=c.filter(function(e){return!Et(y,e)});return s().createElement(oe.A,{loading:d,expanded:o&&!d&&!p,error:p,errorMsgId:"queryPanel",buttons:Ot(z?[{glyph:"clear-filter",tooltipId:"queryform.crossLayerFilter.clear",onClick:function(){return T()}}]:[]),onSwitch:l,title:s().createElement(dt.A,{msgId:"queryform.crossLayerFilter.title"})},s().createElement(j.fI,{className:"inline-form filter-field-fixed-row"},s().createElement(j.fv,{xs:6},s().createElement("div",null,s().createElement(dt.A,{msgId:"queryform.crossLayerFilter.targetLayer"}),"Â ",c.length&&Q.length?s().createElement(gt.A,{id:"unmatchingLayersInfo",bsStyle:"link",text:s().createElement(dt.A,{msgId:"queryform.crossLayerFilter.errors.layersExcluded"})}):null)),s().createElement(j.fv,{xs:6},s().createElement(yt.Ay,{clearable:!1,disabled:d||!!p,isLoading:f,options:c.filter(function(e){return Et(y,e)}).map(function(e){return{label:e.title||e.name,value:e.name}}),placeholder:s().createElement(dt.A,{msgId:"queryform.crossLayerFilter.placeholder"}),filter:"contains",value:z,onChange:function(e){L("typeName",e&&e.value)}}))),z&&B?s().createElement(j.fI,{className:"inline-form filter-field-fixed-row"},s().createElement(j.fv,{xs:6},s().createElement("div",null,s().createElement(dt.A,{msgId:"queryform.crossLayerFilter.operation"}))),s().createElement(j.fv,{xs:6},s().createElement(bt,{value:O,onChange:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).id;return x(e)},spatialOperations:wt(i)}))):null,z&&B&&O?(e=E,t=I,s().createElement(j.fI,{className:"inline-form filter-field-fixed-row"},s().createElement(j.fv,{xs:6},s().createElement("div",{className:"pull-left"},s().createElement(dt.A,{msgId:"queryform.crossLayerFilter.areaOfInterest"}),"Â ",s().createElement(gt.A,{bsStyle:"link",text:s().createElement(dt.A,{msgId:"queryform.crossLayerFilter.areaOfInterestTooltip"})}))),s().createElement(j.fv,{xs:6},s().createElement(ht.A,{checked:e,onChange:t,className:"pull-right cross-layer-aoi"})))):null,z&&B&&O?s().createElement(j.fI,{className:"filter-field-fixed-row"},s().createElement(j.fv,{xs:12},s().createElement(m.A,{dropUp:!0,autocompleteEnabled:!0,withContainer:!1,attributes:h,groupLevels:-1,filterFields:V,actions:{onUpdateLogicCombo:S,onAddFilterField:q,onUpdateFilterField:R,onRemoveFilterField:k,toggleMenu:G},groupFields:H,filterField:!0}))):null)});const xt=At;var Ct=r(310340),It=r(380959),Dt=r(475223),Lt=r(50173),Nt=r(367091),qt=r(358132),_t=r(552749);function Rt(e){return Rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Rt(e)}var Mt=["DrawSupport","tools"];function kt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Ut(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?kt(Object(r),!0).forEach(function(t){Gt(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):kt(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function Gt(e,t,r){return(t=function(e){var t=function(e){if("object"!=Rt(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=Rt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Rt(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var zt=(0,u.connect)(function(e){return e.draw||{}},{onChangeDrawingStatus:h.VX,onEndDrawing:h.Mr,onGeometryChanged:h.vK,onDrawStopped:h.Ij,setCurrentStyle:h.d}),Bt=r(227341),Vt=r.n(Bt),Wt=r(6683);function Ht(e){return Ht="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ht(e)}var Qt=["bbox"];function Yt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Xt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Yt(Object(r),!0).forEach(function(t){Zt(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Yt(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function Zt(e,t,r){return(t=function(e){var t=function(e){if("object"!=Ht(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=Ht(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Ht(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Kt=(0,I.compose)((0,I.defaultProps)({onMapReady:function(){},baseLayer:{group:"background",id:"mapnik__0",loading:!1,loadingError:!1,name:"mapnik",source:"osm",title:"Open Street Map",type:"osm",visibility:!0}}),(0,I.withPropsOnChange)("baseLayer",function(e){return{layers:[e.baseLayer]}}),(0,I.withPropsOnChange)(["id"],function(e){var t=e.hookRegister;return{hookRegister:(void 0===t?null:t)||(0,Wt.sl)()}}),(0,I.withStateHandlers)(function(){return{initialized:!1}},{onMapViewChanges:function(){return function(e){return{map:e}}},onLayerLoad:function(e,t){var r=e.map,n=e.initialized,o=t.onMapReady,i=t.baseLayer,a=t.hookRegister,l=t.layer;return function(e){if(!n&&e===i.id){o(r);var t=l.bbox.bounds,s=a.getHook(Wt.jY);return s&&s(t,{crs:l.bbox.crs,maxZoom:21}),{initialized:!0}}return{}}},centerLayer:function(e,t){var r=t.layer;return function(e){if(Vt()(r))return{};var t=(0,ge.getExtentFromViewport)(r.bbox,r.bbox.crs),n=(0,Wt.X1)(t,r.bbox.crs),o=r.bbox.crs!==(e.projection||"EPSG:3857")?(0,ge.reprojectBbox)(r.bbox.bounds,r.bbox.crs,e.projection||"EPSG:3857"):r.bbox.extent,i=1;null!=e&&e.size&&(i=(0,Wt.r2)(o,e.size,0,21)),e.bbox;var a=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(e,Qt);return{map:Xt(Xt({},a),{},{zoom:i,center:n,extent:o,mapStateSource:"mapModal"})}}}}),(0,I.withProps)(function(e){return{layers:e.layers.concat(e.layer||[])}}),(0,I.withPropsOnChange)(function(e,t){var r=e.map,n=void 0===r?{}:r,o=t.map;return!(null!=n&&n.size)&&(null==o?void 0:o.size)},function(e){var t=e.centerLayer,r=e.map;return null!=r&&r.size&&t(r),{}}),(0,I.withProps)(function(e){return{eventHandlers:{onLayerLoad:e.onLayerLoad}}}));Kt.displayName="mapEnhancer";const Jt=Kt;var $t=(0,I.compose)(Jt,_t.A,(0,Nt.A)(0),Lt.A,qt.A,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:zt;return(0,I.withPropsOnChange)(["plugins"],function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).plugins,r=t.DrawSupport,n=t.tools,o=void 0===n?{}:n,i=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(t,Mt);if(!r)return{};var a=e(r);return{plugins:Ut(Ut({},i),{},{tools:Ut(Ut({},o),{},{draw:a})})}})}())(Dt.A),er=function(e){var t=e.map,r=e.mapStateSource,n=e.layer,o=void 0===n?{}:n,i=e.onMapReady,a=void 0===i?function(){}:i;return t?s().createElement($t,{map:t,mapStateSource:r,onMapReady:a,zoomControl:!0,options:{style:{height:"100%"}},layer:o,tools:["draw"]}):null};er.propTypes={map:a().object,mapStateSource:a().string,onMapReady:a().bool,layer:a().object};const tr=er;var rr=r(737704),nr=r(654456),or=(0,u.connect)((0,f.Mz)([rr.oR,g.G_],function(e,t){return{layer:e,map:t,mapStateSource:"wizardMap"}}),{onMapReady:nr.jF})(tr);const ir={start:[],attributes:[{id:"attributeFilter",plugin:b,cfg:{},position:1}],afterAttributes:[],spatial:[{id:"spatialFilter",plugin:function(e){var t=e.useEmbeddedMap,r=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(e,Ze);return t?s().createElement($e,r):s().createElement(Je,r)},cfg:{},position:1}],afterSpatial:[],layers:[{id:"crossLayer",plugin:xt,cfg:{},position:1}],end:[],map:[{id:"spatialFilterMap",plugin:(0,It.A)(function(e){var t=e.container,r=e.useEmbeddedMap,n=e.hideSpatialFilter,o=e.queryPanelEnabled,i=e.targetContainerSelector,a=i&&document.querySelector(i)||t;return r&&!n&&o?(0,Ct.createPortal)(s().createElement("div",{className:"mapstore-query-map"},s().createElement(or,e)),a):null}),cfg:{targetContainerSelector:"#page-dashboard > .ms2-border-layout-body"},position:1}]};var ar=r(653077),lr=r(130711),sr=r(167883),ur=r(904059),cr=r(273494),pr=r(785072),fr=r.n(pr),dr=r(449516);fr()(dr.A,{insert:"head",singleton:!1}),dr.A.locals;var yr=r(750042),mr=r.n(yr),br=r(154150),vr=r(76941),gr=r(711030),hr=r(256951);function Or(e){return Or="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Or(e)}function Fr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Tr(n.key),n)}}function Er(e,t,r){return t=jr(t),function(e,t){if(t&&("object"==Or(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,wr()?Reflect.construct(t,r||[],jr(e).constructor):t.apply(e,r))}function wr(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(wr=function(){return!!e})()}function jr(e){return jr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},jr(e)}function Sr(e,t){return Sr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Sr(e,t)}function Pr(e,t,r){return(t=Tr(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Tr(e){var t=function(e){if("object"!=Or(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=Or(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Or(t)?t:t+""}var Ar=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Pr(r=Er(this,t,[e]),"getCurrentFilter",function(){return{featureTypeName:r.props.featureTypeName,groupFields:r.props.groupFields,filterFields:r.props.sendFilters&&r.props.sendFilters.attributeFilter&&r.props.filterFields.filter(function(e){return(0,L.$N)(e.value,e.operator)})||[],spatialField:r.props.sendFilters&&r.props.sendFilters.spatialFilter&&r.props.spatialField||{attribute:r.props.spatialField&&r.props.spatialField.attribute},pagination:r.props.pagination,filterType:r.props.filterType,ogcVersion:r.props.ogcVersion,sortOptions:r.props.sortOptions,crossLayerFilter:r.props.sendFilters&&r.props.sendFilters.crossLayerFilter&&(0,L.d7)(r.props.crossLayerFilter)||null,hits:r.props.hits,filters:r.props.filters}}),Pr(r,"isCurrentFilterChanged",function(){var e=r.getCurrentFilter(),t={groupFields:e.groupFields,filterFields:e.filterFields,spatialField:e.spatialField,crossLayerFilter:e.crossLayerFilter,filters:e.filters},n=r.props.appliedFilter||{},i={groupFields:n.groupFields,filterFields:n.attributePanelExpanded&&n.filterFields||[],spatialField:n.spatialPanelExpanded&&n.spatialField||{attribute:r.props.spatialField&&r.props.spatialField.attribute},filters:n.filters,crossLayerFilter:n.crossLayerExpanded&&n.crossLayerFilter&&n.crossLayerFilter.operation?(0,L.d7)(n.crossLayerFilter):null};return!o()(t,i)}),Pr(r,"search",function(){var e=r.getCurrentFilter();r.props.actions.onQuery(r.props.searchUrl,e,r.props.params),r.props.advancedToolbar&&r.props.actions.storeAppliedFilter()}),Pr(r,"reset",function(){if(r.props.actions.onChangeDrawingStatus("clean","","queryform",[]),r.props.actions.onReset(),r.props.advancedToolbar){var e={featureTypeName:r.props.featureTypeName,groupFields:[],filterFields:[],spatialField:{attribute:r.props.spatialField&&r.props.spatialField.attribute},pagination:r.props.pagination,filterType:r.props.filterType,ogcVersion:r.props.ogcVersion,sortOptions:r.props.sortOptions,crossLayerFilter:null,hits:r.props.hits};r.props.actions.onQuery(r.props.searchUrl,e,r.props.params),r.props.advancedToolbar&&r.props.actions.storeAppliedFilter()}}),Pr(r,"restorePersistedFilter",function(){r.props.actions.onRestoreFilter()}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Sr(e,t)}(t,e),function(e,t){return t&&Fr(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"render",value:function(){var e=this,t=this.props.filterFields.filter(function(e){return e.exception}).length>0,r=this.props.allowEmptyFilter&&!this.props.advancedToolbar,n=this.props.filterFields.filter(function(e){return(0,L.$N)(e.value,e.operator)}).length>0,i=(0,L.i2)(this.props),a=(0,L.i2)(this.props.appliedFilter),l=this.isCurrentFilterChanged(),u=n||this.props.spatialField.geometry||(0,L.aS)(this.props.crossLayerFilter)||this.props.filters&&this.props.filters.length>0&&this.props.filters.map(function(){return!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).invalid}).reduce(function(e,t){return e&&t},!0),c=!o()(this.props.appliedFilter,this.props.storedFilter),p=r||i&&this.props.appliedFilter&&!a,f=t||!this.props.toolbarEnabled||i&&!p||!i&&(!u||!l),d=this.props.emptyFilterWarning&&i&&l,y=this.props.advancedToolbar?"queryform.apply":this.props.queryBtnMsgId,m=[{tooltipId:d?"queryform.emptyfilter":y,disabled:f,noTooltipWhenDisabled:!0,glyph:this.props.advancedToolbar?"ok":this.props.queryBtnGlyph,className:d?"square-button showWarning":"square-button",id:"query-toolbar-query",onClick:this.search}];if(this.props.advancedToolbar){var b=!c||this.props.loadingError||l,v=!c||!this.props.storedFilter||!this.props.toolbarEnabled,g=!this.props.appliedFilter||this.props.appliedFilter&&a||!this.props.toolbarEnabled;m=m.concat([{tooltipId:"queryform.save",disabled:b,noTooltipWhenDisabled:!0,glyph:"floppy-disk",id:"query-toolbar-save",onClick:this.props.actions.onSaveFilter},{tooltipId:"queryform.discard",disabled:v,noTooltipWhenDisabled:!0,glyph:"undo",id:"query-toolbar-discard",onClick:this.restorePersistedFilter},{tooltipId:"queryform.reset",glyph:"clear-filter",noTooltipWhenDisabled:!0,id:"reset",disabled:g,onClick:this.reset}])}else m=[{tooltipId:"queryform.reset",glyph:"clear-filter",noTooltipWhenDisabled:!0,id:"reset",disabled:!this.props.toolbarEnabled,onClick:this.reset}].concat(m);return s().createElement("div",{className:"container-fluid query-toolbar"},s().createElement(hr.A,{btnDefaultProps:{bsStyle:"primary",className:"square-button",tooltipPosition:"bottom"},className:"queryFormToolbar row-fluid pull-right",buttons:m}),s().createElement(vr.A,{show:!!this.props.showGeneratedFilter,bsSize:"large"},s().createElement(vr.A.Header,null,s().createElement(vr.A.Title,null,this.props.resultTitle)),s().createElement(vr.A.Body,null,s().createElement("textarea",{style:{width:"862px",maxWidth:"862px",height:"236px",maxHeight:"236px"}},this.props.showGeneratedFilter)),s().createElement(vr.A.Footer,null,s().createElement(gr.A,{style:{float:"right"},onClick:function(){return e.props.actions.onQuery(null,null)}},"Close"))))}}])}(s().Component);Pr(Ar,"propTypes",{filterType:a().string,params:a().object,filterFields:a().array,groupFields:a().array,spatialField:a().object,filters:a().array,sendFilters:a().object,crossLayerFilter:a().object,toolbarEnabled:a().bool,searchUrl:a().string,showGeneratedFilter:a().oneOfType([a().bool,a().string]),featureTypeName:a().string,actions:a().object,ogcVersion:a().string,titleMsgId:a().string,queryBtnMsgId:a().string,resultTitle:a().string,queryBtnGlyph:a().string,pagination:a().object,sortOptions:a().object,hits:a().bool,allowEmptyFilter:a().bool,emptyFilterWarning:a().bool,appliedFilter:a().object,storedFilter:a().object,advancedToolbar:a().bool,loadingError:a().bool}),Pr(Ar,"defaultProps",{sendFilters:{attributeFilter:!0,spatialFilter:!0,crossLayerFilter:!0,filters:!0},filterType:"OGC",params:{},groupFields:[],filterFields:[],spatialField:{},toolbarEnabled:!0,searchUrl:null,showGeneratedFilter:!1,featureTypeName:null,titleMsgId:"queryform.title",queryBtnMsgId:"queryform.query",resultTitle:"Generated Filter",queryBtnGlyph:"search",pagination:null,sortOptions:null,hits:!1,allowEmptyFilter:!1,emptyFilterWarning:!1,advancedToolbar:!1,loadingError:!1,actions:{onQuery:function(){},onReset:function(){},onChangeDrawingStatus:function(){},onSaveFilter:function(){},onRestoreFilter:function(){},storeAppliedFilter:function(){}}});const xr=Ar;var Cr=r(595535),Ir=r(551258),Dr=r(820543);function Lr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,a,l=[],s=!0,u=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=i.call(r)).done)&&(l.push(n.value),l.length!==t);s=!0);}catch(e){u=!0,o=e}finally{try{if(!s&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Nr(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Nr(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Nr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function qr(e){var t=e.content,r=e.show,n=void 0!==r&&r,o=e.autoDismissSeconds,i=void 0===o?5:o,a=e.placement,u=void 0===a?"bottom":a,c=e.glyph,p=void 0===c?"exclamation-mark":c,f=e.bsStyle,d=void 0===f?"danger":f,y=e.id,m=void 0===y?"alert-popover":y,b=e.className,v=void 0===b?"":b,g=e.popoverClassName,h=void 0===g?"":g,O=e.onClose,F=void 0===O?function(){}:O,E=e.showCountdown,w=void 0===E||E,S=e.pauseOnHover,P=void 0===S||S,T=e.autoShowFirstTime,A=void 0===T||T,x=e.style,C=void 0===x?{}:x,I=Lr((0,l.useState)(!1),2),D=I[0],L=I[1],N=Lr((0,l.useState)(i),2),q=N[0],_=N[1],R=Lr((0,l.useState)(!1),2),M=R[0],k=R[1],U=Lr((0,l.useState)("hover"),2),G=U[0],z=U[1],B=Lr((0,l.useState)(!1),2),V=B[0],W=B[1],H=(0,l.useRef)(null),Q=(0,l.useRef)(null),Y=(0,l.useRef)(null),X=function(){L(!1),Q.current&&clearInterval(Q.current),Y.current&&(clearTimeout(Y.current),Y.current=null),F()};return(0,l.useEffect)(function(){n&&t&&!V&&(A?(z("auto"),L(!0),_(i),k(!1)):z("hover"),W(!0))},[n,t,V,i,A]),(0,l.useEffect)(function(){n&&t||(L(!1),Q.current&&clearInterval(Q.current))},[n,t]),(0,l.useEffect)(function(){return"auto"===G&&D&&i>0&&(Q.current=setInterval(function(){M||_(function(e){return e<=1?(X(),0):e-1})},1e3)),function(){Q.current&&clearInterval(Q.current)}},[D,M,G,i,X]),(0,l.useEffect)(function(){return function(){Q.current&&clearInterval(Q.current),Y.current&&clearTimeout(Y.current)}},[]),s().createElement("div",{className:"alert-popover"},s().createElement("div",{ref:H,className:"alert-popover-trigger ".concat(v||"square-button _border-transparent"),style:C,onClick:function(){V&&n&&t&&(z("hover"),L(!D))},onMouseEnter:function(){Y.current&&(clearTimeout(Y.current),Y.current=null),V&&n&&t&&(z("hover"),L(!0))},onMouseLeave:function(){"hover"===G&&(Y.current=setTimeout(function(){L(!1)},200))}},s().createElement(j.e6,{className:"alert-popover-icon text-".concat(d),glyph:p})),s().createElement(Ir.A,{target:H.current,show:D,placement:u,rootClose:!0,onHide:X},s().createElement(j.AM,{id:m,placement:u,className:"alert-popover-popup ".concat(h),onMouseEnter:function(){Y.current&&(clearTimeout(Y.current),Y.current=null),"auto"===G&&P?k(!0):"hover"===G&&L(!0)},onMouseLeave:function(){"auto"===G&&P?k(!1):"hover"===G&&L(!1)}},s().createElement("div",{className:"alert-popover-header"},function(){if(!w||"auto"!==G||0===i)return null;var e=q/i*100,t=2*Math.PI*6,r=t,n=t-e/100*t;return s().createElement("div",{className:"alert-popover-countdown"},s().createElement("svg",{width:"16",height:"16",className:"countdown-svg"},s().createElement("circle",{cx:"8",cy:"8",r:6,className:"countdown-background"}),s().createElement("circle",{cx:"8",cy:"8",r:6,className:"countdown-progress ".concat(M?"paused":"counting"),strokeDasharray:r,strokeDashoffset:n})),s().createElement("div",{className:"countdown-number ".concat(M?"paused":"counting")},q))}(),s().createElement(j.e6,{glyph:"1-close",className:"alert-popover-close",onClick:X})),s().createElement("div",{className:"alert-popover-content"},t))))}fr()(Dr.A,{insert:"head",singleton:!1}),Dr.A.locals,qr.propTypes={content:a().node,show:a().bool,autoDismissSeconds:a().number,placement:a().oneOf(["top","bottom","left","right"]),glyph:a().string,bsStyle:a().oneOf(["danger","warning","info","success","primary","default"]),id:a().string,className:a().string,popoverClassName:a().string,onClose:a().func,showCountdown:a().bool,pauseOnHover:a().bool,autoShowFirstTime:a().bool,style:a().object};var _r=r(132672);const Rr=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.loadingError,r=e.onToggleQuery,n=void 0===r?function(){}:r,o=e.buttonStyle,i=void 0===o?"default":o;return s().createElement(_r.A,{centerChildrenVertically:!0,gap:"sm",classNames:["_padding-sm"]},t?s().createElement(qr,{show:t,content:s().createElement(Cr.A,{msgId:"queryform.loadingError"}),autoDismissSeconds:5,placement:"right"}):s().createElement("div",{className:"square-button _border-transparent",style:{display:"flex"}},s().createElement(j.e6,{glyph:"filter"})),s().createElement(_r.A.Fill,null),s().createElement(gr.A,{id:"toc-query-close-button",key:"menu-button",className:"square-button _border-transparent",bsStyle:i,onClick:function(){return n()}},s().createElement(j.e6,{glyph:"1-close"})))};var Mr=r(107019),kr=["validations"],Ur=["style"];function Gr(e){return Gr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Gr(e)}function zr(){return zr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},zr.apply(null,arguments)}function Br(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function Vr(e){return function(e){if(Array.isArray(e))return Wr(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Wr(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Wr(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Wr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function Hr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,en(n.key),n)}}function Qr(e,t,r){return t=Xr(t),function(e,t){if(t&&("object"==Gr(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Yr()?Reflect.construct(t,r||[],Xr(e).constructor):t.apply(e,r))}function Yr(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Yr=function(){return!!e})()}function Xr(e){return Xr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Xr(e)}function Zr(e,t){return Zr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Zr(e,t)}function Kr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Jr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Kr(Object(r),!0).forEach(function(t){$r(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Kr(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function $r(e,t,r){return(t=en(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function en(e){var t=function(e){if("object"!=Gr(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=Gr(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Gr(t)?t:t+""}var tn=function(){return null};function rn(e){return e.plugin?e:Jr(Jr({},e),{},{plugin:tn})}var nn=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return $r(e=Qr(this,t,[].concat(n)),"getItems",function(t){var r=e.props.selectedLayer,n=e.props.items.filter(e.filterItem(t,r)),o=function(){var e=arguments.length>1?arguments[1]:void 0,t=arguments.length>2?arguments[2]:void 0;return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map(function(r){return function(e){var t,r,n=arguments.length>2?arguments[2]:void 0;return null!==(t=r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).find(function(t){return t.target===e.id}))&&void 0!==t&&t.layerNameRegex&&(new RegExp(r.layerNameRegex).test(n)||(r=null)),null!=r?r:e}(r,e,t)}).map(rn)}(e.props.standardItems[t],e.props.items,r).map(function(e){return Jr(Jr({},e),{},{target:t})});return[].concat(Vr(o),Vr(n)).sort(function(e,t){var r,n;return(null!==(r=e.position)&&void 0!==r?r:0)-(null!==(n=t.position)&&void 0!==n?n:0)})}),$r(e,"renderItem",function(t,r){var n,o,i=r.validations,a=Br(r,kr),l=null!==(n=t.component)&&void 0!==n?n:t.plugin,u=e.props,c=(u.style,Br(u,Ur)),p=e.props[t.id+"Options"];return!0===a["hide".concat((0,Mr.upperFirst)(t.id))]?null:s().createElement(l,zr({role:"body"},c,t.cfg,a,p,{validation:null==i?void 0:i[null!==(o=t.id)&&void 0!==o?o:t.name]}))}),$r(e,"renderItems",function(t,r){return e.getItems(t).map(function(t){return e.renderItem(t,r)})}),$r(e,"filterItem",function(e,t){return function(r){if(r.layerNameRegex){var n=new RegExp(r.layerNameRegex);return(!e||r.target===e)&&n.test(t)}return!e||r.target===e}}),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Zr(e,t)}(t,e),function(e,t){return t&&Hr(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"render",value:function(){if(""!==this.props.featureTypeError)return s().createElement("div",null,s().createElement(Rr,{onToggleQuery:this.props.controlActions.onToggleQuery}),s().createElement("div",{style:{margin:"0 auto","text-align":"center"}},this.props.featureTypeErrorText));var e=s().createElement("div",{className:"m-header"},this.props.header,s().createElement(xr,{sendFilters:{attributeFilter:this.props.attributePanelExpanded,spatialFilter:this.props.spatialPanelExpanded,crossLayerFilter:this.props.crossLayerExpanded},filters:this.props.filters,params:this.props.params,filterFields:this.props.filterFields,groupFields:this.props.groupFields,spatialField:this.props.spatialField,toolbarEnabled:this.props.toolbarEnabled,searchUrl:this.props.searchUrl,showGeneratedFilter:this.props.showGeneratedFilter,featureTypeName:this.props.featureTypeName,ogcVersion:this.props.ogcVersion,filterType:this.props.filterType,actions:this.props.queryToolbarActions,resultTitle:this.props.resultTitle,pagination:this.props.pagination,sortOptions:this.props.sortOptions,crossLayerFilter:this.props.crossLayerFilterOptions.crossLayerFilter,hits:this.props.hits,allowEmptyFilter:this.props.allowEmptyFilter,emptyFilterWarning:this.props.emptyFilterWarning,appliedFilter:this.props.appliedFilter,storedFilter:this.props.storedFilter,advancedToolbar:this.props.advancedToolbar,loadingError:this.props.loadingError,queryBtnGlyph:"ok"})),t=this.props,r=t.spatialMethodOptions,n=t.toolsOptions,o=t.spatialOperations;return this.props.attributes.length>0?s().createElement(s().Fragment,null,s().createElement(br.A,{header:e,className:"mapstore-query-builder",id:"query-form-panel"},this.renderItems("start",Jr({spatialOperations:o,spatialMethodOptions:r},n)),this.renderItems("attributes",Jr({spatialOperations:o,spatialMethodOptions:r},n)),this.renderItems("afterAttributes",Jr({spatialOperations:o,spatialMethodOptions:r},n)),this.renderItems("spatial",Jr({spatialOperations:o,spatialMethodOptions:r},n)),this.renderItems("afterSpatial",Jr({spatialOperations:o,spatialMethodOptions:r},n)),this.renderItems("layers",Jr({spatialOperations:o,spatialMethodOptions:r},n)),this.renderItems("end",Jr({spatialOperations:o,spatialMethodOptions:r},n))),this.renderItems("map",Jr({spatialOperations:o,spatialMethodOptions:r},n))):s().createElement("div",{className:"spinner-panel",style:{margin:"0 auto",width:"60px"}},s().createElement(mr(),{spinnerName:"three-bounce",overrideSpinnerClassName:"spinner"}))}}])}(s().Component);$r(nn,"propTypes",{params:a().object,attributes:a().array,featureTypeError:a().string,featureTypeErrorText:a().node,filterFields:a().array,groupFields:a().array,spatialField:a().object,attributePanelExpanded:a().bool,spatialPanelExpanded:a().bool,crossLayerExpanded:a().bool,toolbarEnabled:a().bool,searchUrl:a().string,showGeneratedFilter:a().oneOfType([a().bool,a().string]),filters:a().array,filterType:a().string,featureTypeName:a().string,ogcVersion:a().string,queryToolbarActions:a().object,resultTitle:a().string,pagination:a().object,sortOptions:a().object,spatialOperations:a().array,spatialMethodOptions:a().array,crossLayerFilterOptions:a().object,hits:a().bool,buttonStyle:a().string,maxHeight:a().number,allowEmptyFilter:a().bool,emptyFilterWarning:a().bool,header:a().node,zoom:a().number,projection:a().string,toolsOptions:a().object,appliedFilter:a().object,storedFilter:a().object,advancedToolbar:a().bool,loadingError:a().bool,controlActions:a().object,standardItems:a().object,items:a().array,selectedLayer:a().oneOfType([a().string,a().bool]),style:a().object}),$r(nn,"defaultProps",{params:{},buttonStyle:"default",removeGroupButtonIcon:"trash",groupFields:[],filterFields:[],filters:[],attributes:[],spatialMethodOptions:[],spatialOperations:[],featureTypeError:"",spatialField:{},crossLayerFilter:null,attributePanelExpanded:!0,spatialPanelExpanded:!0,toolbarEnabled:!0,searchUrl:"",showGeneratedFilter:!1,featureTypeName:null,pagination:null,sortOptions:null,hits:!1,maxHeight:830,allowEmptyFilter:!1,emptyFilterWarning:!1,advancedToolbar:!1,loadingError:!1,crossLayerFilterOptions:{},queryToolbarActions:{onQuery:function(){},onReset:function(){},onChangeDrawingStatus:function(){},onSaveFilter:function(){},onRestoreFilter:function(){}},toolsOptions:{},controlActions:{onToggleQuery:function(){}},items:[],selectedLayer:!1,standardItems:{},style:{}});const on=nn;var an=r(406250),ln=r(229710),sn=r(282439),un=r.n(sn),cn=r(995531),pn=r(883832),fn=r(989105),dn=r(779893),yn=r(806653),mn=r(486174);const bn={isAutoCompleteEnabled:function(e,t){return e.ofType(nr.qD).switchMap(function(e){var r=(0,dn.tj)(e.url,{version:"1.0.0",REQUEST:"DescribeProcess",IDENTIFIER:"gs:PagedUnique"},(0,mn.Ns)(t.getState()));return null===r?nt().Observable.of((0,d.wd)(!1)):nt().Observable.fromPromise(cn.A.post(r,null,{timeout:5e3,headers:{Accept:"application/json","Content-Type":"application/xml"}}).then(function(e){return e.data})).switchMap(function(e){return un()(e,"<ows:ExceptionReport")?nt().Observable.of((0,d.wd)(!1)):nt().Observable.of((0,d.wd)(!0))}).catch(function(){return nt().Observable.of((0,d.wd)(!1))})})},fetchAutocompleteOptionsEpic:function(e,t){return e.ofType(d.EV,d.rQ).debounce(function(e){return nt().Observable.timer(e.fieldOptions.delayDebounce||0)}).filter(function(e){return"value"===e.fieldName&&"string"===e.fieldType&&t.getState().queryform.autocompleteEnabled}).switchMap(function(e){var r,n,o=t.getState(),i=(0,g.BH)(o),a={};if(a=e.type===d.rQ?(null===(n=o.queryform.crossLayerFilter)||void 0===n||null===(n=n.collectGeometries)||void 0===n||null===(n=n.queryCollection)||void 0===n||null===(n=n.filterFields)||void 0===n?void 0:n.filter(function(t){return t.rowId===e.rowId})[0])||{}:o.queryform&&o.queryform.filterFields&&o.queryform.filterFields.filter(function(t){return t.rowId===e.rowId})[0],"selected"===e.fieldOptions.selected)return nt().Observable.from([e.type===d.rQ?(0,d.XD)(a,[],0):(0,d.CS)(a,[],0)]);var l=(0,fn.H)({attribute:a.attribute,layerName:e.type===d.rQ?null===(r=o.queryform.crossLayerFilter)||void 0===r||null===(r=r.collectGeometries)||void 0===r?void 0:r.queryCollection.typeName:(0,yn.lb)(o),maxFeatures:i,startIndex:e.fieldOptions.currentPage?e.fieldOptions.currentPage-1:1*i,value:e.fieldValue}),s=(0,dn.tj)(o.query.url,{outputFormat:"json"},(0,mn.Ns)(t.getState()));return null===s?nt().Observable.of((0,d.wd)(!1)):nt().Observable.fromPromise(cn.A.post(s,l,{timeout:6e4,headers:{Accept:"application/json","Content-Type":"application/xml"}}).then(function(e){return e.data})).switchMap(function(t){var r=C()(t.values)?t.values:[t.values],n=t.size;return nt().Observable.from(e.type===d.rQ?[(0,d.XD)(a,r,n),(0,d.AM)(e.rowId,!0,"crossLayer")]:[(0,d.CS)(a,r,n),(0,d.AM)(e.rowId,!0,"filterField")])}).startWith((0,d.bA)(!0,a,e.type===d.rQ?"crossLayer":"filterField")).catch(function(){return nt().Observable.from([e.type===d.rQ?(0,d.XD)(a,[],0):(0,d.CS)(a,[],0),(0,pn.z3)({title:"warning",message:"warning",action:{label:"warning"},autoDismiss:3,position:"tr"}),(0,d.AM)(e.rowId,!0,e.type===d.rQ?"crossLayer":"filterField")])}).concat([(0,d.bA)(!1,a,e.type===d.rQ?"crossLayer":"filterField")])})}};var vn=r(980971),gn=r(307679);function hn(e){return hn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},hn(e)}function On(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Fn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?On(Object(r),!0).forEach(function(t){En(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):On(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function En(e,t,r){return(t=function(e){var t=function(e){if("object"!=hn(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=hn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==hn(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const wn={handleLayerFilterPanel:function(e,t){var r=t.getState;return e.ofType(sr.Wz).switchMap(function(){var t=(0,gn.ZT)(r()),n=t||{},o=n.url,i=n.name,a=n.layerFilter,l=n.fields,s=t&&t.search&&t.search.url;return nt().Observable.of((0,nr.Mb)(s||o,i,l),(0,d.Bb)(a),(0,sr.oA)(a),(0,y.fN)("queryPanel","enabled",!0)).merge(nt().Observable.of((0,nr.UR)()).filter(function(){return!tt()(r(),"query.isLayerFilter")}),e.ofType(d.TK).switchMap(function(e){var n=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.crossLayerFilter,r=e.spatialField,n=e.filterFields,o=e.filters;return!!(n&&_()(n)||r&&r.method&&r.operation&&r.geometry||t&&t.collectGeometries&&t.operation)||o&&o.length>0}(e.filterObj)?Fn({},tt()(r(),"queryform",{})):void 0;return n&&(n.filterFields=n.attributePanelExpanded&&n.filterFields||[],n.spatialField=n.spatialPanelExpanded&&n.spatialField||null,n.crossLayerFilter=n.crossLayerExpanded&&(0,L.d7)(n.crossLayerFilter)||null),nt().Observable.of(function(e,t){return(0,ur.ju)(e,{layerFilter:t})}(t.id,n))})).let(function(e){return function(t){return t.takeUntil(e.ofType(y.x7).filter(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.control,r=e.property;return"queryPanel"===t&&(!r||"enabled"===r)}).merge(e.ofType(vn.LK)))}}(e)).concat(nt().Observable.from([(0,nr.UR)(),(0,d.cL)(),(0,h.VX)("clean","","queryform",[],{})]))})},restoreSavedFilter:function(e,t){var r=t.getState;return e.ofType(sr.EA).switchMap(function(){var e={typeName:tt()(r(),"state.query.typeName")},t=tt()(r(),"state.query.url"),n=tt()(r(),"layerFilter.persisted");return nt().Observable.of((0,h.VX)("clean","","queryform",[]),(0,d.Bb)(n),(0,d.$P)(t,n,e),(0,nr.jF)())})},onApplyFilter:function(e,t){var r=t.getState;return e.ofType(sr.Ek).map(function(){var e=Fn({},tt()(r(),"queryform",{}));return(0,sr.nX)(e)})}};var jn=r(382378),Sn=r.n(jn);const Pn={updateSpatialFilterValue:function(e){return e.ofType(d.Tq).switchMap(function(e){var t=e.feature,r=e.srsName,n=e.style,o=e.options;return rt.Observable.of((0,h.VX)("drawOrEdit",t.geometry.type,"queryform",[t],{editEnabled:!1,stopAfterDrawing:!0,featureProjection:r},n)).concat(t&&o&&o.autoZoom?[(0,cr.jc)(Sn()(t),r)]:[])})}};var Tn=r(23412),An=r(401631),xn=r(141857);function Cn(e){return Cn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Cn(e)}function In(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Dn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?In(Object(r),!0).forEach(function(t){Ln(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):In(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function Ln(e,t,r){return(t=function(e){var t=function(e){if("object"!=Cn(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=Cn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Cn(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Nn(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function qn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Nn(Object(r),!0).forEach(function(t){_n(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Nn(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function _n(e,t,r){return(t=function(e){var t=function(e){if("object"!=Rn(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=Rn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Rn(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Rn(e){return Rn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Rn(e)}var Mn=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return{geometry:e.featureTypes[0].properties.filter(function(e){return 0===e.type.indexOf("gml:")}).map(function(e){var r;return{label:null!==(r=F()(t,{name:e.name}))&&void 0!==r?r:e.name,attribute:e.name,type:"geometry",valueId:"id",valueLabel:"name",values:[]}}),original:e,attributesJSONSchema:(0,at.wu)(e),attributes:(0,at.wY)(e,t)}};function kn(e){return kn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},kn(e)}function Un(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Gn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Un(Object(r),!0).forEach(function(t){zn(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Un(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function zn(e,t,r){return(t=function(e){var t=function(e){if("object"!=kn(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=kn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==kn(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Bn={};var Vn=r(762686);function Wn(e){return Wn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Wn(e)}function Hn(e,t,r){return(t=function(e){var t=function(e){if("object"!=Wn(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=Wn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Wn(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Qn(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var Yn={featureTypes:{},data:{},result:null,resultError:null,syncWmsFilter:!1,isLayerFilter:!1};var Xn=r(978548),Zn=r(570740),Kn=r.n(Zn),Jn=r(791710),$n=r.n(Jn),eo=r(905185),to=["attribute"];function ro(e){return ro="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ro(e)}function no(e){return function(e){if(Array.isArray(e))return oo(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return oo(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?oo(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function oo(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function io(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function ao(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?io(Object(r),!0).forEach(function(t){lo(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):io(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function lo(e,t,r){return(t=function(e){var t=function(e){if("object"!=ro(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=ro(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ro(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var so={searchUrl:null,featureTypeConfigUrl:null,showGeneratedFilter:!1,attributePanelExpanded:!0,spatialPanelExpanded:!0,crossLayerExpanded:!0,showDetailsPanel:!1,groupLevels:5,useMapProjection:!1,toolbarEnabled:!0,groupFields:[{id:1,logic:"OR",index:0}],maxFeaturesWPS:5,filterFields:[],spatialField:{method:null,attribute:"the_geom",operation:"INTERSECTS",geometry:null},simpleFilterFields:[],map:null},uo=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=Object.assign({},e,lo(lo({},t.fieldName,t.fieldValue),"type",t.fieldType),{fieldOptions:Object.assign({},ao({},e.fieldOptions),{currentPage:void 0===t.fieldOptions.currentPage?1:t.fieldOptions.currentPage})});return"attribute"===t.fieldName&&(r.value="string"===t.fieldType?"":null,r.operator="="),"operator"===t.fieldName&&(r.value=null),r};var co=r(589769),po=r(97401),fo=r(112585),yo=r(129519);function mo(e){return mo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},mo(e)}function bo(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,jo(n.key),n)}}function vo(e,t,r){return t=ho(t),function(e,t){if(t&&("object"==mo(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,go()?Reflect.construct(t,r||[],ho(e).constructor):t.apply(e,r))}function go(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(go=function(){return!!e})()}function ho(e){return ho=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ho(e)}function Oo(e,t){return Oo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Oo(e,t)}function Fo(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Eo(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Fo(Object(r),!0).forEach(function(t){wo(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Fo(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function wo(e,t,r){return(t=jo(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function jo(e){var t=function(e){if("object"!=mo(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=mo(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==mo(t)?t:t+""}var So=d.cL.bind(null,"query"),Po=(0,u.connect)(function(e){return{useMapProjection:e.queryform.useMapProjection,groupLevels:e.queryform.groupLevels,groupFields:e.queryform.groupFields,filterFields:e.queryform.filterFields,attributes:e.query&&e.query.typeName&&e.query.featureTypes&&e.query.featureTypes[e.query.typeName]&&e.query.featureTypes[e.query.typeName].attributes,featureTypeError:e.query&&e.query.typeName&&e.query.featureTypes&&e.query.featureTypes[e.query.typeName]&&e.query.featureTypes[e.query.typeName].error,spatialField:e.queryform.spatialField,filters:e.queryform.filters,showDetailsPanel:e.queryform.showDetailsPanel,toolbarEnabled:e.queryform.toolbarEnabled,attributePanelExpanded:e.queryform.attributePanelExpanded,autocompleteEnabled:e.queryform.autocompleteEnabled,crossLayerExpanded:e.queryform.crossLayerExpanded,crossLayerFilterOptions:Eo({layers:(0,g.u6)(e),crossLayerFilter:(0,g.jy)(e)},e.queryform.crossLayerFilterOptions||{}),maxFeaturesWPS:e.queryform.maxFeaturesWPS,spatialPanelExpanded:e.queryform.spatialPanelExpanded,featureTypeConfigUrl:e.query&&e.query.url,searchUrl:e.query&&e.query.url,featureTypeName:e.query&&e.query.typeName,ogcVersion:"1.1.0",params:{typeName:e.query&&e.query.typeName},resultTitle:"Query Result",showGeneratedFilter:!1,allowEmptyFilter:!0,emptyFilterWarning:!0,maxHeight:e.map&&e.map.present&&e.map.present.size&&e.map.present.size.height,zoom:((0,v.mg)(e)||{}).zoom,projection:((0,v.mg)(e)||{}).projection}},function(e){return{attributeFilterActions:(0,p.zH)({onAddGroupField:d.Fc,onAddFilterField:d.et,onRemoveFilterField:d.lS,onUpdateFilterField:d.g,onUpdateExceptionField:d.Jd,onUpdateLogicCombo:d.Gs,onRemoveGroupField:d.qS,onChangeCascadingValue:d.hT,toggleMenu:d.AM,onExpandAttributeFilterPanel:d.Js},e),spatialFilterActions:(0,p.zH)({onChangeSpatialFilterValue:d.yP,onExpandSpatialFilterPanel:d.vT,onSelectSpatialMethod:d.Kh,onSelectViewportSpatialMethod:d.Ke,onSelectSpatialOperation:d.qu,onChangeDrawingStatus:h.VX,onRemoveSpatialSelection:d.hX,onShowSpatialSelectionDetails:d.Wu,onChangeDwithinValue:d.hA,zoneFilter:d.Dt,zoneSearch:d.TS,zoneChange:d.Tk},e),queryToolbarActions:(0,p.zH)({onQuery:d.$P,onReset:So,onSaveFilter:sr.XB,onRestoreFilter:sr.AD,storeAppliedFilter:sr.$h,onChangeDrawingStatus:h.VX},e),crossLayerFilterActions:(0,p.zH)({expandCrossLayerFilterPanel:d.YX,setCrossLayerFilterParameter:d.Zv,addCrossLayerFilterField:d.Bo,updateCrossLayerFilterField:d.Vq,removeCrossLayerFilterField:d.wK,resetCrossLayerFilter:d.bY,toggleMenu:function(e,t){return(0,d.AM)(e,t,"crossLayer")}},e),controlActions:(0,p.zH)({onToggleQuery:y.KP.bind(null,"queryPanel",null)},e)}})(on),To=(0,f.Mz)([function(e){return e.controls&&e.controls.toolbar&&"toc"===e.controls.toolbar.active},gn.eK,function(e){return e.layers&&e.layers.settings},lr.sY,function(e){return(0,po.o7)(e,{height:!0})},co.aH,g.xY,g.zv,function(e){return e&&e.query&&e.query.isLayerFilter},gn.oy,yn.lb],function(e,t,r,n,o,i,a,l,s,u,c){return{enabled:e,groups:t,settings:r,queryPanelEnabled:n,layout:i?{}:o,appliedFilter:a,storedFilter:l,advancedToolbar:s,loadingError:u,selectedLayer:c}}),Ao=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),wo(r=vo(this,t,[e]),"getNoBackgroundLayers",function(e){return"background"!==e.name}),wo(r,"renderSidebar",function(){return s().createElement(c.A,{open:r.props.queryPanelEnabled,sidebar:r.renderQueryPanel(),sidebarClassName:"query-form-panel-container",touch:!1,rootClassName:"query-form-root",styles:{sidebar:Eo(Eo({},r.props.layout),{},{zIndex:1044,width:600}),overlay:{zIndex:1023,width:0},root:{right:r.props.queryPanelEnabled?0:"auto",width:"0",overflow:"visible"},content:{overflowY:"auto"}}},s().createElement("div",null))}),wo(r,"onToggle",function(){r.props.advancedToolbar&&!o()(r.props.appliedFilter,r.props.storedFilter)?r.setState(function(){return{showModal:!0}}):r.props.onToggleQuery()}),wo(r,"restoreAndClose",function(){r.setState(function(){return{showModal:!1}}),r.props.onRestoreFilter(),r.props.onToggleQuery()}),wo(r,"storeAndClose",function(){r.setState(function(){return{showModal:!1}}),r.props.onSaveFilter(),r.props.onToggleQuery()}),wo(r,"renderQueryPanel",function(){return s().createElement("div",{className:"mapstore-query-builder"},s().createElement(Po,{queryPanelEnabled:r.props.queryPanelEnabled,header:s().createElement(Rr,{loadingError:r.props.loadingError,onToggleQuery:r.onToggle}),spatialOperations:r.props.spatialOperations,spatialMethodOptions:r.props.spatialMethodOptions,toolsOptions:r.props.toolsOptions,featureTypeErrorText:s().createElement(yo.A,{msgId:"layerProperties.featureTypeError"}),appliedFilter:r.props.appliedFilter,storedFilter:r.props.storedFilter,advancedToolbar:r.props.advancedToolbar,loadingError:r.props.loadingError,items:r.props.items,selectedLayer:r.props.selectedLayer,standardItems:ir}),s().createElement(an.A,null,s().createElement(ln.A,{show:r.state.showModal,title:s().createElement(yo.A,{msgId:"queryform.changedFilter"}),size:"xs",onClose:function(){return r.setState(function(){return{showModal:!1}})},buttons:[{bsStyle:"primary",text:s().createElement(yo.A,{msgId:"yes"}),onClick:r.storeAndClose},{bsStyle:"primary",text:s().createElement(yo.A,{msgId:"no"}),onClick:r.restoreAndClose}]},s().createElement("div",{className:"ms-alert"},s().createElement("div",{className:"ms-alert-center"},s().createElement(yo.A,{msgId:r.props.loadingError?"queryform.changedFilterWithErrorAlert":"queryform.changedFilterAlert"}))))))}),r.state={showModal:!1},r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Oo(e,t)}(t,e),function(e,t){return t&&bo(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(t,[{key:"UNSAFE_componentWillReceiveProps",value:function(e){e.toolsOptions.useEmbeddedMap||!0!==e.queryPanelEnabled||!1!==this.props.queryPanelEnabled||this.props.onInit()}},{key:"render",value:function(){return this.renderSidebar()}}])}(s().Component);wo(Ao,"propTypes",{advancedToolbar:a().bool,appliedFilter:a().object,items:a().array,layout:a().object,loadingError:a().bool,onInit:a().func,onRestoreFilter:a().func,onSaveFilter:a().func,onToggleQuery:a().func,queryPanelEnabled:a().bool,selectedLayer:a().oneOfType([a().string,a().bool]),spatialMethodOptions:a().array,spatialOperations:a().array,storedFilter:a().object,toolsOptions:a().object}),wo(Ao,"defaultProps",{groupPropertiesChangeHandler:function(){},layerPropertiesChangeHandler:function(){},retrieveLayerData:function(){},onToggleGroup:function(){},onToggleLayer:function(){},onToggleQuery:function(){},onZoomToExtent:function(){},onSettings:function(){},onInit:function(){},updateNode:function(){},removeNode:function(){},activateLegendTool:!0,activateZoomTool:!0,activateSettingsTool:!0,activateRemoveLayer:!0,visibilityCheckType:"checkbox",settingsOptions:{},queryPanelEnabled:!1,layout:{},toolsOptions:{},onSaveFilter:function(){},onRestoreFilter:function(){},items:[],selectedLayer:!1});const xo={QueryPanelPlugin:(0,u.connect)(To,{groupPropertiesChangeHandler:ur.BG,layerPropertiesChangeHandler:ur.ju,retrieveLayerData:ar.a,onToggleGroup:(0,fo.QN)("groups",ur.TN),onToggleLayer:(0,fo.QN)("layers",ur.TN),onToggleQuery:y.KP.bind(null,"queryPanel",null),onSort:(0,fo.nc)(fo.lP,ur.T9),onSettings:ur.l0,onInit:nr.jF,onZoomToExtent:cr.jc,hideSettings:ur.qO,updateSettings:ur.Xx,updateNode:ur.OK,removeNode:ur.bf,onSaveFilter:sr.XB,onRestoreFilter:sr.AD})(Ao),reducers:{draw:Xn.A,queryform:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:so,r=arguments.length>1?arguments[1]:void 0;switch(r.type){case d.qG:return ao(ao({},t),{},{map:r.mapData});case d.TK:return ao(ao({},t),{},{map:null});case d.gJ:var n={rowId:(new Date).getTime(),groupId:r.groupId,attribute:null,operator:"=",value:null,type:null,fieldOptions:{valuesCount:0,currentPage:1},exception:null};return Object.assign({},t,{filterFields:t.filterFields?[].concat(no(t.filterFields),[n]):[n]});case d.hr:return Object.assign({},t,{filterFields:t.filterFields.filter(function(e){return e.rowId!==r.rowId})});case d.EV:return Object.assign({},t,{filterFields:t.filterFields.map(function(e){return e.rowId===r.rowId?uo(e,r):e})});case d.Zs:return Object.assign({},t,{filterFields:t.filterFields.map(function(e){return e.rowId===r.filterField.rowId?Object.assign({},e,{options:Object.assign({},ao({},e.options),lo({},e.attribute,r.options))},{fieldOptions:Object.assign({},ao({},e.fieldOptions),{valuesCount:r.valuesCount})}):e})});case d.ue:return"filterField"===r.layerFilterType?Object.assign({},t,{filterFields:t.filterFields.map(function(e){return e.rowId===r.rowId?Object.assign({},e,{openAutocompleteMenu:r.status}):e})}):(0,eo.hZ)("crossLayerFilter.collectGeometries.queryCollection.filterFields",(tt()(t,"crossLayerFilter.collectGeometries.queryCollection.filterFields")||[]).map(function(e){return e.rowId===r.rowId?ao(ao({},e),{},{openAutocompleteMenu:r.status}):e}),t);case d.g8:return Object.assign({},t,{autocompleteEnabled:r.status});case d.kR:return"filterField"===r.layerFilterType?Object.assign({},t,{filterFields:t.filterFields.map(function(e){return e.rowId===r.filterField.rowId?Object.assign({},e,{loading:r.status}):e})}):(0,eo.hZ)("crossLayerFilter.collectGeometries.queryCollection.filterFields",(tt()(t,"crossLayerFilter.collectGeometries.queryCollection.filterFields")||[]).map(function(e){return e.rowId===r.filterField.rowId?ao(ao({},e),{},{loading:r.status}):e}),t);case d.vH:return Object.assign({},t,{filterFields:t.filterFields.map(function(e){return e.rowId===r.rowId?Object.assign({},e,{exception:r.exceptionMessage}):e})});case d.pr:var o={id:(new Date).getTime(),logic:"OR",groupId:r.groupId,index:r.index+1};return Object.assign({},t,{groupFields:t.groupFields?[].concat(no(t.groupFields),[o]):[o]});case d.eQ:return Object.assign({},t,{groupFields:t.groupFields.map(function(e){return e.id===r.groupId?Object.assign({},e,{logic:r.logic}):e})});case d.m5:return Object.assign({},t,{filterFields:t.filterFields.filter(function(e){return e.groupId!==r.groupId}),groupFields:t.groupFields.filter(function(e){return e.id!==r.groupId})});case d.TF:return Object.assign({},t,{filterFields:t.filterFields.map(function(e){for(var t=0;t<r.attributes.length;t++)if(e.attribute===r.attributes[t].id)return Object.assign({},e,{value:null});return e})});case d.pp:return Object.assign({},t,{attributePanelExpanded:r.expand});case d.T:return Object.assign({},t,{spatialPanelExpanded:r.expand});case d.qi:return Object.assign({},t,{crossLayerExpanded:r.expand});case d.k8:return Object.assign({},t,{crossLayerFilter:(0,eo.hZ)(r.key,r.value,t.crossLayerFilter)});case d.hz:return(0,eo.Vo)("crossLayerFilter.collectGeometries.queryCollection.filterFields",{rowId:r.rowId,groupId:r.groupId,attribute:null,operator:"=",value:null,type:null,fieldOptions:{valuesCount:0,currentPage:1},exception:null},{rowId:r.rowId},t);case d.rQ:return(0,eo.hZ)("crossLayerFilter.collectGeometries.queryCollection.filterFields",(tt()(t,"crossLayerFilter.collectGeometries.queryCollection.filterFields")||[]).map(function(e){return e.rowId===r.rowId?uo(e,r):e}),t);case d.cH:return(0,eo.XB)("crossLayerFilter.collectGeometries.queryCollection.filterFields",{rowId:r.rowId},t);case d.Mj:return Object.assign({},t,{crossLayerFilter:{attribute:t.crossLayerFilter&&t.crossLayerFilter.attribute}});case d.AW:return(0,eo.hZ)("crossLayerFilter.collectGeometries.queryCollection.filterFields",(tt()(t,"crossLayerFilter.collectGeometries.queryCollection.filterFields")||[]).map(function(e){return e.rowId===r.filterField.rowId?ao(ao({},e),{},{options:ao(ao({},e.options),{},lo({},e.attribute,r.options)),fieldOptions:ao(ao({},e.fieldOptions),{},{valuesCount:r.valuesCount})}):e}),t);case d.qT:return Object.assign({},t,{spatialField:Object.assign({},t.spatialField,lo(lo({},r.fieldName,r.method),"geometry",null))});case d.Xb:return Object.assign({},t,{spatialField:Object.assign({},t.spatialField,{geometry:r.geometry})},{toolbarEnabled:!0});case d.yq:return Object.assign({},t,{spatialField:Object.assign({},t.spatialField,lo({},r.fieldName,r.operation))});case d.j3:return Object.assign({},t,{spatialField:Object.assign({},t.spatialField,{attribute:r.attribute}),crossLayerFilter:Object.assign({},t.crossLayerFilter,{attribute:r.attribute})});case h.V9:return"queryform"===r.owner&&"start"===r.status?Object.assign({},t,{toolbarEnabled:!1}):t;case d.Tq:return Object.assign({},t,{toolbarEnabled:!0,spatialField:Object.assign({},t.spatialField,{value:r.value,collectGeometries:r.collectGeometries,geometry:r.srsName?ao(ao({},r.geometry),{},{projection:r.srsName}):r.geometry})});case h.Jb:return"queryform"===r.owner?Object.assign({},t,{toolbarEnabled:!0,spatialField:Object.assign({},t.spatialField,{collectGeometries:r.collectGeometries,geometry:r.geometry})}):t;case d.ze:var i=Object.assign({},so.spatialField,{attribute:t.spatialField.attribute,value:void 0});return Object.assign({},t,{spatialField:Object.assign({},t.spatialField,i)});case d.y$:return Object.assign({},t,{showDetailsPanel:r.show});case d.MI:var a=Object.assign({},so.spatialField,{attribute:t.spatialField.attribute,value:void 0}),l={attribute:t.crossLayerFilter&&t.crossLayerFilter.attribute};return Object.assign({},t,so,{spatialField:a,crossLayerFilter:l,filters:[],map:t.map});case d.Lp:return Object.assign({},t,{showGeneratedFilter:r.data});case d.Rx:return Object.assign({},t,{spatialField:Object.assign({},t.spatialField,{geometry:Object.assign({},t.spatialField.geometry,{distance:r.distance})})});case d.yz:return Object.assign({},t,{spatialField:Object.assign({},t.spatialField,{zoneFields:t.spatialField.zoneFields.map(function(e){return e.id===r.id&&r.data.features&&r.data.features.length>0?Object.assign({},e,{values:r.data.features,open:!0,error:null}):e})})});case d.QJ:return Object.assign({},t,{spatialField:Object.assign({},t.spatialField,{zoneFields:t.spatialField.zoneFields.map(function(e){return e.id===r.id?Object.assign({},e,{busy:r.active}):e})})});case d.qq:var s,u,c=t.spatialField.zoneFields.map(function(e){if(e.id===r.id){if(s=e.multivalue?r.value.value:r.value.value[0],r.value.feature[0]){var t=r.value.feature[0],n=t.geometry_name;if(e.multivalue&&r.value.feature.length>1){for(var o=1;o<r.value.feature.length;o++){var i=r.value.feature[o];i&&(t=Kn()(t,i))}u={coordinates:t.geometry.coordinates,geometryName:n,geometryType:t.geometry.type}}else u={coordinates:t.geometry.coordinates,geometryName:n,geometryType:t.geometry.type}}return Object.assign({},e,{value:s,open:!1,geometryName:u?u.geometryName:null})}return e.dependson&&r.id===e.dependson.id?Object.assign({},e,{disabled:!1,values:null,value:null,open:!1,dependson:Object.assign({},e.dependson,{value:s})}):e}),p=$n()({type:"FeatureCollection",features:r.value.feature});return Object.assign({},t,{spatialField:Object.assign({},t.spatialField,{zoneFields:c,geometry:p&&u?{extent:p,type:u.geometryType,coordinates:u.coordinates}:null})});case d.g5:return Object.assign({},t,{spatialField:Object.assign({},t.spatialField,{zoneFields:t.spatialField.zoneFields.map(function(e){var t=Object.assign({},e,{values:null,value:null,open:!1,error:null});return e.dependson?Object.assign({},t,{disabled:!0,open:!1,value:null,dependson:Object.assign({},e.dependson,{value:null})}):t}),geometry:null})});case d.Ro:var f;return Object.assign({},t,{spatialField:Object.assign({},t.spatialField,{zoneFields:t.spatialField.zoneFields.map(function(e){return e.id===r.id?(f="object"!==ro(r.error)?r.error.status&&r.error.statusText&&r.error.data?{status:r.error.status,statusText:r.error.statusText,data:r.error.data}:{message:r.error.message||"unknown error"}:r.error,Object.assign({},e,{error:f,busy:!1})):e})})});case d.$A:var y=t.simpleFilterFields.reduce(function(e,t){return t.fieldId===r.id?e.push(ao(ao({},t),r.properties)):e.push(t),e},[]);return ao(ao({},t),{},{simpleFilterFields:y});case d.mj:var m,b=(null!==(m=t.filters)&&void 0!==m?m:[]).reduce(function(e,t){var n=r.filters.find(function(e){return e.id===t.id});return n?e.push(n):e.push(t),e},[]);return r.filters.forEach(function(e){b.find(function(t){return t.id===e.id})||b.push(e)}),ao(ao({},t),{},{filters:b});case d.jR:var v,g=(null!==(v=t.filters)&&void 0!==v?v:[]).reduce(function(e,t){return r.filters.find(function(e){return e.id===t.id})||e.push(t),e},[]);return ao(ao({},t),{},{filters:g});case d.DB:var O=r.properties.fieldId?r.properties:ao(ao({},r.properties),{},{fieldId:(new Date).getTime()}),F=t.simpleFilterFields?[].concat(no(t.simpleFilterFields),[O]):[O];return ao(ao({},t),{},{simpleFilterFields:F});case d.Q5:return ao(ao({},t),{},{simpleFilterFields:t.simpleFilterFields.filter(function(e){return e.fieldId!==r.id})});case d.PN:return ao(ao({},t),{},{simpleFilterFields:[]});case d.Ur:var E=so.spatialField,w=(E.attribute,function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(E,to)),j=Object.assign({},so,{spatialField:ao({},w)}),S=r.filter||j,P=S.spatialField,T=S.filterFields,A=S.groupFields,x=S.crossLayerFilter,C=S.attributePanelExpanded,I=S.spatialPanelExpanded,D=S.filters;return ao(ao({},t),{attributePanelExpanded:C,spatialPanelExpanded:I,crossLayerExpanded:(null==r||null===(e=r.filter)||void 0===e?void 0:e.crossLayerExpanded)||j.crossLayerExpanded,spatialField:ao(ao({},P),{},{attribute:P&&P.attribute||t.spatialField&&t.spatialField.attribute}),filters:null!=D?D:[],filterFields:T,groupFields:A,crossLayerFilter:ao(ao({},x),{},{attribute:x&&x.attribute||t.crossLayerFilter&&t.crossLayerFilter.attribute})});default:return t}},query:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Yn,r=arguments.length>1?arguments[1]:void 0;switch(r.type){case nr.qD:return Object.assign({},t,{typeName:r.typeName,url:r.url});case nr.IY:return Object.assign({},t,{featureTypes:Object.assign({},t.featureTypes,Hn({},r.typeName,r.featureType))});case nr.pF:return Object.assign({},t,{featureTypes:Object.assign({},t.featureTypes,Hn({},r.typeName,{error:r.error}))});case nr.KF:return Object.assign({},t,{featureLoading:r.isLoading});case nr.ZJ:return Object.assign({},t,{featureLoading:!1,data:Object.assign({},t.data,Hn({},r.typeName,(e=r.feature,["STATE_NAME","STATE_ABBR","SUB_REGION","STATE_FIPS"].map(function(t){return{attribute:t,values:e.features.reduce(function(e,r){return-1===e.indexOf(r.properties[t])?[].concat(function(e){return function(e){if(Array.isArray(e))return Qn(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Qn(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Qn(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e),[r.properties[t]]).sort():e},[])}}).reduce(function(e,t){return Object.assign(e,Hn({},t.attribute,t.values.map(function(e){return{id:e,name:e}})))},{}))))});case nr.GW:return Object.assign({},t,{featureLoading:!1,featureTypes:Object.assign({},t.data,Hn({},r.typeName,{error:r.error}))});case nr.cv:return Object.assign({},t,{isNew:!0,searchUrl:r.searchUrl,filterObj:r.filterObj});case nr.f4:return Object.assign({},t,{filterObj:Object.assign({},t.filterObj,r.updates)});case nr.Ve:return Object.assign({},t,{isNew:!1,result:r.result,searchUrl:r.searchUrl,filterObj:r.filterObj,resultError:null});case nr._Z:return Object.assign({},t,{isNew:!1,result:null,resultError:r.error});case y.rY:case d.MI:return r.skip&&r.skip.indexOf("query")>=0?t:Object.assign({},t,{isNew:!1,result:null,filterObj:null,searchUrl:null,filters:null});case nr.Rb:return Object.assign({},t,{result:null,resultError:null});case nr.Xi:return Object.assign({},t,{syncWmsFilter:!t.syncWmsFilter});case Vn.s2:return Object.assign({},t,{syncWmsFilter:r.syncWmsFilter});case nr.Ii:return Object.assign({},t,{isLayerFilter:!t.isLayerFilter});default:return t}},layerFilter:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Bn,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case sr.Ku:return Gn(Gn({},Bn),{},{persisted:t.filter,applied:t.filter});case sr.EA:return Gn(Gn({},e),{},{applied:e.persisted});case sr.Zm:return Gn(Gn({},e),{},{applied:t.filter});case sr.NG:return Gn(Gn({},e),{},{persisted:e.applied});case d.MI:return Gn(Gn({},e),{},{applied:void 0});default:return e}}},epics:Eo(Eo(Eo({featureTypeSelectedEpic:function(e,t){return e.ofType(nr.qD).filter(function(e){return e.url&&e.typeName}).switchMap(function(e){var r=t.getState();if((0,yn.j5)(r,e.typeName)){var n=Mn((0,yn.uT)(r,e.typeName),e.fields),o=n.geometry[0]&&n.geometry[0].attribute?n.geometry[0].attribute:"the_geom";return nt().Observable.of((0,nr.MN)(e.typeName,n,e.owner),(0,d.bB)(o),nt().Scheduler.async)}var i=(0,An.IT)(r);return i&&"vector"===i.type?nt().Observable.defer(function(){return cn.A.get(e.url)}).map(function(t){var r={featureTypes:[t.data.featureTypes[0]]},n={geometry:r.featureTypes[0].properties.filter(function(e){return 0===e.name.indexOf("geometry")}).map(function(e){return e}),original:r,attributes:(0,at.wY)(r,e.fields)},o=n.geometry[0]&&n.geometry[0].attribute?n.geometry[0].attribute:"the_geom",i=new Promise(function(e){e((0,d.bB)(o))}).then(function(){return new Promise(function(t){t((0,nr.MN)(e.typeName,n))})});return nt().Observable.defer(function(){return i})}).mergeAll():nt().Observable.defer(function(){var r;return cn.A.get(dn.Ay.filterUrlParams(e.url,(0,mn.Ns)(t.getState()))+"?service=WFS&version=1.1.0&request=DescribeFeatureType&typeName="+e.typeName+"&outputFormat=application/json",{_msAuthSourceId:null==i||null===(r=i.security)||void 0===r?void 0:r.sourceId})}).map(function(t){if("object"===Rn(t.data)&&t.data.featureTypes&&t.data.featureTypes[0]){var r=Mn(t.data,e.fields),n=r.geometry[0]&&r.geometry[0].attribute?r.geometry[0].attribute:"the_geom";return nt().Observable.from([(0,d.bB)(n),(0,nr.MN)(e.typeName,r)])}try{JSON.parse(t.data)}catch(t){return nt().Observable.from([(0,nr.Z4)(e.typeName,"Error from WFS: "+t.message),pn.z3({title:"warning",message:"layerProperties.featureTypeErrorInvalidJSON",autoDismiss:3,position:"tc"})])}return nt().Observable.from([(0,nr.Z4)(e.typeName,"Error: feature types are empty")])}).mergeAll().catch(function(t){return nt().Observable.of((0,nr.Z4)(e.typeName,t.message||t.statusText))})})},wfsQueryEpic:function(e,t){return e.ofType(nr.Jj).switchMap(function(r){var n,o,i,a,l=(i=(a=t.getState()).query&&a.query.featureTypes&&a.query.featureTypes[a.query.typeName]&&a.query.featureTypes[a.query.typeName].attributes&&a.query.featureTypes[a.query.typeName].attributes[0]&&a.query.featureTypes[a.query.typeName].attributes[0].attribute||null)?{sortBy:i,sortOrder:"A"}:{},s=(null==r||null===(n=r.filterObj)||void 0===n?void 0:n.sortOptions)||l,u=yn.Be.totalFeatures(t.getState()),c=dn.Ay.filterUrlParams(r.searchUrl,(0,mn.Ns)(t.getState())),p=(0,An.IT)(t.getState()),f=(0,An._d)(t.getState()),d=null!=p?p:{},y=d.layerFilter,m=d.params,b=void 0===m?{}:m,v=null==b?void 0:b[F()(Object.keys(b||{}),function(){return"cql_filter"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").toLowerCase()})],g="vector"===(null==p?void 0:p.type)?r.filterObj:(0,L.o2)({ogcVersion:"1.1.0"},v,f?y:null,r.filterObj),h=function(e,t,r){var n=(0,An.Z)(r),o=(0,xn.$P)({id:n},"time")(r),i=(0,gn.pO)(r,n)||{},a=tt()(i,'params["time"]');if((0,An.te)(r)&&o&&a){var l=(0,Tn.parse)(e)||{};return{url:(0,Tn.format)(Dn(Dn({},l),{},{query:Dn(Dn({},l.query),{},{time:a})})),options:t}}return{url:e,options:t}}(c,r.queryOptions||{},t.getState()),O=h.url,E=h.options,w=qn(qn(qn({},r.filterObj.pagination),{},{totalFeatures:u,sortOptions:s},E),{},{layer:p});return nt().Observable.merge((0,ot.Gw)(qn(qn({},p),{},{name:r.filterObj.featureTypeName||(null==p?void 0:p.name),search:qn(qn({},null!==(o=null==p?void 0:p.search)&&void 0!==o?o:{}),{},{url:O})}),g,w).map(function(e){return(0,nr.qu)(e,r.searchUrl,r.filterObj,r.queryOptions,r.reason)}).catch(function(e){return nt().Observable.of((0,nr.Lk)(e))}).startWith((0,nr.x5)(!0)).concat(nt().Observable.of((0,nr.x5)(!1)),nt().Observable.of((0,ur.u9)(null==p?void 0:p.id)))).takeUntil(e.ofType(nr.f4))})},viewportSelectedEpic:function(e,t){return e.ofType(d.ds,cr.e6).switchMap(function(e){var r=e.type===cr.e6?e:(0,v.mg)(t.getState());if((e.type===d.ds||e.type===cr.e6&&"Viewport"===(0,g.nh)(t.getState()))&&r.bbox&&r.bbox.bounds&&r.bbox.crs){var n=Object.keys(r.bbox.bounds).reduce(function(e,t){return Object.assign({},e,_n({},t,parseFloat(r.bbox.bounds[t])))},{});return nt().Observable.of((0,d.Zi)(ge.default.getViewportGeometry(n,r.bbox.crs)))}return nt().Observable.empty()})},redrawSpatialFilterEpic:function(e,t){return e.ofType(nr.V8).switchMap(function(){var e=t.getState(),r=(0,g.kd)(e),n={type:"Feature",geometry:{type:(0,g.yE)(e),coordinates:(0,g.ng)(e)}},o=(0,g.A3)(e)?(0,h.VX)("drawOrEdit",r.method||"","queryform",[n],{featureProjection:(0,g.dz)(e),drawEnabled:!1,editEnabled:!1}):(0,h.VX)("clean",r.method||"","queryform",[],{drawEnabled:!1,editEnabled:!1});return nt().Observable.of(o)})}},bn),Pn),wn)}},432267(e,t,r){r.d(t,{A3:()=>v,BH:()=>w,G_:()=>y,dz:()=>S,fV:()=>h,jy:()=>m,kd:()=>g,ng:()=>P,nh:()=>E,u6:()=>b,xY:()=>F,yE:()=>j,zv:()=>O});var n=r(978632),o=r.n(n),i=r(801081),a=r(307679),l=r(508828),s=r(628017);function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}var c=["title"];function p(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?p(Object(r),!0).forEach(function(t){d(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function d(e,t,r){return(t=function(e){var t=function(e){if("object"!=u(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=u(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==u(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var y=function(e){return o()(e,"queryform.map")},m=function(e){return o()(e,"queryform.crossLayerFilter")},b=function(e){return((0,a.Kv)(e)||[]).filter(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.type,r=e.group;return"wms"===t&&"background"!==r}).map(function(t){var r=t.title;return f(f({},function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(t,c)),{},{title:(0,s.zH)((0,l.Pd)(e),r)})})},v=function(e){return o()(e,"queryform.spatialField.geometry")},g=function(e){return o()(e,"queryform.spatialField")},h=(0,i.Mz)(function(e){return o()(e,"queryform.attributePanelExpanded")},function(e){return o()(e,"queryform.spatialPanelExpanded")},function(e){return o()(e,"queryform.crossLayerExpanded")},function(e,t,r){return{attributePanelExpanded:e,spatialPanelExpanded:t,crossLayerExpanded:r}}),O=function(e){return o()(e,"layerFilter.persisted")},F=function(e){return o()(e,"layerFilter.applied")},E=function(e){return o()(e,"queryform.spatialField.method")},w=function(e){return o()(e,"queryform.maxFeaturesWPS")},j=function(e){return v(e)&&v(e).type||"Polygon"},S=function(e){return v(e)&&v(e).projection||"EPSG =4326"},P=function(e){return v(e)&&v(e).coordinates||[]}},449516(e,t,r){r.d(t,{A:()=>i});var n=r(576314),o=r.n(n)()(function(e){return e[1]});o.push([e.id,"",""]);const i=o},545567(e,t,r){r.d(t,{EV:()=>z,Gw:()=>U,o0:()=>M,sq:()=>G});var n=r(23412),o=r.n(n),i=r(908437),a=r.n(i),l=r(39128),s=r.n(l),u=r(104567),c=r.n(u),p=r(802401),f=r.n(p),d=r(45388),y=r.n(d),m=r(738805),b=r(692114),v=r(995531),g=r(102685),h=r(112585),O=r(492312),F=r(193275),E=r(79738),w=["totalFeatures","features"],j=["sortOptions","propertyName"];function S(e){return function(e){if(Array.isArray(e))return P(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return P(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?P(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function P(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function T(e){return T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},T(e)}function A(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function x(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function C(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?x(Object(r),!0).forEach(function(t){I(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):x(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function I(e,t,r){return(t=function(e){var t=function(e){if("object"!=T(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=T(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==T(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var D=(0,F.A)({wfsVersion:"1.1.0"}),L=D.getFeature,N=D.query,q=D.sortBy,_=D.propertyName,R=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"json",i=(0,g.zD)(t,r),a=o().parse((0,E.t)(e),!0),l=f()(a.query)?a.query:{};l.service="WFS",l.outputFormat=n;var s=o().format({protocol:a.protocol,host:a.host,pathname:a.pathname,query:l});return r.layer&&"vector"===r.layer.type?y().Observable.defer(function(){return new Promise(function(e){var n,o=function(e,t){if(t.filterFields&&0!==t.filterFields.length){var r=e.features.filter((0,g.Jt)(t));e.features=r,e.numberMatched=r.length,e.numberReturned=r.length,e.totalFeatures=r.length}return t.sortOptions&&t.sortOptions.sortBy&&t.sortOptions.sortOrder&&"NONE"!==t.sortOptions.sortOrder&&e.features.sort(function(e,r){var n=e.properties[t.sortOptions.sortBy],o=r.properties[t.sortOptions.sortBy],i=n.toLowerCase().localeCompare(o.toLowerCase());return"ASC"===t.sortOptions.sortOrder?i:-1*i}),e}({crs:{type:"name",properties:{name:"urn:ogc:def:crs:EPSG::4326"}},numberMatched:(n=r.layer.features).length,numberReturned:n.length,timeStamp:"2020-07-20T11:36:20.118Z",totalFeatures:n.length,type:"FeatureCollection",features:n},t);e(o)})}):{data:i,queryString:s}},M=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0;if(r.layer&&"vector"===r.layer.type)return R(e,t,r,n);var o=R(e,t,r,n),i=o.data,a=o.queryString;return y().Observable.defer(function(){var e,t;return v.A.post(a,i,{timeout:6e4,responseType:"arraybuffer",headers:{Accept:"application/xml","Content-Type":"application/xml"},_msAuthSourceId:(null===(e=r.layer)||void 0===e||null===(e=e.security)||void 0===e?void 0:e.sourceId)||(null===(t=r.security)||void 0===t?void 0:t.sourceId)})})},k=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(r.layer&&"vector"===r.layer.type)return R(e,t,r);var n=R(e,t,r),o=n.data,i=n.queryString;return y().Observable.defer(function(){return v.A.post(i,o,C({timeout:6e4,headers:{Accept:"application/json","Content-Type":"application/xml"}},null==r?void 0:r.requestOptions))}).let(O.m9).map(function(e){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.totalFeatures,r=e.features,n=A(e,w),o=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).startIndex,i=arguments.length>2?arguments[2]:void 0;return i>t&&i===o+r.length&&t===r.length?C(C({},n),{},{features:r,totalFeatures:i}):C(C({},n),{},{features:r,totalFeatures:t})}(e.data,function(){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).pagination||!c()(e.startIndex)&&!c()(e.maxFeatures)&&{startIndex:e.startIndex,maxFeatures:e.maxFeatures}}(t,r),r.totalFeatures)})},U=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.search,r=void 0===t?{}:t,n=e.url,o=e.name,i=e.security,l=arguments.length>1?arguments[1]:void 0,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},c=u.sortOptions,p=u.propertyName,f=A(u,j);return k(r.url||n,l&&"object"===T(l)?C(C({},l),{},{typeName:o||l.typeName}):L(N(o,[].concat(S(c?[q(c.sortBy,c.sortOrder)]:[]),S(p?[_(p)]:[]),S(l?s()(l):[]))),f),C({security:i},f)).catch(function(e){if("OGCError"===e.name&&"NoApplicableCode"===e.code&&!c&&p&&p[0])return k(r.url||n,l&&"object"===T(l)?C(C({},l),{},{typeName:o||l.typeName}):L(N(o,[q(a()(p)?p[0]:p)].concat(S(p?[_(p)]:[]),S(l?s()(l):[]))),f),f);throw e})},G=function(e){var t=e.layer,r=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.name,r=e.search,n=void 0===r?{}:r,i=e.url,a=e.describeFeatureTypeURL,l=o().parse((0,E.t)(a||n.url||i),!0);return o().format(C(C({},l),{},{search:void 0,query:C(C({},l.query),{},{service:"WFS",version:"1.1.0",typeName:t,outputFormat:"application/json",request:"DescribeFeatureType"})}))}(t);return y().Observable.defer(function(){var e;return v.A.get(r,{_msAuthSourceId:null==t||null===(e=t.security)||void 0===e?void 0:e.sourceId})}).let(O.m9)},z=function(e){var t=e.layer,r=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.name,r=e.search,n=void 0===r?{}:r,i=e.url,a=(0,h.wk)({name:t,url:n&&n.url||i}),l=o().parse(a,!0);return o().format(C(C({},l),{},{search:void 0,query:C(C({},l.query),{},{service:"WFS",version:"1.1.1",request:"GetCapabilities"})}))}(t);return y().Observable.defer(function(){var e;return v.A.get(r,{_msAuthSourceId:null==t||null===(e=t.security)||void 0===e?void 0:e.sourceId})}).let(O.m9).switchMap(function(e){return y().Observable.bindNodeCallback(function(e,t){return(0,m.parseString)(e,{tagNameProcessors:[b.stripPrefix],explicitArray:!1,mergeAttrs:!0},t)})(e.data)})}},552749(e,t,r){r.d(t,{A:()=>s});var n=r(916589);function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach(function(t){l(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function l(e,t,r){return(t=function(e){var t=function(e){if("object"!=o(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=o(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==o(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const s=(0,n.compose)((0,n.withHandlers)({onMapViewChanges:function(e){var t=e.map,r=void 0===t?{}:t,n=e.onMapViewChanges,o=void 0===n?function(){}:n;return function(e,t,n,i,l,s,u,c,p,f){o(a(a({},r),{},{center:e,bbox:a(a({},r.bbox),n),zoom:t,size:i,mapStateSource:l,projection:s,resolution:c,orientate:p,zoomToExtentHandler:f}))}}}),(0,n.withPropsOnChange)(["onMapViewChanges","eventHandlers"],function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.onMapViewChanges,r=void 0===t?function(){}:t,n=e.eventHandlers;return{eventHandlers:a(a({},void 0===n?{}:n),{},{onMapViewChanges:r})}}))},590421(e,t,r){r.d(t,{H6:()=>E,XM:()=>O,ar:()=>F});var n=r(23412),o=r.n(n),i=r(59404),a=r.n(i),l=r(962028),s=r.n(l),u=r(104567),c=r.n(u),p=r(45388),f=r.n(p),d=r(337291),y=r(995531),m=r(989105);function b(e){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},b(e)}function v(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function g(e,t,r){return(t=function(e){var t=function(e){if("object"!=b(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=b(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==b(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var h=function(e){var t=e.searchText,r=void 0===t?"":t,n=e.queriableAttributes,o=void 0===n?[]:n,i=e.predicate,a=void 0===i?"ILIKE":i,l=s()(o),u=r.toLowerCase(),p="strToLowerCase(".concat(l,") ").concat(a," '%").concat(u,"%'");return c()(l)?"":"("+p+")"},O=function(e){return e.distinctUntilChanged(function(e){var t=e.value,r=e.currentPage,n=e.attribute,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return!(o.value!==t||o.currentPage!==r||o.attribute!==n)}).throttle(function(e){return f().Observable.timer(e.delayDebounce||0)}).merge(e.debounce(function(e){return f().Observable.timer(e.delayDebounce||0)})).distinctUntilChanged().switchMap(function(e){if(e.performFetch){var t=(0,m.H)({attribute:e.attribute,layerName:e.typeName,maxFeatures:e.maxFeatures,startIndex:(e.currentPage-1)*e.maxFeatures,value:e.value});return f().Observable.fromPromise(y.A.post(e.url,t,{timeout:6e4,headers:{Accept:"application/json","Content-Type":"application/xml"}}).then(function(e){return{fetchedData:e.data,busy:!1}})).catch(function(){return f().Observable.of({fetchedData:{values:[],size:0},busy:!1})}).startWith({busy:!0})}return f().Observable.of({fetchedData:{values:[],size:0},busy:!1})}).startWith({})},F=function(e){return e.distinctUntilChanged(function(e){var t=e.value,r=e.currentPage,n=e.filterProps,o=void 0===n?{}:n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=i.filterProps||{};return!(i.value!==t||i.currentPage!==r||a.typeName!==o.typeName||JSON.stringify(a.queriableAttributes)!==JSON.stringify(o.queriableAttributes)||a.maxFeatures!==o.maxFeatures||a.predicate!==o.predicate)}).throttle(function(e){return f().Observable.timer(e.delayDebounce||0)}).merge(e.debounce(function(e){return f().Observable.timer(e.delayDebounce||0)})).distinctUntilChanged().switchMap(function(e){var t=e.filterProps,r=void 0===t?{}:t,n=e.value,o=e.currentPage,i=r.typeName,a=r.queriableAttributes,l=r.maxFeatures,s=r.blacklist,u=r.performFetch,c=void 0===u||u,p=r.predicate;if(c&&e.url&&i&&a&&a.length>0){var d=(o-1)*l,b=a[0],v=(0,m.H)({attribute:b,layerName:i,maxFeatures:l,startIndex:d,value:n,predicate:p});return v?f().Observable.fromPromise(y.A.post(e.url,v,{timeout:6e4,headers:{Accept:"application/json","Content-Type":"application/xml"}}).then(function(e){var t,r,n=(null===(t=e.data)||void 0===t?void 0:t.values)||[],o=(null===(r=e.data)||void 0===r?void 0:r.size)||0;return s&&Array.isArray(s)&&s.length>0&&(n=n.filter(function(e){return!s.includes(e)})),{fetchedData:{values:n,size:o},busy:!1}})).catch(function(){return f().Observable.of({fetchedData:{values:[],size:0},busy:!1})}).startWith({busy:!0}):f().Observable.of({fetchedData:{values:[],size:0},busy:!1})}return f().Observable.of({fetchedData:{values:[],size:0},busy:!1})}).startWith({})},E=function(e){return f().Observable.merge(e.distinctUntilChanged(function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).value===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).value}).debounce(function(e){return f().Observable.timer(e.delayDebounce||0)}),e.distinctUntilChanged(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.filterProps,r=e.currentPage,n=arguments.length>1?arguments[1]:void 0,o=n.filterProps,i=n.currentPage;return t===o&&r===i})).switchMap(function(e){if(e.performFetch){var t=o().parse(e.url,!0),r="";(a()(t.pathname,"wfs")||a()(t.pathname,"wms")||a()(t.pathname,"ows")||a()(t.pathname,"wps"))&&(r=t.pathname.replace(/(wms|ows|wps|wfs)$/,"wfs")),t.query&&t.query.service&&delete t.query.service;var n=o().format(Object.assign({},t,{search:null,pathname:r})),i=Object.assign({},function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?v(Object(r),!0).forEach(function(t){g(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({url:n,typeName:e.filterProps&&e.filterProps.typeName||"",predicate:e.filterProps&&e.filterProps.predicate||"ILIKE",blacklist:e.filterProps&&e.filterProps.blacklist||[],maxFeatures:e.filterProps&&e.filterProps.maxFeatures||3,queriableAttributes:e.filterProps&&e.filterProps.queriableAttributes||[],returnFullData:!0,startIndex:((e.currentPage||1)-1)*(e.filterProps&&e.filterProps.maxFeatures||3),outputFormat:"application/json",staticFilter:"",fromTextToFilter:h,item:{},timeout:6e4,headers:{Accept:"application/json","Content-Type":"application/xml"},srsName:e.filterProps&&e.filterProps.srsName||"EPSG:4326"},t.query));return f().Observable.fromPromise(d.n.Utils.getService("wfs")(e.value,i).then(function(t){return{fetchedData:{values:t.features.map(function(e){return e.properties}),size:t.totalFeatures,features:t.features,crs:e.filterProps&&e.filterProps.srsName||"EPSG:4326"},busy:!1}})).catch(function(){return f().Observable.of({fetchedData:{values:[],size:0,features:[]},busy:!1})}).startWith({busy:!0})}return f().Observable.of({fetchedData:{values:[],size:0,features:[]},busy:!1})}).startWith({})}},653077(e,t,r){r.d(t,{V:()=>E,a:()=>w});var n=r(904059),o=r(375482),i=r(142974),a=r(181817),l=r(995531),s=r(23412),u=r.n(s),c=r(738805),p=r.n(c),f=r(79738);const d=function(e,t){var r=u().parse((0,f.t)(e),!0),n=u().format(Object.assign({},r,{query:Object.assign({service:"WCS",version:"1.1.0",identifiers:t,request:"DescribeCoverage"},r.query)}));return l.A.get(n).then(function(e){var t;return p().parseString(e.data,{explicitArray:!1},function(e,r){t=r}),t})};var y=r(112585),m=r(978632),b=r.n(m),v=r(112206);function g(e){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},g(e)}function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function O(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach(function(t){F(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function F(e,t,r){return(t=function(e){var t=function(e){if("object"!=g(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=g(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==g(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function E(e,t,r){return function(i){return o.Ay.describeLayer(e,t.name,r).then(function(r){return r&&"WFS"===r.owsType?a.sq(e,r.name).then(function(e){return r.geometryType=(0,v.ud)(e),i((0,n.OK)(t.id,"id",{describeLayer:r,describeFeatureType:e}))}).catch(function(){return i((0,n.OK)(t.id,"id",{describeLayer:r||{error:"no describe feature found"}}))}):(r&&"WCS"===r.owsType&&d(e,r.name).then(function(e){var o=b()(e,"wcs:CoverageDescriptions.wcs:CoverageDescription.wcs:Range.wcs:Field.wcs:Axis.wcs:AvailableKeys.wcs:Key");r.bands=o&&"string"==typeof o?["1"]:o.map(function(e,t){return t+1+""}),i((0,n.OK)(t.id,"id",{describeLayer:r,describeCoverage:e}))}).catch(function(){return i((0,n.OK)(t.id,"id",{describeLayer:r||{error:"no describe coverage found"}}))}),i((0,n.OK)(t.id,"id",{describeLayer:r||{error:"no describe Layer found"}})))}).catch(function(e){return i((0,n.OK)(t.id,"id",{describeLayer:{error:e.status}}))})}}function w(e){var t=(0,y.wk)(e);return function(r){return r((0,n.OK)(e.id,"id",{capabilitiesLoading:!0})),o.Ay.getCapabilities(t).then(function(t){var a=o.Ay.parseLayerCapabilities(t,e);r(a?(0,n.OK)(e.id,"id",O(O({},(0,i.e9)(a)),{},{capabilitiesLoading:null})):(0,n.OK)(e.id,"id",{capabilitiesLoading:null,capabilities:{error:"error getting capabilities",details:"no layer info"},description:null}))}).catch(function(t){r((0,n.OK)(e.id,"id",{capabilitiesLoading:null,capabilities:{error:"error getting capabilities",details:t},description:null}))})}}},654456(e,t,r){r.d(t,{GW:()=>u,IY:()=>i,Ii:()=>g,Jj:()=>m,KF:()=>l,LO:()=>h,Lk:()=>T,Lm:()=>n,MN:()=>w,Mb:()=>E,P:()=>C,Rb:()=>y,UR:()=>O,V8:()=>b,VZ:()=>x,Ve:()=>f,Xi:()=>v,Z4:()=>j,ZJ:()=>a,_Z:()=>d,cv:()=>c,f4:()=>p,jF:()=>F,oR:()=>A,pF:()=>s,qD:()=>o,qu:()=>P,x5:()=>S}),r(995531);var n="LAYER_SELECTED_FOR_SEARCH",o="FEATURE_TYPE_SELECTED",i="FEATURE_TYPE_LOADED",a="FEATURE_LOADED",l="FEATURE_LOADING",s="FEATURE_TYPE_ERROR",u="FEATURE_ERROR",c="QUERY_CREATE",p="QUERY:UPDATE_QUERY",f="QUERY_RESULT",d="QUERY_ERROR",y="RESET_QUERY",m="QUERY",b="INIT_QUERY_PANEL",v="QUERY:TOGGLE_SYNC_WMS",g="QUERY:TOGGLE_LAYER_FILTER";function h(){return{type:v}}function O(){return{type:g}}function F(){return{type:b}}function E(e,t){return{type:o,url:e,typeName:t,fields:arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],owner:arguments.length>3?arguments[3]:void 0}}function w(e,t,r){return{type:i,typeName:e,featureType:t,owner:r}}function j(e,t){return{type:s,typeName:e,error:t}}function S(e){return{type:l,isLoading:e}}function P(e,t,r,n,o){return{type:f,searchUrl:t,filterObj:r,result:e,queryOptions:n,reason:o}}function T(e){return{type:d,error:e}}function A(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.updates,r=e.reason,n=e.useLayerFilter;return{type:p,updates:t,reason:r,useLayerFilter:n}}function x(e,t,r){return{type:c,searchUrl:e,filterObj:t,owner:r}}function C(e,t,r,n){return{type:m,searchUrl:e,filterObj:t,queryOptions:r,reason:n}}},717140(e,t,r){r.d(t,{Ij:()=>m,Jb:()=>o,Kf:()=>s,Lu:()=>i,Ly:()=>p,Mm:()=>y,Mr:()=>v,Ne:()=>u,Nu:()=>w,Q4:()=>a,S$:()=>c,V9:()=>n,VX:()=>b,ZM:()=>l,d:()=>g,et:()=>d,jx:()=>O,tq:()=>h,uw:()=>F,vK:()=>f,vw:()=>E});var n="CHANGE_DRAWING_STATUS",o="DRAW:END_DRAWING",i="DRAW:SET_CURRENT_STYLE",a="DRAW:GEOMETRY_CHANGED",l="DRAW:DRAW_SUPPORT_STOPPED",s="DRAW:SET_SNAPPING_LAYER",u="DRAW:SNAPPING_IS_LOADING",c="DRAW:TOGGLE_SNAPPING",p="DRAW:SET_SNAPPING_CONFIG";function f(e,t,r,n,o){return{type:a,features:e,owner:t,enableEdit:r,textChanged:n,circleChanged:o}}function d(){return{type:"DRAW:FEATURES_SELECTED",features:arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]}}function y(){return{type:"DRAW:DRAWING_FEATURES",features:arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]}}function m(){return{type:l}}function b(e,t,r,o,i,a){return{type:n,status:e,method:t,owner:r,features:o,options:i,style:a}}function v(e,t){return{type:o,geometry:e,owner:t}}function g(e){return{type:i,currentStyle:e}}var h=function(e){return b("clean","",e,[],{})};function O(){return{type:c}}function F(e){return{type:s,snappingLayer:e}}function E(){return{type:u}}function w(e,t,r){return{type:p,value:e,prop:t,pluginCfg:r}}},820543(e,t,r){r.d(t,{A:()=>i});var n=r(576314),o=r.n(n)()(function(e){return e[1]});o.push([e.id,"/*\n * Copyright 2025, GeoSolutions Sas.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree.\n */\n.alert-popover .alert-popover-trigger {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n}\n.alert-popover .alert-popover-icon {\n  cursor: pointer;\n  transition: opacity 0.2s ease;\n}\n.alert-popover .alert-popover-icon:hover {\n  opacity: 0.8;\n}\n.alert-popover-popup .alert-popover-header {\n  display: flex;\n  align-items: center;\n  justify-content: flex-end;\n  gap: 8px;\n  margin-bottom: 8px;\n}\n.alert-popover-popup .alert-popover-content {\n  position: relative;\n}\n.alert-popover-popup .alert-popover-close {\n  cursor: pointer;\n  transition: opacity 0.2s ease;\n  font-size: 12px;\n}\n.alert-popover-popup .alert-popover-close:hover {\n  opacity: 0.7;\n}\n.alert-popover-popup .alert-popover-countdown {\n  position: relative;\n  width: 16px;\n  height: 16px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.alert-popover-popup .alert-popover-countdown .countdown-svg {\n  overflow: visible;\n}\n.alert-popover-popup .alert-popover-countdown .countdown-svg .countdown-background {\n  stroke: #ddd;\n  stroke-width: 2.5;\n  fill: none;\n  opacity: 0.3;\n}\n.alert-popover-popup .alert-popover-countdown .countdown-svg .countdown-progress {\n  stroke-width: 2.5;\n  fill: none;\n  stroke-linecap: round;\n  transform-origin: 8px 8px;\n}\n.alert-popover-popup .alert-popover-countdown .countdown-svg .countdown-progress.counting {\n  stroke: #ff4444;\n  transition: stroke-dashoffset 1s linear, stroke 0.3s ease;\n}\n.alert-popover-popup .alert-popover-countdown .countdown-svg .countdown-progress.paused {\n  stroke: #ffa500;\n  transition: none;\n}\n.alert-popover-popup .alert-popover-countdown .countdown-number {\n  position: absolute;\n  font-size: 8px;\n  font-weight: bold;\n  pointer-events: none;\n  line-height: 1;\n  transition: color 0.3s ease;\n}\n.alert-popover-popup .alert-popover-countdown .countdown-number.counting {\n  color: #ff4444;\n}\n.alert-popover-popup .alert-popover-countdown .countdown-number.paused {\n  color: #ffa500;\n}\n",""]);const i=o},978548(e,t,r){r.d(t,{A:()=>c});var n=r(717140);function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach(function(t){l(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function l(e,t,r){return(t=function(e){var t=function(e){if("object"!=o(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=o(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==o(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var s={drawStatus:null,drawOwner:null,drawMethod:null,options:{},features:[],tempFeatures:[],snapping:!1,snappingIsLoading:!1,snappingLayer:!1},u={edge:!0,vertex:!0,pixelTolerance:10,strategy:"bbox"};const c=function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s,o=arguments.length>1?arguments[1]:void 0;switch(o.type){case n.V9:return Object.assign({},r,{drawStatus:o.status,drawOwner:o.owner,drawMethod:o.method,options:o.options,features:o.features,style:o.style});case n.Lu:return Object.assign({},r,{currentStyle:o.currentStyle});case n.Q4:return Object.assign({},r,{tempFeatures:o.features});case n.ZM:return Object.assign({},r,{tempFeatures:[]});case n.S$:return a(a({},r),{},{snapping:!r.snapping});case n.Kf:return a(a({},r),{},{snappingLayer:o.snappingLayer,snappingIsLoading:!1});case n.Ne:return a(a({},r),{},{snappingIsLoading:!r.snappingIsLoading});case n.Ly:return a(a({},r),{},{snapConfig:a(a(a({},a(a({},u),(null===(e=o.pluginCfg)||void 0===e?void 0:e.snapConfig)||{})),null!==(t=null==r?void 0:r.snapConfig)&&void 0!==t?t:{}),o.prop&&void 0!==o.value?l({},o.prop,o.value):{})});default:return r}}}}]);