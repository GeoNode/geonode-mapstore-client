(self.webpackChunkgeonode_mapstore_client=self.webpackChunkgeonode_mapstore_client||[]).push([[9010],{28261:(e,t,n)=>{"use strict";n.d(t,{Z:()=>u});var l=n(67294),r=n.n(l),a=n(45697),o=n.n(a),i=["id","className","style","children"];function c(){return c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(e[l]=n[l])}return e},c.apply(this,arguments)}function s(e){var t=e.id,n=e.className,l=e.style,a=e.children,o=function(e,t){if(null==e)return{};var n,l,r=function(e,t){if(null==e)return{};var n,l,r={},a=Object.keys(e);for(l=0;l<a.length;l++)n=a[l],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(l=0;l<a.length;l++)n=a[l],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,i),s=n?" "+n:"";return r().createElement(r().Fragment,null,r().createElement("div",c({},o,{id:t,className:"gn-spinner".concat(s),style:l}),r().createElement("div",null)),a)}s.propTypes={id:o().string,className:o().string,style:o().object},s.defaultProps={};const u=s},51605:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l.Z});var l=n(28261)},58074:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>W});var l=n(67294),r=n.n(l),a=n(22843),o=n(33664),i=n(22222),c=n(57588),s=n(92222),u=n(32244),d=n(94943),v=n(89255),y=n(99380),f=n(80416),m=n(96909),p=n(82904),b=n(60604),E=n(99009),g=n(9082),S=n(93222),h="GEONODE:REQUEST_DATASET_AVAILABLE_STYLES",O="GEONODE:CREATE_GEONODE_STYLE",C="GEONODE:DELETE_GEONODE_STYLE";function w(e,t){return{type:h,layer:e,options:t}}const N={gnCreateStyle:function(e){return e.ofType(O).switchMap((function(){return v.Observable.empty()}))},gnDeleteStyle:function(e){return e.ofType(C).switchMap((function(){return v.Observable.empty()}))},gnRequestDatasetAvailableStyles:function(e,t){return e.ofType(h).switchMap((function(e){var n,l,r;if(null!=e&&null!==(n=e.layer)&&void 0!==n&&n.availableStyles&&(null==e||null===(l=e.options)||void 0===l||!l.forceUpdate))return v.Observable.of((0,p.Xg)("visualStyleEditor","enabled",!0),(0,b.W)(e.layer.id,E.s1,"override",{}),(0,m.Nf)("edit"));var a=t.getState(),o=(null==e||null===(r=e.options)||void 0===r?void 0:r.styleService)||(0,S.Z0)(a);return v.Observable.concat(v.Observable.of((0,p.Xg)("visualStyleEditor","enabled",!0)),v.Observable.defer((function(){var t;return(0,y.l8)(null==e||null===(t=e.layer)||void 0===t?void 0:t.name)})).switchMap((function(t){return v.Observable.defer((function(){return g.ZP.getStylesInfo({baseUrl:null==o?void 0:o.baseUrl,styles:((null==t?void 0:t.styles)||[]).map((function(e){return{title:e.sld_title,name:e.workspace?"".concat(e.workspace,":").concat(e.name):e.name}}))})})).switchMap((function(t){return v.Observable.of((0,f.tV)(e.layer.id,"layer",{availableStyles:t}),(0,b.W)(e.layer.id,E.s1,"override",{}),(0,m.Nf)("edit"))}))})))}))}};var Z=n(1550),k=n(43129),P=n(5346),j=n(83958),T=n(90702),x=n(93473),A=n(99534),D=n(94745),U=n(51605);function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,l)}return n}function L(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(Object(n),!0).forEach((function(t){_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function G(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var l,r,a=[],o=!0,i=!1;try{for(n=n.call(e);!(o=(l=n.next()).done)&&(a.push(l.value),!t||a.length!==t);o=!0);}catch(e){i=!0,r=e}finally{try{o||null==n.return||n.return()}finally{if(i)throw r}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return R(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?R(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function R(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,l=new Array(t);n<t;n++)l[n]=e[n];return l}var M=(0,n(93451).Z)("placeholder")(c.FormControl),Y=(0,E.YD)().filter((function(e){return!["Base CSS","Base SLD"].includes(e.title)})),z=(0,o.connect)((0,i.P1)([S.QW,S.gB,S.aN,S.p],(function(e,t,n,l){var r;return{isStyleChanged:void 0!==e&&void 0!==t&&e!==t,loading:n,error:!(null==l||null===(r=l.edit)||void 0===r||!r.status)}})),{onClick:m.Lc})((function(e){var t=e.variant,n=e.onClick,l=e.size,a=e.isStyleChanged,o=e.error,i=e.loading,c=!(!i&&!o);return r().createElement(x.Z,{className:a?"gn-pending-changes-icon":"",variant:t||"primary",size:l,disabled:c,onClick:c?function(){}:function(){return n()}},r().createElement(P.Z,{msgId:"save"})," ",i&&r().createElement(U.Z,null))})),B=(0,o.connect)((0,i.P1)([S.Vf,S.gc,S.Z0,S.Ed,S.lC,S.QW,function(e){var t,n;return null==e||null===(t=e.controls)||void 0===t||null===(n=t.visualStyleEditor)||void 0===n?void 0:n.enabled},S.i7],(function(e,t,n,l,r,a,o,i){var c;return{layer:e,temporaryStyleId:t,styleService:n,format:l,geometryType:r,initialCode:a,enabled:o,selectedStyle:null==e||null===(c=e.availableStyles)||void 0===c?void 0:c.find((function(e){return e.name===i}))}})),{onUpdateStatus:m.Nf,onUpdateParams:f.Xy,onInit:m.E0,onReset:m.Wv.bind(null,void 0,!1),onSelect:m.p2,onUpdateMetadata:m.bB,onSave:m.Lc,onClose:p.Xg.bind(null,"visualStyleEditor","enabled",!1),onZoomTo:Z.Px,onRefresh:w,onCreate:function(e,t){return{type:O,title:e,options:t}},onDelete:function(e,t){return{type:C,styleName:e,options:t}}},(function(e,t,n){var l,r,a,o=(null===(l=n.styleService)||void 0===l?void 0:l.baseUrl)===(null===(r=e.styleService)||void 0===r?void 0:r.baseUrl)&&(null===(a=e.styleService)||void 0===a?void 0:a.isStatic),i=n.styleService&&!o?L(L({},n.styleService),{},{isStatic:!0}):L({},e.styleService);return L(L(L(L({},n),e),t),{},{styleService:i})}))((function(e){var t,n,a,o=e.layer,i=e.editorConfig,u=e.styleService,d=e.onInit,v=e.onUpdateStatus,y=e.onUpdateParams,f=e.onReset,m=e.temporaryStyleId,p=e.showLayerProperties,b=e.geometryType,E=e.format,S=e.onSelect,h=e.onUpdateMetadata,O=e.initialCode,C=e.enabled,w=e.onClose,N=e.onZoomTo,Z=e.onRefresh,U=e.onCreate,I=e.onDelete,L=e.selectedStyle,_=G((0,l.useState)(!1),2),R=_[0],B=_[1],V=G((0,l.useState)(!1),2),W=V[0],X=V[1],Q=G((0,l.useState)(""),2),$=Q[0],q=Q[1],F=(0,l.useRef)();F.current=function(){m&&g.ZP.deleteStyle({baseUrl:u.baseUrl,styleName:m})},(0,l.useEffect)((function(){function e(){F.current()}return d(u),window.addEventListener("beforeunload",e),function(){window.removeEventListener("beforeunload",e),f()}}),[]);var J=Y.filter((function(e){return e.types.includes(b)&&E===e.format}));if(!C||!o.id)return null;var H=!!((null==o||null===(t=o.availableStyles)||void 0===t?void 0:t.length)>0),K=!!((null==J?void 0:J.length)>0);return r().createElement("div",{className:"gn-visual-style-editor"},p&&r().createElement("div",{className:"gn-visual-style-editor-layer-info"},r().createElement("div",{className:"gn-visual-style-editor-layer-title"},o.title),o.bbox&&r().createElement(x.Z,{onClick:function(){var e=o.bbox.bounds,t=e.minx,n=e.miny,l=e.maxx,r=e.maxy;N([t,n,l,r],o.bbox.crs)}},r().createElement(c.Glyphicon,{glyph:"zoom-to"})),r().createElement(x.Z,{onClick:function(){f(),w()}},r().createElement(c.Glyphicon,{glyph:"1-close"}))),p&&H&&r().createElement("div",{className:"gn-visual-style-editor-styles"},r().createElement("div",{className:"gn-visual-style-editor-styles-select"},r().createElement(k.ZP,{value:o.style||(null===(n=o.availableStyles)||void 0===n||null===(a=n[0])||void 0===a?void 0:a.name),options:o.availableStyles.map((function(e){return{value:e.name,label:e.title}})),clearable:!1,onChange:function(e){y({style:e.value},!0),v("edit")}})),r().createElement(x.Z,{onClick:function(){Z(o,{forceUpdate:!0})}},r().createElement(c.Glyphicon,{glyph:"refresh"})),r().createElement(x.Z,{onClick:function(){return X(!0)}},r().createElement(c.Glyphicon,{glyph:"trash"})),r().createElement(x.Z,{onClick:function(){return B(!0)}},r().createElement(c.Glyphicon,{glyph:"plus"}))),H&&(K||p)&&r().createElement("div",{className:"gn-visual-style-editor-toolbar"},p&&r().createElement(z,{variant:"default",size:"xs"}),K&&r().createElement(T.Z,{placement:"right",content:r().createElement("ul",{className:"gn-visual-style-editor-templates"},J.map((function(e,t){var n;return r().createElement("li",{key:t,className:"gn-visual-style-editor-template",onClick:function(){return function(e){S(e),h({styleJSON:null})}((t=e.code,r=(null==L||null===(n=L.metadata)||void 0===n?void 0:n.title)||(null==L?void 0:L.label)||(null==L?void 0:L.title)||(null==L?void 0:L.name)||"",a=(null==L||null===(l=L.metadata)||void 0===l?void 0:l.description)||(null==L?void 0:L._abstract)||"",t.replace(/\$\{styleTitle\}/,r).replace(/\$\{styleAbstract\}/,a)));var t,n,l,r,a}},r().createElement("div",{className:"gn-visual-style-editor-template-preview"},null!=e&&null!==(n=e.preview)&&void 0!==n&&n.config?r().createElement(j.Z,e.preview.config):null==e?void 0:e.preview),r().createElement("div",{className:"gn-visual-style-editor-template-title"},e.title))})))},r().createElement(x.Z,{size:"xs"},r().createElement(P.Z,{msgId:"gnviewer.templates"})))),r().createElement("div",{className:"gn-visual-style-editor-body"},r().createElement("div",null,r().createElement(s.m2,{key:O,config:i}))),r().createElement(A.Z,null,r().createElement(D.Z,{title:"Add new style",fitContent:!0,clickOutEnabled:!1,show:R,onClose:function(){B(!1),q("")},buttons:[{text:"Close",onClick:function(){B(!1),q("")}},{text:"Create",onClick:function(){B(!1),U($),q("")}}]},r().createElement("label",null,"Title: "),r().createElement(M,{value:$,onChange:function(e){var t;return q(null==e||null===(t=e.target)||void 0===t?void 0:t.value)}}))),r().createElement(A.Z,null,r().createElement(D.Z,{title:"Delete style",show:W,fitContent:!0,clickOutEnabled:!1,onClose:function(){X(!1)},buttons:[{text:"No, don't delete it",onClick:function(){X(!1)}},{text:"Yes, I'm sure",onClick:function(){I(),X(!1)}}]},"Are you sure you want to delete this style?")))})),V=(0,o.connect)((0,i.P1)([S.Vf],(function(e){return{layer:e}})),{onClick:w})((function(e){var t=e.layer,n=e.status,l=e.onClick,a=void 0===l?function(){}:l;return"LAYER"!==n?null:r().createElement(x.Z,{variant:"primary",className:"square-button-md",onClick:function(){a(t)}},r().createElement(c.Glyphicon,{glyph:"dropper"}))}));const W=(0,a.rx)("VisualStyleEditor",{component:B,containers:{ActionNavbar:{name:"SaveStyle",Component:z},TOC:{target:"toolbar",Component:V}},reducers:{styleeditor:u.Z},epics:L(L({},d.ZP),N)})}}]);