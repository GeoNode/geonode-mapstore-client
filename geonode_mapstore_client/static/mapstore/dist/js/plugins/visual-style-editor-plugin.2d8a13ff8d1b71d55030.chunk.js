(self.webpackChunkgeonode_mapstore_client=self.webpackChunkgeonode_mapstore_client||[]).push([[9010],{55105:(e,t,n)=>{"use strict";n.d(t,{Nr:()=>d,ic:()=>y,Jz:()=>f,VM:()=>m,CF:()=>p});var r=n(91175),l=n.n(r),a=n(827),o=n(52259);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s=function(e){return e.maplayout&&e.maplayout.layout||{}},d=function(e){return e.maplayout&&e.maplayout.boundingMapRect||{}},y=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=s(e);return n&&Object.keys(n).filter((function(e){return t[e]})).reduce((function(e,t){return u(u({},e),{},c({},t,n[t]))}),{})||{}},v=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=s(e),r=!!l()(t.filter((function(e){return n[e.key]})).map((function(e){return"not"===e.type?n[e.key]!==e.value&&n[e.key]:n[e.key]===e.value})));return r},f=function(e){return v(e,[{key:"right",value:658}])},m=function(e){return v(e,[{key:"bottom",value:30,type:"not"}])},p=function(e){var t=(0,a.Od)(e),n=d(e);return n&&t&&t.size&&{left:(0,o.parseLayoutValue)(n.left,t.size.width),bottom:(0,o.parseLayoutValue)(n.bottom,t.size.height),right:(0,o.parseLayoutValue)(n.right,t.size.width),top:(0,o.parseLayoutValue)(n.top,t.size.height)}}},73443:(e,t,n)=>{"use strict";n.d(t,{rs:()=>r,AY:()=>l,SW:()=>a,yB:()=>o,oG:()=>i,oz:()=>u,id:()=>c,gc:()=>s,cE:()=>d,rG:()=>y,Vj:()=>v,nY:()=>f});var r="GEONODE:SAVING_RESOURCE",l="GEONODE:SAVE_SUCCESS",a="GEONODE:SAVE_ERROR",o="GEONODE:CLEAR_SAVE",i="GEONODE:SAVE_CONTENT",u="GEONODE:SAVE_DIRECT_CONTENT";function c(){return{type:r}}function s(e){return{type:l,success:e}}function d(e){return{type:a,error:e}}function y(){return{type:o}}function v(e,t,n,r){return{type:i,id:e,metadata:t,reload:n,showNotifications:r}}function f(){return{type:u}}},28261:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var r=n(67294),l=n.n(r),a=n(45697),o=n.n(a),i=["id","className","style","children"];function u(){return u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},u.apply(this,arguments)}function c(e){var t=e.id,n=e.className,r=e.style,a=e.children,o=function(e,t){if(null==e)return{};var n,r,l=function(e,t){if(null==e)return{};var n,r,l={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}(e,i),c=n?" "+n:"";return l().createElement(l().Fragment,null,l().createElement("div",u({},o,{id:t,className:"gn-spinner".concat(c),style:r}),l().createElement("div",null)),a)}c.propTypes={id:o().string,className:o().string,style:o().object},c.defaultProps={};const s=c},51605:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r.Z});var r=n(28261)},58074:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>ae});var r=n(67294),l=n.n(r),a=n(22843),o=n(33664),i=n(22222),u=n(57588),c=n(92222),s=n(32244),d=n(94943),y=n(89255),v=n(23570),f=n.n(v),m=n(80416),p=n(96909),b=n(82904),g=n(60604),E=n(99009),S=n(9082),h=n(93222),O="GEONODE:REQUEST_DATASET_AVAILABLE_STYLES",w="GEONODE:CREATE_GEONODE_STYLE",C="GEONODE:DELETE_GEONODE_STYLE",N=n(3828),P=n(73443),k=n(17621),j=n.n(k);function T(e){return function(e){if(Array.isArray(e))return A(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Z(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Z(e,t){if(e){if("string"==typeof e)return A(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?A(e,t):void 0}}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function I(e){var t=e.type,n=e.title,r=j()("hsl(".concat(Math.floor(270*Math.random()),", 90%, 70%)")).toHexString();switch(t){case"raster":return"@mode 'Flat'; @styleTitle '"+n+"'; \n* {\n\traster-channels: auto;\n\traster-opacity: 1;\n}\n";case"point":default:return"@mode 'Flat'; @styleTitle '"+n+"'; \n* {\n\tmark: symbol('square');\n\t:mark {\n\t\tfill: "+r+";\n\t\tsize: 4;\n\t}\n}\n";case"linestring":return"@mode 'Flat'; @styleTitle '"+n+"'; \n* {\n\tstroke: "+r+";\n}\n";case"polygon":return"@mode 'Flat'; @styleTitle '"+n+"'; \n* {\n\tfill: "+r+";\n}\n"}}function D(e){var t=e.name;return"geonode:".concat(f()(),"_ms_").concat(t)}const L={gnCreateStyle:function(e,t){return e.ofType(w).switchMap((function(e){var n,r,l,a,o=t.getState(),i=(null==e||null===(n=e.options)||void 0===n?void 0:n.styleService)||(0,h.Z0)(o),u=D({name:e.title.toLowerCase().replace(/\W/g,"")}),c=e.layer||(0,h.Vf)(o),s={title:e.title,description:"",msStyleJSON:null,msEditorType:"visual",gnLayerName:c.name,gnDatasetPk:null==c||null===(r=c.extendedParams)||void 0===r||null===(l=r.mapLayer)||void 0===l||null===(a=l.dataset)||void 0===a?void 0:a.pk,gnMapPk:(0,N.fg)(o)},d=(0,h.lC)(o);return y.Observable.defer((function(){return S.ZP.createStyle({baseUrl:null==i?void 0:i.baseUrl,code:I({type:d,title:e.title}),format:"css",styleName:u,metadata:s})})).switchMap((function(){return y.Observable.of((0,m.tV)(c.id,"layer",{availableStyles:[].concat(T(c.availableStyles),[{format:"css",metadata:s,name:u,title:e.title}])}),(0,g.W)(c.id,E.s1,"override",{}),(0,m.Xy)({style:u},!0),(0,p.Nf)("edit"),(0,P.nY)())}))}))},gnDeleteStyle:function(e,t){return e.ofType(C).switchMap((function(e){var n,r=t.getState(),l=(null==e||null===(n=e.options)||void 0===n?void 0:n.styleService)||(0,h.Z0)(r),a=e.layer||(0,h.Vf)(r),o=function(){var t,n=(a.availableStyles||[]).filter((function(t){return t.name!==e.styleName}));return y.Observable.of((0,m.tV)(a.id,"layer",{availableStyles:n}),(0,g.W)(a.id,E.s1,"override",{}),(0,m.Xy)({style:(null==n||null===(t=n[0])||void 0===t?void 0:t.name)||""},!0),(0,p.Nf)("edit"),(0,P.nY)())};return y.Observable.defer((function(){return y.Observable.defer((function(){return S.ZP.deleteStyle({baseUrl:null==l?void 0:l.baseUrl,styleName:e.styleName})}))})).switchMap((function(){return o()})).catch((function(){return o()}))}))},gnRequestDatasetAvailableStyles:function(e,t){return e.ofType(O).switchMap((function(e){var n,r=t.getState(),l=(null==e||null===(n=e.options)||void 0===n?void 0:n.styleService)||(0,h.Z0)(r);return y.Observable.defer((function(){return function(e){var t,n,r,l=e.layer,a=e.styleService,o=e.mapPk,i=null==l||null===(t=l.extendedParams)||void 0===t||null===(n=t.mapLayer)||void 0===n||null===(r=n.dataset)||void 0===r?void 0:r.subtype,u=(null==l?void 0:l.availableStyles)||[];if(0===u.length){var c,s,d,y=l.name.split(":"),v=1===y.length?y[0]:y[y.length-1],f=D({name:v}),m={title:v,description:"",msStyleJSON:null,msEditorType:"visual",gnDatasetPk:null==l||null===(c=l.extendedParams)||void 0===c||null===(s=c.mapLayer)||void 0===s||null===(d=s.dataset)||void 0===d?void 0:d.pk,gnMapPk:o};return S.ZP.createStyle({baseUrl:null==a?void 0:a.baseUrl,code:I({type:i,title:v}),format:"css",styleName:f,metadata:m}).then((function(){return[[{name:f,title:v,metadata:m,format:"css"}],!0]}))}return new Promise((function(e){return e([u])}))}({layer:e.layer,styleService:l,mapPk:(0,N.fg)(r)})})).switchMap((function(t){var n,r,a,o,i=(o=2,function(e){if(Array.isArray(e))return e}(a=t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,l,a=[],o=!0,i=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);o=!0);}catch(e){i=!0,l=e}finally{try{o||null==n.return||n.return()}finally{if(i)throw l}}return a}}(a,o)||Z(a,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=i[0],c=i[1],s=null==e||null===(n=e.layer)||void 0===n?void 0:n.style,d=u.find((function(e){return e.name===s}))?s:null==u||null===(r=u[0])||void 0===r?void 0:r.name;return y.Observable.concat(y.Observable.of((0,b.Xg)("visualStyleEditor","enabled",!0)),y.Observable.defer((function(){return S.ZP.getStylesInfo({baseUrl:null==l?void 0:l.baseUrl,styles:u})})).switchMap((function(t){return y.Observable.of.apply(y.Observable,[(0,m.tV)(e.layer.id,"layer",{availableStyles:t}),(0,m.Xy)({style:d},!0),(0,g.W)(e.layer.id,E.s1,"override",{}),(0,p.Nf)("edit")].concat(T(c?[(0,P.nY)()]:[])))})))}))}))}};var U=n(1550),x=n(43129),V=n(5346),_=n(83958),G=n(90702),M=n(93473),z=n(99534),R=n(94745),Y=n(51605),W=n(55105),F=n(93451),B=n(15135),X=n(75110);function q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function J(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?q(Object(n),!0).forEach((function(t){$(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):q(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function $(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Q(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,l,a=[],o=!0,i=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);o=!0);}catch(e){i=!0,l=e}finally{try{o||null==n.return||n.return()}finally{if(i)throw l}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return H(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?H(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function H(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var K=(0,F.Z)("placeholder")(u.FormControl),ee=(0,E.YD)().filter((function(e){return!["Base CSS","Base SLD"].includes(e.title)})),te=(0,B.Z)(M.Z),ne=(0,o.connect)((0,i.P1)([h.QW,h.gB,h.aN,h.p],(function(e,t,n,r){var l;return{isStyleChanged:void 0!==e&&void 0!==t&&e!==t,loading:n,error:!(null==r||null===(l=r.edit)||void 0===l||!l.status)}})),{onClick:p.Lc})((function(e){var t=e.variant,n=e.onClick,r=e.size,a=e.isStyleChanged,o=e.error,i=e.loading,u=!(!i&&!o);return l().createElement(te,{className:a?"gn-pending-changes-icon":"",variant:t||"primary",size:r,disabled:u,onClick:u?function(){}:function(){return n()}},l().createElement(V.Z,{msgId:"save"})," ",i&&l().createElement(Y.Z,null))})),re=(0,o.connect)((0,i.P1)([h.Vf,h.gc,h.Z0,h.Ed,h.lC,h.QW,function(e){var t,n;return null==e||null===(t=e.controls)||void 0===t||null===(n=t.visualStyleEditor)||void 0===n?void 0:n.enabled},h.i7,function(e){return(0,W.ic)(e,{height:!0})},X.Iz],(function(e,t,n,r,l,a,o,i,u,c){var s;return{layer:e,temporaryStyleId:t,styleService:n,format:r,geometryType:l,initialCode:a,enabled:o,selectedStyle:null==e||null===(s=e.availableStyles)||void 0===s?void 0:s.find((function(e){return e.name===i})),style:u,originalStyle:null==c?void 0:c.style}})),{onUpdateStatus:p.Nf,onUpdateParams:m.Xy,onInit:p.E0,onReset:p.Wv.bind(null,void 0,!1),onSelect:p.p2,onUpdateMetadata:p.bB,onSave:p.Lc,onClose:b.Xg.bind(null,"visualStyleEditor","enabled",!1),onZoomTo:U.Px,onCreate:function(e,t){return{type:w,title:e,options:t}},onDelete:function(e,t){return{type:C,styleName:e,options:t}},onUpdateNode:m.tV},(function(e,t,n){var r,l,a,o=(null===(r=n.styleService)||void 0===r?void 0:r.baseUrl)===(null===(l=e.styleService)||void 0===l?void 0:l.baseUrl)&&(null===(a=e.styleService)||void 0===a?void 0:a.isStatic),i=n.styleService&&!o?J(J({},n.styleService),{},{isStatic:!0}):J({},e.styleService);return J(J(J(J({},n),e),t),{},{styleService:i})}))((function(e){var t,n=e.layer,a=e.editorConfig,o=e.styleService,i=e.onInit,s=e.onUpdateStatus,d=e.onUpdateParams,y=e.onReset,v=e.temporaryStyleId,f=e.showLayerProperties,m=e.geometryType,p=e.format,b=e.onSelect,g=e.onUpdateMetadata,E=e.initialCode,h=e.enabled,O=e.onClose,w=e.onZoomTo,C=e.onCreate,N=e.onDelete,P=e.selectedStyle,k=e.style,j=e.originalStyle,T=e.onUpdateNode,Z=Q((0,r.useState)(!1),2),A=Z[0],I=Z[1],D=Q((0,r.useState)(!1),2),L=D[0],U=D[1],M=Q((0,r.useState)(""),2),Y=M[0],W=M[1],F=(0,r.useRef)();F.current=function(){v&&S.ZP.deleteStyle({baseUrl:o.baseUrl,styleName:v})},(0,r.useEffect)((function(){function e(){F.current()}return i(o),window.addEventListener("beforeunload",e),function(){window.removeEventListener("beforeunload",e),y()}}),[]);var B=ee.filter((function(e){return e.types.includes(m)&&p===e.format}));if(!h||!n.id)return null;var X=!!((null==B?void 0:B.length)>0);return l().createElement("div",{className:"gn-visual-style-editor",style:k},f&&l().createElement("div",{className:"gn-visual-style-editor-layer-info"},l().createElement("div",{className:"gn-visual-style-editor-layer-title"},n.title),n.bbox&&l().createElement(te,{onClick:function(){var e=n.bbox.bounds,t=e.minx,r=e.miny,l=e.maxx,a=e.maxy;w([t,r,l,a],n.bbox.crs)},tooltipId:"gnviewer.zoomToLayer"},l().createElement(u.Glyphicon,{glyph:"zoom-to"})),l().createElement(te,{onClick:function(){y(),O()},className:"square-button"},l().createElement(u.Glyphicon,{glyph:"1-close"}))),f&&l().createElement("div",{className:"gn-visual-style-editor-styles"},l().createElement("div",{className:"gn-visual-style-editor-styles-select"},l().createElement(x.ZP,{value:n.style,options:((null==n?void 0:n.availableStyles)||[]).map((function(e){return{value:e.name,label:e.title}})),clearable:!1,onChange:function(e){d({style:e.value},!0),s("edit")}})),l().createElement(te,{onClick:function(){T(n.id,"layers",{style:n.style})},tooltipId:"gnviewer.applyCurrentStyleToLayer"},l().createElement(u.Glyphicon,{glyph:n.style===j?"star":"star-empty"})),l().createElement(te,{disabled:(null==n||null===(t=n.availableStyles)||void 0===t?void 0:t.length)<2,onClick:function(){return U(!0)},tooltipId:"gnviewer.deleteCurrentStyle"},l().createElement(u.Glyphicon,{glyph:"trash"})),l().createElement(te,{onClick:function(){return I(!0)},tooltipId:"gnviewer.createNewStyle"},l().createElement(u.Glyphicon,{glyph:"plus"}))),(X||f)&&l().createElement("div",{className:"gn-visual-style-editor-toolbar"},f&&l().createElement(ne,{variant:"default",size:"xs"}),X&&l().createElement(G.Z,{placement:"right",content:l().createElement("ul",{className:"gn-visual-style-editor-templates"},B.map((function(e,t){var n;return l().createElement("li",{key:t,className:"gn-visual-style-editor-template",onClick:function(){return function(e){b(e),g({styleJSON:null})}((t=e.code,l=(null==P||null===(n=P.metadata)||void 0===n?void 0:n.title)||(null==P?void 0:P.label)||(null==P?void 0:P.title)||(null==P?void 0:P.name)||"",a=(null==P||null===(r=P.metadata)||void 0===r?void 0:r.description)||(null==P?void 0:P._abstract)||"",t.replace(/\$\{styleTitle\}/,l).replace(/\$\{styleAbstract\}/,a)));var t,n,r,l,a}},l().createElement("div",{className:"gn-visual-style-editor-template-preview"},null!=e&&null!==(n=e.preview)&&void 0!==n&&n.config?l().createElement(_.Z,e.preview.config):null==e?void 0:e.preview),l().createElement("div",{className:"gn-visual-style-editor-template-title"},e.title))})))},l().createElement(te,{size:"xs"},l().createElement(V.Z,{msgId:"gnviewer.templates"})))),l().createElement("div",{className:"gn-visual-style-editor-body"},l().createElement("div",null,l().createElement(c.m2,{key:E,config:a}))),l().createElement(z.Z,null,l().createElement(R.Z,{title:l().createElement(V.Z,{msgId:"gnviewer.createStyleTitle"}),fitContent:!0,clickOutEnabled:!1,show:A,onClose:function(){I(!1),W("")},buttons:[{text:l().createElement(V.Z,{msgId:"gnviewer.createStyleClose"}),onClick:function(){I(!1),W("")}},{text:l().createElement(V.Z,{msgId:"gnviewer.createStyleCreate"}),bsStyle:"primary",onClick:function(){I(!1),C(Y),W("")}}]},l().createElement("div",{style:{padding:"1rem"}},l().createElement(u.ControlLabel,null,l().createElement(V.Z,{msgId:"gnviewer.createStyleTitleInput"})," "),l().createElement(K,{value:Y,onChange:function(e){var t;return W(null==e||null===(t=e.target)||void 0===t?void 0:t.value)}})))),l().createElement(z.Z,null,l().createElement(R.Z,{title:l().createElement(V.Z,{msgId:"gnviewer.deleteStyleTitle"}),show:L,fitContent:!0,clickOutEnabled:!1,onClose:function(){U(!1)},buttons:[{text:l().createElement(V.Z,{msgId:"gnviewer.deleteStyleCancel"}),onClick:function(){U(!1)}},{text:l().createElement(V.Z,{msgId:"gnviewer.deleteStyleConfirm"}),bsStyle:"danger",onClick:function(){N(n.style),U(!1)}}]},l().createElement("div",{style:{padding:"1rem"}},l().createElement(V.Z,{msgId:"gnviewer.deleteStyleMessage"})))))})),le=(0,o.connect)((0,i.P1)([h.Vf,N.HG],(function(e,t){return{layer:e,enabled:!(null==t||!t.includes("change_resourcebase"))}})),{onClick:function(e,t){return{type:O,layer:e,options:t}}})((function(e){var t,n=e.layer,r=e.status,a=e.onClick,o=void 0===a?function(){}:a;return e.enabled&&"LAYER"===r&&null!=n&&null!==(t=n.extendedParams)&&void 0!==t&&t.mapLayer?l().createElement(te,{variant:"primary",className:"square-button-md",onClick:function(){o(n)}},l().createElement(u.Glyphicon,{glyph:"dropper"})):null}));const ae=(0,a.rx)("VisualStyleEditor",{component:re,containers:{ActionNavbar:{name:"SaveStyle",Component:ne},TOC:{target:"toolbar",Component:le}},reducers:{styleeditor:s.Z},epics:J(J({},d.ZP),L)})}}]);