"use strict";(self.webpackChunkgeonode_mapstore_client=self.webpackChunkgeonode_mapstore_client||[]).push([[58164],{458164:(e,t,r)=>{r.r(t),r.d(t,{OlStyleParser:()=>D,createGetImagesSrc:()=>L,default:()=>M});var o=r(706141),n=r(644294),i=r(429276),l=r(910940),a=r(200953),s=r(981426),c=r(927733),u=r(113628),y=r(55394),f=r(986936),h=r(508100),m=r(570915),g=r(611217),p=r(694974),S=r(887331),b=r(736128),v=r(934142),d=r(385733),O=r(399392),C=r(684633),w=r(185015),F=r.n(w);function k(e){return k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},k(e)}function z(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,o)}return r}function P(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?z(Object(r),!0).forEach(function(t){I(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):z(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function x(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,A(o.key),o)}}function I(e,t,r){return(t=A(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function A(e){var t=function(e){if("object"!=k(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=k(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==k(t)?t:t+""}var j=r(290505).R.openlayers({Point:n.A,LineString:g.A,Polygon:v.Ay,GeoJSON:b.A,getCenter:m.q1}),L=function(){var e={};return function(t,r){return r?(e[r]||(e[r]=t.toDataURL()),e[r]):t.toDataURL()}},E=function(e){switch(e){case"top-left":return[0,0];case"top":return[.5,0];case"top-right":return[1,0];case"left":return[0,.5];case"center":default:return[.5,.5];case"right":return[1,.5];case"bottom-left":return[0,1];case"bottom":return[.5,1];case"bottom-right":return[1,1]}},_=function(e,t){var r=e,o=t;if((0,O.Ec)(r)&&(r=O.d6.evaluateStringFunction(r)),"string"!=typeof r)return null;if(r.startsWith("rgba("))return r;if(!/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(r))return null;var n=parseInt(r.slice(1,3),16),i=parseInt(r.slice(3,5),16),l=parseInt(r.slice(5,7),16);return(0,O.uR)(o)&&(o=O.d6.evaluateNumberFunction(o)),o<0&&(o=1),"rgba("+n+", "+i+", "+l+", "+o+")"},D=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),I(this,"unsupportedProperties",{Symbolizer:{MarkSymbolizer:{avoidEdges:"none",blur:"none",offsetAnchor:"none",pitchAlignment:"none",pitchScale:"none",visibility:"none"},FillSymbolizer:{antialias:"none",fillOpacity:{support:"none",info:"Use opacity instead."},visibility:"none"},IconSymbolizer:{allowOverlap:"none",anchor:"none",avoidEdges:"none",color:"none",haloBlur:"none",haloColor:"none",haloWidth:"none",keepUpright:"none",offsetAnchor:"none",size:{support:"partial",info:"Will set/get the width of the ol Icon."},optional:"none",padding:"none",pitchAlignment:"none",rotationAlignment:"none",textFit:"none",textFitPadding:"none",visibility:"none"},LineSymbolizer:{blur:"none",gapWidth:"none",gradient:"none",miterLimit:"none",roundLimit:"none",spacing:"none",visibility:"none",graphicFill:"none",graphicStroke:"none",perpendicularOffset:"none"},RasterSymbolizer:"none"},Function:{double2bool:{support:"none",info:"Always returns false"},atan2:{support:"none",info:"Currently returns the first argument"},rint:{support:"none",info:"Currently returns the first argument"},numberFormat:{support:"none",info:"Currently returns the first argument"},strAbbreviate:{support:"none",info:"Currently returns the first argument"}}}),I(this,"title","OpenLayers Style Parser"),I(this,"olIconStyleCache",{}),I(this,"OlStyleConstructor",i.Ay),I(this,"OlStyleImageConstructor",l.A),I(this,"OlStyleFillConstructor",u.A),I(this,"OlStyleStrokeConstructor",a.A),I(this,"OlStyleTextConstructor",s.A),I(this,"OlStyleCircleConstructor",c.A),I(this,"OlStyleIconConstructor",y.A),I(this,"OlStyleRegularshapeConstructor",f.A),I(this,"isOlParserStyleFct",function(e){return"function"==typeof e}),t&&(this.OlStyleConstructor=t.style.Style,this.OlStyleImageConstructor=t.style.Image,this.OlStyleFillConstructor=t.style.Fill,this.OlStyleStrokeConstructor=t.style.Stroke,this.OlStyleTextConstructor=t.style.Text,this.OlStyleCircleConstructor=t.style.Circle,this.OlStyleIconConstructor=t.style.Icon,this.OlStyleRegularshapeConstructor=t.style.RegularShape)},t=[{key:"readStyle",value:function(){return new Promise(function(e,t){try{e(null)}catch(e){t(e)}})}},{key:"writeStyle",value:function(e){var t=this;return new Promise(function(r){var o=t.checkForUnsupportedProperties(e);try{r(t.getOlStyleTypeFromGeoStylerStyle(e),{unsupportedProperties:o,warnings:o&&["Your style contains unsupportedProperties!"]})}catch(e){r({errors:[e]})}})}},{key:"checkForUnsupportedProperties",value:function(e){var t,r=this,o={};return null==e||null===(t=e.rules)||void 0===t||t.forEach(function(e){e.symbolizers.forEach(function(e){var t,n,i=(n="".concat(e.kind,"Symbolizer"))[0].toUpperCase()+n.slice(1),l=null===(t=r.unsupportedProperties)||void 0===t||null===(t=t.Symbolizer)||void 0===t?void 0:t[i];l&&("string"==typeof l||l instanceof String?(o.Symbolizer||(o.Symbolizer={}),o.Symbolizer[i]=l):Object.keys(e).forEach(function(e){l[e]&&(o.Symbolizer||(o.Symbolizer={}),o.Symbolizer[i]||(o.Symbolizer[i]={}),o.Symbolizer[i][e]=l[e])}))})}),Object.keys(o).length>0?o:null}},{key:"getOlStyleTypeFromGeoStylerStyle",value:function(e){return this.geoStylerStyleToOlParserStyleFct(e)}},{key:"geoStylerStyleToOlParserStyleFct",value:function(e){var t=this,r=e.rules,o=function(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=o.map,i=o.features;return(0,C.J)(e,{features:i}).then(function(e){return t._getImages=function(){return e},t._getImageSrc=L(),t._computeIconScaleBasedOnSymbolizer=function(t,r){var o=e.find(function(e){return e.id===(0,O.RU)(t,r)})||{},n=o.image,i=o.width,l=o.height;if(n&&i&&l){var a=i>l?i:l;return t.size/a}return t.size},function(e,o){t._getMap=function(){return n};var i=[],l=n?n.getView().getProjection().getUnits():"m",a=h.I[l],s=o*a*39.37*(25.4/.28);return r.forEach(function(r){var n,l,a=null==r||null===(n=r.scaleDenominator)||void 0===n?void 0:n.min,c=null==r||null===(l=r.scaleDenominator)||void 0===l?void 0:l.max,u=!0;(a||c)&&(a=(0,O.Le)(a)?O.d6.evaluateNumberFunction(a):a,c=(0,O.Le)(c)?O.d6.evaluateNumberFunction(c):c,a&&s<a&&(u=!1),c&&s>=c&&(u=!1));var y=!1;if(r.filter)try{y=(0,O.Cx)(e,r.filter)}catch(e){y=!1}else y=!0;u&&y&&r.symbolizers.forEach(function(r){var n=t.getOlSymbolizerFromSymbolizer(r,e);if("function"!=typeof n)i.push(n);else{var l=n(e,o);i.push(l)}})}),i}})};return o.__geoStylerStyle=e,o}},{key:"getOlSymbolizerFromSymbolizer",value:function(e,t){var r;switch(e.kind){case"Mark":r=this.getOlPointSymbolizerFromMarkSymbolizer(e,t);break;case"Icon":r=this.getOlIconSymbolizerFromIconSymbolizer(e,t);break;case"Text":r=this.getOlTextSymbolizerFromTextSymbolizer(e,t);break;case"Line":r=this.getOlLineSymbolizerFromLineSymbolizer(e,t);break;case"Fill":r=this.getOlPolygonSymbolizerFromFillSymbolizer(e,t);break;case"Circle":r=this.getOlCircleSymbolizerFromCircleSymbolizer(e,t);break;default:var o=new this.OlStyleFillConstructor({color:"rgba(255,255,255,0.4)"}),n=new this.OlStyleStrokeConstructor({color:"#3399CC",width:1.25});r=new this.OlStyleConstructor({image:new this.OlStyleCircleConstructor({fill:o,stroke:n,radius:5}),fill:o,stroke:n})}return r}},{key:"getOlPointSymbolizerFromMarkSymbolizer",value:function(e,t){for(var r=P({},e),o=0,n=Object.keys(r);o<n.length;o++){var i=n[o];(0,O.Le)(r[i])&&(r[i]=O.d6.evaluateFunction(r[i],t))}var l=j(r,t,this._getMap()),a=this._getImages(),s=(0,O.RU)(r,e),c=a.find(function(e){return e.id===s})||{},u=c.image,y=c.width,f=c.height;if(u){var h,m,g=y>f?y:f,p=2*r.radius/g,S=null!==(h=null===(m=this._getImageSrc)||void 0===m?void 0:m.call(this,u,s))&&void 0!==h?h:u.toDataURL();return new this.OlStyleConstructor(P({image:new this.OlStyleIconConstructor({src:S,crossOrigin:"anonymous",opacity:1,scale:p,rotation:"number"==typeof r.rotate?r.rotate*Math.PI/180:void 0})},l))}return new this.OlStyleConstructor}},{key:"getOlIconSymbolizerFromIconSymbolizer",value:function(e,t){for(var r=this,o=P({},e),n=0,i=Object.keys(o);n<i.length;n++){var l=i[n];(0,O.Le)(o[l])&&(o[l]=O.d6.evaluateFunction(o[l],t))}var a=j(o,t,this._getMap()),s={src:o.image,crossOrigin:"anonymous",opacity:o.opacity,scale:this._computeIconScaleBasedOnSymbolizer(o,e),rotation:"number"==typeof o.rotate?o.rotate*Math.PI/180:void 0,displacement:o.offset,anchor:E(o.anchor)},c=new RegExp("\\{\\{.*?\\}\\}","g");return"string"==typeof o.image&&o.image.match(c)?function(e){var t,n=(0,O.vK)(e,o.image,"");return n||(n=o.image+""),r.olIconStyleCache[n]?(t=r.olIconStyleCache[n],void 0!==s.rotation&&t.setRotation(s.rotation),void 0!==s.opacity&&t.setOpacity(s.opacity)):(t=new r.OlStyleIconConstructor(P(P({},s),{},{src:n})),r.olIconStyleCache[n]=t),new r.OlStyleConstructor(P({image:t},a))}:new this.OlStyleConstructor(P({image:new this.OlStyleIconConstructor(P({},s))},a))}},{key:"getOlLineSymbolizerFromLineSymbolizer",value:function(e,t){for(var r=P({},e),o=0,n=Object.keys(r);o<n.length;o++){var i=n[o];(0,O.Le)(r[i])&&(r[i]=O.d6.evaluateFunction(r[i],t))}var l=r.color,a=r.opacity,s=l&&null!=a?_(l,a):l,c=j(r,t,this._getMap());return new this.OlStyleConstructor(P(P({},c),{},{stroke:new this.OlStyleStrokeConstructor({color:s,width:r.width,lineCap:r.cap,lineJoin:r.join,lineDash:r.dasharray,lineDashOffset:r.dashOffset})}))}},{key:"getOlPolygonSymbolizerFromFillSymbolizer",value:function(e,t){for(var r,o=P({},e),n=0,i=Object.keys(o);n<i.length;n++){var l=i[n];(0,O.Le)(o[l])&&(o[l]=O.d6.evaluateFunction(o[l],t))}var a=j(o,t,this._getMap()),s=o.color,c=null!==(r=o.fillOpacity)&&void 0!==r?r:o.opacity,u=s&&Number.isFinite(c)?_(s,c):s,y=s?new this.OlStyleFillConstructor({color:u}):void 0,f=o.outlineColor,h=o.outlineOpacity,m=f&&Number.isFinite(h)?_(f,h):f,g=f||o.outlineWidth?new this.OlStyleStrokeConstructor({color:m,width:o.outlineWidth,lineDash:o.outlineDasharray}):void 0,p=new this.OlStyleConstructor(P(P({},a),{},{fill:y,stroke:g}));if(o.graphicFill){var S=this.getOlPatternFromGraphicFill(o.graphicFill);y||(y=new this.OlStyleFillConstructor({})),S&&y.setColor(S),p.setFill(y)}return p}},{key:"getOlCircleSymbolizerFromCircleSymbolizer",value:function(e,t){for(var r=this,o=P({},e),n=0,i=Object.keys(o);n<i.length;n++){var l=i[n];(0,O.Le)(o[l])&&(o[l]=O.d6.evaluateFunction(o[l],t))}var a=o.color,s=o.opacity,c=a&&Number.isFinite(s)?_(a,s):a,u=a?new this.OlStyleFillConstructor({color:c}):void 0,y=o.outlineColor,f=o.outlineOpacity,m=y&&Number.isFinite(f)?_(y,f):y,g=y||o.outlineWidth?new this.OlStyleStrokeConstructor({color:m,width:o.outlineWidth,lineDash:o.outlineDasharray}):void 0,S=new this.OlStyleConstructor({fill:u,stroke:g,geometry:function(e){var t=r._getMap();if(o.geodesic){var n=t.getView().getProjection().getCode(),i=(0,d.pd)(e.getGeometry().getCoordinates(),n,"EPSG:4326"),l=(0,v.kj)(i,o.radius,128);return l.transform("EPSG:4326",n),new v.Ay(l.getCoordinates())}return new p.A(e.getGeometry().getCoordinates(),o.radius/h.I[t.getView().getProjection().getUnits()])}});if(o.graphicFill){var b=this.getOlPatternFromGraphicFill(o.graphicFill);u||(u=new this.OlStyleFillConstructor({})),b&&u.setColor(b),S.setFill(u)}return S}},{key:"getOlPatternFromGraphicFill",value:function(e){var t;if("Icon"===(null==e?void 0:e.kind)){var r,i=null===(r=t=this.getOlIconSymbolizerFromIconSymbolizer(e))||void 0===r?void 0:r.getImage();if(null==i||i.load(),(null==i?void 0:i.getImageState())!==o.A.LOADED)return null}else{if("Mark"!==(null==e?void 0:e.kind)||!F()(null==e?void 0:e.wellKnownName))return null;t=this.getOlPointSymbolizerFromMarkSymbolizer(e)}var l=t.clone(),a=l.getImage(),s=document.createElement("canvas"),c=s.getContext("2d"),u=a.getScale()||1;a.setScale(1);var y=a.getSize(),f=(0,S.J7)(c,{pixelRatio:u,size:y});f.setStyle(l);var h=y.map(function(e){return e/2});return f.drawGeometry(new n.A(h)),c.createPattern(s,"repeat")}},{key:"getOlTextSymbolizerFromTextSymbolizer",value:function(e,t){for(var r,o,n=this,i=P({},e),l=0,a=Object.keys(i);l<a.length;l++){var s=a[l];(0,O.Le)(i[s])&&(i[s]=O.d6.evaluateFunction(i[s],t))}var c,u=j(i,t,this._getMap()),y=i.color,f=i.opacity,h=y&&Number.isFinite(f)?_(y,f):y,m=i.haloColor,g=i.haloWidth,p=m&&Number.isFinite(f)?_(m,f):m,S=null!==(r=i.fontWeight)&&void 0!==r?r:"normal",b=null!==(o=i.fontStyle)&&void 0!==o?o:"normal",v=i.size,d=i.font,C=P({font:S+" "+b+" "+v+"px "+(null==d?void 0:d.join(", ")),fill:new this.OlStyleFillConstructor({color:h}),stroke:new this.OlStyleStrokeConstructor({color:p,width:g||0}),overflow:i.allowOverlap,offsetX:i.offset?i.offset[0]:0,offsetY:i.offset?i.offset[1]:0,rotation:"number"==typeof i.rotate?i.rotate*Math.PI/180:void 0},function(e){switch(e){case"top-left":return{textBaseline:"top",textAlign:"left"};case"top":default:return{textBaseline:"top",textAlign:"center"};case"top-right":return{textBaseline:"top",textAlign:"right"};case"left":return{textBaseline:"middle",textAlign:"left"};case"center":return{textBaseline:"middle",textAlign:"center"};case"right":return{textBaseline:"middle",textAlign:"right"};case"bottom-left":return{textBaseline:"bottom",textAlign:"left"};case"bottom":return{textBaseline:"bottom",textAlign:"center"};case"bottom-right":return{textBaseline:"bottom",textAlign:"right"}}}(i.anchor)),w=new RegExp("\\{\\{.*?\\}\\}","g");return(0,O.Ec)(i.label)||(c=i.label?i.label.match(w):null),c?function(e){var t=new n.OlStyleTextConstructor(P({text:(0,O.vK)(e,i.label,"")},C));return new n.OlStyleConstructor(P(P({},u),{},{text:t}))}:new this.OlStyleConstructor(P(P({},u),{},{text:new this.OlStyleTextConstructor(P({text:i.label},C))}))}}],t&&x(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();I(D,"title","OpenLayers Style Parser");const M=D}}]);