"use strict";(self.webpackChunkgeonode_mapstore_client=self.webpackChunkgeonode_mapstore_client||[]).push([[73998],{173998:(e,t,r)=>{r.d(t,{A:()=>Oe});var n=r(273517),o=r.n(n),a=r(492078),i=r.n(a),s=r(400912),c=r.n(s),p=r(907309),u=r.n(p),l=r(737530),d=r.n(l),g=r(590179),y=r.n(g),f=r(956449),m=r.n(f),w=r(468090),v=r.n(w),h=r(587612),C=r.n(h),S=r(269843),b=r.n(S),P=r(499084),I=r.n(P),G=r(605556),O=r.n(G),F=r(668414),A=r.n(F),j=r(995531),T=r(6683),x=r(764932),M=r(491281),L=r(19843),E=r(535273),k=r(841358),D=r(736128),_=r(786717),W=r(754602),R=r(712651),N=r(925388),J=r(130945),H=r(54620),V=r(360918),q=r(330503),B=r(934142),Z=r(644294),K=r(611217),$=r(496702),z=r(502871),U=r(694974),Q=r(334338),X=r(429276),Y=r(200953),ee=r(113628),te=r(981426),re=r(927733),ne=r(650071),oe=r(958704),ae=r(36068),ie=r(874458),se=r(229132),ce=r(142770),pe=r(111854),ue=r(570915),le=r(85890),de=r(260942),ge=r(181817);function ye(e){return ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ye(e)}function fe(e){return function(e){if(Array.isArray(e))return me(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return me(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?me(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function me(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function we(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function ve(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?we(Object(r),!0).forEach(function(t){Pe(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):we(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function he(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ie(n.key),n)}}function Ce(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Ce=function(){return!!e})()}function Se(e){return Se=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Se(e)}function be(e,t){return be=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},be(e,t)}function Pe(e,t,r){return(t=Ie(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ie(e){var t=function(e){if("object"!=ye(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=ye(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ye(t)?t:t+""}var Ge=new D.A,Oe=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return Pe(e=function(e,t,r){return t=Se(t),function(e,t){if(t&&("object"==ye(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Ce()?Reflect.construct(t,r||[],Se(e).constructor):t.apply(e,r))}(this,t,[].concat(n)),"getNewFeature",function(t,r,n,o){return new _.A({geometry:e.createOLGeometry({type:t,coordinates:r,radius:n,center:o})})}),Pe(e,"getMapCrs",function(){return e.props.map.getView().getProjection().getCode()}),Pe(e,"getWMSSnapSource",function(t,r){var n,o=e.props.toggleSnappingIsLoading;if((null===(n=e)||void 0===n||null===(n=n.snapMetadata)||void 0===n?void 0:n.id)!==t.id){var a=new W.A({format:new D.A,loader:function(e,n,i){var s,c=i.getCode(),p=(0,ge.yc)(t.search.url,t.name,{version:"1.1.0",outputFormat:"application/json",srsname:c,bbox:e.join(",")+","+c,maxFeatures:null!==(s=null==r?void 0:r.maxFeatures)&&void 0!==s?s:5e5});o();var u=function(t){a.removeLoadedExtent(e),t&&console.warn(t)};j.A.get(p).then(function(e){o(),200===e.status?a.addFeatures(a.getFormat().readFeatures(e.data)):u()}).catch(u)},strategy:e.selectLoadingStrategy(r)});e.snapMetadata={id:t.id,source:a}}return e.snapMetadata.source}),Pe(e,"getLayerInstance",function(t){return e.props.map.getLayers().getArray().find(function(e){return e.get("msId")===t})}),Pe(e,"updateFeatureStyles",function(t){t&&t.length>0&&t.forEach(function(t){if(t.style){var r=e.toOlFeature(t);r&&r.setStyle(t.style?(0,k.gd)(t):e.toOlStyle(t.style,t.selected))}})}),Pe(e,"updateOnlyFeatureStyles",function(t){e.drawLayer&&e.drawLayer.getSource().getFeatures().forEach(function(e){var r=c()(t.features).features||t.features,n=u()(r,function(t){return t.properties.id===e.getProperties().id});if(n){var o=(0,M.createStylesAsync)(I()(n.style));j.A.all(o).then(function(t){e.setStyle(function(){return(0,k.Op)(ve(ve({},n),{},{style:t}))})})}})}),Pe(e,"addLayer",function(t,r){var n,o=e.convertGeometryTypeToStyleType(t.drawMethod);n=function(e){var r=c()(t.features)&&u()(c()(t.features).features,function(t){return t.properties.id===e.getProperties().id})||null;if(r){var n=(0,M.createStylesAsync)(I()(r.style));return j.A.all(n).then(function(t){e.setStyle(function(){return(0,k.Op)(ve(ve({},r),{},{style:t}))})}),null}return(0,k.Op)({style:k.k5[o]})},e.geojson=new D.A,e.drawSource=new W.A,e.drawLayer=new R.A({source:e.drawSource,zIndex:1e8,style:n}),e.props.map.addLayer(e.drawLayer),r&&e.addInteractions(t);var a=c()(t.features);if(a&&a.features&&a.features.length){var i=a.features.filter(function(e){return!e.properties.isCircle||e.properties.isCircle&&!e.properties.canEdit||!t.options.drawEnabled});return e.addFeatures(Object.assign({},t,{features:[ve(ve({},a),{},{features:i})]}))}return e.addFeatures(t)}),Pe(e,"addFeatures",function(t){var r,n=t.features,o=t.drawMethod,a=t.options,i=e.getMapCrs();if(n.forEach(function(t){if("FeatureCollection"===t.type){var n=(new D.A).readFeatures(t);a.geodesic||(n=n.map(function(e){return(0,L.s)(e,i)})),e.drawSource=new W.A({features:n}),e.drawLayer.setSource(e.drawSource)}else{var s,c=null,p=t;if(p.geometry&&"GeometryCollection"!==p.geometry.type&&(p=(0,x.reprojectGeoJson)(p,p.featureProjection,i).geometry),"GeometryCollection"!==p.type)"Circle"===o&&p&&(p.properties&&p.properties.center||p.center)?(c=[(c=p.properties&&p.properties.center?(0,x.reproject)(p.properties.center,"EPSG:4326",i):p.center).x,c.y],r=new _.A({geometry:e.createOLGeometry({type:"Circle",center:c,projection:"EPSG:3857",radius:p.properties&&p.properties.radius||p.radius,options:a})})):r=new _.A({geometry:e.createOLGeometry(p.geometry?p.geometry:ve(ve({},p),{},{radius:null===(s=p.properties)||void 0===s?void 0:s.radius,center:c}))}),r.setProperties(t.properties),e.drawSource.addFeature(r)}}),0===n.length&&(a.editEnabled||a.drawEnabled))a.transformToFeatureCollection?(e.drawSource=new W.A({features:(new D.A).readFeatures({type:"FeatureCollection",features:[]})}),e.drawLayer.setSource(e.drawSource)):(r=new _.A({geometry:e.createOLGeometry({type:o,coordinates:null})}),e.drawSource.addFeature(r));else{if(n[0]&&"GeometryCollection"===n[0].type){e.drawSource=new W.A({features:(new D.A).readFeatures(n[0])});var s=e.replacePolygonsWithCircles(e.drawSource.getFeatures()[0]);e.drawSource.getFeatures()[0].getGeometry().setGeometries(s),e.drawLayer.setSource(e.drawSource)}n[0]&&n[0].geometry&&"GeometryCollection"===n[0].geometry.type&&(r=(0,x.reprojectGeoJson)(n[0],a.featureProjection,i).geometry,e.drawSource=new W.A({features:(new D.A).readFeatures(r)}),e.drawSource.getFeatures()[0].set("textGeometriesIndexes",n[0].properties&&n[0].properties.textGeometriesIndexes),e.drawSource.getFeatures()[0].set("textValues",n[0].properties&&n[0].properties.textValues),e.drawSource.getFeatures()[0].set("circles",n[0].properties&&n[0].properties.circles),e.drawLayer.setSource(e.drawSource))}return e.updateFeatureStyles(n),r}),Pe(e,"replaceFeatures",function(t){var r;return e.drawLayer?(e.drawSource.clear(),r=e.addFeatures(t),t.style&&e.drawLayer.setStyle(function(r){var n=u()(c()(t.features).features,function(e){return e.properties.id===r.getProperties().id});if(n){var o=(0,M.createStylesAsync)(I()(n.style));return j.A.all(o).then(function(e){r.setStyle(function(){return(0,k.Op)(ve(ve({},n),{},{style:e}))})}),null}var a=e.convertGeometryTypeToStyleType(t.drawMethod);return(0,k.Op)({style:k.k5[a]})})):r=e.addLayer(t,t.options&&t.options.drawEnabled||!1),r}),Pe(e,"endDrawing",function(t){var r=e.replaceFeatures(t);if(r){var n=e.fromOLFeature(r);"Circle"===t.drawMethod&&t&&t.features&&t.features.length&&t.features[0]&&t.features[0].radius>=0&&(n.radius=t.features[0].radius),e.props.onEndDrawing(n,t.drawOwner)}}),Pe(e,"addDrawInteraction",function(t,r,n,o){e.drawInteraction&&e.removeDrawInteraction(),e.drawInteraction=new H.Ay(e.drawPropertiesForGeometryType(t,n,e.drawSource,o)),e.props.map.disableEventListener("singleclick"),e.drawInteraction.on("drawstart",function(){e.selectInteraction&&(e.selectInteraction.getFeatures().clear(),e.selectInteraction.setActive(!1))}),e.drawInteraction.on("drawend",function(t){var n=t.feature.clone();if(n.set("id",A().v1()),"Circle"===e.props.drawMethod&&"Circle"===n.getGeometry().getType()){var o=n.getGeometry().getRadius(),a=n.getGeometry().getCenter();n.setGeometry(e.polygonFromCircle(a,o))}var i=e.fromOLFeature(n,r);e.props.onEndDrawing(i,e.props.drawOwner),e.props.options.stopAfterDrawing&&e.props.onChangeDrawingStatus("stop",e.props.drawMethod,e.props.drawOwner,e.props.features.concat([i])),e.selectInteraction&&(e.addSelectInteraction(),e.selectInteraction.setActive(!0))}),e.props.map.addInteraction(e.drawInteraction),e.setDoubleClickZoomEnabled(!1)}),Pe(e,"selectLoadingStrategy",function(e){return"all"===(null==e?void 0:e.strategy)?de.Q7:de.Qk}),Pe(e,"createSnapInteraction",function(t){var r=t.snapConfig,n=t.snappingLayerInstance,o=t.mapLayerInstance,a=t.layerType;if(o instanceof R.A)return new le.A(ve(ve({},r),{},{source:o.getSource()}));if((o instanceof J.A||o instanceof N.A)&&"wms"===a){var i=e.getWMSSnapSource(n,r);return e.snapLayer=new R.A({source:i,style:new X.Ay({stroke:new Y.A({color:"rgba(255,255,0,0)"})})}),e.props.map.addLayer(e.snapLayer),new le.A(ve(ve({},r),{},{source:i}))}return null}),Pe(e,"addSnapInteraction",function(t){var r=t.snapping,n=t.snappingLayerInstance,o=t.snapConfig;if(r){var a=e.getLayerInstance(n.id),i=n.type;e.removeSnapInteraction();var s=e.createSnapInteraction({snapConfig:o,snappingLayerInstance:n,mapLayerInstance:a,layerType:i});s&&(e.snapInteraction=s,e.props.map.addInteraction(e.snapInteraction))}}),Pe(e,"toMulti",function(e){return"Point"===e.getType()?new q.A([e.getCoordinates()]):e}),Pe(e,"handleDrawAndEdit",function(t,r,n,o){e.drawInteraction&&e.removeDrawInteraction(),e.drawInteraction=new H.Ay(e.drawPropertiesForGeometryType((0,T.jT)(t),n,(0,T.ZR)(t)?e.drawSource:null,o)),e.props.map.disableEventListener("singleclick"),e.drawInteraction.on("drawstart",function(){e.selectInteraction&&(e.selectInteraction.getFeatures().clear(),e.selectInteraction.setActive(!1))}),e.drawInteraction.on("drawend",function(n){var a=n.feature.clone(),i=A().v1();a.set("id",i);var s,p,l,d=a.getGeometry(),g=e.drawLayer.getSource().getFeatures(),y=e.props.features;if(e.props.options.transformToFeatureCollection){var f;if("Circle"===t){var m,w,h;if(l="Polygon",e.props.options.geodesic){w=n.feature.getGeometry().geodesicCenter||(0,ue.q1)(d.getExtent());var C=e.props.map.getView().getProjection().getCode(),S=[fe(w),fe(d.getCoordinates()[0][0])].map(function(t){return e.reprojectCoordinatesToWGS84(t,C)});m=(0,x.calculateDistance)(S,"haversine"),h=(0,B.kj)(S[0],m).clone().transform("EPSG:4326",C).getCoordinates()}else m=d.getRadius(),w=d.getCenter(),h=e.polygonCoordsFromCircle(w,m);f=e.getNewFeature(l,h),w=(0,x.reproject)(w,e.getMapCrs(),"EPSG:4326",!1);var b=o&&o.features&&o.features.length&&o.features[0]&&o.features[0].features&&o.features[0].features.length&&o.features[0].features.filter(function(e){return e.properties.isDrawing})[0].properties.id||i;f.setProperties({isCircle:!0,radius:m,center:[w.x,w.y],id:b,crs:e.getMapCrs(),isGeodesic:e.props.options.geodesic})}else if("Polygon"===t){l=e.props.drawMethod;var P=d.getCoordinates();P[0].push(P[0][0]),f=e.getNewFeature(l,P)}else{l="Text"===t?"Point":e.props.drawMethod;var I=d.getCoordinates();f=e.getNewFeature(l,I),"Text"===t&&f.setProperties({isText:!0,valueText:"."})}var G=g.length>=1?fe(e.replaceCirclesWithPolygonsInFeatureColl(g)):[];f.getProperties().id||f.setProperties({id:A().v1()});var O=[].concat(fe(G),[f]),F=Ge.writeFeaturesObject(O),j=new W.A({features:(new D.A).readFeatures(F)});e.drawLayer.setSource(j);var M=(0,x.reprojectGeoJson)(F,e.getMapCrs(),"EPSG:4326");e.props.onGeometryChanged([M],e.props.drawOwner,e.props.options&&e.props.options.stopAfterDrawing?"enterEditMode":"","Text"===t,"Circle"===t),e.props.onEndDrawing(M,e.props.drawOwner),e.props.onDrawingFeatures([v()(M.features)])}else{var L;if("Circle"===t){l="Polygon";var E=d.getRadius(),k=d.getCenter(),_=e.polygonCoordsFromCircle(k,E),R=e.toMulti(e.createOLGeometry({type:l,coordinates:_}));if(1===y.length&&y[0]&&!y[0].geometry)s=[],p=new Q.A([R]);else if((s=e.toMulti(c()(g).getGeometry())).getGeometries){var N=e.replaceCirclesWithPolygons(c()(g));p=new Q.A([].concat(fe(N),[R]))}else p=new Q.A([s,R]);a.setGeometry(p)}else if("Text"===t||"MultiPoint"===t){var J=d.getCoordinates();l="MultiPoint";var H=e.toMulti(e.createOLGeometry({type:l,coordinates:[J]}));if(1!==y.length||y[0].geometry)if((s=e.toMulti(c()(g).getGeometry())).getGeometries){var V=e.replaceCirclesWithPolygons(c()(g));p=new Q.A([].concat(fe(V),[H]))}else(p=s.clone()).appendPoint(H.getPoint(0));else s=[],p=H.clone();a.setGeometry(p)}else if(!(0,T.ZR)(t)){var q;p=null,s=1!==y.length||y[0].geometry?e.toMulti(c()(g).getGeometry()):e.toMulti(e.createOLGeometry({type:t,coordinates:null}));var Z=g.map(function(e){return"GeometryCollection"===e.getGeometry().getType()?e.getGeometry().getGeometries():e.getGeometry()});"GeometryCollection"===g[0].getGeometry().getType()&&(Z=Z[0]);var K=u()(Z,function(e){return e.getType()===t});if(K?e.appendToMultiGeometry(t,K,d):q=e.toMulti(e.createOLGeometry({type:t,coordinates:d.getCoordinates()})),d.getType()!==(0,T.jT)(s.getType())){var $=c()(g).getGeometry().getGeometries?e.replaceCirclesWithPolygons(c()(g)):[];if(K){var z=$.map(function(e){return e.getType()===K.getType()?K:e});p=new Q.A(z)}else p="GeometryCollection"===s.getType()?new Q.A([].concat(fe($),[q])):"Text"===t?new Q.A([q]):new Q.A([s,q]);a.setGeometry(p)}else a.setGeometry(K)}var U=e.props.features[0].properties;"Text"===t&&(U=Object.assign({},e.props.features[0].properties,{textValues:(e.props.features[0].properties.textValues||[]).concat(["."]),textGeometriesIndexes:(e.props.features[0].properties.textGeometriesIndexes||[]).concat([a.getGeometry().getGeometries().length-1])})),"Circle"===t&&(U=Object.assign({},U,{circles:(e.props.features[0].properties.circles||[]).concat([a.getGeometry().getGeometries().length-1])}));var X=e.fromOLFeature(a,r,U),Y=new W.A({features:(new D.A).readFeatures(X)});e.drawLayer.setSource(Y);var ee=(0,x.reprojectGeoJson)(Ge.writeFeatureObject(a.clone()),e.getMapCrs(),"EPSG:4326");"Polygon"===ee.geometry.type&&ee.geometry.coordinates[0].push(ee.geometry.coordinates[0][0]),e.props.onGeometryChanged([ee],e.props.drawOwner,e.props.options&&e.props.options.stopAfterDrawing?"enterEditMode":"","Text"===t,"Circle"===t),e.props.onEndDrawing(X,e.props.drawOwner),X=(0,x.reprojectGeoJson)(X,e.getMapCrs(),"EPSG:4326");var te=(0,T.ZR)(e.props.drawMethod)&&"GeometryCollection"!==(null===(L=e.props.features[0].geometry)||void 0===L?void 0:L.type)?e.props.features.filter(function(e){return null!==e.geometry}).map(function(t){return ve(ve({},t),{},{featureProjection:e.getMapCrs()})}).concat([ve(ve({},X),{},{type:"Feature",geometry:{type:X.type,coordinates:X.coordinates},featureProjection:e.getMapCrs(),properties:U})]):[ve(ve({},X),{},{properties:U})];e.props.options.stopAfterDrawing?e.props.onChangeDrawingStatus("stop",e.props.drawMethod,e.props.drawOwner,te):e.props.onChangeDrawingStatus("replace",e.props.drawMethod,e.props.drawOwner,te.map(function(t){return(0,x.reprojectGeoJson)(t,"EPSG:4326",e.getMapCrs())}),Object.assign({},e.props.options,{featureProjection:e.getMapCrs()})),e.selectInteraction&&(e.addSelectInteraction(),e.selectInteraction.setActive(!0))}}),e.props.map.addInteraction(e.drawInteraction),e.addDrawHoleInteraction(t,n,o),e.setDoubleClickZoomEnabled(!1)}),Pe(e,"addDrawHoleInteraction",function(t,r,n){var o;e.drawHoleInteraction=new V.A(e.drawPropertiesForGeometryType(t,r,e.drawSource,n)),null!=n&&null!==(o=n.options)&&void 0!==o&&o.hole?(e.drawInteraction.setActive(!1),e.drawHoleInteraction.setActive(!0)):(e.drawInteraction.setActive(!0),e.drawHoleInteraction.setActive(!1)),e.drawHoleInteraction.on("modifyend",function(r){e.drawInteraction&&e.drawInteraction.setActive(!0),e.drawHoleInteraction.setActive(!1);var n=new W.A({features:r.features});e.drawLayer.setSource(n);var o=[];n.forEachFeature(function(e){o.push((new D.A).writeFeatureObject(e))}),e.props.onGeometryChanged(o,e.props.drawOwner,e.props.options&&e.props.options.stopAfterDrawing?"enterEditMode":"","Text"===t,"Circle"===t),e.props.onEndDrawing(o,e.props.drawOwner),o=o.map(function(t){return(0,x.reprojectGeoJson)(t,e.getMapCrs(),"EPSG:4326")}),e.props.options.stopAfterDrawing?e.props.onChangeDrawingStatus("stop",e.props.drawMethod,e.props.drawOwner,o):e.props.onChangeDrawingStatus("replace",e.props.drawMethod,e.props.drawOwner,o.map(function(t){return(0,x.reprojectGeoJson)(t,"EPSG:4326",e.getMapCrs())}),Object.assign({},e.props.options,{featureProjection:e.getMapCrs()})),e.selectInteraction&&(e.addSelectInteraction(),e.selectInteraction.setActive(!0))}),e.props.map.addInteraction(e.drawHoleInteraction)}),Pe(e,"drawPropertiesForGeometryType",function(t,r,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a={source:e.drawSource||n,type:null!=t?t:"Point",style:"Marker"===t?(0,k.Sr)(o.style):new X.Ay({fill:new ee.A({color:"rgba(255, 255, 255, 0.2)"}),stroke:new Y.A({color:"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:2}),image:new re.A({radius:5,stroke:new Y.A({color:"rgba(0, 0, 0, 0.7)"}),fill:new ee.A({color:"rgba(255, 255, 255, 0.2)"})})}),features:new ne.A,condition:oe.Gk},i={};switch(t){case"BBOX":i.type="LineString",i.maxPoints=2,i.geometryFunction=function(e,t){var r=t;r||(r=new B.Ay([]));var n=e[0],o=e[1];return r.setCoordinates([[n,[n[0],o[1]],o,[o[0],n[1]],n]]),r};break;case"Circle":i.maxPoints=100,o.options&&o.options.geodesic?i.geometryFunction=function(t,r){var n=r;n||(n=new B.Ay([])).setProperties({geodesicCenter:fe(t[0])},!0);var o=e.props.map.getView().getProjection().getCode(),a=fe(t).map(function(t){return e.reprojectCoordinatesToWGS84(t,o)}),i=(0,x.calculateDistance)(a,"haversine"),s=(0,B.kj)(a[0],i).clone().transform("EPSG:4326",o).getCoordinates();return n.setCoordinates(s),n}:i.type=t;break;case"Marker":case"Point":case"Text":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":"LineString"===t&&(i.maxPoints=r);var s="Text"===t||"Marker"===t?"Point":t;i.type=s,i.geometryFunction=function(t,r){var n=r;return n||(n=e.createOLGeometry({type:s,coordinates:null,options:o.options})),n.setCoordinates(t),n};break;default:return{}}return Object.assign({},a,i)}),Pe(e,"setDoubleClickZoomEnabled",function(t){for(var r=e.props.map.getInteractions(),n=0;n<r.getLength();n++){var o=r.item(n);if(o instanceof ae.A){o.setActive(t);break}}}),Pe(e,"updateFeatureExtent",function(t){var r=t.features.getArray(),n=e.props.features.map(function(t){var n=c()(r.filter(function(r){return e.fromOLFeature(r).id===t.id}));return n?Object.assign({},t,{geometry:n.geometry,center:n.center,extent:n.extent,coordinate:n.coordinates,radius:n.radius}):t});e.props.onChangeDrawingStatus("replace",e.props.drawMethod,e.props.drawOwner,n)}),Pe(e,"addInteractions",function(t){e.clean(),e.drawLayer||e.addLayer(t),e.addDrawInteraction(t.drawMethod,t.options.startingPoint,t.options.maxPoints,t),t.options&&t.options.editEnabled&&(e.addSelectInteraction(),e.translateInteraction&&e.props.map.removeInteraction(e.translateInteraction),e.translateInteraction=new ie.A({features:e.selectInteraction.getFeatures()}),e.translateInteraction.setActive(!1),e.translateInteraction.on("translateend",e.updateFeatureExtent),e.props.map.addInteraction(e.translateInteraction),e.addTranslateListener(),e.modifyInteraction&&e.props.map.removeInteraction(e.modifyInteraction),e.modifyInteraction=new se.A({features:e.selectInteraction.getFeatures(),condition:function(e){return(0,oe.fs)(e)&&!(0,oe.Js)(e)}}),e.props.map.addInteraction(e.modifyInteraction)),e.drawSource.clear(),t.features.length>0&&e.addFeatures(t)}),Pe(e,"addSingleClickListener",function(e,t){return t.map.on("singleclick",e)}),Pe(e,"addDrawOrEditInteractions",function(t){e.unSingleClickCallback(),e.clean();var r,n=t.features.map(function(r){return(0,x.reprojectGeoJson)(r,t.options.featureProjection,e.getMapCrs())||{}}),o=n.every(function(e){return!!(e&&e.features&&e.features.length)}),a=n.every(function(e){return!!(e&&e.properties&&e.properties.isCircle)});if(o)r=Object.assign({},t,{features:n});else if(a)r=Object.assign({},t,{features:[]});else{var i=n.reduce(function(e,t){return t.geometry?[].concat(fe(e),[ve(ve({},t.geometry),{},{properties:t.properties})]):e},[]);r=Object.assign({},t,{features:i})}e.drawLayer?(e.drawSource.clear(),e.addFeatures(r)):e.addLayer(r),t.options.editEnabled&&(t.options.geodesic||e.addModifyInteraction(t),!1!==t.options.translateEnabled&&e.addTranslateInteraction(),t.options.addClickCallback&&e.setState({keySingleClickCallback:e.addSingleClickListener(function(r){if(e.drawSource&&t.options){var n,o=e.drawSource.getFeatures(),a=0,i=o&&o.length&&o.filter(function(e,t){return e.getProperties().canEdit&&(a=t),e.getProperties().canEdit})[0]||null,s=i&&i.getGeometry()&&i.getGeometry().getCoordinates&&i.getGeometry().getCoordinates()||[],c=[],p=t.drawMethod;switch(p){case"Polygon":c=s.length?(0,E.c$)(s)?[(c=(c=d()(s[0],0,s[0].length-1)).concat([r.coordinate])).concat([s[0][0]])]:s[0].length>1?[[].concat(fe(s[0]),[r.coordinate,s[0][0]])]:[[].concat(fe(s[0]),[r.coordinate])]:[[r.coordinate]],(n=e.getNewFeature(p,c)).setProperties(y()(i&&i.getProperties()||{},"geometry"));break;case"LineString":case"MultiPoint":c=s.length?[].concat(fe(s),[r.coordinate]):[r.coordinate],(n=e.getNewFeature(p,c)).setProperties(y()(i&&i.getProperties()||{},"geometry"));break;case"Circle":p="Polygon";var u=i&&i.getProperties()&&i.getProperties().radius||1e4,l=r.coordinate,g=e.polygonCoordsFromCircle(l,u);if(t.options.geodesic){var f=e.props.map.getView().getProjection().getCode(),m=[fe(l)].map(function(t){return e.reprojectCoordinatesToWGS84(t,f)});g=(0,B.kj)(m[0],u).clone().transform("EPSG:4326",f).getCoordinates()}n=e.getNewFeature(p,g),l=(0,x.reproject)(l,e.getMapCrs(),"EPSG:4326",!1),n.setProperties(y()(i&&i.getProperties()||{},"geometry")),n.setProperties({isCircle:!0,radius:u,center:[l.x,l.y],isGeodesic:e.props.options.geodesic});break;case"Text":p="Point",(n=e.getNewFeature(p,r.coordinate)).setProperties(y()(i&&i.getProperties()||{},"geometry")),n.setProperties({isText:!0,valueText:i&&i.getProperties()&&i.getProperties().valueText||t.options.defaultTextAnnotation||"New"});break;default:c=r.coordinate,(n=e.getNewFeature(p,c)).setProperties(y()(i&&i.getProperties()||{},"geometry"))}var w={type:"Feature",geometry:{coordinates:fe((0,x.reprojectGeoJson)(Ge.writeFeaturesObject([n.clone()]),e.getMapCrs(),"EPSG:4326").features[0].geometry.coordinates),type:p},properties:ve({},y()(n.getProperties(),"geometry"))};e.props.onDrawingFeatures([w]),t.options.geodesic||(n=(0,L.s)(n,e.getMapCrs())),o[a]=n,e.drawSource=new W.A({features:o}),e.drawLayer.setSource(e.drawSource),e.addModifyInteraction(t)}},t)})),t.options&&t.options.selectEnabled&&e.addSelectInteraction(t.options&&t.options.selected,t),t.options.drawEnabled&&e.handleDrawAndEdit(t.drawMethod,t.options.startingPoint,t.options.maxPoints,t)}),Pe(e,"addSelectInteraction",function(t,r){var n;if(e.selectInteraction&&e.props.map.removeInteraction(e.selectInteraction),t&&(n=u()(e.drawSource.getFeatures(),function(e){return e.getProperties().id===t.properties.id}))&&e.selectFeature(n),e.selectInteraction=new ce.A({layers:[e.drawLayer],features:new ne.A(t&&n?[n]:null)}),n){var o=e.convertGeometryTypeToStyleType(r.drawMethod);n.setStyle((0,k.gd)(ve(ve({},r),{},{style:ve(ve({},r.style),{},{type:o,highlight:!0,useSelectedStyle:r.options.useSelectedStyle})}),!1,r.features[0]&&r.features[0].properties&&r.features[0].properties.valueText&&[r.features[0].properties.valueText]||[]))}e.selectInteraction.on("select",function(t){var r=e.selectInteraction.getFeatures().getArray(),n=[];return r.length&&(n=e.props.features.map(function(n){var o;if("FeatureCollection"===n.type&&r.length>0){var a=c()(r);if(e.selectFeature(a),a.getGeometry&&"Circle"===a.getGeometry().getType()){var i=a.getGeometry().getRadius(),s=(0,x.reproject)(a.getGeometry().getCenter(),e.getMapCrs(),"EPSG:4326");a.setProperties({center:[s.x,s.y],radius:i}),a=e.replaceCircleWithPolygon(a.clone())}return e.drawSource.getFeatures().forEach(function(t){t.getProperties().id===a.getProperties().id?e.selectFeature(a):e.deselectFeature(t)}),(0,x.reprojectGeoJson)(Ge.writeFeatureObject(a.clone()),e.getMapCrs(),"EPSG:4326")}return o=r.reduce(function(e,t){return t.get("id")===n.id||e},!1),Object.assign({},n,{selected:o,selectedFeature:t.selected})}),e.props.onSelectFeatures(n)),0===r.length?(e.props.onSelectFeatures([]),e.drawSource.getFeatures().map(function(t){return e.deselectFeature(t)}),null):null}),e.props.map.addInteraction(e.selectInteraction)}),Pe(e,"selectFeature",function(e){e.setProperties({selected:!0})}),Pe(e,"deselectFeature",function(e){e.setProperties({selected:!1})}),Pe(e,"removeDrawInteraction",function(){e.drawInteraction&&(e.props.map.removeInteraction(e.drawInteraction),e.drawInteraction=null,setTimeout(function(){return e.props.map.enableEventListener("singleclick")},500),setTimeout(function(){return e.setDoubleClickZoomEnabled(!0)},250))}),Pe(e,"updateSnapInteraction",function(t){var r,n=!(null===(r=t.snappingLayerInstance)||void 0===r||!r.id);if(!n&&e.snapInteraction&&e.removeSnapInteraction(),e.snapInteraction){var o,a,i=e.props.snapConfig!==t.snapConfig,s=(null===(o=e.props.snappingLayerInstance)||void 0===o?void 0:o.id)!==(null===(a=t.snappingLayerInstance)||void 0===a?void 0:a.id),c=!t.snapping&&e.props.snapping,p=t.snapping&&!e.props.snapping;p&&e.activateSnapInteraction(),c&&e.deactivateSnapInteraction(),(p||s||i)&&e.addSnapInteraction(t)}else t.snapping&&n&&e.addSnapInteraction(t)}),Pe(e,"activateSnapInteraction",function(){var t;null===(t=e.snapInteraction)||void 0===t||t.setActive(!0)}),Pe(e,"deactivateSnapInteraction",function(){var t;null===(t=e.snapInteraction)||void 0===t||t.setActive(!1)}),Pe(e,"removeSnapInteraction",function(){e.snapInteraction&&(e.props.map.removeInteraction(e.snapInteraction),e.snapInteraction=null),e.snapLayer&&e.props.map.removeLayer(e.snapLayer)}),Pe(e,"removeInteractions",function(){e.removeDrawInteraction(),e.removeSnapInteraction(),e.selectInteraction&&(e.props.map.enableEventListener("singleclick"),e.props.map.removeInteraction(e.selectInteraction)),e.modifyInteraction&&(e.props.map.removeInteraction(e.modifyInteraction),e.unSingleClickCallback()),e.translateInteraction&&e.props.map.removeInteraction(e.translateInteraction)}),Pe(e,"clean",function(t){t||e.removeInteractions(),e.drawLayer&&(e.props.map.removeLayer(e.drawLayer),e.geojson=null,e.drawLayer=null,e.drawSource=null)}),Pe(e,"fromOLFeature",function(t,r,n){var o=t.getGeometry(),a=e.props.map.getView().getProjection().getCode(),s=o.getType();if(o.getCoordinates){var c,p=o.getExtent(),u=o.getProperties(),l=u&&u.geodesicCenter||(0,ue.q1)(p),d=o.getCoordinates();if(r&&(d=i()(r,d),o.setCoordinates(d)),"Circle"===e.props.drawMethod)if(e.props.options.geodesic){var g=[fe(l),fe(d[0][0])].map(function(t){return e.reprojectCoordinatesToWGS84(t,a)});c=(0,x.calculateDistance)(g,"haversine")}else c=e.calculateRadius(l,d);return Object.assign({},{id:t.get("id"),type:s,extent:p,center:l,coordinates:d,radius:c,style:e.fromOlStyle(t.getStyle()),projection:e.getMapCrs()})}var y=o.getGeometries().map(function(o,s){var c,p=o.getExtent(),u=(0,ue.q1)(p),l=o.getCoordinates();if(r&&(l=i()(r,l),o.setCoordinates(l)),n.circles&&-1!==n.circles.indexOf(s))if(e.props.options.geodesic){var d=[fe(u),fe(l[0][0])].map(function(t){return e.reprojectCoordinatesToWGS84(t,a)});c=(0,x.calculateDistance)(d,"haversine")}else c=e.calculateRadius(u,l);else c=0;return Object.assign({},{id:t.get("id"),type:o.getType(),extent:p,center:u,coordinates:l,radius:c,style:e.fromOlStyle(t.getStyle()),projection:e.getMapCrs()})});return Object.assign({},{type:"Feature",id:t.get("id"),style:e.fromOlStyle(t.getStyle()),geometry:{type:"GeometryCollection",geometries:y},projection:a})}),Pe(e,"reprojectCoordinatesToWGS84",function(e,t){var r=(0,x.reproject)(e,t,"EPSG:4326");return[r.x,r.y]}),Pe(e,"toOlFeature",function(t){return c()(e.drawSource.getFeatures().filter(function(e){return e.get("id")===t.id}))}),Pe(e,"fromOlStyle",function(t){return t?{fillColor:e.rgbToHex(t.getFill().getColor()),fillTransparency:t.getFill().getColor()[3],strokeColor:t.getStroke().getColor(),strokeWidth:t.getStroke().getWidth(),text:t.getText().getText()}:{}}),Pe(e,"toOlStyle",function(t,r,n){var o=t&&t.fillColor?t.fillColor:[255,255,255,.2];"string"==typeof o&&(o=e.hexToRgb(o).concat([t.fillOpacity>=0&&t.fillOpacity<=1?t.fillOpacity:1])),t&&t.fillTransparency&&(o[3]=t.fillTransparency);var a=t&&(t.strokeColor||t.color)?t.strokeColor||t.color:"#ffcc33";r&&(a="#4a90e2"),a=e.hexToRgb(a).concat([t&&t.opacity||1]);var i=new X.Ay({fill:new ee.A({color:o}),stroke:new Y.A({color:a,width:t&&(t.strokeWidth||t.weight)?t.strokeWidth||t.weight:2}),text:new te.A({text:t&&t.text?t.text:"",fill:new ee.A({color:t&&(t.strokeColor||t.color)?t.strokeColor||t.color:"#000"}),stroke:new Y.A({color:"#fff",width:2}),font:t&&t.fontSize?t.fontSize+"px helvetica":""})});return"GeometryCollection"===n?[].concat(fe((0,k.nt)({style:{iconGlyph:"comment",iconShape:"square",iconColor:"blue"}})),[i]):t&&(t.iconUrl||t.iconGlyph)?(0,k.nt)({style:t}):i}),Pe(e,"hexToRgb",function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,r,n){return t+t+r+r+n+n}));return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}),Pe(e,"componentToHex",function(e){var t=e.toString(16);return 1===t.length?"0"+t:t}),Pe(e,"rgbToHex",function(t){return"#"+e.componentToHex(t[0])+e.componentToHex(t[1])+e.componentToHex(t[2])}),Pe(e,"addModifyInteraction",function(t){e.modifyInteraction&&e.props.map.removeInteraction(e.modifyInteraction);var r=t&&t.options&&t.options.editFilter;e.modifyFeatureColl=new ne.A(C()(e.drawLayer.getSource().getFeatures(),r)),e.modifyInteraction=new se.A({features:e.modifyFeatureColl,condition:function(e){return(0,oe.fs)(e)&&!(0,oe.Js)(e)}}),e.modifyInteraction.on("modifyend",function(t){var r=t.features.getArray().map(function(t){var r=t.clone();if(r.getGeometry&&"GeometryCollection"===r.getGeometry().getType()&&r.getGeometry().setGeometries(e.replaceCirclesWithPolygons(r)),r.getGeometry&&r.getGeometry()&&"Circle"===r.getGeometry().getType()){var n=(0,x.reproject)(r.getGeometry().getCenter(),e.getMapCrs(),"EPSG:4326"),o=r.getGeometry().getRadius();r.setProperties({center:[n.x,n.y],radius:o}),t.setProperties({center:[n.x,n.y],radius:o}),r=e.replaceCircleWithPolygon(r.clone())}return(0,x.reprojectGeoJson)(Ge.writeFeatureObject(r),e.getMapCrs(),"EPSG:4326")});e.props.options.transformToFeatureCollection?e.props.onDrawingFeatures(r):e.props.onGeometryChanged(r,e.props.drawOwner,!1,"editing","editing")}),e.props.map.addInteraction(e.modifyInteraction)}),Pe(e,"addTranslateInteraction",function(){e.translateInteraction&&e.props.map.removeInteraction(e.translateInteraction),e.translateInteraction=new ie.A({features:new ne.A(e.drawLayer.getSource().getFeatures())}),e.translateInteraction.setActive(!1),e.translateInteraction.on("translateend",function(t){var r=t.features.getArray().map(function(t){var r=t.clone();if(r.getGeometry&&"GeometryCollection"===r.getGeometry().getType()&&r.getGeometry().setGeometries(e.replaceCirclesWithPolygons(r)),r.getGeometry&&r.getGeometry()&&"Circle"===r.getGeometry().getType()){var n=(0,x.reproject)(r.getGeometry().getCenter(),e.getMapCrs(),"EPSG:4326"),o=r.getGeometry().getRadius();r.setProperties({center:[n.x,n.y],radius:o}),r=e.replaceCircleWithPolygon(r)}return t.getProperties()&&t.getProperties().selected&&e.props.onSelectFeatures([(0,x.reprojectGeoJson)(Ge.writeFeatureObject(r),e.getMapCrs(),"EPSG:4326")]),(0,x.reprojectGeoJson)(Ge.writeFeatureObject(r),e.getMapCrs(),"EPSG:4326")});e.props.options.transformToFeatureCollection?e.props.onDrawingFeatures(r):e.props.onGeometryChanged(r,e.props.drawOwner,e.props.drawOwner,!1,"Text"===e.props.drawMethod,"Circle"===e.props.drawMethod)}),e.addTranslateListener(),e.props.map.addInteraction(e.translateInteraction)}),Pe(e,"createOLGeometry",function(t){var r=t.type,n=t.coordinates,o=t.radius,a=t.center,i=t.geometries,s=t.projection,c=t.options,p=void 0===c?{}:c;return"GeometryCollection"===r?i&&i.length?new Q.A(i.map(function(t){return e.olGeomFromType({type:t.type})})):new Q.A([]):e.olGeomFromType({type:r,coordinates:n,radius:o,center:a,projection:s,options:p})}),Pe(e,"olGeomFromType",function(t){var r,n=t.type,o=t.coordinates,a=t.radius,i=t.center,s=t.projection,c=t.options;switch(n){case"Point":case"Marker":case"Text":r=new Z.A(o||[]);break;case"LineString":r=new K.A(o||[]);break;case"MultiPoint":r=new q.A(o||[]);break;case"MultiLineString":r=new $.A(o||[]);break;case"MultiPolygon":r=new z.A(o||[]);break;default:var p=m()(i)?{x:i[0],y:i[1]}:i,u=s&&!isNaN(parseFloat(a))&&p&&!b()(p.x)&&!b()(p.y)&&!isNaN(parseFloat(p.x))&&!isNaN(parseFloat(p.y));(r=u?c.geodesic?(0,B.kj)(e.reprojectCoordinatesToWGS84([p.x,p.y],s),a,100).clone().transform("EPSG:4326",s):(0,B.nD)(new U.A([p.x,p.y],a),100):new B.Ay(o&&m()(o[0])?o:[]))&&u&&c.geodesic&&r.setProperties({geodesicCenter:[p.x,p.y]},!0)}return r}),Pe(e,"convertGeometryTypeToStyleType",function(e){return"BBOX"===e?"LineString":e}),Pe(e,"appendToMultiGeometry",function(e,t,r){switch(e){case"MultiPoint":t.appendPoint(r);break;case"MultiLineString":t.appendLineString(r);break;case"MultiPolygon":var n=r.getCoordinates();n[0].push(n[0][0]),r.setCoordinates(n),t.appendPolygon(r)}}),Pe(e,"calculateRadius",function(e,t){return m()(t)&&m()(t[0])&&m()(t[0][0])?Math.sqrt(Math.pow(e[0]-t[0][0][0],2)+Math.pow(e[1]-t[0][0][1],2)):100}),Pe(e,"polygonFromCircle",function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;return(0,B.nD)(new U.A(e,t),r)}),Pe(e,"polygonCoordsFromCircle",function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;return e.polygonFromCircle(t,r,n).getCoordinates()}),Pe(e,"replaceCirclesWithPolygonsInFeatureColl",function(t){return t.map(function(t){return"Circle"!==t.getGeometry().getType()?t:e.replaceCircleWithPolygon(t)})}),Pe(e,"replaceCircleWithPolygon",function(t){if(t.getProperties().isCircle&&"Circle"===t.getGeometry().getType()){var r=t.getGeometry().getCenter(),n=t.getGeometry().getRadius();return t.setGeometry(e.polygonFromCircle(r,n)),t}return t}),Pe(e,"replaceCirclesWithPolygons",function(t){return t.getGeometry&&!t.getGeometry().getGeometries?t:t.getGeometry().getGeometries().map(function(r,n){if("Circle"!==r.getType())return r;if(t.getProperties()&&t.getProperties().circles&&-1!==t.getProperties().circles.indexOf(n)){var o=r.getCenter(),a=r.getRadius();return e.polygonFromCircle(o,a)}return r})}),Pe(e,"replacePolygonsWithCircles",function(t){return t.getGeometry().getGeometries().map(function(r,n){if("Polygon"!==r.getType())return r;if(t.getProperties()&&t.getProperties().circles&&-1!==t.getProperties().circles.indexOf(n)){var o=r.getExtent(),a=(0,ue.q1)(o),i=e.calculateRadius(a,r.getCoordinates());return new U.A(a,i)}return r})}),Pe(e,"addTranslateListener",function(){document.addEventListener("keydown",function(t){t.altKey&&"AltLeft"===t.code&&e.translateInteraction.setActive(!0)}),document.addEventListener("keyup",function(t){"AltLeft"===t.code&&e.translateInteraction.setActive(!1)})}),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&be(e,t)}(t,e),r=t,(n=[{key:"UNSAFE_componentWillReceiveProps",value:function(e){if(this.drawLayer&&this.updateFeatureStyles(e.features),!e.drawStatus&&this.selectInteraction&&this.selectInteraction.getFeatures().clear(),this.props.drawStatus!==e.drawStatus||this.props.drawMethod!==e.drawMethod||this.props.features!==e.features)switch(e.drawStatus){case"create":this.addLayer(e);break;case"start":this.addInteractions(e);break;case"drawOrEdit":this.addDrawOrEditInteractions(e);break;case"stop":this.removeDrawInteraction();break;case"replace":this.replaceFeatures(e);break;case"updateStyle":this.updateOnlyFeatureStyles(e);break;case"clean":this.clean();break;case"cleanAndContinueDrawing":this.clean(!0);break;case"endDrawing":this.endDrawing(e)}this.updateSnapInteraction(e)}},{key:"render",value:function(){return null}},{key:"unSingleClickCallback",value:function(){this.state&&this.state.keySingleClickCallback&&(0,pe.e)(this.state.keySingleClickCallback)}}])&&he(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n}(o().Component);Pe(Oe,"propTypes",{map:O().object,drawOwner:O().string,drawStatus:O().string,drawMethod:O().string,options:O().object,features:O().array,onChangeDrawingStatus:O().func,onGeometryChanged:O().func,onDrawStopped:O().func,onDrawingFeatures:O().func,onSelectFeatures:O().func,onEndDrawing:O().func,style:O().object,snapping:O().bool,snappingLayer:O().object,snappingLayerInstance:O().object,isSnappingLoading:O().bool,snapConfig:O().object,onRefreshSnappingLayer:O().func,toggleSnappingIsLoading:O().func}),Pe(Oe,"defaultProps",{map:null,drawOwner:null,drawStatus:null,drawMethod:null,features:null,options:{stopAfterDrawing:!0},onChangeDrawingStatus:function(){},onGeometryChanged:function(){},onDrawStopped:function(){},onDrawingFeatures:function(){},onSelectFeatures:function(){},onEndDrawing:function(){}})},19843:(e,t,r)=>{r.d(t,{s:()=>c});var n=r(956449),o=r.n(n),a=r(764932),i=r(570915),s=r(694974),c=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;if(!e.getGeometry()||"Polygon"!==e.getGeometry().getType()||e.getProperties().center&&0===e.getProperties().center.length)return e;if(e.getProperties()&&e.getProperties().isCircle&&e.getProperties().center&&e.getProperties().center[0]&&e.getProperties().center[1]){var n,c=e.getGeometry().getExtent();n=e.getProperties().center?[(n=(0,a.reproject)(e.getProperties().center,"EPSG:4326",t)).x,n.y]:(0,i.q1)(c);var p=e.getProperties().crs===t?e.getProperties().radius:function(e,t,r,n){if(o()(t)&&o()(t[0])&&o()(t[0][0])){var i=(0,a.reproject)(t[0][0],n,r);return Math.sqrt(Math.pow(e[0]-i.x,2)+Math.pow(e[1]-i.y,2))}return 100}(n,e.getGeometry().getCoordinates(),t,r);return e.setGeometry(new s.A(n,p)),e}return e}},360918:(e,t,r)=>{r.d(t,{A:()=>m});var n=r(934142),o=r(502871),a=r(322809),i=r(54620),s=r(142770);function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function p(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?p(Object(r),!0).forEach(function(t){y(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function l(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(l=function(){return!!e})()}function d(e){return d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},d(e)}function g(e,t){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},g(e,t)}function y(e,t,r){return(t=f(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function f(e){var t=function(e){if("object"!=c(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=c(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==c(t)?t:t+""}const m=function(e){function t(e){var r;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),y(r=function(e,t,r){return t=d(t),function(e,t){if(t&&("object"==c(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,l()?Reflect.construct(t,r||[],d(e).constructor):t.apply(e,r))}(this,t,[u(u({},e),{},{type:"Polygon",geometryFunction:e.geometryFunction?function(t,n){return e.geometryFunction(t,r._geometryFn(t,n))}:function(e,t){return r._geometryFn(e,t)}})]),"setMap",function(e){this.getMap()&&this.getMap().removeInteraction(this._select),e&&e.addInteraction(this._select),i.Ay.prototype.setMap.call(this,e)}),y(r,"setActive",function(e){this._select.getFeatures().clear(),i.Ay.prototype.setActive.call(this,e)}),y(r,"removeLastPoint",function(){this._feature&&this._feature.getGeometry().getCoordinates()[0].length>2&&i.Ay.prototype.removeLastPoint.call(this)}),y(r,"getPolygon",function(){return this._polygon}),y(r,"_startDrawing",function(e){var t=this.getMap();this._feature=e.feature;var r=e.feature.getGeometry().getCoordinates()[0][0];this._current=null,t.forEachFeatureAtPixel(t.getPixelFromCoordinate(r),function(e,t){if(!this._current&&this._features(e,t)){var n=e.getGeometry();if("Polygon"===n.getType()&&n.intersectsCoordinate(r))this._polygonIndex=!1,this._polygon=n,this._current=e;else if("MultiPolygon"===n.getType()&&n.intersectsCoordinate(r))for(var o,a=0;n.getPolygon(a);a++)if((o=n.getPolygon(a)).intersectsCoordinate(r)){this._polygonIndex=a,this._polygon=o,this._current=e;break}}}.bind(this),{layerFilter:this.layers_}),this._select.getFeatures().clear(),this._current?this._select.getFeatures().push(this._current):(this.setActive(!1),this.setActive(!0))}),y(r,"_finishDrawing",function(e){e.hole=e.feature,e.feature=this._select.getFeatures().item(0),this.dispatchEvent({type:"modifystart",features:[this._current]});var t=e.hole.getGeometry().getCoordinates()[0];if(t.length>=3)if(!1!==this._polygonIndex){for(var r,n=e.feature.getGeometry(),i=new o.A([]),s=0;n.getPolygon(s);s++)r=n.getPolygon(s),s===this._polygonIndex?(r.appendLinearRing(new a.A(t)),i.appendPolygon(r)):i.appendPolygon(r);e.feature.setGeometry(i)}else this.getPolygon().appendLinearRing(new a.A(t));this.dispatchEvent({type:"modifyend",features:[this._current]}),this._feature=null,this._select.getFeatures().clear()}),y(r,"_geometryFn",function(e,t){var r=e[0].pop();return this.getPolygon()&&!this.getPolygon().intersectsCoordinate(r)||(this.lastOKCoord=[r[0],r[1]]),e[0].push([this.lastOKCoord[0],this.lastOKCoord[1]]),t&&t.setCoordinates([e[0].concat([e[0][0]])]),new n.Ay(e)}),r._select=new s.A({style:e.style}),r._select.setActive(!1),e.layers&&("function"==typeof e.layers?r.layers_=e.layers:e.layers.indexOf&&(r.layers_=function(t){return e.layers.indexOf(t)>=0})),"function"==typeof e.featureFilter)r._features=e.featureFilter;else if(e.featureFilter){var p=e.featureFilter;r._features=function(e){return p.indexOf?!!p[p.indexOf(e)]:!!p.item(p.getArray().indexOf(e))}}else r._features=function(){return!0};return r.on("drawstart",r._startDrawing.bind(r)),r.on("drawend",r._finishDrawing.bind(r)),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&g(e,t)}(t,e),r=t,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(i.Ay)}}]);