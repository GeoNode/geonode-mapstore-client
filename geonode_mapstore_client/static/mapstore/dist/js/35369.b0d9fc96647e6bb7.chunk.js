"use strict";(self.webpackChunkgeonode_mapstore_client=self.webpackChunkgeonode_mapstore_client||[]).push([[35369],{435369:(e,t,r)=>{r.d(t,{A:()=>P});var n=r(273517),l=r.n(n),i=r(8117),a=r(881137),o=r(629559),c=r(8571),s=r(168995),m=r(636422),u=r(724188),d=r(764932),g=r(294312),p=r(142974);function y(e){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y(e)}function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function E(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach((function(t){S(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function S(e,t,r){return(t=function(e){var t=function(e){if("object"!=y(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=y(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==y(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function h(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,l,i,a,o=[],c=!0,s=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(o.push(n.value),o.length!==t);c=!0);}catch(e){s=!0,l=e}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(s)throw l}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return b(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?b(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var v=(0,a.A)(i.$n),G={custom:function(e){var t=e.tileGrids,r=e.supportFormatCache,n=e.selectedTileGridId,a=e.projection,o=e.hasCustomParams,s=e.tileGridCacheSupport,m=e.layer;return l().createElement(l().Fragment,null,l().createElement("p",{style:{maxWidth:400}},n&&r&&l().createElement(c.A,{msgId:"layerProperties.tileGridInUse",msgParams:{id:n}})),l().createElement(c.A,{msgId:"layerProperties.availableTileGrids"}),l().createElement(i.XI,{bordered:!0,condensed:!0},l().createElement("thead",null,l().createElement("tr",null,l().createElement("th",null,l().createElement(c.A,{msgId:"layerProperties.crsId"})),l().createElement("th",null,l().createElement(c.A,{msgId:"layerProperties.projection"})),l().createElement("th",null,l().createElement(c.A,{msgId:"layerProperties.tileSize"})))),l().createElement("tbody",null,(t||[]).map((function(e){var t=(e.tileSize||e.tileSizes[0]||[])[0],i=e.id===n&&r&&r?"bg-success":"";return l().createElement("tr",{className:i,key:e.id},l().createElement("td",null,e.id),l().createElement("td",{className:n||(0,d.normalizeSRS)(e.crs)!==(0,d.normalizeSRS)(a)?"":"bg-warning"},e.crs),l().createElement("td",null,t))})))),(null==s?void 0:s.formats)&&l().createElement(l().Fragment,null,l().createElement(c.A,{msgId:"layerProperties.supportedFormats"}),l().createElement(i.XI,{bordered:!0,condensed:!0},l().createElement("tbody",null,s.formats.map((function(e){return l().createElement("tr",{key:e,className:e===m.format?"bg-success":""},l().createElement("td",null,e))}))))),l().createElement("div",{style:{maxWidth:400}},n?r?null:l().createElement(i.Fc,{bsStyle:"warning"},!r&&l().createElement(c.A,{msgId:"layerProperties.notSupportedSelectedFormatCache"})):l().createElement(i.Fc,{bsStyle:"warning"},l().createElement(c.A,{msgId:"layerProperties.noTileGridMatchesConfiguration"})),o&&l().createElement(i.Fc,{bsStyle:"warning"},l().createElement(c.A,{msgId:"layerProperties.customParamsCacheWarning"}))))},standard:function(e){var t=e.tileGrids,r=e.tileGridCacheSupport,n=e.layer,a=e.supportFormatCache,o=e.projection,s=e.hasCustomParams,m=(0,d.normalizeSRS)(o),u=t.filter((function(e){return(0,d.normalizeSRS)(e.crs)===m})),g=u.length>0,p=u.filter((function(e){return(e.tileSize||e.tileSizes[0]||[])[0]===(n.tileSize||256)})).length>0;return l().createElement(l().Fragment,null,l().createElement("p",{style:{maxWidth:400}},l().createElement(c.A,{msgId:"layerProperties.tileGridInfoChecks"})),l().createElement(i.XI,{bordered:!0,condensed:!0},l().createElement("tbody",null,l().createElement("tr",{className:g?"bg-success":"bg-warning"},l().createElement("td",null,l().createElement(i.e6,{className:g?"text-success":"text-danger",glyph:g?"ok-sign":"remove-sign"})," ",l().createElement(c.A,{msgId:"layerProperties.projection"}))),l().createElement("tr",{className:p?"bg-success":"bg-warning"},l().createElement("td",null,l().createElement(i.e6,{className:p?"text-success":"text-danger",glyph:p?"ok-sign":"remove-sign"})," ",l().createElement(c.A,{msgId:"layerProperties.tileSize"}))),l().createElement("tr",{className:a?"bg-success":"bg-warning"},l().createElement("td",null,l().createElement(i.e6,{className:a?"text-success":"text-danger",glyph:a?"ok-sign":"remove-sign"})," ",l().createElement(c.A,{msgId:"layerProperties.format.title"}))))),t&&l().createElement(l().Fragment,null,l().createElement(c.A,{msgId:"layerProperties.availableTileGrids"}),l().createElement(i.XI,{bordered:!0,condensed:!0},l().createElement("thead",null,l().createElement("tr",null,l().createElement("th",null,l().createElement(c.A,{msgId:"layerProperties.crsId"})),l().createElement("th",null,l().createElement(c.A,{msgId:"layerProperties.projection"})),l().createElement("th",null,l().createElement(c.A,{msgId:"layerProperties.tileSize"})))),l().createElement("tbody",null,t.map((function(e){var t=(e.tileSize||e.tileSizes[0]||[])[0],r=g&&!p&&(0,d.normalizeSRS)(e.crs)===m?"bg-success":"",i=t===(n.tileSize||256)&&(0,d.normalizeSRS)(e.crs)===m?"bg-success":"";return l().createElement("tr",{key:e.id},l().createElement("td",null,e.id),l().createElement("td",{className:"".concat(r," ").concat(i)},e.crs),l().createElement("td",{className:i},t))}))))),(null==r?void 0:r.formats)&&l().createElement(l().Fragment,null,l().createElement(c.A,{msgId:"layerProperties.supportedFormats"}),l().createElement(i.XI,{bordered:!0,condensed:!0},l().createElement("tbody",null,r.formats.map((function(e){return l().createElement("tr",{key:e,className:e===n.format?"bg-success":""},l().createElement("td",null,e))}))))),l().createElement("div",{style:{maxWidth:400}},s&&l().createElement(i.Fc,{bsStyle:"warning"},l().createElement(c.A,{msgId:"layerProperties.customParamsCacheWarning"}))))}};const P=function(e){var t,r,a=e.layer,y=void 0===a?{}:a,f=e.projection,S=e.onChange,b=e.disableTileGrids,P=h((0,n.useState)(!1),2),I=P[0],A=P[1],C=h((0,n.useState)((function(){var e;return"custom"===(null==y?void 0:y.tileGridStrategy)&&(null==y?void 0:y.tiled)&&0===(null==y||null===(e=y.tileGrids)||void 0===e?void 0:e.length)?"layerProperties.noConfiguredGridSets":""})),2),j=C[0],w=C[1],z=h((0,n.useState)(""),2),T=z[0],O=z[1],k=h((0,n.useState)({}),2),N=k[0],F=k[1],x=null===(t=(0,p.gK)(E(E(E({},y),"custom"!==y.tileGridStrategy&&N),{},{projection:f})))||void 0===t?void 0:t.id,W=y.tileGridCacheSupport||N.tileGridCacheSupport,R=!y.format||!!((null==W?void 0:W.formats)||[]).includes(y.format),X=!!y.localizedLayerStyles,D=!y||void 0===y.tiled||y.tiled,_=(null===(r=y.tileGrids||N.tileGrids||[])||void 0===r?void 0:r.length)>0&&D&&!y.singleTile,q=(0,u.ez)(y);function M(e,t){if(t||S(e),void 0!==(null==e?void 0:e.tileGrids)){var r=e.tileGrids.filter((function(e){return e.origin&&e.tileSize&&e.tileSize[0]===e.tileSize[1]}));F(E(E({},e),{},{tileGrids:r})),0===r.length&&t&&w("layerProperties.noConfiguredGridSets")}}var U=function(e){return A(!0),w(""),O(""),(0,m.Q3)(q,e.name,e).then((function(e){var t=e.tileGrids,r=e.formats,n=t.filter((function(e){var t=e.crs;return(0,g.dv)((0,d.normalizeSRS)(t))}));return 0===(null==n?void 0:n.length)&&w("layerProperties.noConfiguredGridSets"),{tileGrids:n,tileGridCacheSupport:(null==n?void 0:n.length)>0?{formats:r}:void 0}})).catch((function(){return w("layerProperties.notPossibleToConnectToWMTSService"),O("danger"),{}})).finally((function(){return setTimeout((function(){return A(!1)}),500)}))},$=G[y.tileGridStrategy]||G.standard;return l().createElement("div",{className:"ms-wms-cache-options"},l().createElement("div",{className:"ms-wms-cache-options-content"},l().createElement(i.Sc,{value:"tiled",key:"tiled",disabled:!!y.singleTile,style:{margin:0},onChange:function(e){return S({tiled:e.target.checked})},checked:D},l().createElement(c.A,{msgId:"layerProperties.cached"})),q&&!b&&l().createElement("div",{className:"ms-wms-cache-options-toolbar"},_&&l().createElement(s.A,{glyph:"info-sign",placement:"right",bsStyle:R&&x?"success":"danger",title:l().createElement(c.A,{msgId:"layerProperties.tileGridInfoChecksTitle"}),popoverStyle:{maxWidth:"none"},text:l().createElement($,{layer:y,tileGridCacheSupport:W,tileGrids:y.tileGrids||N.tileGrids,supportFormatCache:R,selectedTileGridId:x,projection:f,hasCustomParams:X})}),l().createElement(v,{disabled:!!I||!D||!!y.singleTile,tooltipId:"custom"===y.tileGridStrategy?"layerProperties.updateTileGrids":"layerProperties.checkAvailableTileGridsInfo",className:"square-button-md no-border format-refresh",onClick:function(){U(E(E({},y),{},{force:!0})).then((function(e){return M(e,"custom"!==y.tileGridStrategy)}))}},l().createElement(i.e6,{glyph:"refresh"})),l().createElement(o.A,{disabled:I||!D||!!y.singleTile,loading:I,tooltipId:"custom"===y.tileGridStrategy?"layerProperties.useStandardTileGridStrategy":"layerProperties.useCustomTileGridStrategy",active:"custom"===y.tileGridStrategy,glyph:"custom"===y.tileGridStrategy?"grid-custom":"grid-regular",bsStyle:"custom"===y.tileGridStrategy?"success":"primary",className:"square-button-md",onClick:function(){var e,t="custom"!==y.tileGridStrategy?"custom":void 0;return("custom"!==t||0!==((null==y||null===(e=y.tileGrids)||void 0===e?void 0:e.length)||0)&&null!=y&&y.tileGridCacheSupport?Promise.resolve(void 0):U(y)).then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.tileGrids;M({tileGridCacheSupport:e.tileGridCacheSupport,tileGridStrategy:((null==r?void 0:r.length)||0)>0?t:void 0,tileGrids:r})}))}}))),!y.singleTile&&D&&j&&l().createElement(i.Fc,{bsStyle:T||"warning"},l().createElement(c.A,{msgId:j,msgParams:{requestUrl:q}})))}}}]);