"use strict";(self.webpackChunkgeonode_mapstore_client=self.webpackChunkgeonode_mapstore_client||[]).push([[8261],{95319(t,e,r){r.d(e,{V:()=>s});var n=r(319763),i=r(982196);class s{bb=null;bb_pos=0;__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsColumn(t,e){return(e||new s).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsColumn(t,e){return t.setPosition(t.position()+n.kc),(e||new s).__init(t.readInt32(t.position())+t.position(),t)}name(t){let e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}type(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb_pos+t):i.$.Byte}title(t){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__string(this.bb_pos+e,t):null}description(t){let e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__string(this.bb_pos+e,t):null}width(){let t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readInt32(this.bb_pos+t):-1}precision(){let t=this.bb.__offset(this.bb_pos,14);return t?this.bb.readInt32(this.bb_pos+t):-1}scale(){let t=this.bb.__offset(this.bb_pos,16);return t?this.bb.readInt32(this.bb_pos+t):-1}nullable(){let t=this.bb.__offset(this.bb_pos,18);return!t||!!this.bb.readInt8(this.bb_pos+t)}unique(){let t=this.bb.__offset(this.bb_pos,20);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}primaryKey(){let t=this.bb.__offset(this.bb_pos,22);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}metadata(t){let e=this.bb.__offset(this.bb_pos,24);return e?this.bb.__string(this.bb_pos+e,t):null}static startColumn(t){t.startObject(11)}static addName(t,e){t.addFieldOffset(0,e,0)}static addType(t,e){t.addFieldInt8(1,e,i.$.Byte)}static addTitle(t,e){t.addFieldOffset(2,e,0)}static addDescription(t,e){t.addFieldOffset(3,e,0)}static addWidth(t,e){t.addFieldInt32(4,e,-1)}static addPrecision(t,e){t.addFieldInt32(5,e,-1)}static addScale(t,e){t.addFieldInt32(6,e,-1)}static addNullable(t,e){t.addFieldInt8(7,+e,1)}static addUnique(t,e){t.addFieldInt8(8,+e,0)}static addPrimaryKey(t,e){t.addFieldInt8(9,+e,0)}static addMetadata(t,e){t.addFieldOffset(10,e,0)}static endColumn(t){let e=t.endObject();return t.requiredField(e,4),e}static createColumn(t,e,r,n,i,o,a,l,h,u,b,d){return s.startColumn(t),s.addName(t,e),s.addType(t,r),s.addTitle(t,n),s.addDescription(t,i),s.addWidth(t,o),s.addPrecision(t,a),s.addScale(t,l),s.addNullable(t,h),s.addUnique(t,u),s.addPrimaryKey(t,b),s.addMetadata(t,d),s.endColumn(t)}}},173899(t,e,r){r.d(e,{X:()=>o});var n=r(319763),i=r(95319),s=r(775665);class o{bb=null;bb_pos=0;__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsFeature(t,e){return(e||new o).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFeature(t,e){return t.setPosition(t.position()+n.kc),(e||new o).__init(t.readInt32(t.position())+t.position(),t)}geometry(t){let e=this.bb.__offset(this.bb_pos,4);return e?(t||new s.V).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}properties(t){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint8(this.bb.__vector(this.bb_pos+e)+t):0}propertiesLength(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}propertiesArray(){let t=this.bb.__offset(this.bb_pos,6);return t?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}columns(t,e){let r=this.bb.__offset(this.bb_pos,8);return r?(e||new i.V).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+4*t),this.bb):null}columnsLength(){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}static startFeature(t){t.startObject(3)}static addGeometry(t,e){t.addFieldOffset(0,e,0)}static addProperties(t,e){t.addFieldOffset(1,e,0)}static createPropertiesVector(t,e){t.startVector(1,e.length,1);for(let r=e.length-1;r>=0;r--)t.addInt8(e[r]);return t.endVector()}static startPropertiesVector(t,e){t.startVector(1,e,1)}static addColumns(t,e){t.addFieldOffset(2,e,0)}static createColumnsVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startColumnsVector(t,e){t.startVector(4,e,4)}static endFeature(t){return t.endObject()}static finishFeatureBuffer(t,e){t.finish(e)}static finishSizePrefixedFeatureBuffer(t,e){t.finish(e,void 0,!0)}static createFeature(t,e,r,n){return o.startFeature(t),o.addGeometry(t,e),o.addProperties(t,r),o.addColumns(t,n),o.endFeature(t)}}},182862(t,e,r){r.d(e,{Ap:()=>l,Bj:()=>s,Ct:()=>o,EH:()=>u,FI:()=>h});var n=r(775665),i=r(358146);function s(t,e){let r,i,o,{xy:a,z:l,m:h,ends:u,parts:b,type:d}=e;if(b){let e=b.map(e=>s(t,e)),r=n.V.createPartsVector(t,e);return n.V.startGeometry(t),n.V.addParts(t,r),n.V.addType(t,d),n.V.endGeometry(t)}let c=n.V.createXyVector(t,a);return l&&(r=n.V.createZVector(t,l)),h&&(i=n.V.createMVector(t,h)),u&&(o=n.V.createEndsVector(t,u)),n.V.startGeometry(t),o&&n.V.addEnds(t,o),n.V.addXy(t,c),r&&n.V.addZ(t,r),i&&n.V.addM(t,i),n.V.addType(t,d),n.V.endGeometry(t)}function o(t,e,r){if(0!==t.length)if(Array.isArray(t[0]))for(let n of t)o(n,e,r);else 2===t.length?e.push(...t):(e.push(t[0],t[1]),r.push(t[2]))}function a(t){let e=t.length/3,r=Array(2*e),n=Array(e);for(let e=0,i=0;e<t.length;e+=3,i++)r[2*i]=t[e],r[2*i+1]=t[e+1],n[i]=t[e+2];return[r,n]}function l(t,e){let r,n,s,o,h,b,d,c=e;c===i.d.Unknown&&(c=u(t.getType())),c===i.d.MultiLineString||c===i.d.Polygon?(t.getFlatCoordinates&&(r=t.getFlatCoordinates()),d=t.getEnds()):c===i.d.MultiPolygon?b=t.getPolygons().map(t=>l(t,i.d.Polygon)):t.getFlatCoordinates&&(r=t.getFlatCoordinates());let f=t.getLayout?.()??"XY";if(r&&("XY"===f?n=r:"XYZ"===f?[n,s]=a(r):"XYM"===f?[n,o]=a(r):"XYZM"===f&&([n,s,o]=function(t){let e=t.length/4,r=Array(2*e),n=Array(e),i=Array(e);for(let e=0,s=0;e<t.length;e+=4,s++)r[2*s]=t[e],r[2*s+1]=t[e+1],n[s]=t[e+2],i[s]=t[e+3];return[r,n,i]}(r))),d){let t=2;"XYZ"===f||"XYM"===f?t=3:"XYZM"===f&&(t=4),h=d.map(e=>e/t)}return{xy:n,z:s,m:o,ends:h,type:c,parts:b}}function h(t,e){let r=[];for(let n=0;n<t.length;n+=2){let i=[t[n],t[n+1]];e&&i.push(e[n>>1]),r.push(i)}return r}function u(t){return t?i.d[t]:i.d.Unknown}},319763(t,e,r){r.d(e,{M$:()=>u,$F:()=>h,kc:()=>n});const n=4,i=new Int32Array(2),s=new Float32Array(i.buffer),o=new Float64Array(i.buffer),a=1===new Uint16Array(new Uint8Array([1,0]).buffer)[0];var l;!function(t){t[t.UTF8_BYTES=1]="UTF8_BYTES",t[t.UTF16_STRING=2]="UTF16_STRING"}(l||(l={}));class h{constructor(t){this.bytes_=t,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(t){return new h(new Uint8Array(t))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(t){this.position_=t}capacity(){return this.bytes_.length}readInt8(t){return this.readUint8(t)<<24>>24}readUint8(t){return this.bytes_[t]}readInt16(t){return this.readUint16(t)<<16>>16}readUint16(t){return this.bytes_[t]|this.bytes_[t+1]<<8}readInt32(t){return this.bytes_[t]|this.bytes_[t+1]<<8|this.bytes_[t+2]<<16|this.bytes_[t+3]<<24}readUint32(t){return this.readInt32(t)>>>0}readInt64(t){return BigInt.asIntN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readUint64(t){return BigInt.asUintN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readFloat32(t){return i[0]=this.readInt32(t),s[0]}readFloat64(t){return i[a?0:1]=this.readInt32(t),i[a?1:0]=this.readInt32(t+4),o[0]}writeInt8(t,e){this.bytes_[t]=e}writeUint8(t,e){this.bytes_[t]=e}writeInt16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeUint16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeInt32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeUint32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeInt64(t,e){this.writeInt32(t,Number(BigInt.asIntN(32,e))),this.writeInt32(t+4,Number(BigInt.asIntN(32,e>>BigInt(32))))}writeUint64(t,e){this.writeUint32(t,Number(BigInt.asUintN(32,e))),this.writeUint32(t+4,Number(BigInt.asUintN(32,e>>BigInt(32))))}writeFloat32(t,e){s[0]=e,this.writeInt32(t,i[0])}writeFloat64(t,e){o[0]=e,this.writeInt32(t,i[a?0:1]),this.writeInt32(t+4,i[a?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+4+4)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let t="";for(let e=0;e<4;e++)t+=String.fromCharCode(this.readInt8(this.position_+4+e));return t}__offset(t,e){const r=t-this.readInt32(t);return e<this.readInt16(r)?this.readInt16(r+e):0}__union(t,e){return t.bb_pos=e+this.readInt32(e),t.bb=this,t}__string(t,e){t+=this.readInt32(t);const r=this.readInt32(t);t+=4;const n=this.bytes_.subarray(t,t+r);return e===l.UTF8_BYTES?n:this.text_decoder_.decode(n)}__union_with_string(t,e){return"string"==typeof t?this.__string(e):this.__union(t,e)}__indirect(t){return t+this.readInt32(t)}__vector(t){return t+this.readInt32(t)+4}__vector_len(t){return this.readInt32(t+this.readInt32(t))}__has_identifier(t){if(4!=t.length)throw new Error("FlatBuffers: file identifier must be length 4");for(let e=0;e<4;e++)if(t.charCodeAt(e)!=this.readInt8(this.position()+4+e))return!1;return!0}createScalarList(t,e){const r=[];for(let n=0;n<e;++n){const e=t(n);null!==e&&r.push(e)}return r}createObjList(t,e){const r=[];for(let n=0;n<e;++n){const e=t(n);null!==e&&r.push(e.unpack())}return r}}class u{constructor(t){let e;this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null,this.text_encoder=new TextEncoder,e=t||1024,this.bb=h.allocate(e),this.space=e}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(t){this.force_defaults=t}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(t,e){t>this.minalign&&(this.minalign=t);const r=1+~(this.bb.capacity()-this.space+e)&t-1;for(;this.space<r+t+e;){const t=this.bb.capacity();this.bb=u.growByteBuffer(this.bb),this.space+=this.bb.capacity()-t}this.pad(r)}pad(t){for(let e=0;e<t;e++)this.bb.writeInt8(--this.space,0)}writeInt8(t){this.bb.writeInt8(this.space-=1,t)}writeInt16(t){this.bb.writeInt16(this.space-=2,t)}writeInt32(t){this.bb.writeInt32(this.space-=4,t)}writeInt64(t){this.bb.writeInt64(this.space-=8,t)}writeFloat32(t){this.bb.writeFloat32(this.space-=4,t)}writeFloat64(t){this.bb.writeFloat64(this.space-=8,t)}addInt8(t){this.prep(1,0),this.writeInt8(t)}addInt16(t){this.prep(2,0),this.writeInt16(t)}addInt32(t){this.prep(4,0),this.writeInt32(t)}addInt64(t){this.prep(8,0),this.writeInt64(t)}addFloat32(t){this.prep(4,0),this.writeFloat32(t)}addFloat64(t){this.prep(8,0),this.writeFloat64(t)}addFieldInt8(t,e,r){(this.force_defaults||e!=r)&&(this.addInt8(e),this.slot(t))}addFieldInt16(t,e,r){(this.force_defaults||e!=r)&&(this.addInt16(e),this.slot(t))}addFieldInt32(t,e,r){(this.force_defaults||e!=r)&&(this.addInt32(e),this.slot(t))}addFieldInt64(t,e,r){(this.force_defaults||e!==r)&&(this.addInt64(e),this.slot(t))}addFieldFloat32(t,e,r){(this.force_defaults||e!=r)&&(this.addFloat32(e),this.slot(t))}addFieldFloat64(t,e,r){(this.force_defaults||e!=r)&&(this.addFloat64(e),this.slot(t))}addFieldOffset(t,e,r){(this.force_defaults||e!=r)&&(this.addOffset(e),this.slot(t))}addFieldStruct(t,e,r){e!=r&&(this.nested(e),this.slot(t))}nested(t){if(t!=this.offset())throw new TypeError("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new TypeError("FlatBuffers: object serialization must not be nested.")}slot(t){null!==this.vtable&&(this.vtable[t]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(t){const e=t.capacity();if(3221225472&e)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");const r=e<<1,n=h.allocate(r);return n.setPosition(r-e),n.bytes().set(t.bytes(),r-e),n}addOffset(t){this.prep(4,0),this.writeInt32(this.offset()-t+4)}startObject(t){this.notNested(),null==this.vtable&&(this.vtable=[]),this.vtable_in_use=t;for(let e=0;e<t;e++)this.vtable[e]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(null==this.vtable||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);const t=this.offset();let e=this.vtable_in_use-1;for(;e>=0&&0==this.vtable[e];e--);const r=e+1;for(;e>=0;e--)this.addInt16(0!=this.vtable[e]?t-this.vtable[e]:0);this.addInt16(t-this.object_start);const n=2*(r+2);this.addInt16(n);let i=0;const s=this.space;t:for(e=0;e<this.vtables.length;e++){const t=this.bb.capacity()-this.vtables[e];if(n==this.bb.readInt16(t)){for(let e=2;e<n;e+=2)if(this.bb.readInt16(s+e)!=this.bb.readInt16(t+e))continue t;i=this.vtables[e];break}}return i?(this.space=this.bb.capacity()-t,this.bb.writeInt32(this.space,i-t)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-t,this.offset()-t)),this.isNested=!1,t}finish(t,e,r){const i=r?n:0;if(e){const t=e;if(this.prep(this.minalign,8+i),4!=t.length)throw new TypeError("FlatBuffers: file identifier must be length 4");for(let e=3;e>=0;e--)this.writeInt8(t.charCodeAt(e))}this.prep(this.minalign,4+i),this.addOffset(t),i&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(t,e){this.finish(t,e,!0)}requiredField(t,e){const r=this.bb.capacity()-t,n=r-this.bb.readInt32(r);if(!(e<this.bb.readInt16(n)&&0!=this.bb.readInt16(n+e)))throw new TypeError("FlatBuffers: field "+e+" must be set")}startVector(t,e,r){this.notNested(),this.vector_num_elems=e,this.prep(4,t*e),this.prep(r,t*e)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(t){if(!t)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(t))return this.string_maps.get(t);const e=this.createString(t);return this.string_maps.set(t,e),e}createString(t){if(null==t)return 0;let e;return e=t instanceof Uint8Array?t:this.text_encoder.encode(t),this.addInt8(0),this.startVector(1,e.length,1),this.bb.setPosition(this.space-=e.length),this.bb.bytes().set(e,this.space),this.endVector()}createByteVector(t){return null==t?0:(this.startVector(1,t.length,1),this.bb.setPosition(this.space-=t.length),this.bb.bytes().set(t,this.space),this.endVector())}createObjectOffset(t){return null===t?0:"string"==typeof t?this.createString(t):t.pack(this)}createObjectOffsetList(t){const e=[];for(let r=0;r<t.length;++r){const n=t[r];if(null===n)throw new TypeError("FlatBuffers: Argument for createObjectOffsetList cannot contain null.");e.push(this.createObjectOffset(n))}return e}createStructOffsetList(t,e){return e(this,t.length),this.createObjectOffsetList(t.slice().reverse()),this.endVector()}}},358146(t,e,r){var n;r.d(e,{d:()=>i});var i=((n={})[n.Unknown=0]="Unknown",n[n.Point=1]="Point",n[n.LineString=2]="LineString",n[n.Polygon=3]="Polygon",n[n.MultiPoint=4]="MultiPoint",n[n.MultiLineString=5]="MultiLineString",n[n.MultiPolygon=6]="MultiPolygon",n[n.GeometryCollection=7]="GeometryCollection",n[n.CircularString=8]="CircularString",n[n.CompoundCurve=9]="CompoundCurve",n[n.CurvePolygon=10]="CurvePolygon",n[n.MultiCurve=11]="MultiCurve",n[n.MultiSurface=12]="MultiSurface",n[n.Curve=13]="Curve",n[n.Surface=14]="Surface",n[n.PolyhedralSurface=15]="PolyhedralSurface",n[n.TIN=16]="TIN",n[n.Triangle=17]="Triangle",n)},554867(t,e,r){r.d(e,{b:()=>s});var n=r(358146),i=r(182862);function s(t){let e;for(let r of t){if(e===n.d.Unknown)break;let t=r.getGeometry?(0,i.EH)(r.getGeometry().getType()):(0,i.EH)(r.geometry.type);void 0===e?e=t:e!==t&&(e=n.d.Unknown)}if(void 0===e)throw Error("Could not infer geometry type for collection of features.");return e}},638658(t,e,r){r.d(e,{$9:()=>b,J2:()=>h,lV:()=>u});var n=r(319763),i=r(982196),s=r(173899),o=r(182862);let a=new TextEncoder,l=new TextDecoder;function h(t,e,r,n,i){let s=r.columns;return i(t,n(e.geometry(),r.geometryType),b(e,s))}function u(t,e,r){let l=r.columns,h=new n.M$,u=0,b=1024,d=new Uint8Array(1024),c=new DataView(d.buffer),f=t=>{if(u+t<b)return;let e=new Uint8Array(b=Math.max(b+t,2*b));e.set(d),c=new DataView((d=e).buffer)};if(l)for(let t=0;t<l.length;t++){let r=l[t],n=e[r.name];if(null!==n)switch(f(2),c.setUint16(u,t,!0),u+=2,r.type){case i.$.Bool:f(1),c.setUint8(u,n),u+=1;break;case i.$.Short:f(2),c.setInt16(u,n,!0),u+=2;break;case i.$.UShort:f(2),c.setUint16(u,n,!0),u+=2;break;case i.$.Int:f(4),c.setInt32(u,n,!0),u+=4;break;case i.$.UInt:f(4),c.setUint32(u,n,!0),u+=4;break;case i.$.Long:f(8),c.setBigInt64(u,BigInt(n),!0),u+=8;break;case i.$.Float:f(4),c.setFloat32(u,n,!0),u+=4;break;case i.$.Double:f(8),c.setFloat64(u,n,!0),u+=8;break;case i.$.DateTime:case i.$.String:{let t=a.encode(n);f(4),c.setUint32(u,t.length,!0),u+=4,f(t.length),d.set(t,u),u+=t.length;break}case i.$.Json:{let t=a.encode(JSON.stringify(n));f(4),c.setUint32(u,t.length,!0),u+=4,f(t.length),d.set(t,u),u+=t.length;break}case i.$.Binary:f(4),c.setUint32(u,n.length,!0),u+=4,f(n.length),d.set(n,u),u+=n.length;break;default:throw Error(`Unknown type ${r.type}`)}}let _=0;u>0&&(_=s.X.createPropertiesVector(h,d.slice(0,u)));let p=(0,o.Bj)(h,t);s.X.startFeature(h),s.X.addGeometry(h,p),_&&s.X.addProperties(h,_);let y=s.X.endFeature(h);return h.finishSizePrefixed(y),h.asUint8Array()}function b(t,e){let r={};if(!e||0===e.length)return r;let n=t.propertiesArray();if(!n)return r;let s=new DataView(n.buffer,n.byteOffset),o=t.propertiesLength(),a=0;for(;a<o;){let t=s.getUint16(a,!0);a+=2;let o=e[t],h=o.name;switch(o.type){case i.$.Bool:r[h]=!!s.getUint8(a),a+=1;break;case i.$.Byte:r[h]=s.getInt8(a),a+=1;break;case i.$.UByte:r[h]=s.getUint8(a),a+=1;break;case i.$.Short:r[h]=s.getInt16(a,!0),a+=2;break;case i.$.UShort:r[h]=s.getUint16(a,!0),a+=2;break;case i.$.Int:r[h]=s.getInt32(a,!0),a+=4;break;case i.$.UInt:r[h]=s.getUint32(a,!0),a+=4;break;case i.$.Long:r[h]=Number(s.getBigInt64(a,!0)),a+=8;break;case i.$.ULong:r[h]=Number(s.getBigUint64(a,!0)),a+=8;break;case i.$.Float:r[h]=s.getFloat32(a,!0),a+=4;break;case i.$.Double:r[h]=s.getFloat64(a,!0),a+=8;break;case i.$.DateTime:case i.$.String:{let t=s.getUint32(a,!0);a+=4,r[h]=l.decode(n.subarray(a,a+t)),a+=t;break}case i.$.Json:{let t=s.getUint32(a,!0);a+=4;let e=l.decode(n.subarray(a,a+t));r[h]=JSON.parse(e),a+=t;break}case i.$.Binary:{let t=s.getUint32(a,!0);a+=4,r[h]=n.subarray(a,a+t),a+=t;break}default:throw Error(`Unknown type ${o.type}`)}}return r}},775665(t,e,r){r.d(e,{V:()=>s});var n=r(319763),i=r(358146);class s{bb=null;bb_pos=0;__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsGeometry(t,e){return(e||new s).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsGeometry(t,e){return t.setPosition(t.position()+n.kc),(e||new s).__init(t.readInt32(t.position())+t.position(),t)}ends(t){let e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}endsLength(){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}endsArray(){let t=this.bb.__offset(this.bb_pos,4);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}xy(t){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+8*t):0}xyLength(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}xyArray(){let t=this.bb.__offset(this.bb_pos,6);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}z(t){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+8*t):0}zLength(){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}zArray(){let t=this.bb.__offset(this.bb_pos,8);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}m(t){let e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+8*t):0}mLength(){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}mArray(){let t=this.bb.__offset(this.bb_pos,10);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}t(t){let e=this.bb.__offset(this.bb_pos,12);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+8*t):0}tLength(){let t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}tArray(){let t=this.bb.__offset(this.bb_pos,12);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}tm(t){let e=this.bb.__offset(this.bb_pos,14);return e?this.bb.readUint64(this.bb.__vector(this.bb_pos+e)+8*t):BigInt(0)}tmLength(){let t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0}type(){let t=this.bb.__offset(this.bb_pos,16);return t?this.bb.readUint8(this.bb_pos+t):i.d.Unknown}parts(t,e){let r=this.bb.__offset(this.bb_pos,18);return r?(e||new s).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+4*t),this.bb):null}partsLength(){let t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0}static startGeometry(t){t.startObject(8)}static addEnds(t,e){t.addFieldOffset(0,e,0)}static createEndsVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addInt32(e[r]);return t.endVector()}static startEndsVector(t,e){t.startVector(4,e,4)}static addXy(t,e){t.addFieldOffset(1,e,0)}static createXyVector(t,e){t.startVector(8,e.length,8);for(let r=e.length-1;r>=0;r--)t.addFloat64(e[r]);return t.endVector()}static startXyVector(t,e){t.startVector(8,e,8)}static addZ(t,e){t.addFieldOffset(2,e,0)}static createZVector(t,e){t.startVector(8,e.length,8);for(let r=e.length-1;r>=0;r--)t.addFloat64(e[r]);return t.endVector()}static startZVector(t,e){t.startVector(8,e,8)}static addM(t,e){t.addFieldOffset(3,e,0)}static createMVector(t,e){t.startVector(8,e.length,8);for(let r=e.length-1;r>=0;r--)t.addFloat64(e[r]);return t.endVector()}static startMVector(t,e){t.startVector(8,e,8)}static addT(t,e){t.addFieldOffset(4,e,0)}static createTVector(t,e){t.startVector(8,e.length,8);for(let r=e.length-1;r>=0;r--)t.addFloat64(e[r]);return t.endVector()}static startTVector(t,e){t.startVector(8,e,8)}static addTm(t,e){t.addFieldOffset(5,e,0)}static createTmVector(t,e){t.startVector(8,e.length,8);for(let r=e.length-1;r>=0;r--)t.addInt64(e[r]);return t.endVector()}static startTmVector(t,e){t.startVector(8,e,8)}static addType(t,e){t.addFieldInt8(6,e,i.d.Unknown)}static addParts(t,e){t.addFieldOffset(7,e,0)}static createPartsVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startPartsVector(t,e){t.startVector(4,e,4)}static endGeometry(t){return t.endObject()}static createGeometry(t,e,r,n,i,o,a,l,h){return s.startGeometry(t),s.addEnds(t,e),s.addXy(t,r),s.addZ(t,n),s.addM(t,i),s.addT(t,o),s.addTm(t,a),s.addType(t,l),s.addParts(t,h),s.endGeometry(t)}}},858261(t,e,r){r.d(e,{EC:()=>K,iu:()=>Y,Z5:()=>W,aW:()=>Z,X:()=>tt,_6:()=>Q,lK:()=>H});var n=r(319763);const i=new Uint8Array(0);function s(t,e){if(!t.length)return e;if(!e.length)return t;var r=new Uint8Array(t.length+e.length);return r.set(t),r.set(e,t.length),r}function o(t){this._source=t,this._array=i,this._index=0}o.prototype.read=function(){var t=this,e=t._array.subarray(t._index);return t._source.read().then(function(r){return t._array=i,t._index=0,r.done?e.length>0?{done:!1,value:e}:{done:!0,value:void 0}:{done:!1,value:s(e,r.value)}})},o.prototype.slice=function(t){if((t|=0)<0)throw new Error("invalid length");var e=this,r=this._array.length-this._index;if(this._index+t<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=t));var n=new Uint8Array(t);return n.set(this._array.subarray(this._index)),function s(){return e._source.read().then(function(o){return o.done?(e._array=i,e._index=0,r>0?n.subarray(0,r):null):r+o.value.length>=t?(e._array=o.value,e._index=t-r,n.set(o.value.subarray(0,t-r),r),n):(n.set(o.value,r),r+=o.value.length,s())})}()},o.prototype.cancel=function(){return this._source.cancel()};var a=r(924787),l=r(173899),h=r(95319);class u{bb=null;bb_pos=0;__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsCrs(t,e){return(e||new u).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsCrs(t,e){return t.setPosition(t.position()+n.kc),(e||new u).__init(t.readInt32(t.position())+t.position(),t)}org(t){let e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}code(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):0}name(t){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__string(this.bb_pos+e,t):null}description(t){let e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__string(this.bb_pos+e,t):null}wkt(t){let e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__string(this.bb_pos+e,t):null}codeString(t){let e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__string(this.bb_pos+e,t):null}static startCrs(t){t.startObject(6)}static addOrg(t,e){t.addFieldOffset(0,e,0)}static addCode(t,e){t.addFieldInt32(1,e,0)}static addName(t,e){t.addFieldOffset(2,e,0)}static addDescription(t,e){t.addFieldOffset(3,e,0)}static addWkt(t,e){t.addFieldOffset(4,e,0)}static addCodeString(t,e){t.addFieldOffset(5,e,0)}static endCrs(t){return t.endObject()}static createCrs(t,e,r,n,i,s,o){return u.startCrs(t),u.addOrg(t,e),u.addCode(t,r),u.addName(t,n),u.addDescription(t,i),u.addWkt(t,s),u.addCodeString(t,o),u.endCrs(t)}}var b=r(358146);class d{bb=null;bb_pos=0;__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsHeader(t,e){return(e||new d).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsHeader(t,e){return t.setPosition(t.position()+n.kc),(e||new d).__init(t.readInt32(t.position())+t.position(),t)}name(t){let e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}envelope(t){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+8*t):0}envelopeLength(){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}envelopeArray(){let t=this.bb.__offset(this.bb_pos,6);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}geometryType(){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readUint8(this.bb_pos+t):b.d.Unknown}hasZ(){let t=this.bb.__offset(this.bb_pos,10);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}hasM(){let t=this.bb.__offset(this.bb_pos,12);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}hasT(){let t=this.bb.__offset(this.bb_pos,14);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}hasTm(){let t=this.bb.__offset(this.bb_pos,16);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}columns(t,e){let r=this.bb.__offset(this.bb_pos,18);return r?(e||new h.V).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+4*t),this.bb):null}columnsLength(){let t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0}featuresCount(){let t=this.bb.__offset(this.bb_pos,20);return t?this.bb.readUint64(this.bb_pos+t):BigInt("0")}indexNodeSize(){let t=this.bb.__offset(this.bb_pos,22);return t?this.bb.readUint16(this.bb_pos+t):16}crs(t){let e=this.bb.__offset(this.bb_pos,24);return e?(t||new u).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}title(t){let e=this.bb.__offset(this.bb_pos,26);return e?this.bb.__string(this.bb_pos+e,t):null}description(t){let e=this.bb.__offset(this.bb_pos,28);return e?this.bb.__string(this.bb_pos+e,t):null}metadata(t){let e=this.bb.__offset(this.bb_pos,30);return e?this.bb.__string(this.bb_pos+e,t):null}static startHeader(t){t.startObject(14)}static addName(t,e){t.addFieldOffset(0,e,0)}static addEnvelope(t,e){t.addFieldOffset(1,e,0)}static createEnvelopeVector(t,e){t.startVector(8,e.length,8);for(let r=e.length-1;r>=0;r--)t.addFloat64(e[r]);return t.endVector()}static startEnvelopeVector(t,e){t.startVector(8,e,8)}static addGeometryType(t,e){t.addFieldInt8(2,e,b.d.Unknown)}static addHasZ(t,e){t.addFieldInt8(3,+e,0)}static addHasM(t,e){t.addFieldInt8(4,+e,0)}static addHasT(t,e){t.addFieldInt8(5,+e,0)}static addHasTm(t,e){t.addFieldInt8(6,+e,0)}static addColumns(t,e){t.addFieldOffset(7,e,0)}static createColumnsVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startColumnsVector(t,e){t.startVector(4,e,4)}static addFeaturesCount(t,e){t.addFieldInt64(8,e,BigInt("0"))}static addIndexNodeSize(t,e){t.addFieldInt16(9,e,16)}static addCrs(t,e){t.addFieldOffset(10,e,0)}static addTitle(t,e){t.addFieldOffset(11,e,0)}static addDescription(t,e){t.addFieldOffset(12,e,0)}static addMetadata(t,e){t.addFieldOffset(13,e,0)}static endHeader(t){return t.endObject()}static finishHeaderBuffer(t,e){t.finish(e)}static finishSizePrefixedHeaderBuffer(t,e){t.finish(e,void 0,!0)}}function c(t){let e=d.getSizePrefixedRootAsHeader(t),r=e.featuresCount(),n=e.indexNodeSize(),i=[];for(let t=0;t<e.columnsLength();t++){let r=e.columns(t);if(!r)throw Error("Column unexpectedly missing");if(!r.name())throw Error("Column name unexpectedly missing");i.push({name:r.name(),type:r.type(),title:r.title(),description:r.description(),width:r.width(),precision:r.precision(),scale:r.scale(),nullable:r.nullable(),unique:r.unique(),primary_key:r.primaryKey()})}let s=e.crs(),o=s?{org:s.org(),code:s.code(),name:s.name(),description:s.description(),wkt:s.wkt(),code_string:s.codeString()}:null;return{geometryType:e.geometryType(),columns:i,envelope:e.envelopeLength()>0?e.envelopeArray():null,featuresCount:Number(r),indexNodeSize:n,crs:o,title:e.title(),description:e.description(),metadata:e.metadata()}}class f{static global=new f;_extraRequestThreshold=262144;extraRequestThreshold(){return this._extraRequestThreshold}setExtraRequestThreshold(t){if(t<0)throw Error("extraRequestThreshold cannot be negative");this._extraRequestThreshold=t}}function _(t,e){e=Math.min(Math.max(+e,2),65535);let r=t,n=r;do{n+=r=Math.ceil(r/e)}while(1!==r);return 40*n}async function*p(t,e,r,n){class i{_level;nodes;constructor(t,e){this._level=e,this.nodes=t}level(){return this._level}startNodeIdx(){return this.nodes[0]}endNodeIdx(){return this.nodes[1]}extendEndNodeIdx(t){this.nodes[1]=t}toString(){return`[NodeRange level: ${this._level}, nodes: ${this.nodes[0]}-${this.nodes[1]}]`}}let{minX:s,minY:o,maxX:a,maxY:l}=r,h=function(t,e){if(e<2)throw Error("Node size must be at least 2");if(0===t)throw Error("Number of items must be greater than 0");let r=t,n=r,i=[r];do{n+=r=Math.ceil(r/e),i.push(r)}while(1!==r);let s=[];for(let t of(r=n,i))s.push(r-t),r-=t;let o=[];for(let t=0;t<i.length;t++)o.push([s[t],s[t]+i[t]]);return o}(t,e),u=h[0][0],b=[new i([0,1],h.length-1)];for(;0!==b.length;){let r=b.shift(),d=r.startNodeIdx(),c=d>=u,_=(()=>{let[,t]=h[r.level()],n=Math.min(r.endNodeIdx()+e,t);return c&&n<t?n+1:n})(),p=_-d,y=new DataView(await n(40*d,40*p));for(let e=d;e<_;e++){let n=e-d,h=40*n;if(a<y.getFloat64(h+0,!0)||l<y.getFloat64(h+8,!0)||s>y.getFloat64(h+16,!0)||o>y.getFloat64(h+24,!0))continue;let _=y.getBigUint64(h+32,!0);if(c){let r=(()=>{if(e<t-1){let t=40*(n+1);return y.getBigUint64(t+32,!0)-_}return null})(),i=e-u;yield[Number(_),i,Number(r)];continue}let p=f.global.extraRequestThreshold()/40,g=b[b.length-1];if(void 0!==g&&g.level()===r.level()-1&&_<g.endNodeIdx()+p){g.extendEndNodeIdx(Number(_));continue}let w=(()=>{let t=r.level()-1;return new i([Number(_),Number(_)+1],t)})();void 0!==g&&(g.level(),w.level()),b.push(w)}}}class y{bytes;header;headerLength;indexLength;constructor(t,e,r,n){this.bytes=t,this.header=e,this.headerLength=r,this.indexLength=n}static open(t){if(!t.subarray(0,3).every((t,e)=>a.$[e]===t))throw Error("Not a FlatGeobuf file");let e=new DataView(t.buffer).getUint32(a.$.length,!0);if(e>10485760||e<8)throw Error("Invalid header size");let r=t.subarray(a.$.length,a.$.length+a.b+e),i=c(new n.$F(r)),s=_(i.featuresCount,i.indexNodeSize);return new y(t,i,e,s)}async*selectBbox(t){let e=this.lengthBeforeTree(),r=async(t,r)=>{let n=e+t;return this.bytes.slice(n,n+r).buffer};for await(let e of p(this.header.featuresCount,this.header.indexNodeSize,t,r)){let[t,r]=e,n=this.readFeature(t);yield{id:r,feature:n}}}lengthBeforeTree(){return a.$.length+a.b+this.headerLength}lengthBeforeFeatures(){return this.lengthBeforeTree()+this.indexLength}readFeature(t){let e=t+this.lengthBeforeFeatures(),r=new DataView(this.bytes.buffer).getUint32(e,!0),i=this.bytes.subarray(e+4,e+4+r),s=new Uint8Array(r+a.b);s.set(i,a.b);let o=new n.$F(s);return l.X.getSizePrefixedRootAsFeature(o)}}var g=r(982196),w=function(t,e){return w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])},w(t,e)};function v(t,e,r,n){return new(r||(r=Promise))(function(i,s){function o(t){try{l(n.next(t))}catch(t){s(t)}}function a(t){try{l(n.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(o,a)}l((n=n.apply(t,e||[])).next())})}function m(t,e){var r,n,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,n=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}function I(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function F(t){return this instanceof F?(this.v=t,this):new F(t)}var x=function(t){function e(e){var r=t.call(this,e)||this;return Object.defineProperty(r,"name",{value:"RepeaterOverflowError",enumerable:!1}),"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf(r,r.constructor.prototype):r.__proto__=r.constructor.prototype,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(r,r.constructor),r}return function(t,e){function r(){this.constructor=t}w(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(e,t),e}(Error);function U(t){null!=t&&"function"==typeof t.then&&t.then(V,V)}(function(){function t(t){if(t<0)throw new RangeError("Capacity may not be less than 0");this._c=t,this._q=[]}Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this._q.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"full",{get:function(){return this._q.length>=this._c},enumerable:!1,configurable:!0}),t.prototype.add=function(t){if(this.full)throw new Error("Buffer full");this._q.push(t)},t.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()}})(),function(){function t(t){if(t<1)throw new RangeError("Capacity may not be less than 1");this._c=t,this._q=[]}Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this._q.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),t.prototype.add=function(t){for(;this._q.length>=this._c;)this._q.shift();this._q.push(t)},t.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()}}(),function(){function t(t){if(t<1)throw new RangeError("Capacity may not be less than 1");this._c=t,this._q=[]}Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this._q.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),t.prototype.add=function(t){this._q.length<this._c&&this._q.push(t)},t.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()}}();var V=function(){};function P(t){var e=t.err,r=Promise.resolve(t.execution).then(function(t){if(null!=e)throw e;return t});return t.err=void 0,t.execution=r.then(function(){},function(){}),void 0===t.pending?r:t.pending.then(function(){return r})}function S(t,e){var r=t.state>=3;return Promise.resolve(e).then(function(e){return!r&&t.state>=4?P(t).then(function(t){return{value:t,done:!0}}):{value:e,done:r}})}function C(t,e){var r,n;if(!(t.state>=2))if(t.state=2,t.onnext(),t.onstop(),null==t.err&&(t.err=e),0!==t.pushes.length||void 0!==t.buffer&&!t.buffer.empty)try{for(var i=I(t.pushes),s=i.next();!s.done;s=i.next())s.value.resolve()}catch(t){r={error:t}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}else B(t)}function B(t){var e,r;if(!(t.state>=3)){t.state<2&&C(t),t.state=3,t.buffer=void 0;try{for(var n=I(t.nexts),i=n.next();!i.done;i=n.next()){var s=i.value,o=void 0===t.pending?P(t):t.pending.then(function(){return P(t)});s.resolve(S(t,o))}}catch(t){e={error:t}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}t.pushes=[],t.nexts=[]}}function O(t){t.state>=4||(t.state<3&&B(t),t.state=4)}function E(t,e){if(U(e),t.pushes.length>=1024)throw new x("No more than 1024 pending calls to push are allowed on a single repeater.");if(t.state>=2)return Promise.resolve(void 0);var r,n=void 0===t.pending?Promise.resolve(e):t.pending.then(function(){return e});n=n.catch(function(e){t.state<2&&(t.err=e),O(t)}),t.nexts.length?(t.nexts.shift().resolve(S(t,n)),r=t.nexts.length?Promise.resolve(t.nexts[0].value):void 0===t.buffer||t.buffer.full?new Promise(function(e){return t.onnext=e}):Promise.resolve(void 0)):void 0===t.buffer||t.buffer.full?r=new Promise(function(e){return t.pushes.push({resolve:e,value:n})}):(t.buffer.add(n),r=Promise.resolve(void 0));var i=!0,s={},o=r.catch(function(t){if(i)throw t});return s.then=function(t,e){return i=!1,Promise.prototype.then.call(r,t,e)},s.catch=function(t){return i=!1,Promise.prototype.catch.call(r,t)},s.finally=r.finally.bind(r),t.pending=n.then(function(){return o}).catch(function(e){t.err=e,O(t)}),s}function T(t){if(!(t.state>=1)){t.state=1;var e=E.bind(null,t),r=function(t){var e=C.bind(null,t),r=new Promise(function(e){return t.onstop=e});return e.then=r.then.bind(r),e.catch=r.catch.bind(r),e.finally=r.finally.bind(r),e}(t);t.execution=new Promise(function(n){return n(t.executor(e,r))}),t.execution.catch(function(){return C(t)})}}var $=new WeakMap,A=function(){function t(t,e){$.set(this,{executor:t,buffer:e,err:void 0,state:0,pushes:[],nexts:[],pending:void 0,execution:void 0,onnext:V,onstop:V})}return t.prototype.next=function(t){U(t);var e=$.get(this);if(void 0===e)throw new Error("WeakMap error");if(e.nexts.length>=1024)throw new x("No more than 1024 pending calls to next are allowed on a single repeater.");if(e.state<=0&&T(e),e.onnext(t),void 0!==e.buffer&&!e.buffer.empty){var r=S(e,e.buffer.remove());if(e.pushes.length){var n=e.pushes.shift();e.buffer.add(n.value),e.onnext=n.resolve}return r}if(e.pushes.length){var i=e.pushes.shift();return e.onnext=i.resolve,S(e,i.value)}return e.state>=2?(B(e),S(e,P(e))):new Promise(function(r){return e.nexts.push({resolve:r,value:t})})},t.prototype.return=function(t){U(t);var e=$.get(this);if(void 0===e)throw new Error("WeakMap error");return B(e),e.execution=Promise.resolve(e.execution).then(function(){return t}),S(e,P(e))},t.prototype.throw=function(t){var e=$.get(this);if(void 0===e)throw new Error("WeakMap error");return e.state<=0||e.state>=2||void 0!==e.buffer&&!e.buffer.empty?(B(e),null==e.err&&(e.err=t),S(e,P(e))):this.next(Promise.reject(t))},t.prototype[Symbol.asyncIterator]=function(){return this},t.race=k,t.merge=L,t.zip=M,t.latest=R,t}();function N(t,e){var r,n,i=[],s=function(t){null!=t&&"function"==typeof t[Symbol.asyncIterator]?i.push(t[Symbol.asyncIterator]()):null!=t&&"function"==typeof t[Symbol.iterator]?i.push(t[Symbol.iterator]()):i.push(function(){return function(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(t,e||[]),s=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(t){i[t]&&(n[t]=function(e){return new Promise(function(r,n){s.push([t,e,r,n])>1||a(t,e)})})}function a(t,e){try{(r=i[t](e)).value instanceof F?Promise.resolve(r.value.v).then(l,h):u(s[0][2],r)}catch(t){u(s[0][3],t)}var r}function l(t){a("next",t)}function h(t){a("throw",t)}function u(t,e){t(e),s.shift(),s.length&&a(s[0][0],s[0][1])}}(this,arguments,function(){return m(this,function(r){switch(r.label){case 0:return e.yieldValues?[4,F(t)]:[3,3];case 1:return[4,r.sent()];case 2:r.sent(),r.label=3;case 3:return e.returnValues?[4,F(t)]:[3,5];case 4:return[2,r.sent()];case 5:return[2]}})})}())};try{for(var o=I(t),a=o.next();!a.done;a=o.next())s(a.value)}catch(t){r={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return i}function k(t){var e=this,r=N(t,{returnValues:!0});return new A(function(t,n){return v(e,void 0,void 0,function(){var e,i,s,o,a,l;return m(this,function(h){switch(h.label){case 0:if(!r.length)return n(),[2];i=!1,n.then(function(){e(),i=!0}),h.label=1;case 1:h.trys.push([1,,5,7]),o=void 0,a=0,l=function(){var i,l,h,u,b,d;return m(this,function(c){switch(c.label){case 0:i=a;try{for(b=void 0,l=I(r),h=l.next();!h.done;h=l.next())u=h.value,Promise.resolve(u.next()).then(function(t){t.done?(n(),void 0===s&&(s=t)):a===i&&(a++,e(t))},function(t){return n(t)})}catch(t){b={error:t}}finally{try{h&&!h.done&&(d=l.return)&&d.call(l)}finally{if(b)throw b.error}}return[4,new Promise(function(t){return e=t})];case 1:return void 0===(o=c.sent())?[3,3]:[4,t(o.value)];case 2:c.sent(),c.label=3;case 3:return[2]}})},h.label=2;case 2:return i?[3,4]:[5,l()];case 3:return h.sent(),[3,2];case 4:return[2,s&&s.value];case 5:return n(),[4,Promise.race(r.map(function(t){return t.return&&t.return()}))];case 6:return h.sent(),[7];case 7:return[2]}})})})}function L(t){var e=this,r=N(t,{yieldValues:!0});return new A(function(t,n){return v(e,void 0,void 0,function(){var e,i,s,o=this;return m(this,function(a){switch(a.label){case 0:if(!r.length)return n(),[2];e=[],i=!1,n.then(function(){var t,r;i=!0;try{for(var n=I(e),s=n.next();!s.done;s=n.next())(0,s.value)()}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}}),a.label=1;case 1:return a.trys.push([1,,3,4]),[4,Promise.all(r.map(function(r,a){return v(o,void 0,void 0,function(){var o;return m(this,function(l){switch(l.label){case 0:l.trys.push([0,,6,9]),l.label=1;case 1:return i?[3,5]:(Promise.resolve(r.next()).then(function(t){return e[a](t)},function(t){return n(t)}),[4,new Promise(function(t){e[a]=t})]);case 2:return void 0===(o=l.sent())?[3,4]:o.done?(s=o,[2]):[4,t(o.value)];case 3:l.sent(),l.label=4;case 4:return[3,1];case 5:return[3,9];case 6:return r.return?[4,r.return()]:[3,8];case 7:l.sent(),l.label=8;case 8:return[7];case 9:return[2]}})})}))];case 2:return a.sent(),[2,s&&s.value];case 3:return n(),[7];case 4:return[2]}})})})}function M(t){var e=this,r=N(t,{returnValues:!0});return new A(function(t,n){return v(e,void 0,void 0,function(){var e,i,s,o;return m(this,function(a){switch(a.label){case 0:if(!r.length)return n(),[2,[]];i=!1,n.then(function(){e(),i=!0}),a.label=1;case 1:a.trys.push([1,,6,8]),a.label=2;case 2:return i?[3,5]:(Promise.all(r.map(function(t){return t.next()})).then(function(t){return e(t)},function(t){return n(t)}),[4,new Promise(function(t){return e=t})]);case 3:return void 0===(s=a.sent())?[2]:(o=s.map(function(t){return t.value}),s.some(function(t){return t.done})?[2,o]:[4,t(o)]);case 4:return a.sent(),[3,2];case 5:return[3,8];case 6:return n(),[4,Promise.all(r.map(function(t){return t.return&&t.return()}))];case 7:return a.sent(),[7];case 8:return[2]}})})})}function R(t){var e=this,r=N(t,{yieldValues:!0,returnValues:!0});return new A(function(t,n){return v(e,void 0,void 0,function(){var e,i,s,o,a,l=this;return m(this,function(h){switch(h.label){case 0:if(!r.length)return n(),[2,[]];i=[],s=!1,n.then(function(){var t,r;e();try{for(var n=I(i),o=n.next();!o.done;o=n.next())(0,o.value)()}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}s=!0}),h.label=1;case 1:return h.trys.push([1,,5,7]),Promise.all(r.map(function(t){return t.next()})).then(function(t){return e(t)},function(t){return n(t)}),[4,new Promise(function(t){return e=t})];case 2:return void 0===(o=h.sent())?[2]:(a=o.map(function(t){return t.value}),o.every(function(t){return t.done})?[2,a]:[4,t(a.slice())]);case 3:return h.sent(),[4,Promise.all(r.map(function(e,r){return v(l,void 0,void 0,function(){var l;return m(this,function(h){switch(h.label){case 0:if(o[r].done)return[2,o[r].value];h.label=1;case 1:return s?[3,4]:(Promise.resolve(e.next()).then(function(t){return i[r](t)},function(t){return n(t)}),[4,new Promise(function(t){return i[r]=t})]);case 2:return void 0===(l=h.sent())?[2,o[r].value]:l.done?[2,l.value]:(a[r]=l.value,[4,t(a.slice())]);case 3:return h.sent(),[3,1];case 4:return[2]}})})}))];case 4:return[2,h.sent()];case 5:return n(),[4,Promise.all(r.map(function(t){return t.return&&t.return()}))];case 6:return h.sent(),[7];case 7:return[2]}})})})}class j{headerClient;header;headerLength;indexLength;nocache;headers;constructor(t,e,r,n,i,s={}){this.headerClient=t,this.header=e,this.headerLength=r,this.indexLength=n,this.nocache=i,this.headers=s}static async open(t,e,r={}){let i,s=new z(t,e,r),o=2024+(()=>{let t,e=0;for(t=0;t<3;t++)e+=16**t*40;return e})();if(!new Uint8Array(await s.getRange(0,8,o,"header")).subarray(0,3).every((t,e)=>a.$[e]===t))throw Error("Not a FlatGeobuf file");if((i=new DataView(await s.getRange(8,4,o,"header")).getUint32(0,!0))>10485760||i<8)throw Error("Invalid header size");let l=await s.getRange(a.$.length,a.b+i,o,"header"),h=c(new n.$F(new Uint8Array(l)));if(0===h.indexNodeSize)throw Error("No index found, cannot read features filtered by bbox");let u=_(h.featuresCount,h.indexNodeSize);return new j(s,h,i,u,e,r)}async*selectBbox(t){let e=this.lengthBeforeTree(),r=this.headerClient,n=async(t,n)=>r.getRange(e+t,n,0,"index"),i=[],s=[];for await(let e of p(this.header.featuresCount,this.header.indexNodeSize,t,n)){let[t,r]=e,[,,n]=e;if(n||(n=4),0===s.length){s.push([t,n,r]);continue}let o=s[s.length-1];t-(o[0]+o[1])>f.global.extraRequestThreshold()&&(i.push(s),s=[]),s.push([t,n,r])}this.headerClient.logUsage("header+index"),s.length>0&&i.push(s);let o=i.flatMap(t=>this.readFeatureBatch(t,this.nocache));yield*A.merge(o)}lengthBeforeTree(){return a.$.length+a.b+this.headerLength}lengthBeforeFeatures(){return this.lengthBeforeTree()+this.indexLength}buildFeatureClient(t){return new z(this.headerClient.httpClient,t,this.headers)}async*readFeatureBatch(t,e){let[r]=t[0],[n,i]=t[t.length-1],s=this.buildFeatureClient(e),o=n+i-r;for(let[e,,r]of t){let t=await this.readFeature(s,e,o);yield{id:r,feature:t},o=0}s.logUsage("feature")}async readFeature(t,e,r){let i,s=e+this.lengthBeforeFeatures();i=new DataView(await t.getRange(s,4,r,"feature length")).getUint32(0,!0);let o=new Uint8Array(await t.getRange(s+4,i,r,"feature data")),h=new Uint8Array(i+a.b);h.set(o,a.b);let u=new n.$F(h);return l.X.getSizePrefixedRootAsFeature(u)}}class z{httpClient;bytesEverUsed=0;bytesEverFetched=0;buffer=new ArrayBuffer(0);head=0;constructor(t,e,r={}){if("string"==typeof t)this.httpClient=new q(t,e,r);else{if(!(t instanceof q))throw Error("Unknown source");this.httpClient=t}}async getRange(t,e,r,n){this.bytesEverUsed+=e;let i=t-this.head,s=i+e;if(i>=0&&s<=this.buffer.byteLength)return this.buffer.slice(i,s);let o=Math.max(e,r);return this.bytesEverFetched+=o,this.buffer=await this.httpClient.getRange(t,o,n),this.head=t,this.buffer.slice(0,e)}logUsage(t){t.split(" ")[0],(100*this.bytesEverUsed/this.bytesEverFetched).toFixed(2)}}class q{url;nocache;headers;requestsEverMade=0;bytesEverRequested=0;constructor(t,e,r={}){this.url=t,this.nocache=e,this.headers=r}async getRange(t,e,r){this.requestsEverMade+=1,this.bytesEverRequested+=e;let n=`bytes=${t}-${t+e-1}`,i=new Headers(this.headers);i.set("Range",n),this.nocache&&i.set("Cache-Control","no-cache, no-store");let s=await fetch(this.url,{headers:i});return await s.arrayBuffer()}}var G=r(638658),X=r(182862),D=r(554867);function H(t){var e;let r,n,i,s=(n=(r=(e=t)[0]).getProperties?r.getProperties():{},i=null,n&&(i=Object.keys(n).filter(t=>"geometry"!==t).map(t=>tt(n,t))),{geometryType:(0,D.b)(e),columns:i,envelope:null,featuresCount:e.length,indexNodeSize:0,crs:null,title:null,description:null,metadata:null}),o=K(s),l=t.map(t=>{if(!t.getGeometry)throw Error("Missing getGeometry implementation");if(!t.getProperties)throw Error("Missing getProperties implementation");return(0,G.lV)((0,X.Ap)(t.getGeometry(),s.geometryType),t.getProperties(),s)}),h=l.map(t=>t.length).reduce((t,e)=>t+e),u=new Uint8Array(a.$.length+o.length+h);u.set(o,a.$.length);let b=a.$.length+o.length;for(let t of l)u.set(t,b),b+=t.length;return u.set(a.$),u}async function*Y(t,e,r,i){if(!t.subarray(0,3).every((t,e)=>a.$[e]===t))throw Error("Not a FlatGeobuf file");if(r){let n=y.open(t);for await(let t of n.selectBbox(r))yield e(t.id,t.feature,n.header);return}let s=new n.$F(t),o=s.readUint32(a.$.length);s.setPosition(a.$.length);let h=c(s);i&&i(h);let u=a.$.length+a.b+o,{indexNodeSize:b,featuresCount:d}=h;b>0&&(u+=_(d,b));let f=0;for(;u<s.capacity();){let t=s.readUint32(u);s.setPosition(u);let r=l.X.getSizePrefixedRootAsFeature(s);yield e(f++,r,h),u+=a.b+t}}async function*Z(t,e,r){let i,s="function"==typeof(u=t).slice?u:new o("function"==typeof u.read?u:u.getReader()),l=async t=>await s.slice(t),h=new Uint8Array(await l(8));var u;if(!h.subarray(0,3).every((t,e)=>a.$[e]===t))throw Error("Not a FlatGeobuf file");let b=new Uint8Array(await l(4)),d=new n.$F(b),f=d.readUint32(0),p=new Uint8Array(await l(f));(h=new Uint8Array(b.length+p.length)).set(b),h.set(p,b.length);let y=c(d=new n.$F(h));r&&r(y);let{indexNodeSize:g,featuresCount:w}=y;if(g>0){let t=_(w,g);await l(t)}let v=0;for(;i=await J(l,y,e,v++);)yield i}async function*W(t,e,r,n,i=!1,s={}){let o=await j.open(t,i,s);for await(let t of(n&&n(o.header),o.selectBbox(e)))yield r(t.id,t.feature,o.header)}async function J(t,e,r,i){let s=new Uint8Array(await t(4,"feature length"));if(0===s.byteLength)return;let o=new n.$F(s),a=o.readUint32(0);s=new Uint8Array(await t(a,"feature data"));let h=new Uint8Array(a+4);return h.set(s,4),o=new n.$F(h),r(i,l.X.getSizePrefixedRootAsFeature(o),e)}function K(t,e=0){let r,i=new n.M$,s=0;t.columns&&(s=d.createColumnsVector(i,t.columns.map(t=>{let e;return e=i.createString(t.name),h.V.startColumn(i),h.V.addName(i,e),h.V.addType(i,t.type),h.V.endColumn(i)})));let o=i.createString("L1");e&&(u.startCrs(i),u.addCode(i,e),r=u.endCrs(i)),d.startHeader(i),r&&d.addCrs(i,r),d.addFeaturesCount(i,BigInt(t.featuresCount)),d.addGeometryType(i,t.geometryType),d.addIndexNodeSize(i,0),s&&d.addColumns(i,s),d.addName(i,o);let a=d.endHeader(i);return i.finishSizePrefixed(a),i.asUint8Array()}async function Q(t,e=!1,r={}){let i=new q(t,e,r),s=new Uint8Array(await i.getRange(0,2024,"read metadata"));if(!s.subarray(0,3).every((t,e)=>a.$[e]===t))throw Error("Not a FlatGeobuf file");let o=new n.$F(s);return o.setPosition(a.$.length),c(o)}function tt(t,e){return{name:e,type:function(t){if("boolean"==typeof t)return g.$.Bool;if("number"==typeof t)return g.$.Double;if("string"==typeof t||null===t)return g.$.String;if(t instanceof Uint8Array)return g.$.Binary;if("object"==typeof t)return g.$.Json;throw Error(`Unknown type (value '${t}')`)}(t[e]),title:null,description:null,width:-1,precision:-1,scale:-1,nullable:!0,unique:!1,primary_key:!1}}},924787(t,e,r){r.d(e,{$:()=>n,b:()=>i});const n=new Uint8Array([102,103,98,3,102,103,98,0]),i=4},982196(t,e,r){var n;r.d(e,{$:()=>i});var i=((n={})[n.Byte=0]="Byte",n[n.UByte=1]="UByte",n[n.Bool=2]="Bool",n[n.Short=3]="Short",n[n.UShort=4]="UShort",n[n.Int=5]="Int",n[n.UInt=6]="UInt",n[n.Long=7]="Long",n[n.ULong=8]="ULong",n[n.Float=9]="Float",n[n.Double=10]="Double",n[n.String=11]="String",n[n.Json=12]="Json",n[n.DateTime=13]="DateTime",n[n.Binary=14]="Binary",n)}}]);