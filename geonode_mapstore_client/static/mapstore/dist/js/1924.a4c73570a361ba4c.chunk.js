"use strict";(self.webpackChunkgeonode_mapstore_client=self.webpackChunkgeonode_mapstore_client||[]).push([[1924],{131924:(e,t,r)=>{r.r(t),r.d(t,{default:()=>_});var n=r(273517),o=r.n(n),i=r(475223),a=r(358132),l=r(444003),c=r(839545),u=r(68982),s=r(6683),f=r(697422),d=r(86881),p=r(433235),y=r(41476),m=r(149785),v=r(866875);function b(e){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},b(e)}function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach(function(t){O(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function O(e,t,r){return(t=function(e){var t=function(e){if("object"!=b(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=b(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==b(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function w(e,t){return w=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},w(e,t)}function E(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(E=function(){return!!e})()}function S(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,a,l=[],c=!0,u=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw o}}return l}}(e,t)||A(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(e,t){if(e){if("string"==typeof e)return j(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?j(e,t):void 0}}function j(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var P=(0,a.A)(i.A);P.displayName="Map";var I={gltf:function(e){var t=e.feature,r=e.url;return Promise.resolve({type:"vector",visibility:!0,features:[t],style:{format:"geostyler",body:{name:"",rules:[{name:"",symbolizers:[{kind:"Model",model:r}]}]}}})},ifc:function(e){var t=e.feature,r=e.url;return(0,u.Fu)(r).then(function(e){return{type:"model",visibility:!0,url:r,features:[t],capabilities:e}})}},k={gltf:function(e){var t=e.map,r=e.setLoading;return(0,n.useEffect)(function(){t.scene.globe.depthTestAgainstTerrain=!1,t.scene.screenSpaceCameraController.enableCollisionDetection=!1;var e=t.dataSources.get(0),n=function(){e.entities.values[0]&&(t.flyTo(e.entities.values[0],{duration:0}),r(!1))};return e.entities.collectionChanged.addEventListener(n),function(){e.entities.collectionChanged.removeEventListener(n)}},[]),null},ifc:function(e){var t=e.map,r=e.setLoading,i=e.container,a=e.center,l=e.layer,c=S((0,n.useState)({}),2),u=c[0],v=c[1],b=null==i?void 0:i.getBoundingClientRect();return(0,n.useEffect)(function(){var e,n=(((null==l?void 0:l.capabilities)||{}).properties||{}).size,o=void 0===n?[100,100,100]:n,i=S((null==a||null===(e=a.geometry)||void 0===e?void 0:e.coordinates)||[0,0],2),c=i[0],u=i[1],d=f.A.fromDegrees((c||0)-o[0]/2/s.Ig.degrees,(u||0)-o[1]/2/s.Ig.degrees,(c||0)+o[0]/2/s.Ig.degrees,(u||0)+o[1]/2/s.Ig.degrees);t.camera.setView({destination:d}),r(!1)},[l]),(0,n.useEffect)(function(){var e,r=new d.A(t.scene.canvas);return r.setInputAction(function(r){var n,o=t.scene.pick(r.endPosition);v({}),e&&(e.primitive.getGeometryInstanceAttributes(e.id).color=p.A.toValue(function(e,t,r){if(E())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,t);var o=new(e.bind.apply(e,n));return r&&w(o,r.prototype),o}(y.A,function(e){if(Array.isArray(e))return j(e)}(n=e.color)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(n)||A(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())),e=void 0,t.scene.requestRender());var i=o||{},a=i.primitive,l=i.id;if(a&&a._msGetFeatureById){var c,u=a.getGeometryInstanceAttributes(l);e={id:l,color:[u.color[0]/255,u.color[1]/255,u.color[2]/255,u.color[3]/255],primitive:a},u.color=p.A.toValue(y.A.RED),t.scene.requestRender();var s=a._msGetFeatureById(l);v({x:r.endPosition.x,y:r.endPosition.y,properties:null==s||null===(c=s.feature)||void 0===c?void 0:c.properties})}},m.A.MOUSE_MOVE),function(){r.destroy()}},[]),null!=u&&u.properties?o().createElement("div",{className:"shadow gn-media-scene-3d-info gn-details-info-fields",style:h({position:"absolute",zIndex:10,padding:"0.25rem",pointerEvents:"none",maxWidth:3*b.width/2,wordBreak:"break-word",transition:"0.3s all",minWidth:300,userSelect:"none"},function(){if(b.width<768||b.height<768)return{left:0,top:0,transform:"translateX(1rem) translateY(1rem)"};var e=null==u?void 0:u.x,t=null==u?void 0:u.y,r=e>b.width/2?"translateX(calc(-100% - 1rem))":"translateX(1rem)",n=t>b.height/2?"translateY(calc(-100% - 1rem))":"translateY(1rem)";return{left:e,top:t,transform:"".concat(r," ").concat(n)}}())},o().createElement("div",{className:"gn-media-scene-3d-info-bg",style:{opacity:.85,position:"absolute",top:0,left:0,width:"100%",height:"100%"}}),Object.keys(u.properties).map(function(e){return o().createElement("div",{key:e,className:"gn-details-info-row"},o().createElement("div",{className:"gn-details-info-label",style:{width:(t=Object.keys(u.properties||{}).reduce(function(e,t){return e.length>t.length?e:t}),t.length?"".concat(.5*t.length,"rem"):"auto")}},e),o().createElement("div",{className:"gn-details-info-value",style:{maxWidth:"none"}},u.properties[e]));var t})):null}};const _=function(e){var t=e.src,r=e.mediaType,i=e.bboxPolygon,a=(0,n.useRef)(),u=S((0,n.useState)(!0),2),s=u[0],f=u[1],d=S((0,n.useState)(null),2),p=d[0],y=d[1],m=i?(0,c.A)(i):{type:"Feature",geometry:{type:"Point",coordinates:[0,0]},properties:{}},b=k[r];return(0,n.useEffect)(function(){I[r]&&I[r]({url:t,feature:m}).then(function(e){y(e)})},[r]),o().createElement("div",{ref:a,className:"gn-media-scene-3d"},p?o().createElement(P,{id:"gn-media-scene-3d-map",mapType:l.Av.CESIUM,map:{registerHooks:!1,projection:"EPSG:4326"},styleMap:{position:"absolute",width:"100%",height:"100%"},eventHandlers:{},layers:[p]},o().createElement(b,{src:t,center:m,container:a.current,setLoading:f,layer:p})):null,s?o().createElement(v.A,null):null)}}}]);